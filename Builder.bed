//*******************************************************************************************************************
//* Program   : Builder.BED                                           
//* Author    : Forrest Bentley                                       
//* Date      : 11/15/2013                                            
//* Desc      : This BEDITWIN program will allow the design and       
//*             execution of new BEDITWIN systems and windows.         
//*             When the screens have been layed out for a system and 
//*             button navigation has been set to open/close windows 
//*             you can View the window flow visually. This is a very 
//*             powerful feature to review the screen flow. The COBOL
//*             Viewer uses this feature to allow analysis of program 
//*             paragraph call flow which could be useful to learn
//*             a COBOL program.                                     
//*                                                                   
//* Builder Files Descriptions 
//* --------------------------------------------
//* 
//* BuilderWindowFile: .WIN file - List of all Windows and Controls on Windows
//* 	WINDOW,WindowName,x,y,cx,cy,Title
//* 	ControlType,ControlName,x,y,cx,cy,Text
//* 
//*         Control                 Control Type
//*         ---------------------   ------------
//*         Push Button 	    PBOBJ1
//* 	    Entry Field 	    EFOBJL
//* 	    Text 		    STTXT1
//* 	    Check Box 		    CBOBJ1
//* 	    Group Box 		    GBOBJ1
//* 	    List Box 		    LBOBJ1
//* 	    Radio Button 	    RBOBJ1
//* 	    Combo Box 		    COOBJS
//* 	    Drop Down List 	    COOBJL
//* 	    Multi-Line Entry 	    MLOBJ1
//* 	    Rectangle 		    STTXTF
//* 	    Box 		    STTXTR
//* 
//* WindowList: Temp List of Windows in the System
//* 	Window Name (without Naming Convention: e.g. Window1 not System_Window1_WIN)
//* 	e.g. Window1
//*              Window2	
//* 
//* WindowNav: .NAV File - Window Button Navigation
//* 	Button Name,Window Name (without Naming Convention: e.g. Window1 not System_Window1_WIN),Action (Open,Close,None)
//*         e.g. Test_Win1_Window2_PBOBJ,Win2,open
//*              Test_Win1_Cancel_PBOBJ,Win1,close
//* 
//* Controls: Temp file containing a list of Controls on a Window
//* 	ControlName,ControlType,Text
//* 	e.g. Test_Win1_Cancel_PBOBJ,PBOBJ1,&Cancel
//* 	
//* GenCode: .BED file - All BEDITWIN logic for the system
//* 
//* ButtonProc: Temp file that holds the .BED Menu & Button Processing for pasting after Vars Created
//* 	.BED Menu/Button Code
//* 
//* MenuNav: .MNU File - Menu Navigation
//* 	TITLE,System Title
//* 	MENU,Menu Text
//* 	ITEM,Menu Selection Text,Window Name to Open
//* 	------- (Menu Separator)
//* 
//* 	e.g. TITLE,Testing 123
//* 	     MENU,~Test
//* 	     ITEM,Test_Win1_MSOBJ,Test_Win1_WIN
//* 	     --------------------
//* 	     ITEM,Test_Main_Exit_MSOBJ,E~xit
//* 
//* Master: .MST File - System Information
//* 	Line1 = System Window Title
//* 	Line2 = System Description
//* 
//* SystemList: Temp List of all .WIN files in directory used in System Window for show Systems to modify
//* 	WindowName
//* 	e.g. Win1
//* 
//* ViewListWork: Temp list of all Windows in the system, used in view
//* 	e.g. Win1
//* 
//* ViewListAdd: Temp copy of ViewList for Filtering (identical to ViewList)
//* 
//* ViewList: Temp list of all Windows in the system with appropriate level numbers
//*     	Level-n,WindowName
//* 	e.g. Level-1,Win1
//* ViewObjects: Temp list of objects on the View screen to be deleted when Cancel is pushed
//* 	WindowName-n
//* 	e.g. Win1-1
//* ViewPositions: Temp list of objects with their positions
//* 	WindowName,Level,x,y,cx,cy
//* 	e.g. Win1,1,109,56,102,74
//* 
//* ViewFilterList: Temp list of Names of Windows
//* 	WindowFullName,ViewDisplayName,WindowListName
//* 	e.g. Builder_Filter_WIN,Filter Window,Filter
//* 
//* Entryaction: .ACT list of Entry Fields and their actions
//* 	EntryFieldName,Action,size
//*              Action = text
//*                       alpha
//*                       numeric
//*                       upper
//*                       lower
//*                       mix
//*                       date
//*                       dollar
//*                       telephone
//*                 Note: Action with a concatinated -P designates a password field
//*                      
//*              
//* 	e.g. Builder_Entry_Size_EFOBJ,numeric,5
//*          TestSystem_Authorization_Password_EFOBO,text-P,10
//* 
//*******************************************************************************************************************
//*                                    C H A N G E        L O G
//*
//*    Date     Author           Description
//* ----------  ---------------  ------------------------------------------------------------------------------------
//* 11/15/2013  Forrest Bentley  Created Program
//* 11/27/2013  Forrest Bentley  View Program Flow Draw Rendering Left/Right Cols
//*                              Eliminate Gaps in Flow Rendering
//*                              Entry Field Edits
//*                              Test button generates code
//* 11/28/2013  Forrest Bentley  Excessive Windows warning
//*                              Program Flow for B-Edit programs
//* 11/29/2013  Forrest Bentley  ViewFilterList sorting
//*                              Fixed View Program Flow "Push down" logic
//*                              Code Check link
//* 11/30/2013  Forrest Bentley  Start Systems bat files
//* 12/02/2013  Forrest Bentley  Added Filter Comments button
//* 12/03/2013  Forrest Bentley  Created Progress Bar processing
//* 12/05/2013  Forrest Bentley  Added Banner processing
//*                              Added Game of Life link
//* 12/07/2013  Forrest Bentley  Added Button Action button
//* 12/07/2013  Forrest Bentley  Added Program Comments button to view
//* 12/08/2013  Forrest Bentley  Added Group Objects Allignment
//* 12/11/2013  Forrest Bentley  Added Search Strings window
//* 12/27/2013  Forrest Bentley  Added functionality to move a selected group using the size/pos arrows
//* 12/28/2013  Forrest Bentley  Changed the About Message Box to a proper About screen
//* 12/30/2013  Forrest Bentley  Added Browse Buttons on File Entry screens
//* 12/31/2013  Forrest Bentley  Fixed B-Edit code generation logic so there isn't text in the win file for EFOBJ, LBOBJ, COOBJ, STTXTR, STTXTB
//* 01/05/2014  Forrest Bentley  Entry Action Focus
//* 01/07/2014  Forrest Bentley  Added Download 3090 COPIES, and inserting when scanning COBOL code.
//* 01/09/2014  Forrest Bentley  Fixed View Program Flow to properly handle prefixes in modules to be filtered/viewed
//* 01/10/2014  Forrest Bentley  Overhauled the Browse window to be more useful (directories and files list boxes)
//* 01/11/2014  Forrest Bentley  Integration with 3090 Code Checker
//*                              Cleanup in 3090 Code Checker (No comment line error checks, GOTO non-EXIT, GOTO not same paragraph prefix
//*                              Preserve Directory on all screens
//* 01/12/2014  Forrest Bentley  Code Checker Integration
//* 01/14/2014  Forrest Bentley  Added View button to View Program Flow Filter screen to view module code
//* 01/15/2014  Forrest Bentley  Added Menu Selections:
//*                                    GE Fleet
//*                                        Bachman on Net, Bachman Visual, IT Knowledge Gateway, MFO2 Architecture
//*                                    Misc
//*                                        IT Tutorials
//*                              View Button cleanup
//* 01/16/2014  Forrest Bentley  Added Java Source processing to view (fixes pending)
//* 01/17/2014  Forrest Bentley  Added logic to change the filter list title dynamically (Functions, Classes, Modules, Paragraphs)
//*                              Fixed Java View to include all Class Usage (call class.function)
//* 01/19/2014  Forrest Bentley  Added Code Selection Screen & Initial Logic
//* 01/20/2014  Forrest Bentley  Added module breakout logic for Code button
//* 01/21/2014  Forrest Bentley  Added GE Documentation/BPM menu selection
//* 01/23/2014  Forrest Bentley  Added Code modification ability
//*                              Error if trying to create an existing system
//* 01/24/2014  Forrest Bentley  Allow directories with space in name in Directory Window
//*                              Add Extension to Search window
//*                              code Assist
//*                              Added Code Assist preload commands (file processing, windows)
//* 01/26/2014  Forrest Bentley  Added Undo to Code Assist
//*                              Changed Code Assist list boxes to Code, Commands, Variables
//* 01/27/2014  Forrest Bentley  Added Assists *Directory Button
//* 01/28/2014  Forrest Bentley  Added logic to automatically create close code for buttons created
//*                              Added Assist *Directory List
//*                              Added Assist *Clear List
//* 01/29/2014  Forrest Bentley  Added Code Assist IF styles
//* 01/31/2014  Forrest Bentley  Added Assist for B-Edit Batch code menu & initial processing
//* 02/01/2014  Forrest Bentley  Added Assist for B-Edit Batch logic
//* 02/02/2014  Forrest Bentley  Corrected Assist Bug
//*                              Added *Directory List for Bedit Assist
//*                              Corrected missing 1st char of name for View of called .bed file
//*                              Added logic to generate shell for any module created on the Assist window that doesn't exist
//*                              Create variables in the Assist variable list if a new variable is created using add/modify
//* 02/03/2014  Forrest Bentley  Enhanced a1900_add_indent
//*                              Added Code, Refresh, Test, Log, and View buttons to the Code Assist window
//*                              Added Global Variables to Assist Var List
//*                              Update Assist window with Code name above code list
//* 02/04/2014  Forrest Bentley  Added begin/end prints for B-Edit batch programs
//*                              Modified 3090 Download to filter by pattern
//*                              Added View Files
//* 02/05/2014  Forrest Bentley  Added Progress bar to Variable View
//*                              Sorted the filter list for File and Variable views
//*                              Removed the Comments and View buttons from the Filter window for File and Variable views
//*                              Corrected paste bug by adding 'clear' before every copy
//*                              Corrected bug in !v500_draw_view MacroCommand = |window createcontrol, changed to use ^ for subs before MacroCommand
//* 02/05/2014  Forrest Bentley  Added Error Log Processing in Assist (loads error module & lighlights error line)
//* 02/06/2014  Forrest Bentley  Added Debug Message
//*                              Corrected date/time output for generated B-Edit programs
//*                              Auto-select 1st module on Code window
//*                              Separated Variables and Modules on the Assist window
//*                              Initial Code for Debug Step Through Code
//* 02/07/2014  Forrest Bentley  Debug Processing - Step, Go, Breakpoint Setting
//*                              Breakpoint Set View, Delete Breakpoint
//*                              Debug Variables
//* 02/08/2014  Forrest Bentley  Improved Debug Variable display
//*                              Changed DebugBreakChar
//*                              Added '*Pad Left' multi-command
//*                              Added 'X' clear Breaks, Find button
//*                              Added code to hide windows when beginning debug, and show them when stop is pressed
//*                              Debug for Beditwin, setfocus on Assist window when break
//*                              Added Find/Replace window
//* 02/09/2014  Forrest Bentley  Added Replace/Replace All
//*                              Added Step Over
//* 02/10/2014  Forrest Bentley  Added logic for Setting Multiple Break-Points
//* 02/12/2014  Forrest Bentley  Retain selected variable when debugging
//*                              Corrected module names with trailing space bug
//*                              Corrected losing lines of code if they equal the last line of code
//*                              Window paint after all clear of list boxes to correct list box scroll bar missing bug
//*                              Added Debug File Viewing
//* 02/13/2014  Forrest Bentley  Double-click Code while debugging toggles breakpoint
//*                              Select 1st file in debug file list (current file)
//*                              Show line position in debug file view
//*                              Added Debug Help Screen
//*                              Corrected generate code field size too large bug
//*                              Select 1st line of code when the code list is refreshed
//*                              Retain selected line after breakpoint is removed
//*                              Added Conditional Breakpoints
//*                              Corrected file/open not first on line for debug variables and file view
//* 02/14/2014  Forrest Bentley  Corrected bug of not finding file/open properly in an IF (line starts with '+')
//*                              Corrected bug of setting breakpoint when not in BeditDebug mode
//*                              Added system variables to Builder_Debugcond_Vars_LBOBJ
//*                              Added Conditional Debugging for TRUE, FALSE, Contains
//*                              Retain DebugConditionsFile until a Debug Go or Step button is pressed to used the data
//*                              Added Open to System window
//* 02/15/2014  Forrest Bentley  Added Debug ABORT processing
//*                              System - Modify button for Windows, Assist button for Batch
//*                              Added Edit Code button to Assist window to jump back to edit full file properly
//*                              Skip Builder_Code_WIN for Batch
//*                              Added Debug button to Window Maintenance to allow debugging Windows programs - Automatically calls Assist Debug
//*                              Center selected line in Assist Code and Variables LBOBJs
//* 02/16/2014  Forrest Bentley  Don't refresh the Assist Code list when debugging and the module hasn't changed
//*                              Fixed Opening a window that's already open bug
//*                              Fixed remove second blank line bug
//*                              Fixed Assist Debug Enter key trying to run Add button code
//*                              Fixed Entry Field Edits bug setting button actions
//*                              Fixed MLOBJ enter pressed bug including return in text
//*                              Fixed bell when enter pressed in entry fields
//* 02/17/2014  Forrest Bentley  Debug Called Program (initial coding)
//*                              Retain Condition Breaks until break occurs
//* 02/19/2014  Forrest Bentley  Added DEBUGHWND to close BEDITWIN program running in debug when STOP pressed
//*                              Fixed bug for ++ debug breakpoints set
//* 02/20/2014  Forrest Bentley  Fixed occassional lockup when pressing STOP to shup down a debug BEDITWIN program
//*                              Added HWND:MainHWND to BEDITSEM.STP passed by bedit4pm.c as soon as the main window is created
//*                              Show only .bed files without matching .win files in Batch Development Program list
//*                              Show only .win files with matching .bed files in the Windows Development System list
//*                              Added logic to show if the debug program is running (update the Debug Group Box)
//* 02/22/2014  Forrest Bentley  Added Alignment Distribute Vertically and Horizontally
//* 02/24/2014  Forrest Bentley  Added Backup/Undo to Control Maintenance window
//* 02/25/2014  Forrest Bentley  Fixed bug removing breakpoint
//*                              Fixed bug refresh after all breakpoints removed
//* 02/26/2014  Forrest Bentley  Grey background for Window Control Maintenance screen
//*                              Added Language button to Window Control Maintenance screen - call to BuilderLang.bed
//* 02/27/2014  Forrest Bentley  Added Banneron/Banneroff to Generated Windows Code
//*                              Force Controls window to defaul Sizing button to "Size Window" (means Size Controls)
//*                              Added 10 backups for Controls window Undo
//* 03/02/2014  Forrest Bentledy Reduced size of Controls window to allow for language interface at the bottom
//*                              Changed Assist window to open without centering
//*                              Open the Language window at startup
//*                              Run the LanguageReturn if not null after calling BuilderLang.bed
//* 03/05/2014  Forrest Bentley  Fixed Language Interface sizing on all monitors
//*                              Main Window sized with Language Interface
//* 03/06/2014  Forrest Bentley  Banner positioning Desktop/Laptop
//*                              Center Assist
//*                              Added Language Create Batch System
//*                              Added Language Create Windows System
//*                              Added Language Create Window
//* 03/07/2014  Forrest Bentley  Added Language change batch/windows system
//*                              Added Language change window
//*                              Added Language Close All
//* 03/11/2014  Forrest Bentley  Added Task Tracking
//* 03/13/2014  Forrest Bentley  Added logic to close already opened TaskTrack before re-opening
//*                              Added Delayed Command to allow time to close TaskTrack before starting a new instance
//* 03/14/2014  Forrest Bentley  Fixed 1st time entry startup of TaskTracker lockup bug (1st time no closewindowname
//* 03/15/2014  Forrest Bentley  Changed version to 2.1
//*                              Removed unneccessary .bat files (start directly)
//* 03/16/2014  Forrest Bentley  Changed to not close TaskManager before staring (bug starting if closing)
//* 04/04/2014  Forrest Bentley  Added Debug to Windows Maintenance screen
//* 04/23/2014  Forrest Bentley  Added POM Dependency Viewing
//* 04/24/2014  Forrest Bentley  Changed view to include more characters of name
//*                              Changed POM Viewer to use 100 and 500 as prefixes
//* 05/07/2014  Forrest Bentley  Updated !v550_window_title with finer title character limitations
//* 05/14/2014  Forrest Bentley  Changed 3090 download to continue if user answers 'no' to delete all files question.
//* 06/10/2014  Forrest Bentley  Added Continuous Delivery Links
//* 06/18/2014  Forrest Bentley  Added NOLA
//* 06/30/2014  Forrest Bentley  Added Bubble help to View screens to see full function names
//* 07/01/2014  Forrest Bentley  Added Bubble help for view lines
//* 07/02/2014  Forrest Bentley  Added Governance menu selection
//*                              Added Webex menu selection
//* 08/16/2014  Forrest Bentley  Added GECA Technology
//* 08/25/2014  Forrest Bentley  Changed view to painting color boxes
//* 08/26/2014  Forrest Bentley  Added click in view to filter clicked box
//* 08/27/2014  Forrest Bentley  Default Text in View
//* 08/28/2014  Forrest Bentley  Left-click on view in open area=>no filter, right-click on view in open area=>open file
//* 10/02/2014  Forrest Bentley  Added Earth Image to main screen
//* 10/03/2014  Forrest Bentley  Corrected filter problem after using the click filter features
//*                              Initial work on PaintFile objects (PaintFile @System@.pnt)
//* 10/06/2014  Forrest Bentley  Added PaintFile modify (for Box3D)
//* 10/07/2014  Forrest Bentley  Fixed PaintFile for Box3D (Create, Set Focus, Modify, Delete, Size/Pos, Radios on/off
//*                              Changed default create object size to 100 by 20
//*                              Added Ellipse, Ellipse3D, Circle, Diamond
//*                              Set PaintFile object colors
//* 10/08/2014  Forrest Bentley  Added Standard Paint selection Window processing
//*                              Started Line and Arrow
//* 10/09/2014  Forrest Bentley  Finished Line and Arrow
//*                              Added Box for PaintFile
//*                              Added Text and TextTilt
//* 10/10/2014  Forrest Bentley  Added font selection for text fields
//*                              Finalized Font Text and TextTilt
//* 10/13/2014  Forrest Bentley  Added Bitmaps to Controls screen
//*                              Initial PaintFile Save and Modify code
//* 10/14/2014  Forrest Bentley  Finished PaintFile Save/Modify
//*                              Misc cleanup
//*                              Added PaintFile object actions
//* 10/15/2014  Forrest Bentley  Allow BitmapFit and Text click actions
//* 10/16/2014  Forrest Bentley  Added a font label
//*                              Clear the CurrFile field when creating a Bitmap so there's no imaging showing when choosing
//*                              Fixed generated code for click areas for Ellipse, Ellipse3D, Circle, and Diamond
//*                              Removed button actions for Tilted Text
//*                              Drag Group PaintFile Objects
//* 10/17/2014  Forrest Bentley  Fixed GroupRectangle GroupControls file capturing Circle, Ellipse, Ellipse3D, and Diamond properly
//*                              Added PaintFile object alignment
//* 10/20/2014  Forrest Bentley  Focus on PaintFile Object by clicking
//* 10/21/2014  Forrest Bentley  Fixed alignment for Circle,Ellipse,Ellipse3d,Diamond
//* 10/22/2014  Forrest Bentley  Added logic to change the color of a PaintFile object when pressing down
//* 10/23/2014  Forrest Bentley  Added logic to use the Size radio button to change the size of an object on the screen when dragging
//*                              Added PaintFile objects backup and restore
//* 10/24/2014  Forrest Bentley  Switched COntrol Size/Pos radio buttons, default to Pos
//*                              Update Length/Height when drag sizing an object
//*                              Added move object to Top/Bottom
//*                              Added Copy an Object
//* 10/27/2014  Forrest Bentley  Improved button positions on Control window
//*                              Added code to convert JPG, JPEG, WBMP, PNG, GIF to BMP for creating Bitmap and BitmapFit objects on the Controls window
//*                                    Note: The images will be converted to BMP in the home directory where Builder was launched.
//*                                          Using James Ratzlaff's Java ImageConverter.jar
//*                              Fixed bug not enabling the Align button if there are only PaintFile objects
//*                              Fixed bug when focus is set to text not able to move up/down using +- buttons
//* 10/28/2014  Forrest Bentley  Added logic to prevent saving/backup/restore GroupRectangle
//*                              Fixed GroupRectangle movement using +- buttons
//* 10/29/2014  Forrest Bentley  Turn off Bitmap button/entry field when creating/focusing on non-bitmap object
//*                              Allow object to be sized upsidedown/reversed (see !a100_windowmouse_drag_paintfile_size)
//*                              Fixed drag sizing controls to full size of screen
//* 10/30/2014  Forrest Bentley  Changed "Make Copy" to "Duplicate"
//*                              Added Copy/Paste
//* 10/31/2014  Forrest Bentley  Added Copy logic (Josh and Rachel's Wedding Today!)
//* 11/01/2014  Forrest Bentley  Added Paste logic
//*                              Corrected bug of not removing all PaintFile objects when modifying a window
//*                              Fixed draging size of an object to be smaller than the current x/y mouse position to improve button sizing
//*                              Added Delete group of objects
//* 11/03/2014  Forrest Bentley  Place GroupRectangle around Pasted objects
//*                              Change colors of all GroupRectangle objects
//* 11/04/2014  Forrest Bentley  Optionally refresh the code when Generating or Testing
//*                              Generate code no PaintFile object color change if no action is set on that object
//* 11/06/2014  Forrest Bentley  Corrected save/modify PaintFile object positions
//*                              Added F2 to repeat language command
//*                              Added F3/F4 to cycle through language command text
//* 11/07/2014  Forrest Bentley  Fixed delete button removing object from combo box list
//* 11/11/2014  Forrest Bentley  Added Connector logic
//* 11/14/2014  Forrest Bentley  Changed draw space to cover entire window
//* 11/15/2014  Forrest Bentley  *************************************************
//*                              ****  1 Year Anniversary of beginning Builder  ****
//*                              *************************************************
//*                              Dynamic positioning of Font/Bitmap labels
//*                              Repaint connectors for non-PaintFile objects when dragging
//*                              Size GroupRectangle objects
//* 11/16/2014  Forrest Bentley  Size Window after Paste
//* 11/17/2014  Forrest Bentley  Don't restrict object movement to the current window size
//*                              Added F5 to Size the Window
//*                              Fixed abort bug when dragging object on desktop
//*                              Create Text field along with PaintFile objects if Text entered
//* 11/19/2014  Forrest Bentley  Fixed Align Mid-Vert
//*                              Added GroupRectangle when creating PaintFile objects with text to allow drag of both objects immediately after creation
//*                              Changed Font label text to Font push button to allow applying of chosen font
//* 11/21/2014  Forrest Bentley  Added window list and Go to Control window
//* 11/24/2014  Forrest Bentley  Improved button position on Control window
//*                              Added /=Straight Connector L=Bent Connector, X=Disconnect Connector
//* 11/25/2014  Forrest Bentley  Improved button positioning on Control Window
//*                              Proper Arrows (with lines)
//* 11/27/2014  Forrest Bentley  Added Connection Selection screen
//* 11/28/2014  Forrest Bentley  Added setfocus to all unshade commands
//*                              Fixed loss of PaintFile objects occassionally after undo
//*                              Added Start button navigation
//* 12/01/2014  Forrest Bentley  Added Straight Arrow Connectors
//* 12/02/2014  Forrest Bentley  Moved BuilderLang.bed variables to Builder.bed
//* 12/03/2014  Forrest Bentley  Added Roundbox, TriangleA-L, Rectangle
//* 12/05/2014  Forrest Bentley  Special Objects Window
//* 12/06/2014  Forrest Bentley  Fixed Connector lines added to control coobj after delete
//* 12/07/2014  Forrest Bentley  Reorganized Triangle letters, added left/right triangles
//* 12/08/2014  Forrest Bentley  Fixed Specialobjects window setfocus when opening
//*                              Added logic to continue connecting until esc
//*                              Added Large Arrows
//* 12/11/2014  Forrest Bentley  Added Large Arrow Hilights
//*                              Added Hollow Large Arrows
//*                              Fixed Large Arrow group sizing
//* 12/12/2014  Forrest Bentley  Added View and Test buttons
//* 12/17/2014  Forrest Bentley  Added Find button to Navigation Selection window
//*                              Finished adding all Large Bent Arrows, including hollow
//* 12/18/2014  Forrest Bentley  Fixed enabling button action for Arrows
//*                              Fixed Navigation retaining previous action display if no action has been set for current object
//* 12/22/2014  Forrest Bentley  Added Text Edit Screen
//* 12/23/2014  Forrest Bentley  Added Object Text creation/movement
//* 12/24/2014  Forrest Bentley  Added Delete Object Text
//*                              Modify Object Text
//*                              Front/Back Object Text
//* 12/26/2014  Forrest Bentley  Add object text if none exists, and remove text line if test is removed
//*                              No Text Objects in any allignment
//*                              Reposition text in Refresh PBOBJ
//*                              Common Object Text offset module = !a400_text_offset_entry2 (used by create and refresh)
//* 12/27/2014  Forrest Bentley  Added TextFile @System@.txt file for text offset values
//* 12/28/2014  Forrest Bentley  Object Text Font Change
//*                              Object Text Position
//* 12/29/2014  Forrest Bentley  Object Text Color
//*                              Object Text Size
//*                              Refresh after Language Command if Control window is open
//*                              If Focus is pressed for a group, never focus on Object Text
//* 12/30/2014  Forrest Bentley  Assign Object Text offsets
//* 12/31/2014  Forrest Bentley  Removed commented write to fgb files
//*                              Fixed bug of adding object text to Text or TextTilt objects when modifying
//*                              Changed Object Text to TextTilt
//* 01/02/2015  Forrest Bentley  Added Bubble Text to Object Text
//* 01/03/2015  Forrest Bentley  Changed Control Goto Windowname dropdown to include current win '>' prefix
//* 01/06/2015  Forrest Bentley  Position objects/groups using arrow keys
//*                              F6 = Clear Control Name/Text fields
//* 01/08/2015  Forrest Bentley  Changed TheNewBoston link from http://thenewboston.org/tutorials.php to http://thenewboston.com
//* 01/15/2015  Forrest Bentley  Added Window System Backup button
//* 01/27/2015  Forrest Bentley  Changed Window Navigation to populate Start entry field when opening, and changed "Window" text to "Window open" "Window close"
//* 02/07/2015  Forrest Bentley  Added Execute and Pallet buttons to Language Interface 
//*                              Changed F1 to toggle between Pallet Window and Language Interface
//* 04/20/2015  Forrest Bentley  Added HTML button to View to see output in XHTML/CSS
//* 04/21/2015  Forrest Bentley  Cleaned up XHTML/CSS (font-size, arrows)
//* 04/23/2015  Forrest Bentley  Added Windows/HTML menu selection
//*                              Added logic to generate HTML for Windows system maintenance testing
//* 04/24/2015  Forrest Bentley  Added logic to handle multi-line entry HTML generation
//* 04/27/2015  Forrest Bentley  Added '_self' to HTML window.open to open navigation windows on same tab
//* 04/29/2015  Forrest Bentley  Added SVG to html screens for special object rendering
//* 04/30/2015  Forrest Bentley  Added all Arrow types to html screens (no arrowheads at this time)
//*
//*******************************************************************************************************************

    //***********************************
    //* Work Variables    
    //***********************************
    string  System  = "GEC B-Edit Analysis System"
    string  Version = "v2.1"
    string  Author = "Forrest Bentley"

    string  Ban1 = "Forrest Bentley"
    string  Ban2 = "B-Edit"
    string  Ban3 = "Analysis System"

    string  BannerLine1 = Ban1
    string  BannerLine2 = Ban2
    string  BannerLine3 = Ban3
 
    int     Xpos
    int     Ypos
    int     XposLast
    int     YposLast
    int     XposDisplay
    int     YposDisplay
    string  MouseOK
    string  Drag
    string  DragGroupCreate
    int     GroupDragX
    int     GroupDragY
    int     GroupDragCX
    int     GroupDragCY
    int     GroupPosCX
    int     GroupPosCY
    int     GroupObjPosCX
    int     GroupObjPosCY
    int     GroupObjXOffset
    int     GroupObjYOffset
    int     GroupMaxPos

    int     MinX
    int     MaxX
    int     MinY
    int     MaxY

    int     ObjectX
    int     ObjectY
    int     ObjectCX
    int     ObjectCY
    int     TestX
    int     TestY

    int     WinX
    int     WinY
    int     WinCX
    int     WinCY

    int     ControlSize
    string  SizingWindow

    string  EntryFieldAction
    string  EntryFieldSize

    string  ButtonFocus
    string  HoldFocus
    string  FocusSet
    string  WindowTitle
    string  ObjectName

    string  NewSystem
    string  NewObject

    string  Newline
    string  Lastline
    int     LenNewline
    string  ControlType
    string  SpecialControlType
    string  Text
    string  ControlName
    string  ControlText
    string  HoldControlAction
    string  MacroCommand
    string  SystemCommand
    string  Delay
    string  DelayCommand
    int     DelayCount
    string  SearchString
    string  WindowInitFirst = 'y'

    string  SystemName = 'NewSys'
    string  WindowName = 'NewWin'
    string  FirstWindowName
    string  SystemWindowName
    string  SystemFileName
    string  SystemNavFilename
    string  GenSystemFilename
    string  EntryactionFilename
    string  MenuFilename
    string  MasterFilename
    string  SystemDesc = "This is a new BEDITWIN system"
    string  SystemTitle = "Generated using @Author@'s @System@ @Version@"

    string  Hwnd
    string  NavAction
    string  HoldAction
    string  ButtonName
    string  ButtonFunction

    string  MenuName
    string  MenuFunction
    
    int     ButtonCount
    int     MenuCount
    int     ViewCount
    int     Level
    int     NewLevel
    int     LevelCount
    int     LevelRowCount

    string  ViewCobol
    string  ViewChange
    int     ViewColWins
    int     ViewRowWins
    int     ViewWinCX
    int     ViewWinCY
    int     ViewWinXStart
    int     ViewWinXSpacing
    int     ViewWinYStart
    int     ViewWinYSpacing
    float   ViewWinCXWork
    float   ViewWinCYWork
    int     ViewCurrX
    int     ViewCurrY
    string  CreateWin
    int     ViewWork
    string  ViewWindowFrom
    string  ViewWindowTo

    string  ViewFromWin 
    int     ViewFromLevel
    int     ViewFromWinX
    int     ViewFromWinY
    int     ViewFromWinCX
    int     ViewFromWinCY

    string  ViewToWin 
    int     ViewToLevel
    int     ViewToWinX
    int     ViewToWinY
    int     ViewToWinCX
    int     ViewToWinCY

    string  ViewHoldWin 
    int     ViewHoldLevel
    int     ViewHoldWinX
    int     ViewHoldWinY
    int     ViewHoldWinCX
    int     ViewHoldWinCY

    int     LineCount
    int     LineX
    int     LineY
    int     LineCX
    int     LineCY
    int     DrawWork
    int     DrawToNextLevel

    string  Directory
    string  HomeDirectory
    string  Extension

    string  HoldRight
    string  HoldRight2
    string  HoldLeft

    string  Userid3090
    string  Password3090
    string  LoginLoc3090
    string  SourceLoc3090
    string  Prodsrcelib3090 = 'g1d800ap.prod.srcelib'
    string  Testsrcelib3090 = 'g1d800at.test.srcelib'
    string  Userfilename3090
    string  Programname3090
    string  COBOL3090
    string  DownloadFrom
    string  DownloadTo
    string  DownloadFilter
    int     DownloadFilterLen

    int     SearchCount
    string  SearchCountStr
    string  SearchLast
    string  SearchAction
    string  SearchNotFound
    string  Dirname

    string  ViewSingleProg
    string  ViewBuilderWindow 

    string  Reenter
   
    string  DirField
    string  FileField

    string  CodeOnly = 'n'

    string  CodeType
    string  BatchUpdating

    string AddIndent
    string ModifyCode = 'n'

    string CodeAssistReenter = 'n'
    string VariableType

    string FindReplace

    int    BumpIndex
    int    ErrorPos

    string CurrModName 
    string OldModName

    string BackupName
    string BackupType
    int    BackupX
    int    BackupY
    int    BackupCX
    int    BackupCY
    string BackupText

    string LanguageCommand

    int    TaskTrackCount

    string NewBubble
    string LastBubble
    string BubbleDesc
    int    BubbleLine
    string BubbleClick

    int    PaintX
    int    PaintY
    int    PaintCX
    int    PaintCY

    string ClickFilter
    string ClickView

    string EarthBitmapLine

    int    Red = 0
    int    Green = 0
    int    Blue = 255
    int    X
    int    Y
    int    Z = Blue
    int    PosX
    int    PosY
    int    PosCX
    int    PosCY

    string TextName
    string TextType
    int    TextX
    int    TextY
    int    TextCX
    int    TextCY
    string TextFont
    string TextText
    string SetTextColor
    string TextHoldControlName
    int    TextHoldRed
    int    TextHoldGreen
    int    TextHoldBlue

    int    DynamicX
    int    DynamicY

    int    KeepRed = Red
    int    KeepGreen = Green
    int    KeepBlue = Blue

    int    TestRed
    int    TestGreen
    int    TestBlue

    string HoldSystemName
    string HoldWindowName
    string HoldControlName
    string HoldType
    int    HoldX
    int    HoldY
    int    HoldCX
    int    HoldCY
    int    HoldRed
    int    HoldGreen
    int    HoldBlue
    string HoldText
    int    HoldTextX
    int    HoldTextY

    int    HoldLength
    int    HoldHeight

    string CopySystemName
    string CopyWindowName
    string CopyControlName
    string CopyType
    string NewControlName

    string MaintainLengthHeight = 'n'
    string HoldValue

    string CurrFont
    string CurrFile

    string Restoring = 'n'
    string PaintSystemName
    int    TempWork

    string AlignTop
    string AlignBottom
    string AlignLeft
    string AlignRight

    string ActualPosition

    int    CharCount

    string KeepSizePos = 'n'
    int    NameNumber

    string CopyGroupRectangleLine
    string ColorControl
    string GroupColorChange

    string RepeatLine

    int    SizeCX
    int    SizeCY

    string UpdateConnectors = 'y'

    string CreateText = 'n'
    string ControlTypeText
    int    TextRed
    int    TextGreen
    int    TextBlue

    string TextFileName
    string TextSearch
    int    TextOffX
    int    TextOffY
    string BubbleFileName

    string GotoWindow

    string ButtonConnectionType
    string SelectedButtonConnectionType

    string Duplicating

    string ConnectSelect
    string BentConnect
    string ContinueConnecting = 'n'

    string Testpntfilename

    string KeyMoveOK
    string KeyWindowOpen
    string KeyFocusField

    string MM
    string DD
    string YY
    string HH
    string Min
    string SS

    string HTMLArrow
    int    FontSize
    string Presentation = "Windows"
    string WindowFilename
    string NavigationFilename
    string HTMLFilename
    string HTMLFirstFilename
    string HTML_name
    string HTML_x
    string HTML_y
    string HTML_cx
    string HTML_cy
    string HTML_text
    string HTML_radio
    int    HTML_id
    int    HTML_work
    int    HTML_work2
    string HTML_navigation

    int    HTML_R
    int    HTML_G 
    int    HTML_B
    string HTMLWindowname

    //***********************************
    //* Debug Variables
    //***********************************
    string BeditDebug = 'n'
    string BeditDebugFile
    string BeditDebugOldFile
    int    BeditDebugLine
    string DEBUGHWND
    string DebugAction
    string DebugSetBreaks
    string DebugBreakType
    string DebugBreakCharSet = '«'
    string WindowDebug
    string DebugType

    //***********************************
    //* Progress Variables
    //***********************************
    int    Progx            error
    int    Progy            error
    int    Progcx           error
    int    Progcy           error
    float  Progress         error
    float  ProgressShow     error
    int    ProgressCount    error
    int    ProgressMax      error
    float  ProgressWork     error
    int    Progframex       error
    int    Progframey       error
    int    Progframecx      error
    int    Progframecy      error

    //*************************** Start of BuilderLang.bed Variables *********************************************
    string LangCommand       error
    string LangVerb          error
    string LangNoun          error
    string LangAdverb        error
    string LangCmdFound      error

    string LangError         error

    string LangDir           error
    int    LangAmount        error
    
    string ControlName       error
    string ControlNameWork   error
    string ControlText       error
    string ControlType       error
    string ControlTypeName   error
    string ControlFilename   error

    string ControlGroupType  error
    string SearchGroupType   error
    string AllControls       error

    string RadioGroup        error
    int    RadioX            error
    int    RadioY            error
    int    RadioCX           error
    int    RadioCY           error

    string SearchControl     error
    int    SearchX           error
    int    SearchY           error
    int    SearchCX          error
    int    SearchCY          error
    string SearchPos         error

    string Newline           error
    string LangDirOf         error

    string LanguageReturn    error
    string CommandSearch     error

    string AlignType         error

    string DistributeType    error

    string HoldControlType   error
    string ObjectType        error
    string HoldName          error

    string MakeColor         error
    string RepeatLine        error
    string PaintPos          error
    string ControlPos        error
    string NewControlName    error

    string CurrLine          error

    string TestControl       error 

    string SameType          error
    string SameObjType       error
    string SameObj           error
    string MakeType          error
    int    MakeSize          error
    int    SizeX             error
    int    SizeY             error
    int    SizeCX            error
    int    SizeCY            error

    string ConnectObj1       error
    string ConnectObj2       error
    string ConnectObj        error
    string ConnectFilename   error
    string ConnectType       error
    string ConnectType2      error
    string ConnectObjname    error

    int    Connect1X         error
    int    Connect1Y         error
    int    Connect1CX        error
    int    Connect1CY        error
    int    Connect2X         error
    int    Connect2Y         error
    int    Connect2CX        error
    int    Connect2CY        error
    int    ConnectX          error
    int    ConnectY          error
    int    ConnectCX         error
    int    ConnectCY         error
    int    CharCount         error
    int    CharCountUpper    error
    int    CharCountLower    error
    int    CharCountSpace    error
    string CharTest          error
    int    ConnectLength     error
    int    ConnectHeight     error
    int    Connect1Length    error
    int    Connect1Height    error
    int    Connect2Length    error
    int    Connect2Height    error

    int    ConnectLeftX      error
    int    ConnectLeftY      error
    int    ConnectRightX     error
    int    ConnectRightY     error
    int    ConnectTopX       error
    int    ConnectTopY       error
    int    ConnectBottomX    error
    int    ConnectBottomY    error

    int    ConnectLeft1X     error
    int    ConnectLeft1Y     error
    int    ConnectRight1X    error
    int    ConnectRight1Y    error
    int    ConnectTop1X      error
    int    ConnectTop1Y      error
    int    ConnectBottom1X   error
    int    ConnectBottom1Y   error
    int    ConnectLeft2X     error
    int    ConnectLeft2Y     error
    int    ConnectRight2X    error
    int    ConnectRight2Y    error
    int    ConnectTop2X      error
    int    ConnectTop2Y      error
    int    ConnectBottom2X   error
    int    ConnectBottom2Y   error

    string ConnectLineType   error
    string RemoveConnection  error

    string TextObject        error
    string TextObj
    string GotoWindow        error

    int    DiffX             error
    int    DiffY             error
    int    BentType          error

    int    Arrow             error
    int    ArrowNumber 

    //**************************** End of BuilderLang.bed Variables **********************************************

    //**************************** Start of BuilderConnect.bed Variables *****************************************

    string ConnType1   error
    int    ConnOrig1X  error
    int    ConnOrig1Y  error
    int    ConnOrig1CX error
    int    ConnOrig1CY error

    string ConnType2   error
    int    ConnOrig2X  error
    int    ConnOrig2Y  error
    int    ConnOrig2CX error
    int    ConnOrig2CY error

    float  ConnHeight     error
    float  ConnLength     error
    float  ConnTempHeight error
    float  ConnTempLength error
    float  ConnRadius     error
    float  ConnAngle      error
    float  ConnTempWork   error
    int    Zerotest       error

    int    ConnectOneX    error
    int    ConnectOneY    error
    int    ConnectTwoX    error
    int    ConnectTwoY    error

    //****************************** End of BuilderConnect.bed Variables *****************************************
 
    //***********************************
    //* Special Actions
    //***********************************
    string WindowEscape                           = "call !a050_Escape"
    string DefaultWindowProcess                   = "call !a050_Default_Window_Processing"
 
    string WindowInit                             = "call !a100_WindowInit"
    string WindowWrap                             = "call !a100_WindowWrap"

    string WindowMouse                            = "call !a100_WindowMouse"
    string WindowDown1                            = "call !a100_WindowDown1"
    string WindowDown2                            = "call !a100_WindowDown2"
    string WindowDown3                            = "call !a100_WindowDown3"
    string WindowUp1                              = "call !a100_WindowUp1"
    string WindowUp2                              = "call !a100_WindowUp2"
    string WindowUp3                              = "call !a100_WindowUp3"
    string WindowF1                               = "call !a100_F1"
    string WindowF2                               = "call !a100_F2"
    string WindowF3                               = "call !a100_F3"
    string WindowF4                               = "call !a100_F4"
    string WindowF5                               = "call !a100_F5"
    string WindowF6                               = "call !a100_F6"

    string WindowUp                               = "call !a100_WindowUp"
    string WindowDown                             = "call !a100_WindowDown"
    string WindowRight                            = "call !a100_WindowRight"
    string WindowLeft                             = "call !a100_WindowLeft"

    string WindowTimer                            = "call !a100_WindowTimer"
 
    //***********************************
    //* Window Menu Actions
    //***********************************
    string Builder_Main_Bedit_MSOBJ               = "call !a110_Builder_Main_Bedit_MSOBJ"
    string Builder_Main_Batch_MSOBJ               = "call !a110_Builder_Main_Batch_MSOBJ"    
    string Builder_Main_Build_MSOBJ               = "call !a110_Builder_Main_Build_MSOBJ"
    string Builder_Main_Import_MSOBJ              = "call !a110_Builder_Main_Import_MSOBJ"
    string Builder_Main_COBOLCall_MSOBJ           = "call !a110_Builder_Main_COBOLCall_MSOBJ"
    string Builder_Main_POM_MSOBJ                 = "call !a110_Builder_Main_POM_MSOBJ"
    string Builder_Main_CodeCheck_MSOBJ           = "call !a110_Builder_Main_CodeCheck_MSOBJ"
    string Builder_Main_3090Check_MSOBJ           = "call !a110_Builder_Main_3090Check_MSOBJ" 
    string Builder_Main_Download_MSOBJ            = "call !a110_Builder_Main_Download_MSOBJ"
    string Builder_Main_Searchdir_MSOBJ           = "call !a110_Builder_Main_Searchdir_MSOBJ"
    string Builder_Main_Exit_MSOBJ                = "call !a110_Builder_Main_Exit_MSOBJ"
    string Builder_Main_About_MSOBJ               = "call !a110_Builder_Main_About_MSOBJ"
    string Builder_Main_ControlManual_MSOBJ       = "call !a110_Builder_Main_ControlManual_MSOBJ"
    string Builder_Main_Overview_MSOBJ            = "call !a110_Builder_Main_Overview_MSOBJ"
    string Builder_Main_Manual_MSOBJ              = "call !a110_Builder_Main_Manual_MSOBJ"
    string Builder_Main_AboutSystem_MSOBJ         = "call !a110_Builder_Main_AboutSystem_MSOBJ"

    string Builder_Main_Windows_MSOBJ             = "call !a110_Builder_Main_Windows_MSOBJ"
    string Builder_Main_Html_MSOBJ                = "call !a110_Builder_Main_Html_MSOBJ"

    string Builder_Main_Eclipse_MSOBJ             = "call !a110_Builder_Main_Eclipse_MSOBJ"
    string Builder_Main_Rumba_MSOBJ               = "call !a110_Builder_Main_Rumba_MSOBJ"
    string Builder_Main_Xampp_MSOBJ               = "call !a110_Builder_Main_Xampp_MSOBJ"
    string Builder_Main_Convert_MSOBJ             = "call !a110_Builder_Main_Convert_MSOBJ"
    string Builder_Main_Calc_MSOBJ                = "call !a110_Builder_Main_Calc_MSOBJ"
    string Builder_Main_Soap_MSOBJ                = "call !a110_Builder_Main_Soap_MSOBJ"
    string Builder_Main_Toad_MSOBJ                = "call !a110_Builder_Main_Toad_MSOBJ"
    string Builder_Main_Fiddler_MSOBJ             = "call !a110_Builder_Main_Fiddler_MSOBJ"
    string Builder_Main_Magnify_MSOBJ             = "call !a110_Builder_Main_Magnify_MSOBJ"
    string Builder_Main_Notepad_MSOBJ             = "call !a110_Builder_Main_Notepad_MSOBJ"
    string Builder_Main_Paint_MSOBJ               = "call !a110_Builder_Main_Paint_MSOBJ"
    string Builder_Main_Search_MSOBJ              = "call !a110_Builder_Main_Search_MSOBJ"
    string Builder_Main_Directory_MSOBJ           = "call !a110_Builder_Main_Directory_MSOBJ"
    string Builder_Main_Dos_MSOBJ                 = "call !a110_Builder_Main_Dos_MSOBJ"
    string Builder_Main_Webex_MSOBJ               = "call !a110_Builder_Main_Webex_MSOBJ"
    string Builder_Main_Taskmanager_MSOBJ         = "call !a110_Builder_Main_Taskmanager_MSOBJ"
    string Builder_Main_Performance_MSOBJ         = "call !a110_Builder_Main_Performance_MSOBJ"
    string Builder_Main_Tasktrack_MSOBJ           = "call !a110_Builder_Main_Tasktrack_MSOBJ"

    string Builder_Main_SDLC_MSOBJ                = "call !a110_Builder_Main_SDLC_MSOBJ"
    string Builder_Main_CD_MSOBJ                  = "call !a110_Builder_Main_CD_MSOBJ"
    string Builder_Main_Jenkins_MSOBJ             = "call !a110_Builder_Main_Jenkins_MSOBJ"
    string Builder_Main_Nola_MSOBJ                = "call !a110_Builder_Main_Nola_MSOBJ"
    string Builder_Main_Governance_MSOBJ          = "call !a110_Builder_Main_Governance_MSOBJ"
    string Builder_Main_Gectechnology_MSOBJ       = "call !a110_Builder_Main_Gectechnology_MSOBJ"

    string Builder_Main_BPM_MSOBJ                 = "call !a110_Builder_Main_BPM_MSOBJ"

    string Builder_Main_Bachmannet_MSOBJ          = "call !a110_Builder_Main_Bachmannet_MSOBJ"
    string Builder_Main_Bachman_MSOBJ             = "call !a110_Builder_Main_Bachman_MSOBJ"
    string Builder_Main_Gateway_MSOBJ             = "call !a110_Builder_Main_Gateway_MSOBJ"
    string Builder_Main_MFO2_MSOBJ                = "call !a110_Builder_Main_MFO2_MSOBJ"
    
    string Builder_Main_Banneron_MSOBJ            = "call !a110_Builder_Main_Banneron_MSOBJ"
    string Builder_Main_Banneroff_MSOBJ           = "call !a110_Builder_Main_Banneroff_MSOBJ"
    string Builder_Main_FutureTimeline_MSOBJ      = "call !a110_Builder_Main_FutureTimeline_MSOBJ"
    string Builder_Main_ExplainingFuture_MSOBJ    = "call !a110_Builder_Main_ExplainingFuture_MSOBJ"
    string Builder_Main_Tutorials_MSOBJ           = "call !a110_Builder_Main_Tutorials_MSOBJ"
    string Builder_Main_Pacman_MSOBJ              = "call !a110_Builder_Main_Pacman_MSOBJ"
    string Builder_Main_Life_MSOBJ                = "call !a110_Builder_Main_Life_MSOBJ"
 
    string Builder_System_Create_PBOBJ            = "call !a200_Builder_System_Create_PBOBJ"
    string Builder_System_Modify_PBOBJ            = "call !a200_Builder_System_Modify_PBOBJ"
    string Builder_System_Backup_PBOBJ            = "call !a200_Builder_System_Backup_PBOBJ"    
    string Builder_System_Assist_PBOBJ            = "call !a200_Builder_System_Assist_PBOBJ"
    string Builder_System_Cancel_PBOBJ            = "call !a200_Builder_System_Cancel_PBOBJ"
    string Builder_System_Open_PBOBJ              = "call !a200_Builder_System_Open_PBOBJ"
    string Builder_System_Debug_PBOBJ             = "call !a200_Builder_System_Debug_PBOBJ"

    string Builder_Window_Backup_PBOBJ            = "call !a300_Builder_Window_backup_PBOBJ"
    string Builder_Window_Create_PBOBJ            = "call !a300_Builder_Window_Create_PBOBJ"
    string Builder_Window_Modify_PBOBJ            = "call !a300_Builder_Window_Modify_PBOBJ"
    string Builder_Window_Save_PBOBJ              = "call !a300_Builder_Window_Save_PBOBJ"
    string Builder_Window_Test_PBOBJ              = "call !a300_Builder_Window_Test_PBOBJ"
    string Builder_Window_View_PBOBJ              = "call !a300_Builder_Window_View_PBOBJ"
    string Builder_Window_Debug_PBOBJ             = "call !a300_Builder_Window_Debug_PBOBJ"
    string Builder_Window_Close_PBOBJ             = "call !a300_Builder_Window_Close_PBOBJ"
    string Builder_Window_Code_PBOBJ              = "call !a300_Builder_Window_Code_PBOBJ"

    string Builder_Control_WinSize_PBOBJ          = "call !a400_Builder_Control_WinSize_PBOBJ"
    string Builder_Control_Focus_PBOBJ            = "call !a400_Builder_Control_Focus_PBOBJ"
    string Builder_Control_Modify_PBOBJ           = "call !a400_Builder_Control_Modify_PBOBJ"
    string Builder_Control_Delete_PBOBJ           = "call !a400_Builder_Control_Delete_PBOBJ"
    string Builder_Control_Create_PBOBJ           = "call !a400_Builder_Control_Create_PBOBJ"
    string Builder_Control_Align_PBOBJ            = "call !a400_Builder_Control_Align_PBOBJ"
    string Builder_Control_Copy_PBOBJ             = "call !a400_Builder_Control_Copy_PBOBJ"
    string Builder_Control_Paste_PBOBJ            = "call !a400_Builder_Control_Paste_PBOBJ"
    string Builder_Control_Color_PBOBJ            = "call !c100_Builder_Stdcolors_MSOBJ"
    string Builder_Control_Undo_PBOBJ             = "call !a400_Builder_Control_Undo_PBOBJ"
    string Builder_Control_Buttonaction_PBOBJ     = "call !a400_Builder_Control_Buttonaction_PBOBJ"
    string Builder_Control_Entryaction_PBOBJ      = "call !a400_Builder_Control_Entryaction_PBOBJ"
    string Builder_Control_Front_PBOBJ            = "call !a400_Builder_Control_Front_PBOBJ"
    string Builder_Control_Back_PBOBJ             = "call !a400_Builder_Control_Back_PBOBJ"
    string Builder_Control_Duplicate_PBOBJ        = "call !a400_Builder_Control_Duplicate_PBOBJ"
    //string Builder_Control_Language_PBOBJ         = "call !a400_Builder_Control_Language_PBOBJ"

    string Builder_Control_SizeXPlus_PBOBJ        = "call !a400_Builder_Control_SizeXPlus_PBOBJ"
    string Builder_Control_SizeXMinus_PBOBJ       = "call !a400_Builder_Control_SizeXMinus_PBOBJ"
    string Builder_Control_SizeYPlus_PBOBJ        = "call !a400_Builder_Control_SizeYPlus_PBOBJ"
    string Builder_Control_SizeYMinus_PBOBJ       = "call !a400_Builder_Control_SizeYMinus_PBOBJ"

    string Builder_Control_Swap_PBOBJ             = "call !a400_Builder_Control_Swap_PBOBJ"

    string Builder_Control_Refresh_PBOBJ          = "call !a400_Builder_Control_Refresh_PBOBJ"
    string Builder_Control_Code_PBOBJ             = "call !a400_Builder_Control_Code_PBOBJ"
    string Builder_Control_Test_PBOBJ             = "call !a400_Builder_Control_Test_PBOBJ"
    string Builder_Control_View_PBOBJ             = "call !a400_Builder_Control_View_PBOBJ"
    string Builder_Control_Save_PBOBJ             = "call !a400_Builder_Control_Save_PBOBJ"
    string Builder_Control_Cancel_PBOBJ           = "call !a400_Builder_Control_Cancel_PBOBJ"

    string Builder_Control_Go_PBOBJ               = "call !a400_Builder_Control_Go_PBOBJ"

    string Builder_Control_Bitmap_PBOBJ           = "call !a400_Builder_Control_Bitmap_PBOBJ"

    string Builder_Control_Font_PBOBJ             = "call !a400_Builder_Control_Font_PBOBJ"

    string Builder_Control_ControlText_PBOBJ      = "call !a400_Builder_Control_ControlText_PBOBJ"
    string Builder_Control_Language_PBOBJ         = "call !a400_Builder_Control_Language_PBOBJ"

    string Builder_Textedit_Apply_PBOBJ           = "call !a420_Builder_Textedit_Apply_PBOBJ"
    string Builder_Textedit_Ok_PBOBJ              = "call !a420_Builder_Textedit_Ok_PBOBJ"

    string Builder_Control_Connectcreate_PBOBJ    = "call !a400_Builder_Control_Connectcreate_PBOBJ"
    string Builder_Control_Connectchoose_PBOBJ    = "call !a400_Builder_Control_Connectchoose_PBOBJ"
    string Builder_Control_Disconnect_PBOBJ       = "call !a400_Builder_Control_Disconnect_PBOBJ"

    string Builder_Specialobjects_Cancel_PBOBJ    = "call !a400_Builder_Specialobjects_Cancel_PBOBJ"

    string Builder_Language_Apply_PBOBJ           = "call !a450_Builder_Language_Apply_PBOBJ"
    string Builder_Language_Execute_PBOBJ         = "call !a450_Builder_Language_Apply_PBOBJ"
    string Builder_Language_Close_PBOBJ           = "call !a450_Builder_Language_Close_PBOBJ"
    string Builder_Language_Gotopallet_PBOBJ      = "call !a450_Builder_Language_Gotopallet_PBOBJ"
    string Builder_Language_Clean_PBOBJ           = "call !a450_Builder_Language_Clean_PBOBJ"

    string Builder_Connectselect_Straight_PBOBJ   = "call !a400_Builder_Connectselect_Straight_PBOBJ"
    string Builder_Connectselect_Straight1_PBOBJ  = "call !a400_Builder_Connectselect_Straight1_PBOBJ"
    string Builder_Connectselect_Straight2_PBOBJ  = "call !a400_Builder_Connectselect_Straight2_PBOBJ"
    string Builder_Connectselect_Straight3_PBOBJ  = "call !a400_Builder_Connectselect_Straight3_PBOBJ"
    string Builder_Connectselect_Straight4_PBOBJ  = "call !a400_Builder_Connectselect_Straight4_PBOBJ"
    string Builder_Connectselect_Bent_PBOBJ       = "call !a400_Builder_Connectselect_Bent_PBOBJ"
    string Builder_Connectselect_Bent1_PBOBJ      = "call !a400_Builder_Connectselect_Bent1_PBOBJ"
    string Builder_Connectselect_Bent2_PBOBJ      = "call !a400_Builder_Connectselect_Bent2_PBOBJ"
    string Builder_Connectselect_Bent3_PBOBJ      = "call !a400_Builder_Connectselect_Bent3_PBOBJ"
    string Builder_Connectselect_Bent4_PBOBJ      = "call !a400_Builder_Connectselect_Bent4_PBOBJ"
    string Builder_Connectselect_Cancel_PBOBJ     = "call !a400_Builder_Connectselect_Cancel_PBOBJ"

    string Builder_Nav_Ok_PBOBJ                   = "call !a500_Builder_Nav_Ok_PBOBJ"
    string Builder_Nav_Cancel_PBOBJ               = "call !a500_Builder_Nav_Cancel_PBOBJ"
    string Builder_Nav_Find_PBOBJ                 = "call !a500_Builder_Nav_Find_PBOBJ"

    string Builder_View_Html_PBOBJ                = "call !a500_Builder_View_Html_PBOBJ"
    string Builder_View_Open_PBOBJ                = "call !a500_Builder_View_Open_PBOBJ"
    string Builder_View_Comments_PBOBJ            = "call !a500_Builder_View_Comments_PBOBJ"
    string Builder_View_Filter_PBOBJ              = "call !a500_Builder_View_Filter_PBOBJ"
    string Builder_View_Cancel_PBOBJ              = "call !a500_Builder_View_Cancel_PBOBJ"

    string Builder_Filter_OK_PBOBJ                = "call !a550_Builder_Filter_OK_PBOBJ"
    string Builder_Filter_Comments_PBOBJ          = "call !a550_Builder_Filter_Comments_PBOBJ"
    string Builder_Filter_View_PBOBJ              = "call !a550_Builder_Filter_View_PBOBJ"
    string Builder_Filter_Cancel_PBOBJ            = "call !a550_Builder_Filter_Cancel_PBOBJ"
    string Builder_Filter_Windowlist_LBOBJ        = "call !a550_Builder_Filter_Windowlist_LBOBJ"
    window action Builder_Filter_Windowlist_LBOBJ

    string Builder_Comments_Ok_PBOBJ              = "call !a560_Builder_Comments_OK_PBOBJ"

    string Builder_Import_Lookup_PBOBJ            = "call !a600_Builder_Import_Lookup_PBOBJ"
    string Builder_Import_3090_PBOBJ              = "call !a600_Builder_Import_3090_PBOBJ"
    string Builder_Import_Ok_PBOBJ                = "call !a600_Builder_Import_OK_PBOBJ"
    string Builder_Import_Copydir_PBOBJ           = "call !a600_Builder_Import_Copydir_PBOBJ"
    string Builder_Import_Cancel_PBOBJ            = "call !a600_Builder_Import_Cancel_PBOBJ"
    string Builder_Import_Browse_PBOBJ            = "call !a600_Builder_Import_Browse_PBOBJ"

    string Builder_3090_Ok_PBOBJ                  = "call !a650_Builder_3090_Ok_PBOBJ"
    string Builder_3090_Cancel_PBOBJ              = "call !a650_Builder_3090_Cancel_PBOBJ"

    string Builder_Entryaction_Set_PBOBJ          = "call !a700_Builder_Entryaction_Set_PBOBJ"
    string Builder_Entryaction_Delete_PBOBJ       = "call !a700_Builder_Entryaction_Delete_PBOBJ"
    string Builder_Entryaction_Cancel_PBOBJ       = "call !a700_Builder_Entryaction_Cancel_PBOBJ"

    string Builder_Callflow_Directory_PBOBJ       = "call !a800_Builder_Callflow_Directory_PBOBJ"
    string Builder_Callflow_Ok_PBOBJ              = "call !a800_Builder_Callflow_Ok_PBOBJ"
    string Builder_Callflow_Cancel_PBOBJ          = "call !a800_Builder_Callflow_Cancel_PBOBJ"

    string Builder_POM_Directory_PBOBJ            = "call !a850_Builder_POM_Directory_PBOBJ"
    string Builder_POM_Ok_PBOBJ                   = "call !a850_Builder_POM_Ok_PBOBJ"
    string Builder_POM_Cancel_PBOBJ               = "call !a850_Builder_POM_Cancel_PBOBJ"

    string Builder_Textedit_Font_PBOBJ            = "call !a875_Builder_Textedit_Font_PBOBJ"
    string Builder_Textedit_Yminus_PBOBJ          = "call !a875_Builder_Textedit_Yminus_PBOBJ"
    string Builder_Textedit_Yplus_PBOBJ           = "call !a875_Builder_Textedit_Yplus_PBOBJ"
    string Builder_Textedit_Xminus_PBOBJ          = "call !a875_Builder_Textedit_Xminus_PBOBJ"
    string Builder_Textedit_Xplus_PBOBJ           = "call !a875_Builder_Textedit_Xplus_PBOBJ"
    string Builder_Textedit_Color_PBOBJ           = "call !a875_Builder_Textedit_Color_PBOBJ"

    string Builder_Progress_Cancel_PBOBJ          = "call !a900_Builder_Progress_Cancel_PBOBJ"

    string Builder_Download3090_Ok_PBOBJ          = "call !a1000_Builder_Download3090_Ok_PBOBJ"
    string Builder_Download3090_Cancel_PBOBJ      = "call !a1000_Builder_Download3090_Cancel_PBOBJ"
    string Builder_Download3090_Todir_PBOBJ       = "call !a1000_Builder_Download3090_Todir_PBOBJ"

    string Builder_Align_Top_PBOBJ                = "call !a1100_Builder_Align_Top_PBOBJ"
    string Builder_Align_Bottom_PBOBJ             = "call !a1100_Builder_Align_Bottom_PBOBJ"
    string Builder_Align_Midhoriz_PBOBJ           = "call !a1100_Builder_Align_Midhoriz_PBOBJ"
    string Builder_Align_Midvert_PBOBJ            = "call !a1100_Builder_Align_Midvert_PBOBJ"
    string Builder_Align_Left_PBOBJ               = "call !a1100_Builder_Align_Left_PBOBJ"
    string Builder_Align_Right_PBOBJ              = "call !a1100_Builder_Align_Right_PBOBJ"
    string Builder_Align_Distvert_PBOBJ           = "call !a1100_Builder_Align_Distvert_PBOBJ"
    string Builder_Align_Disthoriz_PBOBJ          = "call !a1100_Builder_Align_Disthoriz_PBOBJ"
    string Builder_Align_Cancel_PBOBJ             = "call !a1100_Builder_Align_Cancel_PBOBJ"

    string Builder_Search_And_PBOBJ               = "call !a1200_Builder_Search_And_PBOBJ"
    string Builder_Search_Or_PBOBJ                = "call !a1200_Builder_Search_Or_PBOBJ"
    string Builder_Search_Remove_PBOBJ            = "call !a1200_Builder_Search_Remove_PBOBJ"
    string Builder_Search_Clear_PBOBJ             = "call !a1200_Builder_Search_Clear_PBOBJ"
    string Builder_Search_Search_PBOBJ            = "call !a1200_Builder_Search_Search_PBOBJ"
    string Builder_Search_Help_PBOBJ              = "call !a1200_Builder_Search_Help_PBOBJ"
    string Builder_Search_Cancel_PBOBJ            = "call !a1200_Builder_Search_Cancel_PBOBJ"
    string Builder_Search_Directory_PBOBJ         = "call !a1200_Builder_Search_Directory_PBOBJ"

    string Builder_Searchresults_Open_PBOBJ       = "call !a1300_Builder_Searchresults_Open_PBOBJ"
    string Builder_Searchresults_Cancel_PBOBJ     = "call !a1300_Builder_Searchresults_Cancel_PBOBJ"
    string Builder_Searchresults_Results_LBOBJ    = "call !a1300_Builder_Searchresults_Open_PBOBJ"
    window action Builder_Searchresults_Results_LBOBJ

    string Builder_Help_Ok_PBOBJ                  = "call !a1400_Builder_Help_Ok_PBOBJ"
    string Builder_About_Ok_PBOBJ                 = "call !a1500_Builder_About_Ok_PBOBJ"

    string Builder_Browse_Refresh_PBOBJ           = "call !a1600_Builder_Browse_Refresh_PBOBJ"
    string Builder_Browse_Back_PBOBJ              = "call !a1600_Builder_Browse_Back_PBOBJ"
    string Builder_Browse_Ok_PBOBJ                = "call !a1600_Builder_Browse_Ok_PBOBJ"
    string Builder_Browse_Cancel_PBOBJ            = "call !a1600_Builder_Browse_Cancel_PBOBJ"
    string Builder_Browse_Newdir_PBOBJ            = "call !a1600_Builder_Browse_Newdir_PBOBJ"
    string Builder_Browse_Open_PBOBJ              = "call !a1600_Builder_Browse_Open_PBOBJ"
    string Builder_Browse_Subdir_LBOBJ            = "call !a1600_Builder_Browse_Subdir_LBOBJ"
    window action Builder_Browse_Subdir_LBOBJ
    string Builder_Browse_Files_LBOBJ             = "call !a1600_Builder_Browse_Files_LBOBJ"
    window action Builder_Browse_Files_LBOBJ

    string Builder_Newdir_Ok_PBOBJ                = "call !a1650_Builder_Newdir_Ok_PBOBJ"
    string Builder_Newdir_Cancel_PBOBJ            = "call !a1650_Builder_Newdir_Cancel_PBOBJ"

    string Builder_Codecheck_Directory_PBOBJ      = "call !a1700_Builder_Codecheck_Directory_PBOBJ"
    string Builder_Codecheck_Ok_PBOBJ             = "call !a1700_Builder_Codecheck_Ok_PBOBJ"
    string Builder_Codecheck_Cancel_PBOBJ         = "call !a1700_Builder_Codecheck_Cancel_PBOBJ"
    string Builder_Codecheck_System_LBOBJ         = "call !a1700_Builder_Codecheck_System_LBOBJ"    
    window action Builder_Codecheck_System_LBOBJ

    string Builder_Code_Ok_PBOBJ                  = "call !a1800_Builder_Code_Ok_PBOBJ"
    string Builder_Code_Cancel_PBOBJ              = "call !a1800_Builder_Code_Cancel_PBOBJ"
    string Builder_Code_Assist_PBOBJ              = "call !a1800_Builder_Code_Assist_PBOBJ"  
    string Builder_Code_Refresh_PBOBJ             = "call !a1800_Builder_Code_Refresh_PBOBJ"
    string Builder_Code_Test_PBOBJ                = "call !a1800_Builder_Code_Test_PBOBJ"   
    string Builder_Code_View_PBOBJ                = "call !a1800_Builder_Code_View_PBOBJ"         
    string Builder_Code_Codemodules_LBOBJ         = "call !a1800_Builder_Code_Codemodules_LBOBJ"
    window action Builder_Code_Codemodules_LBOBJ

    string Builder_Codeassist_Ok_PBOBJ            = "call !a1900_Builder_Codeassist_Ok_PBOBJ"
    string Builder_Codeassist_Close_PBOBJ         = "call !a1900_Builder_Codeassist_Close_PBOBJ"
    string Builder_Codeassist_Up_PBOBJ            = "call !a1900_Builder_Codeassist_Up_PBOBJ"
    string Builder_Codeassist_Down_PBOBJ          = "call !a1900_Builder_Codeassist_Down_PBOBJ"
    string Builder_Codeassist_Right_PBOBJ         = "call !a1900_Builder_Codeassist_Right_PBOBJ"
    string Builder_Codeassist_Left_PBOBJ          = "call !a1900_Builder_Codeassist_Left_PBOBJ"
    string Builder_Codeassist_Delete_PBOBJ        = "call !a1900_Builder_Codeassist_Delete_PBOBJ"
    string Builder_Codeassist_Add_PBOBJ           = "call !a1900_Builder_Codeassist_Add_PBOBJ"
    string Builder_Codeassist_Modify_PBOBJ        = "call !a1900_Builder_Codeassist_Modify_PBOBJ"
    string Builder_Codeassist_Find_PBOBJ          = "call !a1900_Builder_Codeassist_Find_PBOBJ"
    string Builder_Codeassist_Undo_PBOBJ          = "call !a1900_Builder_Codeassist_Undo_PBOBJ"
    string Builder_Codeassist_Code_PBOBJ          = "call !a1900_Builder_Codeassist_Code_PBOBJ"
    string Builder_Codeassist_Refresh_PBOBJ       = "call !a1900_Builder_Codeassist_Refresh_PBOBJ"
    string Builder_Codeassist_Test_PBOBJ          = "call !a1900_Builder_Codeassist_Test_PBOBJ"
    string Builder_Codeassist_Log_PBOBJ           = "call !a1900_Builder_Codeassist_Log_PBOBJ"
    string Builder_Codeassist_Edit_PBOBJ          = "call !a1900_Builder_Codeassist_Edit_PBOBJ"
    string Builder_Codeassist_View_PBOBJ          = "call !a1900_Builder_Codeassist_View_PBOBJ"

    string Builder_Codeassist_Debugrun_PBOBJ      = "call !a1900_Builder_Codeassist_Debugrun_PBOBJ"
    string Builder_Codeassist_Debugstep_PBOBJ     = "call !a1900_Builder_Codeassist_Debugstep_PBOBJ"
    string Builder_Codeassist_Debugstepover_PBOBJ = "call !a1900_Builder_Codeassist_Debugstepover_PBOBJ"
    string Builder_Codeassist_Debuggo_PBOBJ       = "call !a1900_Builder_Codeassist_Debuggo_PBOBJ"
    string Builder_Codeassist_Debugsetbreak_PBOBJ = "call !a1900_Builder_Codeassist_Debugsetbreak_PBOBJ"
    string Builder_Codeassist_Debugsetbrks_PBOBJ  = "call !a1900_Builder_Codeassist_Debugsetbrks_PBOBJ"
    string Builder_Codeassist_Debugcond_PBOBJ     = "call !a1900_Builder_Codeassist_Debugcond_PBOBJ"
    string Builder_Codeassist_Debugdelbreak_PBOBJ = "call !a1900_Builder_Codeassist_Debugdelbreak_PBOBJ"
    string Builder_Codeassist_Debugclearbrks_PBOBJ = "call !a1900_Builder_Codeassist_Debugclearbrks_PBOBJ"
    string Builder_Codeassist_Debugfiles_PBOBJ    = "call !a1900_Builder_Codeassist_Debugfiles_PBOBJ"
    string Builder_Codeassist_Debugstop_PBOBJ     = "call !a1900_Builder_Codeassist_Debugstop_PBOBJ"
    string Builder_Codeassist_Debughelp_PBOBJ     = "call !a1900_Builder_Codeassist_Debughelp_PBOBJ"

    string Builder_Debughelp_Close_PBOBJ          = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugrun_PBOBJ       = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugstep_PBOBJ      = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debuggo_PBOBJ        = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugstepover_PBOBJ  = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugsetbreak_PBOBJ  = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugsetbrks_PBOBJ   = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugcond_PBOBJ      = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugdelbreak_PBOBJ  = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugclearbrks_PBOBJ = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugfiles_PBOBJ     = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debugstop_PBOBJ      = "call !a1900_Builder_Debughelp_Close_PBOBJ"
    string Builder_Debughelp_Debughelp_PBOBJ      = "call !a1900_Builder_Debughelp_Close_PBOBJ"

    string Builder_Debugcond_Add_PBOBJ            = "call !a1900_Builder_Debugcond_Add_PBOBJ"
    string Builder_Debugcond_Delete_PBOBJ         = "call !a1900_Builder_Debugcond_Delete_PBOBJ"
    string Builder_Debugcond_Ok_PBOBJ             = "call !a1900_Builder_Debugcond_Ok_PBOBJ"
    string Builder_Debugcond_Cancel_PBOBJ         = "call !a1900_Builder_Debugcond_Cancel_PBOBJ"

    string Builder_Codeassist_Code_LBOBJ          = "call !a1900_Builder_Codeassist_Code_LBOBJ"
    window action Builder_Codeassist_Code_LBOBJ
    string Builder_Codeassist_Variables_LBOBJ     = "call !a1900_Builder_Codeassist_Variables_LBOBJ"
    window action Builder_Codeassist_Variables_LBOBJ
    string Builder_Codeassist_Modules_LBOBJ       = "call !a1900_Builder_Codeassist_Modules_LBOBJ"
    window action Builder_Codeassist_Modules_LBOBJ
    string Builder_Codeassist_Commands_LBOBJ      = "call !a1900_Builder_Codeassist_Commands_LBOBJ"
    window action Builder_Codeassist_Commands_LBOBJ

    string Builder_Find_Find_PBOBJ                = "call !a1900_Builder_Find_Find_PBOBJ"
    string Builder_Find_Replace_PBOBJ             = "call !a1900_Builder_Find_Replace_PBOBJ"
    string Builder_Find_Replaceall_PBOBJ          = "call !a1900_Builder_Find_Replaceall_PBOBJ"
    string Builder_Find_Cancel_PBOBJ              = "call !a1900_Builder_Find_Cancel_PBOBJ"
    string Builder_Find_Matchcase_CBOBJ           = "call !a1900_Builder_Find_Matchcase_CBOBJ"

    string Builder_Debugfiles_View_PBOBJ          = "call !a1900_Builder_Debugfiles_View_PBOBJ"
    string Builder_Debugfiles_Close_PBOBJ         = "call !a1900_Builder_Debugfiles_Close_PBOBJ"
    string Builder_Debugfiles_Filelist_LBOBJ      = "call !a1900_Builder_Debugfiles_Filelist_LBOBJ"
    window action Builder_Debugfiles_Filelist_LBOBJ

    string Builder_Debugdata_Close_PBOBJ          = "call !a1900_Builder_Debugdata_Close_PBOBJ"

    string Builder_Stdcolors_Ok_PBOBJ             = "call !c100_Builder_Stdcolors_Ok_PBOBJ"
    string Builder_Stdcolors_Cancel_PBOBJ         = "call !c100_Builder_Stdcolors_Cancel_PBOBJ"
    string Builder_Stdcolors_More_PBOBJ           = "call !a400_Builder_Control_Color_PBOBJ"
    string Builder_Colors_Ok_PBOBJ                = "call !c100_Builder_Colors_Ok_PBOBJ"
    string Builder_Colors_Cancel_PBOBJ            = "call !c100_Builder_Colors_Cancel_PBOBJ"
    string Builder_Colors_Refresh_PBOBJ           = "call !c100_Builder_Colors_Refresh_PBOBJ"
    string Builder_Colors_Blueup_PBOBJ            = "call !c100_Builder_Colors_Blueup_PBOBJ"
    string Builder_Colors_Bluedown_PBOBJ          = "call !c100_Builder_Colors_Bluedown_PBOBJ"

    //***********************************
    //* Field Edits
    //***********************************
    string Builder_System_Title_EFOBJ            = "call !z999_entry_action_return"
    window action Builder_System_Title_EFOBJ
    window edit Builder_System_Title_EFOBJ mix 30

    string Builder_3090_Userid_EFOBJ             = "call !z999_entry_action_return"
    window action Builder_3090_Userid_EFOBJ
    window edit Builder_3090_Userid_EFOBJ upper 8

    string Builder_3090_Password_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Password_EFOBJ
    window edit Builder_3090_Password_EFOBJ upper 8

    string Builder_3090_Filename_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Filename_EFOBJ
    window edit Builder_3090_Filename_EFOBJ upper 8

    string Builder_3090_Fullname_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Fullname_EFOBJ
    window edit Builder_3090_Fullname_EFOBJ upper 50

    string Builder_Download3090_Userid_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Userid_EFOBJ
    window edit Builder_Download3090_Userid_EFOBJ upper 8

    string Builder_Download3090_Password_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Password_EFOBJ
    window edit Builder_Download3090_Password_EFOBJ upper 8

    string Builder_Download3090_From_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_From_EFOBJ
    window edit Builder_Download3090_From_EFOBJ upper 60

    string Builder_Download3090_To_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_To_EFOBJ
    window edit Builder_Download3090_To_EFOBJ lower 60

    string Builder_Download3090_Filter_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Filter_EFOBJ
    window edit Builder_Download3090_Filter_EFOBJ upper 8

    string Builder_Download3090_Extension_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Extension_EFOBJ
    window edit Builder_Download3090_Extension_EFOBJ lower 3
 
//*********************************************************************
//* Main Processing
//*********************************************************************
    open WindowFile Builder.win
    open MenuFile Builder.mnu

    //*************************
    //* Main Window Loop      *
    //*************************
    //trace=log
    window start noclose 
    print:"Processing Complete.
    exit
 
//*********************************************************************
//* Special Actions
//*********************************************************************
!a050_Escape
    ContinueConnecting = 'n'
    Builder_Language_Commands_MLOBJ = null
    window modify Builder_Language_Commands_MLOBJ
    ButtonConnectionType = null
!a050_Escape_2
    //window deletecontrol GroupRectangle error
    file PaintFile b fs:/,GroupRectangle,/ if (!eof) d;1
    file PaintFile b window paint Builder_Control_WIN
    DragGroupCreate = 'n'
    ButtonFocus = null
    window disable Builder_Control_Align_PBOBJ
    window disable Builder_Control_Copy_PBOBJ
    return

//******************************************
//* Default Window Processing
//******************************************
!a050_Default_Window_Processing
    window getfocus ButtonFocus
    //message = "Default window processing for @ButtonFocus@" window message info ok
    window getfocus ButtonFocus
    Builder_Control_Control_EFOBJ = ButtonFocus
    FocusSet = 'y'
    window modify Builder_Control_Control_EFOBJ
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ

    call !a400_Builder_Control_Focus_Controls_set

//******************************************
//* Check to see if connecting objects
//******************************************
    if-1  (ButtonConnectionType beginswith 'Straight')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'connect')
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'connect @left@ to'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@ @BentConnect@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    if-1  (ButtonConnectionType beginswith 'Bent')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'connect')
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'connect @left@ to'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@ @BentConnect@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    if-1  (ButtonConnectionType = 'Disconnect')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'disconnect')
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'disconnect @left@ from'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@ButtonFocus@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    return

//*****************************************
//* F1 = Focus to Language Command Entry
//*****************************************
!a100_F1
    window getfocus KeyFocusField
    if  (KeyFocusField = 'Builder_Language_Commands_MLOBJ')
+       window setfocus Builder_Control_WIN
+       window setfocus Builder_Control_Control_EFOBJ
+       return
+   endif
    window setfocus Builder_Language_WIN
    Builder_Language_Commands_MLOBJ = null
    window modify Builder_Language_Commands_MLOBJ
    window setfocus Builder_Language_Commands_MLOBJ
    return

//*****************************************
//* F2 = Repeat last Language Command
//*****************************************
!a100_F2
    window setfocus Builder_Language_WIN
    window setfocus Builder_Language_Commands_MLOBJ
    Builder_Language_Commands_MLOBJ = RepeatLine
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_PBOBJ
    return

//*****************************************
//* F3 = Show Previous Language Command
//*****************************************
!a100_F3
    file Repeat error open Repeat null
    window setfocus Builder_Language_WIN
    window setfocus Builder_Language_Commands_MLOBJ
    Builder_Language_Commands_MLOBJ = line
    b;1
    window modify Builder_Language_Commands_MLOBJ
    return

//*****************************************
//* F4 = Show Next Language Command
//*****************************************
!a100_F4
    file Repeat error open Repeat null
    window setfocus Builder_Language_WIN
    window setfocus Builder_Language_Commands_MLOBJ
    f;1
    Builder_Language_Commands_MLOBJ = line
    window modify Builder_Language_Commands_MLOBJ
    return

//*****************************************
//* F5 = Size the Window
//*****************************************
!a100_F5
    Builder_Language_Commands_MLOBJ = 'size window'
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_PBOBJ
    return

//*****************************************
//* F6 = Clear Control Name/Text fields
//*****************************************
!a100_F6
    window hwnd Builder_Control_WIN status error return
    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ
    Builder_Control_ControlText_EFOBJ = null
    window modify Builder_Control_ControlText_EFOBJ
    window setfocus Builder_Control_Control_EFOBJ 
    return

//*****************************************
//* Check to see if a key move is ok
//*****************************************
!a100_check_keymoveok
    KeyMoveOK = 'y'

    window hwnd Builder_Control_WIN status error KeyMoveOK = 'n' return

    KeyWindowOpen = 'y' window hwnd Builder_Textedit_WIN status error KeyWindowOpen = 'n'
    if  (KeyWindowOpen) KeyMoveOK = 'n' return

    KeyWindowOpen = 'y' window hwnd Builder_Stdcolors_WIN status error KeyWindowOpen = 'n'
    if  (KeyWindowOpen) KeyMoveOK = 'n' return

    KeyWindowOpen = 'y' window hwnd Builder_Colors_WIN status error KeyWindowOpen = 'n'
    if  (KeyWindowOpen) KeyMoveOK = 'n' return

    KeyWindowOpen = 'y' window hwnd Builder_Connectselect_WIN status error KeyWindowOpen = 'n'
    if  (KeyWindowOpen) KeyMoveOK = 'n' return

    KeyWindowOpen = 'y' window hwnd Builder_Specialobjects_WIN status error KeyWindowOpen = 'n'
    if  (KeyWindowOpen) KeyMoveOK = 'n' return

    window getfocus KeyFocusField
    //if  (KeyFocusField = 'Builder_Control_Control_EFOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_ControlText_EFOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_ControlList_COOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_Windownamelist_COOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_ControlType_COOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_Height_EFOBJ') KeyMoveOK = 'n' return
    if  (KeyFocusField = 'Builder_Control_Length_EFOBJ') KeyMoveOK = 'n' return

    return

//*****************************************
//* Up = Move object/group up
//*****************************************
!a100_WindowUp
    //message = 'Up pressed' window message info ok
    call !a100_check_keymoveok
    if  (KeyMoveOK) window push Builder_Control_SizeXMinus_PBOBJ
    return

//*****************************************
//* Down = Move object/group Down
//*****************************************
!a100_WindowDown
    //message = 'Down pressed' window message info ok
    call !a100_check_keymoveok
    if  (KeyMoveOK) window push Builder_Control_SizeXPlus_PBOBJ
    return

//*****************************************
//* Right = Move object/group Right
//*****************************************
!a100_WindowRight
    //message = 'Right pressed' window message info ok
    call !a100_check_keymoveok
    if  (KeyMoveOK) window push Builder_Control_SizeYPlus_PBOBJ
    return

//*****************************************
//* Up = Move object/group Left
//*****************************************
!a100_WindowLeft
    //message = 'Left pressed' window message info ok
    call !a100_check_keymoveok
    if  (KeyMoveOK) window push Builder_Control_SizeYMinus_PBOBJ
    return

//******************************************
//* Timer Module                           *
//******************************************
!a100_WindowTimer
    //***************************************
    //* Run a Delayed Command
    //***************************************
    if  (Delay)
+       DelayCount --
+       if (DelayCount < 1)
+          Delay = 'n'
+          $DelayCommand
+          DelayCommand = null
+          window timer off
+   endif

    //***************************************
    //* Debugging Semaphore Processing
    //***************************************
    if-1  (BeditDebug)
+       if-2 (exists beditsem.stp)
+          Builder_Codeassist_Debug_GBOBJ = 'Debug' window modify Builder_Codeassist_Debug_GBOBJ
+          //************************************
+          //* Debug Semaphore Ready
+          //************************************
+          //window hide Builder_Codeassist_WIN
+          //$DebugAction
+          DebugAction = null
+          window show Builder_Codeassist_WIN
+          window setfocus Builder_Codeassist_WIN
+          window paint Builder_Codeassist_WIN
+          close beditsem error
+          open beditsem beditsem.stp 
+          b
+          if-3  (line = 'FILELIST')
+              //************************************
+              //* FILELIST
+              //************************************
+              call !a100_filelist
+              close beditsem
+              do
+                  sleep 50
+                  system:"del beditsem.stp"
+              until (!exists beditsem.stp)
+          else-3
+          //message = line window message info ok
+          if-4  (line = 'FILEDATA')
+              //************************************
+              //* FILEDATA
+              //************************************
+              call !a100_filedata
+              close beditsem
+              do
+                  sleep 50
+                  system:"del beditsem.stp"
+              until (!exists beditsem.stp)
+          else-4
+              f;1
+              //************************************
+              //* Unpack the Varaible names and contents
+              //************************************
+              clear
+              copy;*
+              close DebugVars error
+              open DebugVars null
+              paste
+              call !a100_debugvars 
+              file beditsem
+              b
+              if-5  (line = 'STOP')
+                  //************************************
+                  //* STOP
+                  //************************************
+                  //message = 'STOP' window message info ok
+                  DEBUGHWND = null
+                  call !a1900_Builder_Codeassist_Debugstop_PBOBJ
+              else-5
+                  if-6  (line = 'ABORT')
+                      //************************************
+                      //* ABORT
+                      //************************************
+                      //message = 'ABORT' window message info ok
+                      call !a1900_Builder_Codeassist_Debugstop_PBOBJ
+                      window push Builder_Codeassist_Log_PBOBJ
+                  else-6
+                      if-7 (line beginswith "HWND:")
+                          //************************************
+                          //* HWND
+                          //************************************
+                          //message = line window message info ok
+                          scan:/@line/:/HWND:/
+                          DEBUGHWND = right
+                          call !a1900_Builder_Codeassist_Debuggo_PBOBJ
+                      else-7
+                          //************************************
+                          //* STEP to line
+                          //************************************
+                          b
+                          scan:/@line/:/:/
+                          BeditDebugLine = left
+                          scan:/@right/:/:/
+                          DebugBreakType = left
+                          scan:/@right/:/:/
+                          DEBUGHWND = left
+                          BeditDebugFile = right
+                          scan:/@BeditDebugFile@/:/./
+                          BeditDebugFile = left
+                          //message = 'SystemName[@SystemName@] Debug File[@BeditDebugFile@] BreakType[@DebugBreakType@] DEBUGHWND[@DEBUGHWND@] Going to process [@BeditDebugLine@] line[@line@]'
+                          //window message info ok
+                          close beditsem
+                          call !a100_CheckCallFile
+                          do
+                              sleep 50
+                              system:"del beditsem.stp"
+                          until (!exists beditsem.stp)
+                          //BeditDebugLine ++
+                          ErrorPos = BeditDebugLine
+                          call !a1900_Builder_Codeassist_Log_errorloc
+                          window setfocus Builder_Codeassist_WIN
+   endif

    if-1  (BeditDebug)
+       if-2 (exists beditsem.stp)
+           close beditsem error
+           do
+               sleep 50
+               system:"del beditsem.stp"
+           until (!exists beditsem.stp)
    return

//******************************************
//* See if a new file was called
//******************************************
!a100_CheckCallFile
    if  (DEBUGHWND = null)
+       window enable Builder_Codeassist_Debugstop_PBOBJ
+   else
+       window disable Builder_Codeassist_Debugstop_PBOBJ
+   endif
    if  (DebugBreakType = 'c')
+       //**********************************
+       //* Clear the Condition Breaks
+       //**********************************
+       close DebugConditionsFile
+       open DebugConditionsFile null
+   endif

    if (BeditDebugFile = null) 
+      BeditDebugFile = SystemName
+      return
+   endif
    if-1  (BeditDebugFile = SystemName)
+       window enable Builder_Codeassist_Code_PBOBJ
+       window enable Builder_Codeassist_Debugsetbrks_PBOBJ
+       window enable Builder_Codeassist_Find_PBOBJ
+       if-2  (BeditDebugOldFile != SystemName)
+           //***********************************
+           //* Returning to original Prog after Call
+           //***********************************
+           OldModName = null
+           return
+       else-2
+           //***********************************
+           //* Running Original Prog
+           //***********************************
+           return
+   endif

    if  (BeditDebugFile = BeditDebugOldFile)
+       //***********************************
+       //* Called Prog Running - no change
+       //***********************************
+       return
+   else
+       //***********************************
+       //* Call a new program
+       //***********************************
+       window disable Builder_Codeassist_Code_PBOBJ
+       window disable Builder_Codeassist_Debugsetbrks_PBOBJ
+       window disable Builder_Codeassist_Find_PBOBJ
+       BeditDebugOldFile = BeditDebugFile
+       Builder_Codeassist_Code_LBOBJ = 'ALL'
+       window delete Builder_Codeassist_Code_LBOBJ
+       close BeditDebugCallFile error
+       MacroCommand = 'open BeditDebugCallFile @BeditDebugFile@.bed error return'
+       $MacroCommand
+       b
+       int    LineCount    error
+       string LineCountStr error
+       LineCount = 0
+       do
+           LineCount ++
+           LineCountStr = '000000@LineCount@'
+           splitr:/@LineCountStr@/;5
+           Builder_Codeassist_Code_LBOBJ = '@right@ @line@'
+           window insert end default Builder_Codeassist_Code_LBOBJ
+           f;1
+       until (eof)
        close BeditDebugCallFile
        Builder_Codeassist_Code_STTXT = 'Code : @BeditDebugFile@'
        window modify Builder_Codeassist_Code_STTXT
        OldModName = BeditDebugFile
    return

//******************************************
//* List of Files Requested
//******************************************
!a100_filelist
    f;1
    window pointer wait
    window hwnd Builder_Debugfiles_WIN status error window open Builder_Debugfiles_WIN shade
    window center Builder_Debugfiles_WIN
    window clear Builder_Debugfiles_WIN

    Builder_Debugfiles_Filelist_LBOBJ = 'ALL'
    window delete Builder_Debugfiles_Filelist_LBOBJ
    window paint Builder_Debugfiles_Filelist_LBOBJ
    do
        if (!eof)
+          Builder_Debugfiles_Filelist_LBOBJ = line
+          window insert end default Builder_Debugfiles_Filelist_LBOBJ
+          f;1
+       endif
    until (eof)

    Builder_Debugfiles_Filelist_LBOBJ = 'INDEX=1'
    window select Builder_Debugfiles_Filelist_LBOBJ
    Builder_Debugfiles_Filelist_LBOBJ = null

    window show Builder_Debugfiles_WIN
    window pointer arrow
    return

//******************************************
//* Show the File Data
//******************************************
!a100_filedata
    int    DataCount    error
    string DataCountStr error
    int    LinePos      error

    b
    f;1
    if (eof) return
    window pointer wait
    window hwnd Builder_Debugdata_WIN status error window open Builder_Debugdata_WIN shade
    window center Builder_Debugdata_WIN
    window clear Builder_Debugdata_WIN
    Builder_Debugdata_Filedata_LBOBJ = 'ALL'
    window delete Builder_Debugdata_Filedata_LBOBJ
    window paint Builder_Debugdata_Filedata_LBOBJ
    Builder_Debugdata_Filedata_LBOBJ = null
    Builder_Debugdata_Filename_STTXT = line
    window modify Builder_Debugdata_Filename_STTXT
    f;1 
    LinePos = line
    if (LinePos < 1) LinePos = 1
    //message = 'Line Pos[@LinePos@]' window message info ok
    DataCount = 0
    f;1
    do
        if  (!eof)
+           DataCount ++
+           DataCountStr = '000000@DataCount@'
+           splitr:/@DataCountStr@/;6
+           Builder_Debugdata_Filedata_LBOBJ = '@right@ @line@'
+           window insert end default Builder_Debugdata_Filedata_LBOBJ
+           f;1
+       endif
    until (eof)
    Builder_Debugdata_Filedata_LBOBJ = 'INDEX=@LinePos@'
    window select Builder_Debugdata_Filedata_LBOBJ
    Builder_Debugdata_Filedata_LBOBJ = null
    window show Builder_Debugdata_WIN
    window pointer arrow
    return

//******************************************
//* Load the Variables with Debug data
//******************************************
!a100_debugvars
    string SelectedVar    error
    int    SelectVarCount error

    //**********************************************
    //* Find the selected variable
    //**********************************************
    Builder_Codeassist_Variables_LBOBJ = null
    window obtain Builder_Codeassist_Variables_LBOBJ
    if  (Builder_Codeassist_Variables_LBOBJ = null) 
+       SelectedVar = null
+       goto !a100_Debugvars_clear
+   endif
    scan:/@Builder_Codeassist_Variables_LBOBJ@/:/[/
    SelectedVar = left

!a100_Debugvars_clear
    //**********************************************
    //* Clear and load the variavbles from bedit.exe
    //**********************************************
    Builder_Codeassist_Variables_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Variables_LBOBJ
    window paint Builder_Codeassist_Variables_LBOBJ
    file DebugVars
    b
    do
        if  (!eof)
+           Builder_Codeassist_Variables_LBOBJ = line
+           window insert end default Builder_Codeassist_Variables_LBOBJ
+           f;1
+       endif
    until (eof)
    //**********************************************
    //* Re-select the previously selected var
    //**********************************************
    if  (SelectedVar = null) return
    SelectVarCount = 0
    do
        SelectVarCount ++
        Builder_Codeassist_Variables_LBOBJ = 'INDEX=@SelectVarCount@'
        window obtain Builder_Codeassist_Variables_LBOBJ
        if  (Builder_Codeassist_Variables_LBOBJ != null)
+           scan:/@Builder_Codeassist_Variables_LBOBJ@/:/[/
+           if  (left = SelectedVar)
+               BumpIndex = SelectVarCount + 5
+               Builder_Codeassist_Variables_LBOBJ = 'INDEX=@BumpIndex@'
+               window select Builder_Codeassist_Variables_LBOBJ
+               window paint Builder_Codeassist_Variables_LBOBJ
+               Builder_Codeassist_Variables_LBOBJ = 'INDEX=@SelectVarCount@'
+               window select Builder_Codeassist_Variables_LBOBJ
+               Builder_Codeassist_Variables_LBOBJ = null
+               return
+       endif
    until (Builder_Codeassist_Variables_LBOBJ = null)

    return

//******************************************
//* Main Window Initialization Routine     *
//******************************************
!a100_WindowInit
    int WinX      error
    int WinY      error
    int WinCX     error
    int WinCY     error
    int MainX     error
    int MainY     error
    int MainCX    error
    int MainCY    error

    int DrawX     error
    int DrawY     error
    int DrawCX    error
    int DrawCY    error

    Presentation = "Windows"
    window check Builder_Main_Windows_MSOBJ
    window uncheck Builder_Main_Html_MSOBJ

    //******************************************************
    //* Make called routines permenant
    //******************************************************
    //perm BuilderLang.bed
    //perm BuilderConnect.bed

    open FindDir null
    systemcurr:"dir"
    b
    fs:/Directory of/
    scanr:/@line/:word
    Directory = right
    HomeDirectory = right
    close FindDir
    
    window open Builder_Language_WIN shade
    //******************************************************
    //* Size the Language Interface Window
    //******************************************************
    MacroCommand = |window windowpos MAIN MainX MainY MainCX MainCY| $MacroCommand
    MacroCommand = |window windowpos Builder_Language_WIN WinX WinY WinCX WinCY| $MacroCommand
    //message = 'Main Window X[@MainX@] Y[@MainY@] CX[@MainCX@] CY[@MainCY@]' window message info ok
    WinX = MainX
    WinCX = MainCX
    if  (MainCY < 1000) 
+       //*******************
+       //* Laptop Resolution
+       //*******************
+       WinCY = 60 
+   endif
    WinY = MainCY - WinCY - 40
    window show Builder_Language_WIN
    MacroCommand = 'window size Builder_Language_WIN @WinX@ @WinY@ @WinCX@ @WinCY@' $MacroCommand

    DrawX = MainX + 5
    DrawY = MainY + 70
    DrawCX = MainCX - 30
    DrawCY = MainCY - 240

    //******************************************************
    //* Size the Main Window
    //******************************************************
    MainCY = MainCY - WinCY - 40
    MacroCommand = 'window size MainWindow @MainX@ @MainY@ @MainCX@ @MainCY@' $MacroCommand


    //******************************************************
    //* Position the Earth Image
    //******************************************************
    close PaintFile error
    open PaintFile Builder.pnt error open PaintFile null
    //message = 'MainCX[@MainCX@] MainCY[@MainCY@]' window message info ok

    WinX = MainCX / 5
    WinY = MainCY / 3

    MacroCommand = "i:/MainWindow,EarthBitmap,Bitmap,@WinX@,@WinY@,BuilderEarth.bmp/" 
    $MacroCommand
    EarthBitmapLine = line
    //i:/******************/
    //i:/******************/
    //i:/******************/
    b
    window paint MainWindow

    //******************************************************
    //* Size the Language Entry Field
    //******************************************************
    WinX = 2
    WinY = 2
    WinCX = MainCX - 20
    WinCY = 20
    MacroCommand = 'window size Builder_Language_Commands_MLOBJ @WinX@ @WinY@ @WinCX@ @WinCY@' $MacroCommand

    window setfocus Builder_Language_Commands_MLOBJ
    call !w200_setup_backup

    //******************************************************
    //* Open Tasks if tasks are pending
    //******************************************************
    if  (!WindowInitFirst) return
    WindowInitFirst = 'n'
    open TempTasks TaskTrack.dat error return
    f;*
    if (pcount > 0)
+      call !a110_Builder_Main_Tasktrack_MSOBJ
+   endif
    close TempTasks    

    return
 
//******************************************
//* Main Window Wrapup Routine             *
//******************************************
!a100_WindowWrap
    return
 
//******************************************
//* Mouse Button 1 Down                    *
//******************************************
!a100_WindowDown1
    //message = '!a100_WindowDown1' window message info ok

    //***************************************
    //* Builder_Specialobjects_WIN
    //***************************************
    window hwnd Builder_Specialobjects_WIN status error goto !a100_WindowDown1_colors
    window obtain Builder_Control_Control_EFOBJ
    //message = Builder_Control_Control_EFOBJ window message info ok
    scan:/@Builder_Control_Control_EFOBJ/:/_/
    if  (!found)
+       mix Builder_Control_Control_EFOBJ
+       window modify Builder_Control_Control_EFOBJ
+   endif
    //message = '!a100_WindowDown1 Specialobjects' window message info ok
    window mousepos Xpos Ypos
    //if  (Xpos < 1) Xpos = 1
    //if  (Xpos > 390) Xpos = 390
    //if  (Ypos < 1) Ypos = 1
    //if  (Ypos > 400) Ypos = 400
    //message = 'Xpos[@Xpos@] Ypos[@Ypos@]' window message info ok
    file PaintFile
    b
    fs:/Builder_Specialobjects_WIN/
    if  (eof) return
    do
        scan:/@line/:/,/
        if  (left != "Builder_Specialobjects_WIN") return
        scan:/@right/:/,/
        ObjectName = left
        scan:/@right/:/,/
        ObjectType = left
        scan:/@right/:/,/
        PosX = left
        scan:/@right/:/,/
        PosY = left
        scan:/@right/:/,/
        PosCX = left
        scan:/@right/:/,/
        PosCY = left

        //**********************************
        //* Adjust Ellipse/Circle X/Y position
        //**********************************
        if-1  (ObjectType beginswith 'Ellipse') or (ObjectType = 'Circle')
+           TempWork = PosCX / 2
+           PosX -= TempWork
+           TempWork = PosCY / 2
+           PosY -= TempWork
+       endif

        //**********************************
        //* Non Line,Text,Arrow Objects
        //**********************************
        if-1  (ObjectType beginswith 'Line') or (ObjectType beginswith 'Text') or (ObjectType beginswith 'Arrow')
+       else-1
+           PosCX += PosX
+           PosCY += PosY
+           if-2  (Xpos >= PosX) and (Xpos <= PosCX) and (Ypos >= PosY) and (Ypos <= PosCY)
+               Builder_Control_ControlType_COOBJ = ObjectType
+               SpecialControlType = ObjectType
+               call !a100_down1_specialobjects_boxes
+               call !a400_Builder_Control_Create_PBOBJ_past_special
+               call !a400_Builder_Specialobjects_Cancel_PBOBJ
+               return
+       endif

        //**********************************
        //* Large Arrow Objects
        //**********************************
        if-1  (ObjectType beginswith 'Arrow')
+           split:/@ObjectType/;5
+           TempWork = right
+           if  (TempWork > 4)
+               PosCX += PosX
+               PosCY += PosY
+               if-2  (Xpos >= PosX) and (Xpos <= PosCX) and (Ypos >= PosY) and (Ypos <= PosCY)
+                   Builder_Control_ControlType_COOBJ = ObjectType
+                   SpecialControlType = ObjectType
+                   //call !a100_down1_specialobjects_boxes
+                   call !a400_Builder_Control_Create_PBOBJ_past_special
+                   call !a400_Builder_Specialobjects_Cancel_PBOBJ
+                   return
+       endif

        f;1
    until (eof)
    return

//*****************************************
//* Special Objects selected using Boxes
//*****************************************
!a100_down1_specialobjects_boxes
    //message = '!a100_down1_specialobjects_boxes ObjectName[@ObjectName@]' window message info ok
    if  (ObjectName = 'Builder_Specialobjects_Linebox_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Line'
+       SpecialControlType = 'Line'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Arrow1box_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Arrow'
+       SpecialControlType = 'Arrow'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Arrow2box_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Arrow2'
+       SpecialControlType = 'Arrow2'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Arrow3box_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Arrow3'
+       SpecialControlType = 'Arrow3'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Arrow4box_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Arrow4'
+       SpecialControlType = 'Arrow4'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Textbox_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'Text'
+       SpecialControlType = 'Text'
+       return
+   endif
    if  (ObjectName = 'Builder_Specialobjects_Texttiltbox_Rectangle')
+       Builder_Control_ControlType_COOBJ = 'TextTilt'
+       SpecialControlType = 'TextTilt'
+       return
+   endif

    return

!a100_WindowDown1_colors
    //***************************************
    //* Builder_Colors_WIN
    //***************************************
    window hwnd Builder_Colors_WIN status error goto !a100_WindowDown1_Stdcolors
    //message = '!a100_WindowDown1 Colors' window message info ok
    window mousepos Xpos Ypos
    if  (Xpos < 10) Xpos = 10
    if  (Xpos > 265) Xpos = 265
    if  (Ypos < 10) Ypos = 10
    if  (Ypos > 265) Ypos = 265

    SearchString = 'Builder_Colors_WIN,ColorPoint,Point,@Xpos@,@Ypos@'

    //message = SearchString window message info ok

    file PaintFile
    b
    fs:/@SearchString@/
    if (eof) 
+      return
+   endif
    scan:/@line/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    Builder_Colors_Red_EFOBJ = left
    scan:/@right/:/,/
    Builder_Colors_Green_EFOBJ = left
    scan:/@right/:/,/
    Builder_Colors_Blue_EFOBJ = left
    window modify Builder_Colors_Red_EFOBJ
    window modify Builder_Colors_Green_EFOBJ
    window modify Builder_Colors_Blue_EFOBJ
    
    Red = Builder_Colors_Red_EFOBJ
    Green = Builder_Colors_Green_EFOBJ
    Blue = Builder_Colors_Blue_EFOBJ

    b
    fs:/Builder_Colors_WIN,SampleBox/
    if (!eof) d;1
    b;1
    Newline = 'Builder_Colors_WIN,SampleBox,Box,296,200,30,30,@Red@,@Green@,@Blue@'
    i:/@Newline@/
    b
    window paint Builder_Colors_WIN
    return

!a100_WindowDown1_Stdcolors
    //***************************************
    //* Builder_Stdcolors_WIN
    //***************************************
    window hwnd Builder_Stdcolors_WIN status error goto !a100_WindowDown1_bubble
    //message = '!a100_WindowDown1_Stdcolors' window message info ok
    window mousepos Xpos Ypos
    file PaintFile error open PaintFile null
    b
    do
        fs:/Builder_Stdcolors_WIN/
        if-1  (!eof)
+           scan:/@line/:/,/
+           scan:/@right/:/,/
+           scan:/@right/:/,/
+           scan:/@right/:/,/
+           PosX = left
+           scan:/@right/:/,/
+           PosY = left
+           scan:/@right/:/,/
+           PosCX = left
+           scan:/@right/:/,/
+           PosCY = left
+           scan:/@right/:/,/
+           HoldRed = left
+           scan:/@right/:/,/
+           HoldGreen = left
+           HoldBlue = right
+           PosCX += PosX
+           PosCY += PosY
+           if-2  (Xpos >= PosX) and (Xpos <= PosCX) and (Ypos >= PosY) and (Ypos <= PosCY)
+               TestRed = HoldRed
+               TestGreen = HoldGreen
+               TestBlue = HoldBlue
+               Drag = 'n'
+               call !a100_WindowUp1
+               call !c100_Builder_Stdcolors_Ok_PBOBJ
+               return
+       endif
        f;1
    until (eof)
    return

!a100_WindowDown1_bubble
    //***************************************
    //* Builder_View_WIN
    //***************************************
    window hwnd Builder_View_WIN status error goto !a100_WindowDown1_controls
    scan:/@BubbleDesc/:/->/
    if  (found) goto !a100_WindowDown1_controls
    ClickFilter = 'y'
    scan:/@BubbleDesc@/:/_/
    if  (!found)
+       scan:/@BubbleDesc@/:/-/
+   endif
    if  (BubbleDesc = null)
+       call !a550_Builder_Filter_Cancel_PBOBJ
+       return
+   endif
    Builder_Filter_Windowlist_LBOBJ = '@BubbleDesc@:\|@left@'
    close BubbleFile error
    open BubbleFile null
    call !a550_Builder_Filter_OK_PBOBJ
    ClickFilter = 'n'
    window deletecontrol Bubble error
    return

!a100_WindowDown1_controls
    //***************************************
    //* Builder_Controls_WIN
    //***************************************
    window hwnd Builder_Control_WIN status error goto !a100_pass_control
    window mousepos Xpos Ypos   
    file PaintFile error open PaintFile null
    b
    do
        fs:/Builder_Control_WIN,/
        if-1  (!eof)
+           scan:/@line/:/,/
+           scan:/@right/:/,/
+           HoldControlName = left
+           scan:/@HoldControlName/:/.Text_/
+           if-2 (HoldControlName != 'Connector') and (!found)
+               scan:/@right/:/,/
+               HoldType = left
+               scan:/@right/:/,/
+               ObjectX = left
+               scan:/@right/:/,/
+               ObjectY = left
+               scan:/@right/:/,/
+               ObjectCX = left
+               scan:/@right/:/,/
+               ObjectCY = left
+               call !a100_paintfile_object_type
+               ObjectCX += TestX
+               ObjectCY += TestY
+               call !a100_WindowDown1_controls_check
+       endif
        f;1
    until (eof)        

!a100_pass_control
    //***************************************
    //* Other
    //***************************************
    //message = '!a100_WindowDown1_controls' window message info ok
    BubbleClick = 'y'
    call !a100_WindowMouse
    if  (!MouseOK) return
    Drag = 'y'
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ
    return

//******************************************
//* Check to see if a control is found to drag
//******************************************
!a100_WindowDown1_controls_check
    if  (HoldType beginswith 'Line')
+       return
+   endif    
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           return
+   endif  
    if  (Xpos >= TestX) and (Xpos <= ObjectCX) and (Ypos >= TestY) and (Ypos <= ObjectCY)
+            ButtonFocus = HoldControlName
+            Builder_Control_ControlList_COOBJ = ButtonFocus
+            call !a400_Builder_Control_Focus_PBOBJ_2
+            call !a050_Escape_2
+            call !a100_check_connect
+            f;*
+            return
+   endif
    return

//******************************************
//* Check to see if connecting objects
//******************************************
!a100_check_connect
    if-1  (ButtonConnectionType beginswith 'Straight')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'connect')
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'connect @left@ to'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@ @BentConnect@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    if-1  (ButtonConnectionType beginswith 'Bent')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'connect')
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'connect @left@ to'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@ @BentConnect@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    if-1  (ButtonConnectionType = 'Disconnect')
+       window obtain Builder_Language_Commands_MLOBJ
+       if-2  (Builder_Language_Commands_MLOBJ = 'disconnect')
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = 'disconnect @left@ from'
+           window modify Builder_Language_Commands_MLOBJ
+           return
+       else-2
+           scan:/@HoldControlName@/:/_/
+           scan:/@right/:/_/
+           scan:/@right/:/_/
+           Builder_Language_Commands_MLOBJ = '@Builder_Language_Commands_MLOBJ@ @left@'
+           window modify Builder_Language_Commands_MLOBJ
+           call !a450_Builder_Language_Apply_PBOBJ
+           call !a100_continue_connecting
+   endif
    return

//******************************************
//* Continue connecting objects
//******************************************
!a100_continue_connecting
    //message = '!a100_continue_connecting ContinueConnecting[@ContinueConnecting@]' window message info ok
    if  (!ContinueConnecting)
+       ButtonConnectionType = null
+       return
+   endif
    Builder_Language_Commands_MLOBJ = 'connect'
    window modify Builder_Language_Commands_MLOBJ
    return

//******************************************
//* Mouse Button 1 Up                      *
//******************************************
!a100_WindowUp1
    if  (!MouseOK) return
    Drag = 'n'
    return

//******************************************
//* Mouse Button 2 Down                    *
//******************************************
!a100_WindowDown2
    window hwnd Builder_Stdcolors_WIN status error goto !a100_WindowDown2_process
    Drag = 'n'
    return

!a100_WindowDown2_process
    //message = '!a100_WindowDown2' window message info ok
    if  (!MouseOK) return
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ
    Drag = 'y'
    return

//******************************************
//* Mouse Button 2 Up                      *
//******************************************
!a100_WindowUp2
    //message = '!a100_WindowUp2' window message info ok
    if  (!MouseOK) return
    Drag = 'y'
    ButtonFocus = 'GroupRectangle'
    return

//******************************************
//* Mouse Button 3 Down                    *
//******************************************
!a100_WindowDown3
    if  (!MouseOK) return
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ
    FocusSet = 'n'
    DragGroupCreate = 'y'
    //window deletecontrol GroupRectangle error
    file PaintFile b fs:/,GroupRectangle,/ if (!eof) d;1
    file PaintFile b window paint Builder_Control_WIN
    Text = null
    GroupDragX = Xpos
    GroupDragY = Ypos
    GroupDragCX = 2
    GroupDragCY = 2
    //window createcontrol Builder_Control_WIN GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY STTXTR @Text
    file PaintFile error open PaintFile null
    b
    fs:/,GroupRectangle,/
    if (!eof) d;1
    b
    Newline = 'Builder_Control_WIN,GroupRectangle,Box,@GroupDragX@,@GroupDragY@,@GroupDragCX@,@GroupDragCY@,250,250,250'
    i:/@Newline@/
    return

//******************************************
//* Mouse Button 3 Up                      *
//******************************************
!a100_WindowUp3
    window hwnd Builder_View_WIN status error goto !a100_WindowUp3_controls
    if  (ViewSingleProg) and (!Builder_Import_Viewfiles_RBOBJ) and (!Builder_Import_Viewvars_RBOBJ)
+   else
+       goto !a100_WindowUp3_controls
+   endif
    ClickView = 'y'

    if  (BubbleDesc = null)
+       call !a500_Builder_View_Open_PBOBJ
+       return
+   endif

    Builder_Filter_Windowlist_LBOBJ = BubbleDesc
    call !a550_Builder_Filter_View_PBOBJ
    ClickView = 'n'
    window deletecontrol Bubble error
    return

!a100_WindowUp3_controls

    if  (!MouseOK) return
    DragGroupCreate = 'n'
    //Drag = 'y'
    ButtonFocus = 'GroupRectangle'
    FocusSet = 'n'
    window enable Builder_Control_Color_PBOBJ

    //***********************************
    //* Find the Controls in the Group
    //***********************************
    GroupPosCX = GroupDragX + GroupDragCX
    GroupPosCY = GroupDragY + GroupDragCY

    close GroupControls error
    open GroupControls null
    file Controls error open Controls null
    b
    do
        if (eof) goto !a100_WindowUp3_done
        scan:/@line/:/,/
        ControlName = left
        ObjectX = 0
        ObjectY = 0
        ObjectCX = 0
        ObjectCY = 0
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY error         
        GroupObjPosCX = ObjectX + ObjectCX
        GroupObjPosCY = ObjectY + ObjectCY
        if  (ObjectX >= GroupDragX) and (ObjectY >= GroupDragY) and (GroupObjPosCX <= GroupPosCX) and (GroupObjPosCY <= GroupPosCY)
+           file GroupControls
+           call !a100_WindowUp3_Offset
+           Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
+           i:/@Newline@/
+       endif
        file Controls error open Controls null
        f;1
    until (eof)

!a100_WindowUp3_done
    window enable Builder_Control_Align_PBOBJ
    window enable Builder_Control_Copy_PBOBJ
    //write PaintFile PaintFile.dat
    file PaintFile
    b
    do
        fs:/Builder_Control_WIN,/
        if  (eof) goto !a100_WindowUp3_cleanup
        scan:/@line/:/,/
        HoldWindowName = left
        scan:/@right/:/,/
        ControlName = left
        scan:/@right/:/,/
        HoldType = left
        if  (HoldWindowName = 'Builder_Control_WIN') and (ControlName != 'GroupRectangle') and (HoldType != 'Bitmap') 
+           scan:/@right/:/,/
+           ObjectX = left
+           scan:/@right/:/,/
+           ObjectY = left
+           scan:/@right/:/,/
+           ObjectCX = left
+           scan:/@right/:/,/
+           ObjectCY = left
+           call !a100_paintfile_object_type
+           GroupObjPosCX = TestX + ObjectCX
+           GroupObjPosCY = TestY + ObjectCY
+           //message = 'debug checking line[@line@] ControlName[@ControlName@] ObjectX[@ObjectX@] ObjectY[@ObjectY@] ObjectCX[@ObjectCX@] ObjectCY[@ObjectCY@] GroupDragX[@GroupDragX@] GroupDragY[@GroupDragY@] GroupObjPosCX[@GroupObjPosCX@]  GroupObjPosCY[@GroupObjPosCY@] GroupDragPosCX[@GroupPosCX@] GroupDragPosCY[@GroupPosCY@]' window message info ok
+           if  (TestX >= GroupDragX) and (TestY >= GroupDragY) and (GroupObjPosCX <= GroupPosCX) and (GroupObjPosCY <= GroupPosCY)
+               //message = 'debug keeping line[@line@] ControlName[@ControlName@] ObjectX[@ObjectX@] ObjectY[@ObjectY@] ObjectCX[@ObjectCX@] ObjectCY[@ObjectCY@] GroupDragX[@GroupDragX@] GroupDragY[@GroupDragY@] GroupObjPosCX[@GroupObjPosCX@]  GroupObjPosCY[@GroupObjPosCY@] GroupDragPosCX[@GroupPosCX@] GroupDragPosCY[@GroupPosCY@]' window message info ok
+               file GroupControls
+               call !a100_WindowUp3_Offset
+               Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
+               i:/@Newline@/
+               file PaintFile
+       endif
        f;1
    until (eof)

!a100_WindowUp3_cleanup


    return

//********************************
//* Correct position for some objects
//********************************
!a100_paintfile_object_type
    TestX = ObjectX
    TestY = ObjectY

    if  (HoldType = 'Text') and (ButtonFocus != 'GroupRectangle')
+       CharCount = 0
+       scanr:/@line/:/,/
+       do
+           split:/@right/;1
+           CharCount ++
+       until (right = null)
+       //ObjectCY = ObjectCX
+       ObjectCX = ObjectCX * CharCount * 2 / 3
+   endif

    if  (ObjectCX = 0) ObjectCX = 100
    if  (ObjectCY = 0) ObjectCY = ObjectCX

    if  (HoldType = 'Circle') or (HoldType = 'Ellipse') or (HoldType = 'Ellipse3D')
+       TempWork = ObjectCX / 2
+       TestX -= TempWork
+       TempWork = ObjectCY / 2
+       TestY -= TempWork
+   endif
    if  (HoldType = 'Diamond')
+       TempWork = ObjectCX / 2
+       TestX -= TempWork
+   endif
    return

//********************************
//* Calculate the Object's Offset
//********************************
!a100_WindowUp3_Offset
    GroupObjXOffset = ObjectX - GroupDragX
    if (GroupObjXOffset < 1)
+      GroupObjXOffset = 1
+   endif
    GroupObjYOffset = ObjectY - GroupDragY
    if (GroupObjYOffset < 1)
+      GroupObjYOffset = 1
+   endif
    return

//******************************************
//* Mouse Movement                         *
//******************************************
!a100_WindowMouse
    window hwnd Builder_View_WIN status error goto !a100_WindowMouse_drag

    //*********************************
    //* Bubble Full View Names
    //*********************************

    window mousepos Xpos Ypos
    if  (!BubbleClick)
+       if (Xpos = XposLast) and (Ypos = YposLast)
+          return
+   endif
    if  (BubbleClick)
+       BubbleClick = 'n'
+       LastBubble = null
+   else
+       BubbleLine = 0
+   endif
    XposLast = Xpos
    YposLast = Ypos

    //BubbleDesc = null

    file BubbleFile error return
    b
    if  (BubbleLine) f;@BubbleLine
    do
        if-1 (!eof)
+           scan:/@line/:/,/
+           ObjectX = left
+           scan:/@right/:/,/
+           ObjectY = left
+           scan:/@right/:/,/
+           ObjectCX = left
+           scan:/@right/:/,/
+           ObjectCY = left
+           if-2  (Xpos >= ObjectX) and (Xpos <= ObjectCX) and (Ypos >= ObjectY) and (Ypos <= ObjectCY)
+               NewBubble = "@ObjectX@@ObjectY@"
+               BubbleLine = lineno
+               if-3  (NewBubble != LastBubble)
+                   window deletecontrol Bubble error
+                   BubbleDesc = "@right@"
+                   size BubbleDesc,99
+                   Ypos -= 20
+                   window createcontrol Builder_View_WIN Bubble @Xpos @Ypos 400 20 STTXT1 @BubbleDesc error
+                   LastBubble = NewBubble
+                   return
+               else-3
+                   Ypos -= 20
+                   window size Bubble @Xpos @Ypos 400 20 error
+                   window paint Bubble error
+                   return
+       endif
        f;1
    until (eof)
    window deletecontrol Bubble error
    BubbleDesc = null
    LastBubble = null
    BubbleLine = 0
    return

!a100_WindowMouse_drag
    window hwnd Builder_Control_WIN status error return
    if  (!MouseOK) return
    window mousepos Xpos Ypos

    if  (Xpos < MinX) or (Xpos > MaxX) or (Ypos < MinY) or (Ypos > MaxY) //return

    Xpos ++
    Ypos ++

    if  (Ypos < 50) return

    XposDisplay = Xpos - MinX
    YposDisplay = Ypos - MinY

    Builder_Control_Xpos_STTXT = XposDisplay
    window modify Builder_Control_Xpos_STTXT
    Builder_Control_Ypos_STTXT = YposDisplay
    window modify Builder_Control_Ypos_STTXT

    //*********************************************
    //* Update the Height/Length of Focus Window
    //*********************************************    
    if  (FocusSet)
+       window obtain @Builder_Control_Control_EFOBJ
+       ButtonFocus = Builder_Control_Control_EFOBJ
+       window exists @ButtonFocus
+       if (status)
+          window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+          Builder_Control_Length_EFOBJ = ObjectCX
+          window modify Builder_Control_Length_EFOBJ
+          Builder_Control_Height_EFOBJ = ObjectCY
+          window modify Builder_Control_Height_EFOBJ
+          ObjectX = ObjectX - MinX
+          Builder_Control_X_EFOBJ = ObjectX
+          window modify Builder_Control_X_EFOBJ
+          ObjectY = ObjectY - MinY
+          Builder_Control_Y_EFOBJ = ObjectY
+          window modify Builder_Control_Y_EFOBJ
+   endif

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       WinX = Xpos
+   else
+       WinX = Xpos + ObjectCX
+   endif
    //******************************************
    //* Restrict Control Scrolling Beyond Window
    //******************************************

//    if-1  (FocusSet) and (status) and (Drag)
//+       //*** Right
//+       if  (WinX > MaxX)
//+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+           ObjectX = MaxX - ObjectCX - 5 
//+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+           ObjectX -= MinX
//+           Builder_Control_X_EFOBJ = ObjectX
//+           window modify Builder_Control_X_EFOBJ
//+           return
//+   endif

    if  (Builder_Control_Size_RBOBJ)
+       WinY = Ypos
+   else
+       WinY = Ypos + ObjectCY
+   endif
//    if  (FocusSet) and (status) and (Drag)
//+       //*** Down
//+       if  (WinY > MaxY)
//+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+           ObjectY = MaxY - ObjectCY - 5
//+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+           ObjectY -= MinY
//+           Builder_Control_Y_EFOBJ = ObjectY
//+           window modify Builder_Control_Y_EFOBJ
//+           return
//+   endif

    if (!DragGroupCreate)
+      goto !a100_WindowMouse_Drag
+   endif
    //**********************************
    //* Size the Group Drag Rectangle
    //**********************************
    GroupDragCX = Xpos - GroupDragX
    GroupDragCY = Ypos - GroupDragY
    if (GroupDragCX < 2)
+        GroupDragCX = 2
+   endif
    if (GroupDragCY < 2)
+        GroupDragCY = 2
+   endif
    //window size GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY
    file PaintFile
    b
    fs:/,GroupRectangle,/
    Newline = 'Builder_Control_WIN,GroupRectangle,Box,@GroupDragX@,@GroupDragY@,@GroupDragCX@,@GroupDragCY@,250,250,250'
    if (eof)
+      b
+      i:/@Newline/
+   else
+      r:/@Newline/
+   endif
    b
    //***********************
    //* Repaint Controls
    //***********************
    file Controls error open Controls null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          MacroCommand = 'window paint @left@ error'
+          $MacroCommand
+       endif
        f;1
    until (eof)
    call BuilderConnect.bed!m100_update_connect
    file PaintFile b window paint Builder_Control_WIN
    return

!a100_WindowMouse_Drag
    if  (!Drag) return
    if (ButtonFocus = 'GroupRectangle')
+      goto !a100_WindowMouse_Drag_Group
+   endif

    window getfocus @ButtonFocus
    if (FocusSet)
+      window obtain @Builder_Control_Control_EFOBJ
+      ButtonFocus = Builder_Control_Control_EFOBJ
+   endif
    //*********************************************
    //* Don't drag control Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_/
    if (found) 
+      return
+   endif

    window exists @ButtonFocus
    if (!status) 
+      call !a100_windowmouse_drag_paintfile
+      return
+   endif

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       if  (Xpos > ObjectX)
+           ObjectCX = Xpos - ObjectX - 2
+   endif
    if  (Builder_Control_Size_RBOBJ)
+       if  (Ypos > ObjectY)
+           ObjectCY = Ypos - ObjectY - 2
+   endif
    if  (Builder_Control_Size_RBOBJ)
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
+       Builder_Control_Length_EFOBJ = ObjectCX
+       window modify Builder_Control_Length_EFOBJ
+       Builder_Control_Height_EFOBJ = ObjectCY
+       window modify Builder_Control_Height_EFOBJ
+   else
+       window size @ButtonFocus @Xpos @Ypos @ObjectCX @ObjectCY
+   endif

    call !b400_repaint_control

    return

!a100_windowmouse_drag_paintfile
    //message = '!a100_windowmouse_drag_paintfile ButtonFocus[@ButtonFocus@]' window message info ok
    if (!Drag) return
    //*********************************
    //* Modify PaintFile
    //*********************************
    UpdateConnectors = 'n'
    file PaintFile error open PaintFile null
    b
    do
        if-1 (!eof)
+          scan:/@line/:/,/
+          if-2  (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if-3  (left = ButtonFocus)
+                  scan:/@line/:/,/
+                  HoldWindowName = left
+                  scan:/@right/:/,/
+                  HoldControlName = left
+                  scan:/@right/:/,/
+                  HoldType = left
+                  scan:/@right/:/,/
+                  ObjectX = left
+                  scan:/@right/:/,/
+                  ObjectY = left
+                  scan:/@right/:/,/
+                  ObjectCX = left
+                  scan:/@right/:/,/
+                  ObjectCY = left
+                  window obtain Builder_Control_Size_RBOBJ
+                  if-4  (Builder_Control_Size_RBOBJ)
+                      call !a100_windowmouse_drag_paintfile_size
+                      MaintainLengthHeight = 'y'
+                      call !a400_modify_paint
+                      f;*
+                  else-4
+                      ObjectX = Xpos
+                      ObjectY = Ypos
+                      MaintainLengthHeight = 'y'
+                      call !a400_modify_paint
+                      f;*
+       endif
        f;1          
    until (eof)
    UpdateConnectors = 'y'
    call BuilderConnect.bed!m100_update_connect
    file PaintFile b window paint Builder_Control_WIN   
    return

!a100_windowmouse_drag_paintfile_size
//    if  (Xpos > ObjectX)
//+       ObjectCX = Xpos - ObjectX
//+   endif
//    if  (Ypos > ObjectY)
//+       ObjectCY = Ypos - ObjectY
//+   endif

    ObjectCX = Xpos - ObjectX
    ObjectCY = Ypos - ObjectY

    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    return

//******************************
//* Move the Group
//******************************
!a100_WindowMouse_Drag_Group
    GroupDragX = Xpos
    GroupDragY = Ypos

    //******************************************
    //* Restrict Control Scrolling Beyond Window
    //******************************************
    WinX = Xpos + GroupDragCX 
//    if  (WinX > MaxX)
//+       //window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+       file PaintFile error return
//+       b fs:/,GroupRectangle,/
//+       scan:/@line/:/,/ scan:/@right/:/,/scan:/@right/:/,/
//+       scan:/@right/:/,/ ObjectX = left
//+       scan:/@right/:/,/ ObjectY = left
//+       scan:/@right/:/,/ ObjectCX = left
//+       scan:/@right/:/,/ ObjectCY = left
//+       GroupDragX = MaxX - GroupDragCX - 5 
//+       GroupDragX -= MinX
//+       return
//+   endif

    //*** Down
    WinY = Ypos + GroupDragCY
//    if  (WinY > MaxY)
//+       //window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
//+       file PaintFile error return
//+       b fs:/,GroupRectangle,/
//+       scan:/@line/:/,/ scan:/@right/:/,/scan:/@right/:/,/
//+       scan:/@right/:/,/ ObjectX = left
//+       scan:/@right/:/,/ ObjectY = left
//+       scan:/@right/:/,/ ObjectCX = left
//+       scan:/@right/:/,/ ObjectCY = left
//+       GroupDragY = MaxY - GroupDragCY - 5
//+       GroupDragY -= MinY
//+       return
//+   endif

    //***********************
    //* Move Objects in Rect
    //***********************
    window obtain Builder_Control_Size_RBOBJ
    file GroupControls error open GroupControls null
    b
    do
        if (eof)
+          goto !a100_WindowMouse_Drag_Group_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        GroupObjXOffset = left
        GroupObjYOffset = right
        scanr:/@ControlName@/:/_/
        if-1  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a100_paintfile_object
+       else-1
+           if-2 (ControlName != 'Connector')
+               window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+               if-3 (Builder_Control_Size_RBOBJ)
+                   ObjectCX += SizeCX
+                   ObjectCY += SizeCY
+                   window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+               else-3
+                   ObjectX = GroupDragX + GroupObjXOffset
+                   ObjectY = GroupDragY + GroupObjYOffset
+                   window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+       endif
        file GroupControls
        f;1
    until (eof)

!a100_WindowMouse_Drag_Group_Done
    SizeCX = 0
    SizeCY = 0
    file PaintFile
    b
    fs:/,GroupRectangle,/
    Newline = 'Builder_Control_WIN,GroupRectangle,Box,@GroupDragX@,@GroupDragY@,@GroupDragCX@,@GroupDragCY@,250,250,250'
    if (eof)
+      b
+      i:/@Newline/
+   else
+      r:/@Newline/
+   endif
    b
    //window size GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY
    //file PaintFile b window paint Builder_Control_WIN
    //***********************
    //* Repaint Controls
    //***********************
    file Controls error open Controls null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          MacroCommand = 'window paint @left@'
+          $MacroCommand
+       endif
        f;1
    until (eof)
    call BuilderConnect.bed!m100_update_connect
    file PaintFile b window paint Builder_Control_WIN  
    return

!a100_paintfile_object
    file PaintFile
    b
    SearchString = 'Builder_Control_WIN,@ControlName@,'
    fs:/@SearchString/
    //message = 'debug SearchString[@SearchString@] line[@line@]' window message info ok
    if (eof) return
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    if  (!AlignBottom)
+       ObjectY = left
+   endif
    HoldRight = right  
    scan:/@right/:/,/
    ObjectCX = left 
    scan:/@right/:/,/
    ObjectCY = left 
    HoldRight2 = right
    if  (!AlignBottom) and (!AlignTop)
+       ObjectX = GroupDragX + GroupObjXOffset
+   endif
    if  (!AlignBottom) and (!AlignLeft) and (!AlignRight)
+       ObjectY = GroupDragY + GroupObjYOffset
+   endif
  
    if  (AlignTop)
+       if  (HoldType = 'Ellipse') or (HoldType = 'Ellipse3D') or (HoldType = 'Circle')
+           TempWork = ObjectCY / 2
+           ObjectY += TempWork
+   endif

    if  (AlignLeft)
+       if  (HoldType = 'Ellipse') or (HoldType = 'Ellipse3D') or (HoldType = 'Circle') or (HoldType = 'Diamond')
+           TempWork = ObjectCX / 2
+           ObjectX += TempWork
+   endif

    AlignTop    = 'n'
    AlignBottom = 'n'
    AlignLeft   = 'n'
    AlignRight  = 'n'

    Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@HoldRight@'

    if  (HoldType beginswith 'Box') or (HoldType = 'Ellipse') or (HoldType = 'Ellipse3D') or (HoldType = 'Circle') or (HoldType = 'Diamond') or (HoldType = 'Text') or (HoldType = 'TextTilt') or (HoldType = 'BitmapFit') or (HoldType beginswith 'Triangle') or (HoldType beginswith 'Rectangle')
+       window obtain Builder_Control_Size_RBOBJ
+       if  (Builder_Control_Size_RBOBJ)
+           ObjectCX += SizeCX
+           ObjectCY += SizeCY
+           Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@HoldRight2@'
+   endif
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork > 4)
+           window obtain Builder_Control_Size_RBOBJ
+           if  (Builder_Control_Size_RBOBJ)
+               ObjectCX += SizeCX
+               ObjectCY += SizeCY
+               Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@HoldRight2@'
+   endif

    r:/@Newline@/

    return
 
//*********************************************************************
//* Main Menu Actions
//*********************************************************************

//******************************
//* Start Bedit Interactive
//******************************
!a110_Builder_Main_Bedit_MSOBJ
    system:"start bedit"
    return

//******************************
//* Open the System Window for Bedit
//******************************
!a110_Builder_Main_Batch_MSOBJ
    DebugType = 'bedit'
    CodeType = "bedit"
    window pointer wait
    window hwnd Builder_System_WIN status error window open Builder_System_WIN shade
    window center Builder_System_WIN
    window clear Builder_System_WIN

    window hide Builder_System_Modify_PBOBJ
    window show Builder_System_Assist_PBOBJ

    Builder_System_WIN = 'Builder System - B-Edit Batch'
    window title Builder_System_WIN

    Builder_System_Systemname_STTXT = 'Program'
    window modify Builder_System_Systemname_STTXT
    Builder_System_Title_STTXT = 'Author'
    window modify Builder_System_Title_STTXT

    MacroCommand = "dir *.bed"
    close SystemList error
    open SystemList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b
!a110_dirlist_batch_loop
    if (eof) goto !a110_dirlist_batch_done
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    Newline = right
    lower Newline
    scanr:/@Newline/:/.bed/
    MacroCommand = 'if (exists @left@.win) f;1 goto !a110_dirlist_batch_loop' $MacroCommand
    Builder_System_SystemList_COOBJ = left
    mix Builder_System_SystemList_COOBJ
    if (Builder_System_SystemList_COOBJ != 'Builder')
+       window insert end default Builder_System_SystemList_COOBJ
+   endif
    r:/@left@/
    f;1
    goto !a110_dirlist_batch_loop
!a110_dirlist_batch_done
    window unshade Builder_System_WIN
    window setfocus Builder_System_WIN
    window paint Builder_System_WIN
    window pointer arrow
    return

//******************************
//* Open the System Window for Windows
//******************************
!a110_Builder_Main_Build_MSOBJ
    DebugType = 'beditwin'
    CodeType = "beditwin"
    window pointer wait
    window hwnd Builder_System_WIN status error window open Builder_System_WIN shade
    window center Builder_System_WIN
    window clear Builder_System_WIN

    window show Builder_System_Modify_PBOBJ
    window hide Builder_System_Assist_PBOBJ

    Builder_System_WIN = 'Builder System - B-Edit Windows'
    window title Builder_System_WIN

    Builder_System_Systemname_STTXT = 'System'
    window modify Builder_System_Systemname_STTXT
    Builder_System_Title_STTXT = 'Title'
    window modify Builder_System_Title_STTXT

    MacroCommand = "dir *.win"
    close SystemList error
    open SystemList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b
!a110_dirlist_loop
    if (eof) goto !a110_dirlist_done
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    Newline = right
    lower Newline
    scanr:/@Newline/:/.win/
    MacroCommand = 'if (!exists @left@.bed) f;1 goto !a110_dirlist_loop' $MacroCommand
    Builder_System_SystemList_COOBJ = left
    mix Builder_System_SystemList_COOBJ
    if (Builder_System_SystemList_COOBJ != 'Builder')
+       window insert end default Builder_System_SystemList_COOBJ
+   endif
    r:/@left@/
    f;1
    goto !a110_dirlist_loop
!a110_dirlist_done
    window unshade Builder_System_WIN
    window setfocus Builder_System_WIN
    window paint Builder_System_WIN
    window pointer arrow
    return

//******************************
//* Change presentation to Windows
//******************************
!a110_Builder_Main_Windows_MSOBJ
    Presentation = "Windows"
    window check Builder_Main_Windows_MSOBJ
    window uncheck Builder_Main_Html_MSOBJ
    return

//******************************
//* Change presentation to HTML
//******************************
!a110_Builder_Main_Html_MSOBJ
    Presentation = "HTML"
    window uncheck Builder_Main_Windows_MSOBJ
    window check Builder_Main_Html_MSOBJ
    return

//******************************
//* Open the COBOL import screen
//******************************
!a110_Builder_Main_Import_MSOBJ
    window pointer wait
    window hwnd Builder_Import_WIN status error window open Builder_Import_WIN shade
    window center Builder_Import_WIN
    window clear Builder_Import_WIN

    Builder_Import_Directory_EFOBJ = Directory
    window modify Builder_Import_Directory_EFOBJ
    Builder_Import_Extension_EFOBJ = Extension
    window modify Builder_Import_Extension_EFOBJ

    Builder_Import_Viewmods_RBOBJ = 'Y'
    window modify Builder_Import_Viewmods_RBOBJ
    Builder_Import_Viewfiles_RBOBJ = 'N'
    window modify Builder_Import_Viewfiles_RBOBJ
    Builder_Import_Viewvars_RBOBJ = 'N'
    window modify Builder_Import_Viewvars_RBOBJ

    if  (Builder_Import_Extension_EFOBJ = 'COB') or (Builder_Import_Extension_EFOBJ = 'BED') or (Builder_Import_Extension_EFOBJ = 'C') or (Builder_Import_Extension_EFOBJ = 'JAVA')
+       call !a600_Builder_Import_Lookup_PBOBJ
+   endif

    window unshade Builder_Import_WIN
    window setfocus Builder_Import_WIN
    window pointer arrow
    close ViewList error
    return

//******************************
//* Open the COBOL Call screen
//******************************
!a110_Builder_Main_COBOLCall_MSOBJ
    window pointer wait
    window hwnd Builder_Callflow_WIN status error window open Builder_Callflow_WIN shade
    window center Builder_Callflow_WIN
    window clear Builder_Callflow_WIN
    Builder_Callflow_Directory_EFOBJ = Directory
    window modify Builder_Callflow_Directory_EFOBJ
    window setfocus Builder_Callflow_Directory_EFOBJ
    window unshade Builder_Callflow_WIN
    window setfocus Builder_Callflow_WIN
    window pointer arrow
    return

//******************************
//* Open the POM Dependency screen
//******************************
!a110_Builder_Main_POM_MSOBJ
    window pointer wait
    window hwnd Builder_POM_WIN status error window open Builder_POM_WIN shade
    window center Builder_POM_WIN
    window clear Builder_POM_WIN
    Builder_POM_Directory_EFOBJ = Directory
    window modify Builder_POM_Directory_EFOBJ
    window setfocus Builder_POM_Directory_EFOBJ
    window unshade Builder_POM_WIN
    window setfocus Builder_POM_WIN
    window pointer arrow
    return

//******************************
//* Open the 3090 Download Screen
//******************************
!a110_Builder_Main_Download_MSOBJ
    window pointer wait
    window conceal Builder_Download3090_Password_EFOBJ
    window hwnd Builder_Download3090_WIN status error window open Builder_Download3090_WIN shade
    window center Builder_Download3090_WIN
    window clear Builder_Download3090_WIN
    //***********************************
    //* Initialize the fields
    //***********************************
    if  (Userid3090 != null)
+       Builder_Download3090_Userid_EFOBJ = Userid3090
+       window modify Builder_Download3090_Userid_EFOBJ
+   endif
    if  (Password3090 != null)
+       Builder_Download3090_Password_EFOBJ = Password3090
+       window modify Builder_Download3090_Password_EFOBJ
+   endif
    if  (Userid3090 != null) and (Password3090 != null)
+       window setfocus Builder_Download3090_From_EFOBJ
+   endif

    if  (Userid3090 = null) 
+       window setfocus Builder_Download3090_Userid_EFOBJ
+   else
+       if  (Password3090 = null)
+           window setfocus Builder_Download3090_Password_EFOBJ
+   endif
    if  (Userid3090 != null) and (Password3090 != null)
+       window setfocus Builder_Download3090_From_EFOBJ
+   endif

    if (LoginLoc3090 = 'test')
+      Builder_Download3090_Test_RBOBJ = 'Y'
+      Builder_Download3090_Prod_RBOBJ = 'N'
+   else
+      Builder_Download3090_Test_RBOBJ = 'N'
+      Builder_Download3090_Prod_RBOBJ = 'Y'
+   endif
    window modify Builder_Download3090_Prod_RBOBJ
    window modify Builder_Download3090_Test_RBOBJ

    Builder_Download3090_From_EFOBJ = DownloadFrom
    window modify Builder_Download3090_From_EFOBJ
    Builder_Download3090_To_EFOBJ = DownloadTo
    window modify Builder_Download3090_To_EFOBJ
    Builder_Download3090_Filter_EFOBJ = DownloadFilter
    window modify Builder_Download3090_Filter_EFOBJ
    Builder_Download3090_Extension_EFOBJ = Extension
    window modify Builder_Download3090_Extension_EFOBJ

    Builder_Download3090_To_EFOBJ = Directory
    window modify Builder_Download3090_To_EFOBJ

    window unshade Builder_Download3090_WIN
    window setfocus Builder_Download3090_WIN
    window pointer arrow
    return

//******************************
//* Search files for String
//******************************
!a110_Builder_Main_Searchdir_MSOBJ
    string SearchDir error
    window pointer wait
    window hwnd Builder_Search_WIN status error window open Builder_Search_WIN shade
    window center Builder_Search_WIN
    window clear Builder_Search_WIN
    window setfocus Builder_Search_Directory_EFOBJ
    window unshade Builder_Search_WIN
    window setfocus Builder_Search_WIN

    close SearchList error
    open SearchList null
    SearchLast = 'OR'

    Builder_Search_Directory_EFOBJ = Directory
    window modify Builder_Search_Directory_EFOBJ
    if (Directory != null)
+      window setfocus Builder_Search_String_EFOBJ
+   endif
    Builder_Search_Extension_EFOBJ = Extension
    window modify Builder_Search_Extension_EFOBJ

    window enable Builder_Search_And_PBOBJ
    window enable Builder_Search_Or_PBOBJ

    window pointer arrow
    return

//******************************
//* Integrate with Code Checker
//******************************
!a110_Builder_Main_CodeCheck_MSOBJ
    window pointer wait
    window hwnd Builder_Codecheck_WIN status error window open Builder_Codecheck_WIN shade
    window center Builder_Codecheck_WIN
    window clear Builder_Codecheck_WIN

    //******************************
    //* Load the System Combo Box
    //******************************
    Builder_Codecheck_System_LBOBJ = 'All'
    window delete Builder_Codecheck_System_LBOBJ
    window paint Builder_Codecheck_System_LBOBJ
    open Appnames appnames.txt error goto !a110_Builder_Main_CodeCheck_noappnames
    b
    do
       if (!eof)
+         split:/@line/;4
+         Builder_Codecheck_System_LBOBJ = right
+         pack Builder_Codecheck_System_LBOBJ
+         window insert end default Builder_Codecheck_System_LBOBJ
+         f;1
+      endif
    until (eof)
    close Appnames

    Builder_Codecheck_Directory_EFOBJ = Directory
    window modify Builder_Codecheck_Directory_EFOBJ

!a110_Builder_Main_CodeCheck_noappnames
    window setfocus Builder_Codecheck_System_EFOBJ
    window unshade Builder_Codecheck_WIN
    window setfocus Builder_Codecheck_WIN
    window pointer arrow
    return

//******************************
//* Integrate with Code Checker
//******************************
!a110_Builder_Main_3090Check_MSOBJ
    DirField = "Chk3090.dir"
    FileField = null
    call !s100_directory
    return

//******************************
//* Exit the System?
//******************************
!a110_Builder_Main_Exit_MSOBJ
    message = "Exit Verification, Are You Sure?"
    window message question yesno
    if  (message)
+       window stop
+   endif
    return

//******************************
//* Display About
//****************************** 
!a110_Builder_Main_About_MSOBJ
    window pointer wait
    window hwnd Builder_About_WIN status error window open Builder_About_WIN shade
    window center Builder_About_WIN
    window clear Builder_About_WIN

    Builder_About_System_EFOBJ = System
    window modify Builder_About_System_EFOBJ
    Builder_About_Version_EFOBJ = Version
    window modify Builder_About_Version_EFOBJ
    Builder_About_Author_EFOBJ = Author
    window modify Builder_About_Author_EFOBJ
    Builder_About_Desc_MLOBJ = |Forrest Bentley B-Edit Analysis System assists with B-Edit code development and provides analysis tools such as code standards checking, and visual program flow display. B-Edit is a language designed for manipulating text files using strong string functions (see B-Edit User's Guide/Language Reference). For questions contact @Author@.|
    window modify Builder_About_Desc_MLOBJ

    window disable Builder_About_Desc_MLOBJ

    window unshade Builder_About_WIN
    window setfocus Builder_About_WIN
    window pointer arrow
    return

//******************************
//* B-Edit Control User's Guide
//******************************
!a110_Builder_Main_ControlManual_MSOBJ
    system:"start BuilderGuide.docx"
    return

//******************************
//* About System
//****************************** 
!a110_Builder_Main_Manual_MSOBJ
    system:"start c:\bedit\bedit-guide.docx"
    return

//******************************
//* Bedit Overview
//****************************** 
!a110_Builder_Main_Overview_MSOBJ
    system:"start c:\bedit\bedit-overview.ppsx"
    return

//******************************
//* About System
//****************************** 
!a110_Builder_Main_AboutSystem_MSOBJ
    system:"start msinfo32.exe"
    return

//******************************
//* Eclipse
//****************************** 
!a110_Builder_Main_Eclipse_MSOBJ
    system:"start eclipse.bat"
    return

//******************************
//* 3090 Rumba
//****************************** 
!a110_Builder_Main_Rumba_MSOBJ
    system:"start http://rumba.comfin.ge.com/rumba/mainframe.html"
    return

//******************************
//* XAMPP
//****************************** 
!a110_Builder_Main_Xampp_MSOBJ
    system:"start xampp.bat"
    return

//******************************
//* Convert CICS to DC-COBOL
//****************************** 
!a110_Builder_Main_Convert_MSOBJ
    system:"start Convert.bat"
    return

//******************************
//* SOAP UI
//****************************** 
!a110_Builder_Main_Soap_MSOBJ
    system:"start soapui.bat"
    return

//******************************
//* Toad
//****************************** 
!a110_Builder_Main_Toad_MSOBJ
    system:"start toad.bat"
    return

//******************************
//* Fiddler
//****************************** 
!a110_Builder_Main_Fiddler_MSOBJ
    system:"start Fiddler.bat"
    return

//******************************
//* Calculator
//****************************** 
!a110_Builder_Main_Calc_MSOBJ
    system:"start calc"
    return

//******************************
//* Magnify
//****************************** 
!a110_Builder_Main_Magnify_MSOBJ
    system:"start magnify"
    return

//******************************
//* Notepad
//****************************** 
!a110_Builder_Main_Notepad_MSOBJ
    system:"start notepad"
    return

//******************************
//* Paint
//****************************** 
!a110_Builder_Main_Paint_MSOBJ
    system:"start mspaint"
    return

//******************************
//* Search
//****************************** 
!a110_Builder_Main_Search_MSOBJ
    system:"start ransack.bat"
    return

//******************************
//* Task Manager
//****************************** 
!a110_Builder_Main_Taskmanager_MSOBJ
    system:"start taskmgr"
    return

//******************************
//* Task Tracking
//******************************
!a110_Builder_Main_Tasktrack_MSOBJ
//    string CloseWindowName error
//    CloseWindowName = 'TaskTrack'
//    if  (TaskTrackCount > 0)
//+       window closewindowname CloseWindowName
//+   endif
    TaskTrackCount ++
//    DelayCommand = |system:"start beditwin call Tasktrack.bed"|
//    Delay = 'y'
//    DelayCount = 20
//    window timer on 0
    system:"start beditwin call Tasktrack.bed"
    return

//******************************
//* Continuous Delivery - SDLC
//******************************
!a110_Builder_Main_SDLC_MSOBJ
    system:'start SDLC.bat'
    return

//******************************
//* Continuous Delivery - CD
//******************************
!a110_Builder_Main_CD_MSOBJ
    system:"start https://devcloud.swcoe.ge.com/devspace/display/GECACD/GECA+Continuous+Delivery+Home"
    return

//******************************
//* Continuous Delivery - Jenkins
//******************************
!a110_Builder_Main_Jenkins_MSOBJ
    system:"start Jenkins.bat"
    return

//******************************
//* Continuous Delivery - NOLA
//******************************
!a110_Builder_Main_Nola_MSOBJ
    system:"start http://sc.ge.com/*NOLASWCoE"
    return

//******************************
//* Continuous Delivery - Governance
//******************************
!a110_Builder_Main_Governance_MSOBJ
    system:"start http://libraries.ge.com/foldersIndex.do?p_id=0&ohr_id=213000864&entity_id=31000646101&sid=101&SF=1#45402210101"
    return

//******************************
//* Continuous Delivery - GEC Technology
//******************************
!a110_Builder_Main_Gectechnology_MSOBJ
    system:"start beditwin call GECTechnology.bed"
    return

//******************************
//* Performance Monitor
//****************************** 
!a110_Builder_Main_Performance_MSOBJ
    message = |To run the Performance Monitor you must allow User Account Control access. Look for the access icon in the toolbar at the bottom of your screen (Blinking Shield) asking "Do you want to allow the forllowing program to make changes to this computer?" and click 'Yes'.|
    window message info ok
    system:"start perfmon"
    return


//******************************
//* BPM Documentation
//****************************** 
!a110_Builder_Main_BPM_MSOBJ
    system:"start http://sc.ge.com/*EAMiddleware"
    return

//******************************
//* Directory Explorer
//****************************** 
!a110_Builder_Main_Directory_MSOBJ
    system:"start explorer"
    return

//******************************
//* DOS Window
//******************************
!a110_Builder_Main_Dos_MSOBJ
    system:"start CMD"
    return

//******************************
//* Webex
//******************************
!a110_Builder_Main_Webex_MSOBJ
    system:"start http://www.ge.com/emeetings"
    return

//******************************
//* Bachman Visual
//******************************
!a110_Builder_Main_Bachman_MSOBJ
    system:'start T:\ITDOC\Strategy"&Planning\Presentations\Bentley\3090_Bachman.pdf'
    return

//******************************
//* Vachman on the Net
//******************************
!a110_Builder_Main_Bachmannet_MSOBJ
    system:"start http://bachman.dev.comfin.ge.com/scripts/mainPage.asp"
    return

//******************************
//* Knowledge Gateway
//******************************
!a110_Builder_Main_Gateway_MSOBJ
    system:"start http://libraries.ge.com/foldersIndex.do?entity_id=17338873101&sid=101&SF=1&prod_id=168811#17338873101"
    return

//******************************
//* MFO2 Architecture
//******************************
!a110_Builder_Main_MFO2_MSOBJ
    system:"start http://libraries.ge.com/foldersIndex.do?entity_id=20934729101&sid=101&SF=1"
    return


//******************************
//* Turn the Banner On
//******************************
!a110_Builder_Main_Banneron_MSOBJ
    BannerLine1 = Ban1
    BannerLine2 = Ban2
    BannerLine3 = Ban3
    window paint MainWindow
    return

//******************************
//* Turn the Banner Off
//******************************
!a110_Builder_Main_Banneroff_MSOBJ
    BannerLine1 = null
    BannerLine2 = null
    BannerLine3 = null
    window paint MainWindow
    return

//******************************
//* Future Timeline
//******************************
!a110_Builder_Main_FutureTimeline_MSOBJ
    system:"start http://www.futuretimeline.net/"
    return

//******************************
//* Explaining the Future
//******************************
!a110_Builder_Main_ExplainingFuture_MSOBJ
    system:"start http://explainingthefuture.com/"
    return

//******************************
//* The New Boston Tutorials
//****************************** 
!a110_Builder_Main_Tutorials_MSOBJ
    system:"start http://thenewboston.com"
    return

//******************************
//* Pacman
//****************************** 
!a110_Builder_Main_Pacman_MSOBJ
    message = 'Use the cursor arrow keys to control the Pacman. This program runs in a DOS CMD window, and for the best presentation maximize the CMD window before starting the game."
    window message info ok
    system:"start Pacman.bat"
    return

//******************************
//* Life
//****************************** 
!a110_Builder_Main_Life_MSOBJ
    message = 'This program runs in a DOS CMD window, and for best presentation maximize the CMD window before beginning the program."
    window message info ok
    system:"start life.bat"
    return

//*********************************************************************
//* Build Window Button Actions
//*********************************************************************
//******************************
//* Backup the System Files
//******************************
!a200_Builder_System_Backup_PBOBJ
    window obtain Builder_System_WIN
    pack Builder_System_SystemList_COOBJ
    if  (Builder_System_SystemList_COOBJ = null)
+       message = 'Please select a System'
+       window message warning ok
+       window setfocus Builder_System_SystemList_COOBJ
+       return
+   endif
    SystemName = Builder_System_SystemList_COOBJ
    call !a300_Builder_Window_backup_PBOBJ
    return

//******************************
//* Open the Builder Window Control Maintenance Window
//******************************
!a200_Builder_System_Create_PBOBJ
    window obtain Builder_System_WIN
    crush Builder_System_Systemname_EFOBJ
    mix Builder_System_Systemname_EFOBJ
    if (Builder_System_Systemname_EFOBJ = null)
+      message = "Please enter a System Name"
+      window message error ok
+      window setfocus Builder_System_Systemname_EFOBJ
+      return
+   endif
    MacroCommand = "    if (exists @Builder_System_Systemname_EFOBJ@.bed) message = 'System already exists' window message error ok window setfocus Builder_System_Systemname_EFOBJ return"
    $MacroCommand
    if (CodeType = 'bedit')
+      message = "Please enter an Author"
+   else
+      message = "Please enter a Title"
+   endif


    close PaintFile error
    open PaintFile @PaintSystemName error open PaintFile null
    b
    fs:/@EarthBitmapLine/
    if (eof)
+      b
+      ib:/@EarthBitmapLine/
+      //i:/******************/
+      //i:/******************/
+      //i:/******************/
+   endif

    if (Builder_System_Title_EFOBJ = null)
+      window message error ok
+      window setfocus Builder_System_Title_EFOBJ
+      return
+   endif
    if (Builder_System_Desc_MLOBJ = null)
+      message = "Please enter a Description"
+      window message error ok
+      window setfocus Builder_System_Desc_MLOBJ
+      return
+   endif
    pattern on
    scanr:/@Builder_System_Desc_MLOBJ/:/~/
    if (found) Builder_System_Desc_MLOBJ = '@left@@right@'

    Builder_System_SystemList_COOBJ = Builder_System_Systemname_EFOBJ
    window insert end default Builder_System_SystemList_COOBJ 
    window modify Builder_System_SystemList_COOBJ
    file SystemList
    b
    case off
    fs:/@Builder_System_Systemname_EFOBJ@/ 
    if (!eof)
+      if (line = Builder_System_Systemname_EFOBJ)
+         case on
+         message = "@Builder_System_Systemname_EFOBJ@.win already exists, overwrite?"
+         window message question yesno
+         if  (!message)
+             return
+   endif
    case on

    if  (Builder_System_Title_EFOBJ != null) SystemTitle = Builder_System_Title_EFOBJ
    if  (Builder_System_Desc_MLOBJ != null) SystemDesc = Builder_System_Desc_MLOBJ

    mix Builder_System_Systemname_EFOBJ
    window modify Builder_System_Systemname_EFOBJ
    SystemName = Builder_System_Systemname_EFOBJ

    if (CodeType = 'bedit')
+      call !a200_Builder_System_Create_bedit
+   return

    //****************************
    //* Open Control Files
    //****************************
    close BuilderWindowFile error
    close WindowList error
    close WindowNav error
    open BuilderWindowFile null error file BuilderWindowFile b d;*
    open WindowList null error file WindowList b d;*
    open WindowNav null error file WindowNav b d;*
    EntryactionFilename = '@SystemName@.act'
    close Entryaction error
    open Entryaction null error file Entryaction b d;*

    close Master error
    MasterFilename = "@SystemName@.mst"
    close Master error
    open Master @MasterFilename error open Master null
    i:/@SystemTitle@/
    i:/@SystemDesc@/
    write Master @MasterFilename
    close Master

    SystemNavFilename = "@Builder_System_Systemname_EFOBJ@.nav'

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    window hide Builder_System_WIN
    window pointer wait
    window hwnd Builder_Window_WIN status error window open Builder_Window_WIN shade
    window center Builder_Window_WIN
    window clear Builder_Window_WIN
    Builder_Window_WIN = "Window Maintenance - System[@SystemName@]"
    window title Builder_Window_WIN
    Builder_Window_Systemname_STTXT = SystemName
    window modify Builder_Window_Systemname_STTXT
    //window disable Builder_Window_Test_PBOBJ
    window disable Builder_Window_Debug_PBOBJ
    window unshade Builder_Window_WIN
    window setfocus Builder_Window_WIN
    window pointer arrow   
    return

//******************************
//* Open the source for a system
//******************************
!a200_Builder_System_Open_PBOBJ
    if (!LanguageCommand)
+      Builder_System_SystemList_COOBJ = null
+      window obtain Builder_System_SystemList_COOBJ
+   endif
    LanguageCommand = 'n'
    crush Builder_System_Systemname_EFOBJ
    if (Builder_System_SystemList_COOBJ = null)
+      message = "Please select a System Name"
+      window message error ok
+      window setfocus Builder_System_SystemList_COOBJ
+      return
+   endif
    MacroCommand = |system:"start @Builder_System_SystemList_COOBJ@.bed"
    $MacroCommand
    return

//******************************
//* Create a Bedit batch program
//******************************
!a200_Builder_System_Create_bedit
    close GenCode error
    open GenCode null
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//* Program : @SystemName@.bed| i:/@Newline@/
    Newline = |//* Author  : @Builder_System_Title_EFOBJ@| i:/@Newline@/
    Newline = |//* Date    : @date@| i:/@Newline@/
    Newline = |//* Desc    : @Builder_System_Desc_MLOBJ@| i:/@Newline@/
    Newline = |//* | i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//*              M A I N T E N A N C E       L O G| i:/@Newline@/
    Newline = |//*| i:/@Newline@/
    Newline = |//* Date       Author           Description| i:/@Newline@/
    Newline = |//* ---------- ---------------- --------------------------------------------------| i:/@Newline@/
    Newline = |//*| i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Main Procesing| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!a100_main| i:/@Newline@/
    Newline = |    call !b100_init| i:/@Newline@/
    Newline = |    call !b200_proc| i:/@Newline@/
    Newline = |    call !b300_wrap| i:/@Newline@/
    Newline = |    exit| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Initialization| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b100_init| i:/@Newline@/
    Newline = |    system:"cls"| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    subs ^ Newline = |    print:"* Begin ^SystemName^.bed    @date@ - @time@"| subs @ i:/@Newline@/
    Newline = |    print:"* @Builder_System_Desc_MLOBJ@"| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Process| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b200_proc| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Wrapup| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b300_wrap| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    subs ^ Newline = |    print:"* ^SystemName^ Processing Complete    @date@ - @time@"| subs @ i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    wait| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* End of Program| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!z999_end_of_program| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//* End of program @SystemName@.bed| i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/

    MacroCommand = 'write GenCode @SystemName@.bed' $MacroCommand
    close GenCode
    //**************************
    //* Separate the batch code
    //**************************
    call !t100_separate_batch_code
    Builder_Code_Codemodules_LBOBJ = 'INDEX=1'
    window select Builder_Code_Codemodules_LBOBJ
    Builder_Code_Codemodules_LBOBJ = "! Global Variables"
    //window push Builder_Code_Assist_PBOBJ
    //call !a1800_Builder_Code_Assist_PBOBJ
    //window close Builder_Code_WIN
    return

//******************************
//* Open the Assist Window
//******************************
!a200_Builder_System_Assist_PBOBJ
    message = 'Assist'
    call !a200_Builder_System_Modify_PBOBJ
    if (message = 'Assist')
+      call !a1800_Builder_Code_Assist_PBOBJ
+   endif
    return

//******************************
//* Debug a System
//******************************
!a200_Builder_System_Debug_PBOBJ
    if (Builder_System_SystemList_COOBJ = null)
+      message = "Please select a System Name from the list"
+      window setfocus Builder_System_SystemList_COOBJ
+      window message error ok
+      return
+   endif
    call !a200_Builder_System_Modify_bedit
    call !a300_Builder_Window_Debug_PBOBJ
    return

//******************************
//* Modify a System
//******************************
!a200_Builder_System_Modify_PBOBJ

    close PaintFile error
    open PaintFile @PaintSystemName error open PaintFile null
    b
    fs:/@EarthBitmapLine/
    if (eof)
+      b
+      ib:/@EarthBitmapLine/
+      //i:/******************/
+      //i:/******************/
+      //i:/******************/
+   endif

    if  (!LanguageCommand)
+       window obtain Builder_System_WIN
+   endif
    LanguageCommand = 'n'
    if (Builder_System_SystemList_COOBJ = null)
+      message = "Please select a System Name from the list"
+      window setfocus Builder_System_SystemList_COOBJ
+      window message error ok
+      return
+   endif

!a200_Builder_System_Modify_bedit
    //message = 'a200 CodeType[@CodeType@]' window message info ok
    if  (CodeType = 'bedit')
+       //**************************
+       //* Separate the batch code
+       //**************************
+       SystemName = Builder_System_SystemList_COOBJ
+       call !t100_separate_batch_code
+       Builder_Code_Codemodules_LBOBJ = 'INDEX=1'
+       window select Builder_Code_Codemodules_LBOBJ
+       Builder_Code_Codemodules_LBOBJ = "! Global Variables"
+       //window push Builder_Code_Assist_PBOBJ
+       //call !a1800_Builder_Code_Assist_PBOBJ
+       //window close Builder_Code_WIN
+       return
+   endif

    //****************************
    //* Open Control Files
    //****************************
    Builder_System_Systemname_EFOBJ = Builder_System_SystemList_COOBJ
    crush Builder_System_Systemname_EFOBJ
    mix Builder_System_Systemname_EFOBJ
    window modify Builder_System_Systemname_EFOBJ
    SystemName = Builder_System_Systemname_EFOBJ
    SystemFileName = '@Builder_System_Systemname_EFOBJ@.win'
    close BuilderWindowFile error
    open BuilderWindowFile @SystemFileName error goto !a200_file_bad
    close Entryaction error
    EntryactionFilename = '@SystemName@.act'
    open Entryaction @EntryactionFilename error open Entryaction null
    goto !a200_file_ok

!a200_file_bad
    message = /File doesn't exist: @SystemFileName@/ 
    window message error ok 
    return
!a200_file_ok
    close Master error
    MasterFilename = "@SystemName@.mst"
    open Master @MasterFilename error open Master null i:/@SystemTitle@/ i:/@SystemDesc@/
    b
    SystemTitle = line
    f;1
    SystemDesc = line
    if  (Builder_System_Title_EFOBJ != null) 
+       SystemTitle = Builder_System_Title_EFOBJ
+       b
+       r:/@SystemTitle@/
+   endif
    if  (Builder_System_Desc_MLOBJ != null) 
+       SystemDesc = Builder_System_Desc_MLOBJ
+       b
+       f;1
+       r:/@SystemDesc@/
+   endif
    write Master @MasterFilename
    close Master

    SystemNavFilename = "@Builder_System_Systemname_EFOBJ@.nav'
    close WindowNav error
    open WindowNav @SystemNavFilename error open WindowNav null 

    close WindowList error
    open WindowList null 

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    SystemName = Builder_System_Systemname_EFOBJ
    window hide Builder_System_WIN
    window pointer wait
    window hwnd Builder_Window_WIN status error window open Builder_Window_WIN shade
    window center Builder_Window_WIN
    window clear Builder_Window_WIN
    Builder_Window_WIN = "Window Maintenance - System[@SystemName@]"
    window title Builder_Window_WIN
    Builder_Window_Systemname_STTXT = SystemName
    window modify Builder_Window_Systemname_STTXT
    file BuilderWindowFile
    b

!a200_window_loop
    cols 1,6
    fs:/WINDOW/
    noco
    if (!eof)
+      scan:/@line/:/,/
+      scan:/@right/:/_/
+      scan:/@right/:/_/
+      file WindowList
+      i:/@left@/
+      Builder_Window_Windownamelist_COOBJ = left
+      window insert end default Builder_Window_Windownamelist_COOBJ
+      file BuilderWindowFile
+      f;1
+      if  (!eof)
+          goto !a200_window_loop
+   endif
    //window disable Builder_Window_Test_PBOBJ

    CodeOnly = 'y'
    call !a400_Builder_Control_Code_PBOBJ 
    CodeOnly = 'n'

    window enable Builder_Window_Debug_PBOBJ

    PaintSystemName = '@SystemName@.pnt'
    close PaintFile error
    open PaintFile @PaintSystemName error open PaintFile null
    b
    fs:/@EarthBitmapLine/
    if (eof)
+      b
+      ib:/@EarthBitmapLine/
+      //i:/******************/
+      //i:/******************/
+      //i:/******************/
+   endif

    window unshade Builder_Window_WIN
    window setfocus Builder_Window_WIN
    window pointer arrow    
    return

//******************************
//* Close the System Window
//******************************
!a200_Builder_System_Cancel_PBOBJ
    //message = "Are you sure?"
    //window message question yesno
    //if (!message) 
    window close Builder_System_WIN
    close PaintFile error
    open PaintFile null
    i:/@EarthBitmapLine@/
    //i:/******************/
    //i:/******************/
    //i:/******************/
    b
    window paint MainWindow
    return

//******************************
//* Backup the Windows system
//******************************
!a300_Builder_Window_backup_PBOBJ
    window pointer wait
    BackupName = '@SystemName@_backup_20@date[7-8]@@date[1-2]@@date[4-5]@_@time[1-2]@@time[4-5]@@time[7-8]@'
    MacroCommand = /system:"md @BackupName@"/
    $MacroCommand
    scan:/@MacroCommand@/:/md /
    MacroCommand = /system:"copy @SystemName@.* @BackupName@"/
    $MacroCommand
    window pointer arrow
    message = '"@SystemName@" files have been backed up to @BackupName@'
    window message info ok
    return

//******************************
//* Open the Window Controls Window
//******************************
!a300_Builder_Window_Create_PBOBJ
    if  (CodeType = 'bedit')
+       call !a350_create_bedit_code
+       return
+   endif
    open Controls null error file Controls b d;*
    window obtain Builder_Window_WIN
    crush Builder_Window_Windowname_EFOBJ
    if  (Builder_Window_Windowname_EFOBJ = null)
+      message = "Please enter a Window Name"
+      window message error ok
+      window setfocus Builder_Window_Windowname_EFOBJ
+      return
+   endif
    if  (Builder_Window_WindowTitle_EFOBJ = null)
+       Builder_Window_WindowTitle_EFOBJ = Builder_Window_Windowname_EFOBJ
+       window modify Builder_Window_WindowTitle_EFOBJ
+      //message = "Please enter a Window Title"
+      //window message error ok
+      //window setfocus Builder_Window_WindowTitle_EFOBJ
+      return
+   endif

    WindowTitle = Builder_Window_WindowTitle_EFOBJ
    mix Builder_Window_Windowname_EFOBJ
    window modify Builder_Window_Windowname_EFOBJ
    file WindowList
    b
    fs:/@Builder_Window_Windowname_EFOBJ@/
    if (!eof)
+      message = "Duplicate Window Name"
+      window message error ok
+      return
+   endif

    Builder_Window_Windownamelist_COOBJ = Builder_Window_Windowname_EFOBJ
    window insert end default Builder_Window_Windownamelist_COOBJ
    file WindowList
    f;*
    i:/@Builder_Window_Windowname_EFOBJ@/

!a300_Builder_Window_Create_PBOBJ_Mod

    ConnectFilename = '@Builder_System_Systemname_EFOBJ@.con'
    close ConnectFile error
    open ConnectFile @ConnectFilename error open ConnectFile null
    write ConnectFile @ConnectFilename
    close ConnectFile

    WindowName = Builder_Window_Windowname_EFOBJ
    window pointer wait
    window hwnd Builder_Control_WIN status error window open Builder_Control_WIN shade
    window hide Builder_Control_Swap_PBOBJ
    window hide Builder_Control_Font_STTXT
    window hide Builder_Control_Font_PBOBJ
    window hide Builder_Control_Fonts_COOBJ
    window hide Builder_Control_Bitmap_PBOBJ
    window hide Builder_Control_Bitmap_EFOBJ
    window hide Builder_Window_WIN

    MacroCommand = 'window size Builder_Control_WIN @MainX@ @MainY@ @MainCX@ @MainCY@' $MacroCommand
    DynamicY = MainCY - 65
    //MacroCommand = 'window size Builder_Control_Windownamelist_COOBJ 20 @DynamicY@ 200 600' $MacroCommand
    //MacroCommand = 'window size Builder_Control_Go_PBOBJ 225 @DynamicY@ 30 20' $MacroCommand

    //********************************
    //* Clear and Load the Window List
    //********************************
    Builder_Control_Windownamelist_COOBJ  = 'ALL'
    window delete Builder_Control_Windownamelist_COOBJ
    file WindowList error open WindowList null
    b

    do
        if (!eof)
+          if  (line = WindowName)
+              Builder_Control_Windownamelist_COOBJ = '>@line@'
+              window insert end default Builder_Control_Windownamelist_COOBJ
+          else
+              Builder_Control_Windownamelist_COOBJ = '  @line@'
+              window insert end default Builder_Control_Windownamelist_COOBJ
+       endif
        f;1
    until (eof)

    //window center Builder_Control_WIN
    window clear Builder_Control_WIN
    Builder_Control_WIN = "Builder Window Control Maintenance - System[@SystemName@] Window[@WindowName@]"
    //window deletecontrol GroupRectangle error
    file PaintFile
    b
    fs:/,GroupRectangle,/
    if (!eof) d;1
    b
    file PaintFile b window paint Builder_Control_WIN
    window disable Builder_Control_Align_PBOBJ
    window disable Builder_Control_Copy_PBOBJ
    window title Builder_Control_WIN
    Builder_Control_Size_EFOBJ = '10'
    window modify Builder_Control_Size_EFOBJ
    Builder_Control_Size_RBOBJ = 'N'
    window modify Builder_Control_Size_RBOBJ
    Builder_Control_Pos_RBOBJ = 'Y'
    window modify Builder_Control_Pos_RBOBJ

    //********************************
    //* Creating New Window - Defaults
    //********************************
    //window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY
    //window size Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY
    //message = 'Reset Window Size MinX[@MinX@] MinY[@MinY@] MaxX[@MaxX@] MaxY[@MaxY@]' window message info ok

    Restoring = 'y'
    call !w100_open_window_build_controls
    Restoring = 'n'
    call !w200_setup_backup
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ

    window disable Builder_Control_Buttonaction_PBOBJ
    window disable Builder_Control_Entryaction_PBOBJ
    window disable Builder_Control_Color_PBOBJ

    SizingWindow = 'n'
    window enable Builder_Control_Focus_PBOBJ
    window enable Builder_Control_Delete_PBOBJ
    HoldAction = Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = "Win"
    window modify Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = HoldAction

    window enable Builder_Control_Paste_PBOBJ
    file CopyPaintFile error window disable Builder_Control_Paste_PBOBJ

    call !a300_Builder_Window_Modify_paintfile

    //********************************
    //* Load the Control Type Combobox
    //********************************
    Builder_Control_ControlType_COOBJ = 'ALL'
    window delete Builder_Control_ControlType_COOBJ    Builder_Control_ControlType_COOBJ = '' window insert end default Builder_Control_ControlType_COOBJ

    Builder_Control_ControlType_COOBJ = 'Button' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Entry' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Text' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Check' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'List' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Group' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Radio' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Multi-Line' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Combo' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Drop Down' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Rectangle' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Rectangle Color' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Box' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Box Color' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Box Round' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Box-3D' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Ellipse' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Ellipse-3D' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Circle' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Diamond' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Triangle' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Line' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Arrow' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Text Font' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Text Tilt' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Bitmap' window insert end default Builder_Control_ControlType_COOBJ
    //Builder_Control_ControlType_COOBJ = 'Bitmap Fit' window insert end default Builder_Control_ControlType_COOBJ
    Builder_Control_ControlType_COOBJ = 'Special' window insert end default Builder_Control_ControlType_COOBJ

    //window size Builder_Control_Frame_STTXT @DrawX @DrawY @DrawCX @DrawCY
    window hide Builder_Control_Frame_STTXT

    window unshade Builder_Control_WIN
    window setfocus Builder_Control_WIN
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    MouseOK = 'y'
    SizingWindow = 'n'
    ButtonFocus = null

    window pointer arrow
    return

//******************************
//* Modify a Window
//******************************
!a300_Builder_Window_Modify_PBOBJ
    if  (!LanguageCommand)
+       window obtain Builder_Window_Windownamelist_COOBJ
+   endif
    LanguageCommand = 'n'
    if  (GotoWindow != null) 
+       Builder_Window_Windownamelist_COOBJ = GotoWindow
+       GotoWindow = null
+   endif
    crush Builder_Window_Windownamelist_COOBJ
    if  (Builder_Window_Windownamelist_COOBJ = null)
+      message = "Please select a Window Name"
+      window message error ok
+      return
+   endif

    Builder_Window_Windowname_EFOBJ = Builder_Window_Windownamelist_COOBJ
    window modify Builder_Window_Windowname_EFOBJ
    window obtain Builder_Window_WindowTitle_EFOBJ
    if  (Builder_Window_WindowTitle_EFOBJ != null)
+       WindowTitle = Builder_Window_WindowTitle_EFOBJ
+       //goto !a300_Builder_Window_Modify_New_Title
    file BuilderWindowFile error return
    b
    Newline = "WINDOW,@SystemName@_@Builder_Window_Windowname_EFOBJ@_WIN"
    fs:/@Newline@/ 
    if (!eof) and (Builder_Window_WindowTitle_EFOBJ != null) 
+      scanr:/@line/:/,/
+      Newline = '@left@',@Builder_Window_WindowTitle_EFOBJ@'
+      r:/@Newline@/
+   endif
    if (!eof) 
+      scanr:/@line/:/,/ 
+      Builder_Window_WindowTitle_EFOBJ = right
+      WindowTitle = right
+      window modify Builder_Window_WindowTitle_EFOBJ
+   endif
!a300_Builder_Window_Modify_New_Title
    call !a300_Builder_Window_Create_PBOBJ_Mod
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ
    return

//******************************
//* Prepare the PaintFile objects
//******************************
!a300_Builder_Window_Modify_paintfile
    close TempPaint error
    open TempPaint null

    file PaintFile
    b
    do
        fs:/Builder_Control_WIN,/
        if (!eof) d;1
    until (eof)
    b
    SearchString = '@SystemName@_@Builder_Window_Windowname_EFOBJ@_WIN,'
    //message = '!a300_Builder_Window_Modify_paintfile SearchString[@SearchString@]' window message info ok
    do
        fs:/@SearchString/
        if (!eof)
+          call !a300_Builder_Window_Modify_paintfile_line
+       endif
        f;1
    until (eof)
    file TempPaint
    b
    clear
    copy;*
    file PaintFile
    f;*
    paste
    close TempPaint
    file PaintFile
    b
    return

//******************************
//* Process a PaintFile object line
//******************************
!a300_Builder_Window_Modify_paintfile_line
    //message = line window message info ok
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    ObjectY = left
    scan:/@right/:/,/
    ObjectCX = left
    scan:/@right/:/,/
    ObjectCY = left
    scan:/@right/:/,/
    Red = left
    scan:/@right/:/,/
    Green = left
    scan:/@right/:/,/
    Blue = left
    HoldRight = right

    if (HoldType = 'Bitmap')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      CurrFile = left
+   endif
    if (HoldType = 'BitmapFit')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      ObjectCX = left
+      scan:/@right/:/,/
+      ObjectCY = left
+      scan:/@right/:/,/
+      CurrFile = left
+   endif

    if (HoldType = 'Text') or (HoldType = 'TextTilt')
+      scan:/@HoldRight/:/,/
+      CurrFont = left
+      Text = right
+   endif

    ObjectX += MinX
    ObjectY += MinY
    if  (HoldType = 'Line')
+       ObjectCX += MinX
+       ObjectCY += MinY
+   endif
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           ObjectCX += MinX
+           ObjectCY += MinY
+   endif
    //message = HoldControlName window message info ok
    if  (HoldControlName = 'Connector') return
    scan:/@HoldControlName@/:/_/
    scan:/@right/:/_/
    //if (right = '0') return    //*** Connector Line ***//
    HoldControlName = '@SystemName@_@WindowName@_@right@'
    Newline = 'Builder_Control_WIN,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@'
    if-1  (HoldType = 'Bitmap') 
+       Newline = '@Newline@,@CurrFile@'
+   else-1
+       if-2  (HoldType = 'BitmapFit')
+           Newline = '@Newline@,@ObjectCX@,@ObjectCY@,@CurrFile@'
+       else-2
+           Newline = '@Newline@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@'
+           if-3  (HoldType = 'Text') or (HoldType = 'TextTilt')
+               Newline = '@Newline@,@CurrFont@,@Text@'
+   endif
    file TempPaint
    i:/@Newline/
    file PaintFile
    if  (Builder_Control_ControlList_COOBJ = 'Connector') return
    Builder_Control_ControlList_COOBJ = HoldControlName
    call !a300_insert_controllist
    return

!a300_insert_controllist
    scan:/@Builder_Control_ControlList_COOBJ/:/.Text_/
    if (found) return
    window insert end default Builder_Control_ControlList_COOBJ
    return

//******************************
//* Generate the New System
//******************************
!a300_Builder_Window_Save_PBOBJ
    MacroCommand = "    if (!exists @SystemName@.bed) goto !a300_Builder_Window_Save_gen" $MacroCommand
    message = 'Do you want to completely refresh the code?' window message question yesno
    if  (message)
+       MacroCommand = 'system:"del @SystemName@.bed'
+       system:"del Bedit-code\*.bed"
+       $MacroCommand
+   endif
!a300_Builder_Window_Save_gen
    call !y100_Generate
    message = 'The new system code is located at @GenSystemFilename@ (@CodeLines@ lines of BEDITWIN code Generated). To run it use [beditwin call @GenSystemFilename@]'
    window message info ok
    //window enable Builder_Window_Test_PBOBJ
    return

//******************************
//* Test the System
//******************************
!a300_Builder_Window_Test_PBOBJ
    MacroCommand = "    if (!exists @SystemName@.bed) goto !a300_Builder_Window_Test_gen" $MacroCommand
    message = 'Do you want to completely refresh the code?' window message question yesno
    if  (message)
+       MacroCommand = 'system:"del @SystemName@.bed'
+       system:"del Bedit-code\*.bed"
+       $MacroCommand
+   endif
!a300_Builder_Window_Test_gen
    call !y100_Generate
    if  (Presentation = 'HTML')
+       call !a300_Builder_Window_Test_HTML
+       MacroCommand = 'system:"start @HTMLFirstFilename@"' 
+       $MacroCommand
+       return
+   endif 
    MacroCommand = |system:"start beditwin call @GenSystemFilename@"|
    $MacroCommand
    window setfocus Builder_Window_WIN
    window setfocus Builder_Window_Windowname_EFOBJ
    return

//******************************
//* Test the System using HTML
//******************************
!a300_Builder_Window_Test_HTML
    //*****************************
    //* Generate the HTML
    //*****************************

    NavigationFilename = '@SystemName@.NAV'
    open NavigationFile @NavigationFilename

    WindowFilename = '@SystemName@.WIN'
    open WinFile @WindowFilename
    b

    HTMLFilename = null
    HTMLFirstFilename = null
    HTML_radio = null

    do
        if-1  (!eof)
+           split:/@line/;7
+           if-2  (left = 'WINDOW,')
+               call !a300_HTML_File
+           else-2
+               call !a300_HTML_Elements
+       endif
        file WinFile
        f;1
    until (eof)

    if  (HTMLFilename != null)
+       call !a300_html_paintfile
+       write HTMLFile @HTMLFilename
+   endif
    close WinFile
    close NavigationFile
    close HTMLFile error
        
    return

//******************************
//* Create the HTML File
//******************************
!a300_HTML_File

    if  (HTMLFilename != null)
+       //message = 'writing HTMLFile:@HTMLFilename@' window message info ok
+       call !a300_html_paintfile
+       write HTMLFile @HTMLFilename
+       close HTMLFile
+       file WinFile
+       scan:/@line/:/,/
+   endif

    HTML_id = 0

    scan:/@right/:/,/
    HTMLWindowname = '@left@,'
    HTMLFilename = '@left@.html'
    if  (HTMLFirstFilename = null) HTMLFirstFilename = HTMLFilename
    open HTMLFile null
    //message = "HTML_File:@HTMLFilename@" window message info ok

    Newline = '<!-- CSS @HTMLFilename@ -->'
    i:/@Newline@/
    i:'<!DOCTYPE html PUBLIC "-W3C//DTD XHTML 1.0 Trasitional//EN"'
    i:'"http://ww.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'


    i:'<htlm>'
    i:'   <head>'
    i:'	     <style type="text/css">'
    i:'      </style>'
    i:'   </head>'
    i:'   <body>'
    i:'      <form>'
    i:'      </form>'
    i:'   </body>'
    i:'</html>'

    return

//******************************
//* Create the HTML Elements
//******************************
!a300_HTML_Elements
    if  (left = 'STTXT1,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       Newline = '         <div id="ID@HTML_id@">@HTML_text@</div>'
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif
    if  (left = 'EFOBJL,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       HTML_work = HTML_cx
+       HTML_work = HTML_work / 9
+       Newline = '         <div id="ID@HTML_id@"><input type="text" size="@HTML_work@"></div>'
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif
    if  (left = "MLOBJ1,")
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;width:@HTML_cx@px;height:@HTML_cy@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       HTML_work = HTML_cx
+       HTML_work = HTML_work / 9
+       HTML_work2 = HTML_cy
+       HTML_work2 = HTML_work2 / 12
+       Newline = '         <div id="ID@HTML_id@"><textarea name="@HTML_name@ rows="@HTML_work2@" cols="@HTML_work@"></textarea></div>'
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif
    if  (left = 'PBOBJ1,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       call !a300_HTML_fixtext
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       call !a300_HTML_button_navigation
+       file HTMLFile
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif

    if  (left = 'RBOBJ1,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       call !a300_HTML_radioset
+       call !a300_HTML_fixtext
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       Newline = '         <div id="ID@HTML_id@">@HTML_text@<input type="radio" name="@HTML_radio@" value="@HTML_text@"></div>'
+       file HTMLFile
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   else
+       HTML_radio = null
+   endif
    if  (left = 'CBOBJ1,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       call !a300_HTML_fixtext
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       Newline = '         <div id="ID@HTML_id@">@HTML_text@<input type="checkbox" name="@HTML_name@" value="@HTML_text@"></div>'
+       file HTMLFile
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif
    if  (left = 'COOBJS,') or (left = 'COOBJL,')
+       scan:/@right/:/,/ HTML_name = left
+       scan:/@right/:/,/ HTML_x = left
+       scan:/@right/:/,/ HTML_y = left
+       scan:/@right/:/,/ HTML_cx = left
+       scan:/@right/:/,/ HTML_cy = left
+       HTML_text = right
+       call !a300_HTML_fixtext
+       HTML_id ++
+       Newline = '            #ID@HTML_id@{position:absolute;top:@HTML_y@px;left:@HTML_x@px;}'
+       file HTMLFile
+       b
+       fs:|</style>|
+       ib:/@Newline@/
+       HTML_name = "_____________________________________"
+       HTML_work = HTML_cx
+       HTML_work = HTML_work / 9
+       split:/@HTML_name/;@HTML_work
+       Newline = '         <div id="ID@HTML_id@"><select><option>@left@</option></select></div>'
+       file HTMLFile
+       b
+       fs:|</form>|
+       ib:/@Newline/
+   endif

    file WinFile
    
    return

//******************************
//* Set the Radio group name
//******************************
!a300_HTML_radioset
    if  (HTML_radio = null)
+       HTML_radio = HTML_name
+   endif
    return

//******************************
//* Remove & from HTML_text
//******************************
!a300_HTML_fixtext
    do
        scan:/@HTML_text@/:/&/
        if  (found) HTML_text = "@left@@right@"
    until (!found)
    return

//******************************
//* Create the Button Navigation
//******************************
!a300_HTML_button_navigation
    //message = '!a300_HTML_button_navigation HTML_name[@HTML_name@]' window message info ok
    Newline = '         <div id="ID@HTML_id@"><input type="button" value="@HTML_text@" onclick="window.open ('@HTMLFirstFilename@','_self')"></div>'  
    file NavigationFile
    b
    fs:/@HTML_name@/
    if  (eof)
+       return
+   endif
    scan:/@line/:/,/
    scan:/@right/:/,/
    HTML_navigation = '@SystemName@_@left@_WIN.html'
    //message = 'HTML_navigation[@HTML_navigation@] line[@line@]' window message info ok
    if (right = 'open')
+       Newline = '         <div id="ID@HTML_id@"><input type="button" value="@HTML_text@" onclick="window.open ('@HTML_navigation@','_self')"></div>'
+   endif

    return

//******************************
//* Add PaintFile objects to HTML
//******************************
!a300_html_paintfile
    //message = '!a300_html_paintfile HTMLWindowname[@HTMLWindowname@]' window message info ok
    file HTMLFile
    b
    fs:|</style>|
    ib:|            img{position:absolute};|
    fs:|</form>|
    i:|      <svg style="width:3000px; height:3000px;">|
    i:|      </svg>|

    file PaintFile
    b

    do
        if  (!eof)
+           scan:/@line/:/@HTMLWindowname@/
+           if (found)
+              call !a300_convert
+       endif
        file PaintFile
        f;1
    until (eof)

    file HTMLFile

    //write HTMLFile fgb.dat

    file PaintFile
    b
    file WinFile
    return

//****************************************
//* Convert 1 PaintFile line to HTML
//****************************************
!a300_convert
    //message = '!a300_convert line[@line@]' window message info ok
    scan:/@right/:/,/
    scan:/@right/:/,/ ObjectType = left
    scan:/@right/:/,/ ObjectX = left
    scan:/@right/:/,/ ObjectY = left
    scan:/@right/:/,/ ObjectCX = left
    scan:/@right/:/,/ ObjectCY = left
    scan:/@right/:/,/ HTML_R = left
    scan:/@right/:/,/ HTML_G = left 
    HTML_B = right
    //message = '!a300_convert line[@line@] ObjectType[@ObjectType@]' window message info ok
    file HTMLFile
    b
    fs:|</svg>|
    b;1
    if  (ObjectType = 'Ellipse')
+       HTML_work = ObjectCX / 2
+       Newline = |          <circle cx="@ObjectX@" cy="@ObjectY@" r="@HTML_work@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Ellipse3D')
+       HTML_work = ObjectCX / 2
+       Newline = |          <circle cx="@ObjectX@" cy="@ObjectY@" r="@HTML_work@" style="stroke:rgb(0,0,0); fill:rgb(0,0,0);"/>|
+       i:/@Newline@/
+       ObjectX -= 3
+       ObjectY -= 3
+       Newline = |          <circle cx="@ObjectX@" cy="@ObjectY@" r="@HTML_work@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Circle')
+       HTML_work = ObjectCX / 2
+       Newline = |          <circle cx="@ObjectX@" cy="@ObjectY@" r="@HTML_work@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:none;"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Box')
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Box3D')
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(0,0,0); fill:rgb(0,0,0);"/>|
+       i:/@Newline@/
+       ObjectX -= 3
+       ObjectY -= 3
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Boxround')
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" rx="20" ry="20" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(0,0,0); fill:rgb(0,0,0);"/>|
+       i:/@Newline@/
+       ObjectX -= 3
+       ObjectY -= 3
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" rx="20" ry="20" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'Rectangle')
+       Newline = |          <rect x="@ObjectX@" y="@ObjectY@" width="@ObjectCX@" height="@ObjectCY@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@);fill:none;"/>|
+       i:/@Newline@/
+       return
+   endif
    split:/@ObjectType/;5
    if  (ObjectType = 'Line') or (left = "Arrow")
+       Newline = |          <line x1="@ObjectX@" y1="@ObjectY@" x2="@ObjectCX@" y2="@ObjectCY@" style="stroke:rgb(@HTML_R@,@HTML_G@,@HTML_B@); fill:rgb(@HTML_R@,@HTML_G@,@HTML_B@);"/>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'TextTilt')
+       scan:/@right/:/,/ HTML_B = left
+       scan:/@right/:/,/
+       Newline = |          <text class="hover" hovertext="@right@" x="@ObjectX@" y="@ObjectY@" font-size="@ObjectCX@" fill="rgb(@HTML_R@,@HTML_G@,@HTML_B@)" transform="rotate(-@ObjectCY@ @ObjectX@,@ObjectY@)">@right@</text>|
+       i:/@Newline@/
+       return
+   endif
    if  (ObjectType = 'BitmapFit')
+       file PaintFile
+       scan:/@line/:/@HTMLWindowname@/
+       scan:/@right/:/,/
+       scan:/@right/:/,/ ObjectType = left
+       scan:/@right/:/,/ ObjectX = left
+       scan:/@right/:/,/ ObjectY = left
+       scan:/@right/:/,/ ObjectCX = left
+       scan:/@right/:/,/ ObjectCY = left
+       file HTMLFile
+       b
+       fs:|</form>|
+       call !a300_fixbitmap
+       Newline = |        <div><img src="@right@" height="@ObjectCY@" width="@ObjectCX@" style="top:@ObjectY@px;left:@ObjectX@px;"/></div>|
+       ib:/@Newline@/
+       return
+   endif

    if  (ObjectType = 'Text')
+       file PaintFile
+       scan:/@line/:/@HTMLWindowname@/
+       scan:/@right/:/,/
+       scan:/@right/:/,/ ObjectType = left
+       scan:/@right/:/,/ ObjectX = left
+       scan:/@right/:/,/ ObjectY = left
+       scan:/@right/:/,/ ObjectCX = left
+       scan:/@right/:/,/ ObjectCY = left
+       scan:/@right/:/,/ HTML_R = left
+       scan:/@right/:/,/ HTML_G = left 
+       scan:/@right/:/,/ HTML_B = left 
+       scan:/@right/:/,/
+       file HTMLFile
+       Newline = |          <text x="@ObjectX@" y="@ObjectY@" font-size="@ObjectCX@" fill="rgb(@HTML_R@,@HTML_G@,@HTML_B@)">@right@</text>|
+       i:/@Newline@/
+       return
+   endif


    file PaintFile
    return

//******************************
//* Fix bitmap size if necessary
//******************************
!a300_fixbitmap
    if  (ObjectCY = 0) ObjectCY = ObjectCX
    return

//******************************
//* View the System
//******************************
!a300_Builder_Window_View_PBOBJ
    ViewSingleProg = 'n'
    ViewBuilderWindow = 'y'
!a300_Builder_Window_View_PBOBJ_2
    window pointer wait
    window hwnd Builder_View_WIN status error window open Builder_View_WIN shade
    if  (ViewSingleProg)
+       window show Builder_View_Comments_PBOBJ
+       window show Builder_View_Open_PBOBJ
+   else
+       window hide Builder_View_Comments_PBOBJ
+       window hide Builder_View_Open_PBOBJ
+   endif
    //window center Builder_View_WIN
    window clear Builder_View_WIN
    Builder_View_WIN = "Builder Window Viewer - System[@SystemName@]"
    window title Builder_View_WIN
    if  (ViewCobol) goto !a300_filterlist_done
    close ViewFilterList error
    open ViewFilterList null
    file BuilderWindowFile
    b
    do
        if (!eof)
+          SearchString = 'WINDOW,'
+          fs:/@SearchString@/
+          if (!eof)
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             WindowName = left
+             scanr:/@line/:/,/
+             WindowTitle = right
+             scan:/@WindowName@/:/_/
+             scan:/@right/:/_/
+             //message = 'WindowName[@WindowName@] WindowTitle[@WindowTitle@]' window message info ok
+             Newline = '@WindowName@,@WindowTitle@,@left@'
+             file ViewFilterList
+             i:/@Newline@/
+             file BuilderWindowFile
+       endif
+       f;1
    until (eof)
!a300_filterlist_done
    ViewCobol = 'n'
    call !v100_view

!a300_view_done
    window unshade Builder_View_WIN
    window setfocus Builder_View_WIN
    window pointer arrow
    return

//******************************
//* Open the Assist Window for Debugging
//******************************
!a300_Builder_Window_Debug_PBOBJ
    CodeType = 'bedit'
    WindowDebug = 'y'
    call !a200_Builder_System_Assist_PBOBJ
    call !a1900_Builder_Codeassist_Debugrun_PBOBJ
    return

//******************************
//* Close Window Maintenance
//******************************
!a300_Builder_Window_Code_PBOBJ
    CodeType = 'beditwin'
    call !a400_Builder_Control_Code_PBOBJ
    return

//******************************
//* Close Window Maintenance
//******************************
!a300_Builder_Window_Close_PBOBJ
    window close Builder_Window_WIN
    window unshade Builder_System_WIN
    window setfocus Builder_System_WIN
    close BuilderWindowFile
    close Entryaction error
    close PaintFile error
    open PaintFile @PaintSystemName error open PaintFile null
    b
    fs:/@EarthBitmapLine/
    if (eof)
+      b
+      ib:/@EarthBitmapLine/
+      //i:/******************/
+      //i:/******************/
+      //i:/******************/
+   endif
    return

//******************************
//* Create Bedit Code
//******************************
!a350_create_bedit_code
    return

//******************************
//* Size a control
//******************************
!a400_Builder_Control_Size_PBOBJ
    window obtain Builder_Control_Control_EFOBJ
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    //******************************
    //* Size X
    //******************************
    window obtain Builder_Control_X_EFOBJ
    if (Builder_Control_X_EFOBJ < 1) 
+      Builder_Control_X_EFOBJ = '1'
+      window modify Builder_Control_X_EFOBJ
+   endif

    //******************************
    //* Size Y
    //******************************
    window obtain Builder_Control_Y_EFOBJ
    if (Builder_Control_Y_EFOBJ < 1) 
+      Builder_Control_Y_EFOBJ = '1'
+      window modify Builder_Control_Y_EFOBJ
+   endif

    //******************************
    //* Size CX
    //******************************
    window obtain Builder_Control_Height_EFOBJ
    if (Builder_Control_Height_EFOBJ < 1) 
+      Builder_Control_Height_EFOBJ = '1'
+      window modify Builder_Control_Height_EFOBJ
+   endif

    //******************************
    //* Size CY
    //******************************
    window obtain Builder_Control_Length_EFOBJ
    if (Builder_Control_Length_EFOBJ < 1) 
+      Builder_Control_Length_EFOBJ = '1'
+      window modify Builder_Control_Length_EFOBJ
+   endif

    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      //window message error ok
+      return
+   endif

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY


!a400_Builder_Control_restrict_size

    ObjectX = Builder_Control_X_EFOBJ
    ObjectX += MinX
    ObjectY = Builder_Control_Y_EFOBJ
    ObjectY += MinY
    ObjectCX = Builder_Control_Length_EFOBJ
    ObjectCY = Builder_Control_Height_EFOBJ

    scanr:/@ButtonFocus/:/_/
    if-1  (right = 'TextTilt')
+       if-2  (ObjectCY < 0)
+           ObjectCY = 0
+           Builder_Control_Height_EFOBJ = ObjectCY
+           window modify Builder_Control_Height_EFOBJ
+       else-2
+           if-3  (ObjectCY > 360)
+               ObjectCY = 360
+               Builder_Control_Height_EFOBJ = ObjectCY
+               window modify Builder_Control_Height_EFOBJ
+   endif
    if  (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt')
+       goto !a400_Builder_Control_restrict_paintfile
+   endif

    //******************************
    //* Restrict to Window Size
    //******************************
    //*** Left
    WinX = ObjectX - MinX
    if (WinX < 1) 
+       ObjectX = MinX + 1
+       WinX = ObjectX - MinX
+       Builder_Control_X_EFOBJ = WinX
+       window modify Builder_Control_X_EFOBJ
+   endif
    //*** Right
    WinX = ObjectX + ObjectCX
//    if  (WinX > MaxX)
//+       ObjectX = MaxX - ObjectCX - 1
//+       WinX = ObjectX - MinX
//+       Builder_Control_X_EFOBJ = WinX
//+       window modify Builder_Control_X_EFOBJ
//+   endif

    //*** Up
    WinY = ObjectY - MinY
    if  (WinY < 1) 
+       ObjectY = MinY + 1
+       WinY = ObjectY - MinY
+       Builder_Control_Y_EFOBJ = WinY
+       window modify Builder_Control_Y_EFOBJ
+   endif
    //*** Down
    WinY = ObjectY + ObjectCY
//    if  (WinY > MaxY)
//+       ObjectY = MaxY - ObjectCY - 1
//+       WinY = ObjectY - MinY
//+       Builder_Control_Y_EFOBJ = WinY
//+       window modify Builder_Control_Y_EFOBJ
//+   endif

    scanr:/@Builder_Control_Control_EFOBJ/:/_/
    if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right = 'Rectangle')
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+       call !b400_repaint_control
+       return
+   endif

!a400_Builder_Control_restrict_paintfile
    //*********************************
    //* Modify PaintFile
    //*********************************
    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if  (left = Builder_Control_Control_EFOBJ)
+                  MaintainLengthHeight = 'n'
+                  call !a400_modify_paint
+                  f;*
+       endif
        f;1          
    until (eof)
    //call !b400_repaint_control

    return


//******************************
//* Modify a Paint Control
//******************************
!a400_modify_paint
    //message = '!a400_modify_paint ObjectX[@ObjectX@] ObjectY[@ObjectY@] ObjectCX[@ObjectCX@] ObjectCY[@ObjectCY@] Drag[@Drag@]' window message info ok
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    HoldX = left
    scan:/@right/:/,/
    HoldY = left
    scan:/@right/:/,/
    if  (HoldType = 'Bitmap')
+       CurrFile = left
+       goto !a400_modify_bitmap
+   endif
    HoldCX = left
    scan:/@right/:/,/
    HoldCY = left
    scan:/@right/:/,/
    if  (HoldType = 'BitmapFit')
+       CurrFile = left
+       goto !a400_modify_bitmap
+   endif
    HoldRed = left
    scan:/@right/:/,/
    HoldGreen = left
    scan:/@right/:/,/
    HoldBlue = left

    if  (HoldType = 'Text') or (HoldType = 'TextTilt')
+       scan:/@right/:/,/
+       CurrFont = left
+       HoldText = right
+       if  (!GroupColorChange)
+           window obtain Builder_Control_ControlText_EFOBJ
+           HoldText = Builder_Control_ControlText_EFOBJ
+   endif

    if  (HoldType = 'Line')
+       if  (!MaintainLengthHeight)
+           ObjectCX += MinX
+           ObjectCY += MinY
+   endif
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           if  (!MaintainLengthHeight)
+               ObjectCX += MinX
+               ObjectCY += MinY
+   endif

!a400_modify_bitmap
    if  (GroupColorChange)
+       if  (HoldType = 'Bitmap') or (HoldType = 'BitmapFit')
+           return
+   endif

    if-1  (HoldType = 'Text') or (HoldType = 'TextTilt')
+       window obtain Builder_Control_Fonts_COOBJ
+       if-2  (Builder_Control_Fonts_COOBJ != null)
+           Builder_Control_Font_STTXT = Builder_Control_Fonts_COOBJ
+           window modify Builder_Control_Font_STTXT
+           CurrFont = Builder_Control_Fonts_COOBJ
+           Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@,@CurrFont@,@HoldText@'
+       else-2
+           Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@,@CurrFont@,@HoldText@'
+   else-1
+       if-3  (HoldType = 'Bitmap')
+           window obtain Builder_Control_Bitmap_EFOBJ
+           CurrFile = Builder_Control_Bitmap_EFOBJ
+           Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@CurrFile@'
+       else-3
+           if-4  (HoldType = 'BitmapFit')
+               window obtain Builder_Control_Bitmap_EFOBJ
+               CurrFile = Builder_Control_Bitmap_EFOBJ
+               Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@CurrFile@'
+           else-4
+               Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@'             
+   endif

    //message = 'line[@line@] Newline[@Newline@]' window message info ok
    r:/@Newline@/
    b
    //b

    if  (HoldType = 'Line')
+       if  (!MaintainLengthHeight)
+           ObjectCX -= MinX
+           ObjectCY -= MinY
+   endif
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           if  (!MaintainLengthHeight)
+               ObjectCX -= MinX
+               ObjectCY -= MinY
+   endif

    if  (HoldType = 'Line') or (HoldType beginswith 'Arrow')
+       if  (!MaintainLengthHeight)
+           Builder_Control_Height_EFOBJ = ObjectCY
+           window modify Builder_Control_Height_EFOBJ
+           Builder_Control_Length_EFOBJ = ObjectCX
+           window modify Builder_Control_Length_EFOBJ
+   endif

    MaintainLengthHeight = 'n'

    ObjectX -= MinX
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ 

    ObjectY -= MinY
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ 

    scanr:/@HoldControlName@/:/_/
    SearchString = "Builder_Control_WIN,@left@.Text_Text/
    //message = SearchString window message info ok
    file PaintFile
    b
    fs:/@SearchString@/
    if  (!eof)
+       TextObj = left
+       SearchString = "@left@.Text_Text/
+       scan:/@line/:/,/
+       scan:/@right/:/,/ TextName = left
+       scan:/@right/:/,/ TextType = left
+       scan:/@right/:/,/ TextX = left
+       scan:/@right/:/,/ TextY = left
+       scan:/@right/:/,/ TextCX = left
+       scan:/@right/:/,/ TextCY = left
+       scan:/@right/:/,/ TextRed = left
+       scan:/@right/:/,/ TextGreen = left
+       scan:/@right/:/,/ TextBlue = left
+       scan:/@right/:/,/ TextFont = left
+       TextText = right
+       call !a400_text_offset
+       Newline = '@HoldWindowName@,@SearchString@,@TextType@,@TextX@,@TextY@,@TextCX@,@TextCY@,@TextRed@,@TextGreen@,@TextBlue@,@TextFont@,@TextText@'
+       r:/@Newline@/
+       //message = Newline window message info ok
+   endif

    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    return

//******************************
//* Fix the text offset (texttext)
//* for Object Text
//******************************
!a400_text_offset
    TextX = ObjectX + MinX
    TextY = ObjectY + MinY
   
!a400_text_offset_entry2
    TextSearch = '@SystemName@_@WindowName@_WIN,@TextObj@'
    //message = TextSearch window message info ok
    close TextFile error
    TextFileName = '@SystemName@.txt'
    open TextFile @TextFileName error open TextFile null goto !a400_text_offset_create
    b
    TextSearch = '@TextSearch@,'
    fs:/@TextSearch/
    if (eof) goto !a400_text_offset_create
    scan:/@line/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    TextX += left
    TextY += right
    close TextFile
    file PaintFile
    return

!a400_text_offset_create
    //message = HoldType window message info ok
    if  (HoldType beginswith 'Ellipse') or (HoldType beginswith 'Circle')
+       TextOffX = -15
+       TextOffY = -10
+       goto !a400_text_offset_newline
+   endif
    if  (HoldType beginswith 'Diamond')
+       TextOffX = -20
+       TextOffY = 2
+       goto !a400_text_offset_newline
+   endif
    if  (HoldType beginswith 'Triangle')
+       TextOffX = 30
+       TextOffY = 30
+       goto !a400_text_offset_newline
+   endif

    TextOffX = 10
    TextOffY = 2

!a400_text_offset_newline
    TextX += TextOffX
    TextY += TextOffY
    Newline = '@SystemName@_@WindowName@_WIN,@TextObj@,@TextOffX@,@TextOffY@'
    i:/@Newline/
    write TextFile @TextFileName
    close TextFile
    file PaintFile
    return

//******************************
//* Create Button
//******************************
!a400_Builder_Control_Create_PBOBJ
    if  (!KeepSizePos)
+       CurrFile = null
+   endif
    //*** Reenable Control Updating
    window enable Builder_Control_Focus_PBOBJ
    window enable Builder_Control_Delete_PBOBJ
    HoldAction = Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = "Win"
    window modify Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = HoldAction

    Builder_Control_Size_RBOBJ = 'N'
    window modify Builder_Control_Size_RBOBJ
    Builder_Control_Pos_RBOBJ = 'Y'
    window modify Builder_Control_Pos_RBOBJ

    window obtain Builder_Control_WIN

    pack Builder_Control_Control_EFOBJ
    if (Builder_Control_Control_EFOBJ = null)
+      message = 'Please enter a Control Name'
+      window message warning ok
+      window setfocus Builder_Control_Control_EFOBJ
+      return
+   endif
    if  (Duplicating)
+       Duplicating = 'n'
+       goto !a400_Builder_Control_Create_duplicating
+   endif
    if  (!CreateText) and (Builder_Control_ControlType_COOBJ = 'Special')
+       call !a400_Builder_Control_Specialobjects
+       return
+   endif

!a400_Builder_Control_Create_PBOBJ_past_special
    if  (CreateText)
+       Builder_Control_ControlType_COOBJ = 'Text Font'
+   endif
    if  (Builder_Control_ControlType_COOBJ != null)
+       Builder_Control_Button_RBOBJ = 'N'
+       Builder_Control_Entry_RBOBJ = 'N'
+       Builder_Control_Text_RBOBJ = 'N'
+       Builder_Control_Check_RBOBJ = 'N'
+       Builder_Control_List_RBOBJ = 'N'
+       Builder_Control_Group_RBOBJ = 'N'
+       Builder_Control_Radio_RBOBJ = 'N'
+       Builder_Control_MLE_RBOBJ = 'N'
+       Builder_Control_Combo_RBOBJ = 'N'
+       Builder_Control_Drop_RBOBJ = 'N'
+       Builder_Control_Rectangle_RBOBJ = 'N'
+       Builder_Control_Box_RBOBJ = 'N'
+       Builder_Control_Boxcolor_RBOBJ = 'N'
+       Builder_Control_Box3D_RBOBJ = 'N'
+       Builder_Control_Ellipse_RBOBJ = 'N'
+       Builder_Control_Ellipse3D_RBOBJ = 'N'
+       Builder_Control_Circle_RBOBJ = 'N'
+       Builder_Control_Diamond_RBOBJ = 'N'
+       Builder_Control_Line_RBOBJ = 'N'
+       Builder_Control_Arrow_RBOBJ = 'N'
+       Builder_Control_Textfont_RBOBJ = 'N'
+       Builder_Control_TextTilt_RBOBJ = 'N'
+       Builder_Control_Bitmap_RBOBJ = 'N'
+       Builder_Control_Bitmapfit_RBOBJ = 'N'
+       Builder_Control_Rectanglecolor_RBOBJ = 'N'
+       Builder_Control_Triangle_RBOBJ = 'N'
+   endif

    if  (Builder_Control_ControlType_COOBJ = 'Button') Builder_Control_Button_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Entry') Builder_Control_Entry_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Text') Builder_Control_Text_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Check') Builder_Control_Check_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'List') Builder_Control_List_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Group') Builder_Control_Group_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Radio') Builder_Control_Radio_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Multi-Line') Builder_Control_MLE_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Combo') Builder_Control_Combo_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Drop Down') Builder_Control_Drop_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Rectangle') Builder_Control_Rectangle_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Box') Builder_Control_Box_RBOBJ = 'Y'

    if  (Builder_Control_ControlType_COOBJ = 'Box Color') or (Builder_Control_ControlType_COOBJ = 'Boxcolor') Builder_Control_Boxcolor_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Box Round')  or (Builder_Control_ControlType_COOBJ = 'Boxround') Builder_Control_Boxround_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Box-3D') or (Builder_Control_ControlType_COOBJ = 'Box3D') Builder_Control_Box3D_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Ellipse') Builder_Control_Ellipse_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Ellipse-3D') or (Builder_Control_ControlType_COOBJ = 'Ellipse3D') Builder_Control_Ellipse3D_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Circle') Builder_Control_Circle_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Diamond') Builder_Control_Diamond_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Line') Builder_Control_Line_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ beginswith 'Arrow') Builder_Control_Arrow_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Text Font') or (Builder_Control_ControlType_COOBJ = 'Text') Builder_Control_Textfont_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Text Tilt') or (Builder_Control_ControlType_COOBJ = 'Texttilt') Builder_Control_TextTilt_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Bitmap') Builder_Control_Bitmap_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Bitmap Fit') or (Builder_Control_ControlType_COOBJ = 'Bitmapfit') Builder_Control_Bitmapfit_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ beginswith 'Triangle') Builder_Control_Triangle_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Rectangle Color') or (Builder_Control_ControlType_COOBJ = 'Rectanglecolor') Builder_Control_Rectanglecolor_RBOBJ = 'Y'

!a400_Builder_Control_Create_duplicating
    ControlType = null
    if  (Builder_Control_Button_RBOBJ)    ControlType = 'PBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Entry_RBOBJ)     ControlType = 'EFOBJL' window enable Builder_Control_Entryaction_PBOBJ  window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Text_RBOBJ)      ControlType = 'STTXT1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Check_RBOBJ)     ControlType = 'CBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Group_RBOBJ)     ControlType = 'GBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_List_RBOBJ)      ControlType = 'LBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Radio_RBOBJ)     ControlType = 'RBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Combo_RBOBJ)     ControlType = 'COOBJS' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Drop_RBOBJ)      ControlType = 'COOBJL' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_MLE_RBOBJ)       ControlType = 'MLOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Rectangle_RBOBJ) ControlType = 'STTXTF' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Box_RBOBJ)       ControlType = 'STTXTR' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Boxcolor_RBOBJ)  ControlType = 'Box' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Boxround_RBOBJ)  ControlType = 'Boxround' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Rectanglecolor_RBOBJ) ControlType = 'Rectangle' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Box3D_RBOBJ)     ControlType = 'Box3D' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Triangle_RBOBJ)  ControlType = 'TriangleA' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Ellipse_RBOBJ)   ControlType = 'Ellipse' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Ellipse3D_RBOBJ) ControlType = 'Ellipse3D' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Circle_RBOBJ)    ControlType = 'Circle' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Diamond_RBOBJ)   ControlType = 'Diamond' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Line_RBOBJ)      ControlType = 'Line' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Arrow_RBOBJ)     ControlType = 'Arrow' window enable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Textfont_RBOBJ)  ControlType = 'Text' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_TextTilt_RBOBJ)  ControlType = 'TextTilt' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ window show Builder_Control_Color_PBOBJ window enable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Bitmap_RBOBJ)    ControlType = 'Bitmap' window disable Builder_Control_Buttonaction_PBOBJ window enable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Color_PBOBJ
    if  (Builder_Control_Bitmapfit_RBOBJ) ControlType = 'BitmapFit' window enable Builder_Control_Buttonaction_PBOBJ window enable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Color_PBOBJ

    if  (CreateText) ControlType = 'TextTilt'

    if  (ControlType = 'Arrow')
+       scanr:/@Builder_Control_Control_EFOBJ/:/_/
+       ControlType = right
+   endif

    if  (SpecialControlType != null) 
+       ControlType = SpecialControlType
+       SpecialControlType = null
+   endif
    if  (CurrFont = null)
+       CurrFont = 'Times New Roman'
+       Builder_Control_Font_STTXT = CurrFont
+   endif

    if  (ControlType = 'Text') or (ControlType = 'TextTilt')
+       call !a400_Builder_Control_Create_loadfonts
+       window show Builder_Control_Font_STTXT
+       window show Builder_Control_Font_PBOBJ
+       window modify Builder_Control_Font_STTXT
+       window show Builder_Control_Fonts_COOBJ
+       DynamicX = MainCX - 400
+       DynamicY = MainCY - 65
+       DynamicY = 52
+       MacroCommand = 'window size Builder_Control_Font_PBOBJ @DynamicX@ @DynamicY@ 35 20' $MacroCommand
+       DynamicX = DynamicX + 40
+       MacroCommand = 'window size Builder_Control_Fonts_COOBJ @DynamicX@ @DynamicY@ 150 650' $MacroCommand
+       DynamicX = DynamicX + 155
+       MacroCommand = 'window size Builder_Control_Font_STTXT @DynamicX@ @DynamicY@ 150 20' $MacroCommand
+   else
+       window hide Builder_Control_Font_STTXT
+       window hide Builder_Control_Font_PBOBJ
+       window hide Builder_Control_Fonts_COOBJ
+   endif

    if-1  (ControlType = 'Bitmap') or (ControlType = 'BitmapFit')
+       window show Builder_Control_Bitmap_PBOBJ
+       window show Builder_Control_Bitmap_EFOBJ
+       DynamicX = MainCX - 700
+       DynamicY = MainCY - 65
+       DynamicY = 52
+       MacroCommand = 'window size Builder_Control_Bitmap_PBOBJ @DynamicX@ @DynamicY@ 70 20' $MacroCommand
+       DynamicX = DynamicX + 75
+       MacroCommand = 'window size Builder_Control_Bitmap_EFOBJ @DynamicX@ @DynamicY@ 600 20' $MacroCommand
+       if-2  (!KeepSizePos)
+           call !a400_Builder_Control_Bitmap_PBOBJ
+   else-1
+       window hide Builder_Control_Bitmap_PBOBJ
+       window hide Builder_Control_Bitmap_EFOBJ
+   endif

    if  (ControlType = 'Line')
+       Builder_Control_Height_STTXT = 'CY-Pos' window modify Builder_Control_Height_STTXT
+       Builder_Control_Length_STTXT = 'CX-Pos' window modify Builder_Control_Length_STTXT
+       window show Builder_Control_Swap_PBOBJ
+   else
+       Builder_Control_Height_STTXT = 'Height' window modify Builder_Control_Height_STTXT
+       Builder_Control_Length_STTXT = 'Length' window modify Builder_Control_Length_STTXT
+       window hide Builder_Control_Swap_PBOBJ
+   endif
    if  (ControlType beginswith 'Arrow')
+       split:/@ControlType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           Builder_Control_Height_STTXT = 'CY-Pos' window modify Builder_Control_Height_STTXT
+           Builder_Control_Length_STTXT = 'CX-Pos' window modify Builder_Control_Length_STTXT
+           window show Builder_Control_Swap_PBOBJ
+   endif

    if  (ControlType = null)
+       message = 'Please select a Control Type'
+       window message error ok
+       return
+   endif
    crush Builder_Control_Control_EFOBJ

    //*********************
    //* Modify to Default
    //*********************   
    scan:/@Builder_Control_Control_EFOBJ/:/@SystemName@/
    if-1 (!found)
+      scan:/@Builder_Control_Control_EFOBJ/:/@WindowName@/
+      if-2  (!found)
+          scan:/@Builder_Control_Control_EFOBJ/:/@ControlType@/
+          if-3 (!found)
+             if-4  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType = 'Boxround') or (ControlType beginswith 'Rectangle')
+                 mix Builder_Control_Control_EFOBJ
+                 ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@ControlType@'
+                 Builder_Control_Control_EFOBJ = ControlName
+             else-4
+                 mix Builder_Control_Control_EFOBJ
+                 splitr:/@ControlType@/;1
+                 ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@left@'
+                 Builder_Control_Control_EFOBJ = ControlName
+   endif
    scan:/@Builder_Control_Control_EFOBJ@/:/_/
    if-1 (!found)
+      if-2  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType = 'Boxround') or (ControlType beginswith 'Rectangle')
+          mix Builder_Control_Control_EFOBJ
+          ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@ControlType@'
+          Builder_Control_Control_EFOBJ = ControlName
+      else-2
+          mix Builder_Control_Control_EFOBJ
+          splitr:/@ControlType@/;1
+          ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@left@'
+          Builder_Control_Control_EFOBJ = ControlName
+   endif 
    window modify Builder_Control_Control_EFOBJ
    //*********************
    //* Check for Duplicate
    //*********************
    file Controls error open Controls null
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if  (!eof)
+       message = 'Duplicate Control Name'
+       window message warning ok
+       window setfocus Builder_Control_Control_EFOBJ
+       return
+   endif
    file PaintFile error open PaintFile null
    SearchString = 'Builder_Control_WIN,@Builder_Control_Control_EFOBJ@,'
    b
    fs:/@SearchString/
    if  (!eof)
+       message = 'Duplicate Control Name'
+       window message warning ok
+       window setfocus Builder_Control_Control_EFOBJ
+       return
+   endif

!a400_Builder_Control_Create_PBOBJ_Create
    //*********************
    //* Add close to Nav
    //*********************
    if  (ControlType = 'PBOBJ1')
+       NavAction = 'close'
+       file WindowNav
+       b
+       fs:/@Builder_Control_Control_EFOBJ@/
+       Newline = "@Builder_Control_Control_EFOBJ@,@WindowName@,@NavAction@"
+       if  (eof)
+           i:/@Newline@/
+   endif

    //*********************
    //* Create the Control
    //*********************
    call !b100_create_control
    if  (!CreateText)
+       Builder_Control_ControlList_COOBJ = Builder_Control_Control_EFOBJ
+       call !a400_Builder_Control_Focus_PBOBJ_2
+       //call !a050_Escape_2
+   endif
    return

//******************************
//* Open the Special Objects window
//******************************
!a400_Builder_Control_Specialobjects
    window pointer wait
    window hwnd Builder_Specialobjects_WIN status error window open Builder_Specialobjects_WIN shade
    file PaintFile error open PaintFile null
    b
    do
        fs:/Builder_Specialobjects_WIN/
        if (!eof) d;1
    until (eof)
    close Special error
    open Special Builder_SpecObjects.pnt error message = 'Unable to open Builder_SpecObjects.pnt' window message warning ok return
    b
    clear
    copy;*
    file PaintFile
    paste
    clear
    b
    close Special
   
    window show Builder_Specialobjects_WIN
    window setfocus Builder_Specialobjects_WIN
    window paint Builder_Specialobjects_WIN
    window pointer arrow
    return

//******************************
//* Cancel the creation of a Special Object
//******************************
!a400_Builder_Specialobjects_Cancel_PBOBJ
    window close Builder_Specialobjects_WIN
    file PaintFile error return
    b
    do
        fs:/Builder_Specialobjects_WIN/
        if (!eof) d;1
    until (eof)
    b    
    return

//******************************
//* Load the fonts into the list
//******************************
!a400_Builder_Control_Create_loadfonts
    Builder_Control_Fonts_COOBJ = 'ALL'
    window delete Builder_Control_Fonts_COOBJ
    open FontsFile BuilderFonts.dat error return
    b
    do
        if  (!eof)
+           Builder_Control_Fonts_COOBJ = line
+           window insert end default Builder_Control_Fonts_COOBJ
+       endif
        f;1
    until (eof)
    close FontsFile
    return

//******************************
//* Go to selected window
//******************************
!a400_Builder_Control_Go_PBOBJ
    window obtain Builder_Control_Windownamelist_COOBJ
    split:/@Builder_Control_Windownamelist_COOBJ/;1
    if  (left = '>') return
    crush Builder_Control_Windownamelist_COOBJ
    if  (Builder_Control_Windownamelist_COOBJ = null)
+       message = 'Please select a window'
+       window message warning ok
+       return
+   endif
    GotoWindow = Builder_Control_Windownamelist_COOBJ
!a400_Builder_Control_Go_PBOBJ_language
    call !a400_Builder_Control_Save_PBOBJ
    window push Builder_Window_Modify_PBOBJ

    return

//******************************
//* Bitmap PBOBJ
//******************************
!a400_Builder_Control_Bitmap_PBOBJ
    if  (Extension = null) Extension = 'bmp'
    DirField = "Builder_Control_Bitmap_EFOBJ"
    FileField = "Builder_Control_Bitmap_EFOBJ"
    call !s100_directory
    return

//******************************
//* Goto Language Interface
//******************************
!a400_Builder_Control_Language_PBOBJ
    window setfocus Builder_Language_WIN
    Builder_Language_Commands_MLOBJ = null
    window modify Builder_Language_Commands_MLOBJ
    window setfocus Builder_Language_Commands_MLOBJ
    return

//******************************
//* Open the Text Edit screen
//******************************
!a400_Builder_Control_ControlText_PBOBJ
    window pointer wait
    window hwnd Builder_Textedit_WIN status error window open Builder_Textedit_WIN shade
    window obtain Builder_Control_ControlText_EFOBJ

    window obtain Builder_Control_Control_EFOBJ
    Builder_Textedit_Name_EFOBJ = Builder_Control_Control_EFOBJ
    window modify Builder_Textedit_Name_EFOBJ 

    window obtain Builder_Control_ControlText_EFOBJ
    Builder_Textedit_Text_EFOBJ = Builder_Control_ControlText_EFOBJ
    window modify Builder_Textedit_Text_EFOBJ

    Builder_Textedit_Pos_RBOBJ = 'Y'
    window modify Builder_Textedit_Pos_RBOBJ
    Builder_Textedit_Size_RBOBJ = 'N'
    window modify Builder_Textedit_Size_RBOBJ

    Builder_Textedit_Size_EFOBJ = '5'
    window modify Builder_Textedit_Size_EFOBJ

    Builder_Textedit_Font_COOBJ = 'ALL'
    window delete Builder_Textedit_Font_COOBJ
    open FontsFile BuilderFonts.dat error return
    b
    do
        if  (!eof)
+           Builder_Textedit_Font_COOBJ = line
+           window insert end default Builder_Textedit_Font_COOBJ
+       endif
        f;1
    until (eof)
    close FontsFile

    file PaintFile error open PaintFile null
    b
    scanr:/@Builder_Textedit_Name_EFOBJ/:/_/
    SearchString = 'Builder_Control_WIN,@left@.Text'
    fs:/@SearchString/
    if  (!eof)
+       scan:/@line/:/,/
+       scan:/@right/:/,/ TextName = left
+       scan:/@right/:/,/
+       scan:/@right/:/,/ TextX = left
+       scan:/@right/:/,/ TextY = left
+       scan:/@right/:/,/ TextCX = left
+       scan:/@right/:/,/ TextCY = left
+       scan:/@right/:/,/ TextRed = left
+       scan:/@right/:/,/ TextGreen = left
+       scan:/@right/:/,/ TextBlue = left
+       scan:/@right/:/,/ TextFont = left
+       TextText = right
+       Builder_Textedit_Font_EFOBJ = TextFont
+       window modify Builder_Textedit_Font_EFOBJ
+   endif

!a400_Builder_Control_ControlText_PBOBJ_unshade
    //******************************
    //* Get Bubble Text
    //******************************
    BubbleFileName = '@SystemName@.bbl'
    close BubbleFile error
    open BubbleFile @BubbleFileName error open BubbleFile null
    SearchString = '@Builder_Textedit_Name_EFOBJ@,'
    fs:/@SearchString/
    if (!eof)
+      scan:/@line/:/,/
+      Builder_Textedit_Bubble_MLOBJ = right
+      window modify Builder_Textedit_Bubble_MLOBJ
+   endif
    close BubbleFile

    window unshade Builder_Textedit_WIN
    window setfocus Builder_Textedit_WIN
    window pointer arrow
    return

//******************************
//* Apply chosen font
//******************************
!a400_Builder_Control_Font_PBOBJ
    call !a400_Builder_Control_Modify_PBOBJ
    return

//******************************
//* Connect 2 objects with Straight lines
//******************************
!a400_Builder_Control_Connectcreate_PBOBJ
    ButtonConnectionType = 'Straight'
    if  (BentConnect = 'bent') or (BentConnect = 'bent1') or (BentConnect = 'bent2') or (BentConnect = 'bent3') or (BentConnect = 'bent4') or (BentConnect = 'straight') or (BentConnect = 'straight1') or (BentConnect = 'straight2') or (BentConnect = 'straight3') or (BentConnect = 'straight4')
+       ButtonConnectionType = BentConnect
+       mix ButtonConnectionType
+   else
+       BentConnect = null
+   endif
    window obtain Builder_Language_Commands_MLOBJ
    pack Builder_Language_Commands_MLOBJ
    //message = 'ConnectCreate Builder_Language_Commands_MLOBJ[@Builder_Language_Commands_MLOBJ@]' window message info ok
    if  (Builder_Language_Commands_MLOBJ = 'connect')
+       ContinueConnecting = 'y'
+   else
+       ContinueConnecting = 'n'
+   endif
    Builder_Language_Commands_MLOBJ = 'connect'
    window modify Builder_Language_Commands_MLOBJ
    return

//******************************
//* Connect 2 objects with Bent lines
//******************************
!a400_Builder_Control_Connectchoose_PBOBJ
    window pointer wait
    window hwnd Builder_Connectselect_WIN status error window open Builder_Connectselect_WIN shade
    ContinueConnecting = 'n'
    file PaintFile error open PaintFile null
    b
    fs:/@EarthBitmapLine/
    if (eof)
+      b
+      ib:/@EarthBitmapLine/
+      //i:/******************/
+      //i:/******************/
+      //i:/******************/
+   endif
    b
    do
        fs:/Builder_Connectselect_WIN/
        if (!eof) d;1
    until (eof)
    open BuilderConnect BuilderConnect.pnt error open BuilderConnnect null
    clear
    b
    copy;*
    close BuilderConnect
    file PaintFile
    b
    paste
    clear
    b
    window unshade Builder_Connectselect_WIN
    window setfocus Builder_Connectselect_WIN
    window paint Builder_Connectselect_WIN
    window pointer arrow
    return

!a400_Builder_Connectselect_Straight_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Straight'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = null
    window modify Builder_Language_Commands_MLOBJ
    return
!a400_Builder_Connectselect_Straight1_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Straight1'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'straight1'
    window modify Builder_Language_Commands_MLOBJ
    return
!a400_Builder_Connectselect_Straight2_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Straight2'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'straight2'
    window modify Builder_Language_Commands_MLOBJ
    return
!a400_Builder_Connectselect_Straight3_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Straight3'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'straight3'
    window modify Builder_Language_Commands_MLOBJ
    return
!a400_Builder_Connectselect_Straight4_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Straight4'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'straight4'
    window modify Builder_Language_Commands_MLOBJ
    return

!a400_Builder_Connectselect_Bent_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Bent'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'bent'
    window modify Builder_Language_Commands_MLOBJ
    return
!a400_Builder_Connectselect_Bent1_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Bent1'
    Builder_Language_Commands_MLOBJ = 'connect'
    BentConnect = 'bent1'
    window modify Builder_Language_Commands_MLOBJ
    return

!a400_Builder_Connectselect_Bent2_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Bent2'
    BentConnect = 'bent2'
    Builder_Language_Commands_MLOBJ = 'connect'
    window modify Builder_Language_Commands_MLOBJ
    return

!a400_Builder_Connectselect_Bent3_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Bent3'
    BentConnect = 'bent3'
    Builder_Language_Commands_MLOBJ = 'connect'
    window modify Builder_Language_Commands_MLOBJ
    return

!a400_Builder_Connectselect_Bent4_PBOBJ
    window close Builder_Connectselect_WIN
    ButtonConnectionType = 'Bent4'
    BentConnect = 'bent4'
    Builder_Language_Commands_MLOBJ = 'connect'
    window modify Builder_Language_Commands_MLOBJ
    return

!a400_Builder_Connectselect_Cancel_PBOBJ
    window close Builder_Connectselect_WIN
    return

//******************************
//* Disconnect 2 objects
//******************************
!a400_Builder_Control_Disconnect_PBOBJ
    ButtonConnectionType = 'Disconnect'
    Builder_Language_Commands_MLOBJ = 'disconnect'
    window modify Builder_Language_Commands_MLOBJ
    return

//******************************
//* Open the Alignment Window
//******************************
!a400_Builder_Control_Align_PBOBJ
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ
    window pointer wait
    window hwnd Builder_Align_WIN status error window open Builder_Align_WIN shade
    window windowpos Builder_Control_Align_PBOBJ ObjectX ObjectY ObjectCX ObjectCY
    window windowpos Builder_Align_WIN WinX WinY WinCX WinCY
    WinX = ObjectX
    WinY = ObjectY
    window size Builder_Align_WIN @WinX @WinY @WinCX @WinCY
    window unshade Builder_Align_WIN
    window setfocus Builder_Align_WIN
    window pointer arrow
    return

//******************************
//* Copy the controls in the
//* GroupRectangle
//******************************
!a400_Builder_Control_Copy_PBOBJ
    window enable Builder_Control_Paste_PBOBJ
    close CopyControls error
    open CopyControls null
    close CopyPaintFile error
    open CopyPaintFile null


    close CopyGroupControls error
    open CopyGroupControls null
    file GroupControls
    clear
    b
    copy;*
    file CopyGroupControls
    paste

    file PaintFile error open PaintFile null
    b
    fs:/GroupRectangle,/
    if  (!eof)
+       CopyGroupRectangleLine = line
+   else
+       CopyGroupRectangleLine = null
+   endif

    file GroupControls error return
    b
    if  (eof) return
    do
        scan:/@line/:/,/
        ControlName = left
        HoldRight = right
        
        //***************************
        //* Copy the Control Object
        //***************************
        file Controls
        b
        SearchString = '@ControlName@,'
        fs:/@SearchString@/
        if (eof) goto !a400_Builder_Control_Copy_PaintFile
        scanr:/@ControlName@/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right = 'Boxround') or (right beginswith 'Rectangle')
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+           scan:/@line/:/,/
+           ControlName = left
+           scan:/@right/:/,/
+           ControlType = left
+           Text = right
+           file CopyControls
+           Newline = /@ControlType@,@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Text@/
+           i:/@Newline/
+       endif

!a400_Builder_Control_Copy_PaintFile
        //***************************
        //* Copy the PaintFile Object
        //***************************
        file PaintFile
        b

        SearchString = 'Builder_Control_WIN,@ControlName@,'
        fs:/@SearchString@/
        if (!eof)
+          copy
+          file CopyPaintFile
+          paste
+       endif
       
        file GroupControls
        f;1
        
    until (eof)
    return

//******************************
//* Paste the controls copied from the
//* GroupRectangle
//******************************
!a400_Builder_Control_Paste_PBOBJ

    close GroupControls error
    open GroupControls null
    file CopyGroupControls
    b
    clear
    copy;*
    file GroupControls
    paste
    //close CopyGroupControls

    //**************************
    //* Controls File Objects
    //**************************
    file CopyControls
    b
    do
        if (!eof)
+           call !a400_Builder_Control_Paste_Controls
+       endif
        file CopyControls
        f;1
    until (eof)

    //**************************
    //* PaintFile Objects
    //**************************
    file CopyPaintFile
    b
    do
        if (!eof)
+           call !a400_Builder_Control_Paste_PaintFile
+       endif
        file CopyPaintFile
        f;1
    until (eof)
    //**************************
    //* Setup GroupRectangle
    //**************************
    file PaintFile
    b
    fs:/GroupRectangle,/
    if  (!eof) d;1
    if  (CopyGroupRectangleLine != null) b i:/@CopyGroupRectangleLine/ ButtonFocus = 'GroupRectangle'
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect
    Builder_Language_Commands_MLOBJ = 'size window'
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_PBOBJ
    file PaintFile b window paint Builder_Control_WIN

    return

//******************************
//* Paste a Controls file Object
//******************************
!a400_Builder_Control_Paste_Controls
    //*****************************
    //* Split up the CopyControls line
    //*****************************
    scan:/@line/:/,/
    HoldType = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    ObjectY = left
    scan:/@right/:/,/
    ObjectCX = left
    scan:/@right/:/,/
    ObjectCY = left
    Text = right
    //*****************************
    //* Split up the ControlName
    //*****************************
    scan:/@HoldControlName/:/_/
    CopySystemName = left
    scan:/@right/:/_/
    CopyWindowName = left
    scan:/@right/:/_/
    CopyControlName = left
    CopyType = right

    NameNumber = 0
!a400_Builder_Control_Paste_Controls_loop
    if (NameNumber = 0)
+      NewControlName = '@SystemName@_@WindowName@_@CopyControlName@_@CopyType@'
+   else
+      NewControlName = '@SystemName@_@WindowName@_@CopyControlName@.@NameNumber@_@CopyType@'
+   endif
    NameNumber ++
    file Controls error open Controls null
    b
    fs:/@NewControlName@/
    if  (!eof) goto !a400_Builder_Control_Paste_Controls_loop
    Newline = '@NewControlName@,@HoldType@,@Text@'
    i:/@Newline/
    file GroupControls
    b
    SearchString = '@HoldControlName@,'
    fs:/@SearchString@/
    if  (!eof) 
+       scan:/@line/:/,/
+       Newline = '@NewControlName@,@right@'
+       r:/@Newline/
+   endif

    Builder_Control_ControlList_COOBJ = NewControlName
    if  (Builder_Control_ControlList_COOBJ != 'Connector')
+       call !a300_insert_controllist
+   endif

    window createcontrol Builder_Control_WIN @NewControlName @ObjectX @ObjectY @ObjectCX @ObjectCY @HoldType @Text
    return


//******************************
//* Paste a PaintFile Object
//******************************
!a400_Builder_Control_Paste_PaintFile
    //*****************************
    //* Split up the CopyPaintFile line
    //*****************************
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    HoldRight = right

    //*****************************
    //* Split up the ControlName
    //*****************************
    scan:/@HoldControlName/:/_/
    CopySystemName = left
    scan:/@right/:/_/
    CopyWindowName = left
    scan:/@right/:/_/
    CopyControlName = left
    CopyType = right

    NameNumber = 0
!a400_Builder_Control_Paste_PaintFile_loop
    if (NameNumber = 0)
+      NewControlName = '@SystemName@_@WindowName@_@CopyControlName@_@CopyType@'
+   else
+      NewControlName = '@SystemName@_@WindowName@_@CopyControlName@.@NameNumber@_@CopyType@'
+   endif

    NameNumber ++
    file PaintFile
    b
    SearchString = '@HoldWindowName@,@NewControlName@,'
    fs:/@SearchString/
    if  (!eof) goto !a400_Builder_Control_Paste_PaintFile_loop
    Newline = '@HoldWindowName@,@NewControlName@,@HoldRight@'
    i:/@Newline@/
    file GroupControls
    b
    SearchString = '@HoldControlName@,'
    fs:/@SearchString@/
    if  (!eof) 
+       scan:/@line/:/,/
+       Newline = '@NewControlName@,@right@'
+       r:/@Newline/
+   endif
    Builder_Control_ControlList_COOBJ = NewControlName
    if  (Builder_Control_ControlList_COOBJ = 'Connector') return
    call !a300_insert_controllist
    return

//******************************
//* Open the Color Selection window
//******************************
!a400_Builder_Control_Color_PBOBJ
    window close Builder_Stdcolors_WIN
    //message = '!a400_Builder_Control_Color_PBOBJ' window message info ok
    window pointer wait
    window hwnd Builder_Colors_WIN status error window open Builder_Colors_WIN shade
    window hide Builder_Control_WIN
    Red = KeepRed
    Green = KeepGreen
    Blue = KeepBlue

    window center Builder_Colors_WIN

    Builder_Colors_Red_EFOBJ = Red
    window modify Builder_Colors_Red_EFOBJ
    Builder_Colors_Green_EFOBJ = Green
    window modify Builder_Colors_Green_EFOBJ
    Builder_Colors_Blue_EFOBJ = Blue
    window modify Builder_Colors_Blue_EFOBJ

    call !c100_colors

    window unshade Builder_Colors_WIN
    window setfocus Builder_Colors_WIN
    window pointer arrow
    return

//******************************
//* Undo the last change
//******************************
!a400_Builder_Control_Undo_PBOBJ
    call !w200_restore_controls
    //window disable Builder_Control_Undo_PBOBJ
    Builder_Language_Commands_MLOBJ = 'size window'
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_call
    return

//******************************
//* Delete a Control
//******************************
!a400_Builder_Control_Delete_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ != null)
+       Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
+       window modify Builder_Control_Control_EFOBJ
+   else
+       window obtain Builder_Control_Control_EFOBJ
+   endif

    window exists @Builder_Control_Control_EFOBJ
    if  (!status)
+       message = 'Control doesn't exist'
+       //window message error ok
+       //return
+   endif

    if-1 (ButtonFocus = 'GroupRectangle')
+      message = 'Are you sure you want to delete all the controls in the group?'
+      window message question yesno
+      if-2  (!message)
+          return
+      else-2
+          goto !a400_Builder_Control_Delete_group
+   endif
    message = 'Are you sure you want to delete @Builder_Control_Control_EFOBJ@?'
    window message question yesno
    if (!message)
+      return
+   endif
    goto !a400_Builder_Control_Delete_control

!a400_Builder_Control_Delete_group
    file GroupControls
    b
    if (eof)
+      call !a050_Escape_2
+      goto !a400_Builder_Control_Delete_done
+   endif
    scan:/@line/:/,/
    Builder_Control_Control_EFOBJ = left
    d;1

!a400_Builder_Control_Delete_control
    //*********************************
    //* Delete control
    //*********************************
    window deletecontrol @Builder_Control_Control_EFOBJ error

    //*********************************
    //* Delete from Controls
    //*********************************
    file Controls error open Controls null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ)
+              d;1
+              f;*
+       endif
        f;1          
    until (eof)

    //*********************************
    //* Delete from PaintFile
    //*********************************
    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if  (left = Builder_Control_Control_EFOBJ)
+                  d;1
+                  f;*
+       endif
        f;1          
    until (eof)

    //*********************************
    //* Delete PaintFile Text
    //*********************************
    scanr:/@Builder_Control_Control_EFOBJ/:/_/
    SearchString = "Builder_Control_WIN,@left@.Text_Text/
    b
    fs:/@SearchString/
    if  (!eof)
+       d;1
+   endif

    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN

    if (ButtonFocus = 'GroupRectangle')
+      goto !a400_Builder_Control_Delete_group
+   endif

!a400_Builder_Control_Delete_done
    //*****************************
    //* Reload the Controls COOBJ
    //*****************************
    Builder_Control_ControlList_COOBJ = "ALL"
    window delete Builder_Control_ControlList_COOBJ
    file Controls
    b
    do
+       if (!eof)
+           scan:/@line/:/,/
+           Builder_Control_ControlList_COOBJ = left
+           call !a300_insert_controllist
+           f;1
+       endif
    until (eof)
    file PaintFile
    b
    do
+       if (!eof)
+           scan:/@line/:/,/
+           if  (left = 'Builder_Control_WIN')
+               scan:/@right/:/,/
+               Builder_Control_ControlList_COOBJ = left
+               if  (Builder_Control_ControlList_COOBJ != 'Connector')
+                   call !a300_insert_controllist
+       endif
        f;1
    until (eof)
    return

//******************************
//* Set Button Actions
//******************************
!a400_Builder_Control_Buttonaction_PBOBJ
    call !n100_navigation
    return

//******************************
//* Set Entry Field Actions
//******************************
!a400_Builder_Control_Entryaction_PBOBJ
    window pointer wait
    window hwnd Builder_Entryaction_WIN status error window open Builder_Entryaction_WIN shade
    window center Builder_Entryaction_WIN
    window clear Builder_Entryaction_WIN

    Builder_Entryaction_Fieldname_STTXT = Builder_Control_Control_EFOBJ
    window modify Builder_Entryaction_Fieldname_STTXT 
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (eof) goto !a400_entryaction_done

    scan:/@line/:/,/
    scan:/@right/:/,/
    EntryFieldAction = left
    Builder_Entryaction_Size_EFOBJ = right
    scan:/@EntryFieldAction@/:/-P/
    if (found)
+      EntryFieldAction = left
+      Builder_Entryaction_Password_CBOBJ = 'Y'
+   else
+      Builder_Entryaction_Password_CBOBJ = 'N'
+   endif
    window modify Builder_Entryaction_Password_CBOBJ
    
    window modify Builder_Entryaction_Size_EFOBJ
    if (EntryFieldAction = 'alpha') Builder_Entryaction_Alpha_RBOBJ = 'Y' window modify Builder_Entryaction_Alpha_RBOBJ window setfocus Builder_Entryaction_Alpha_RBOBJ
    if (EntryFieldAction = 'numeric') Builder_Entryaction_Numeric_RBOBJ = 'Y' window modify Builder_Entryaction_Numeric_RBOBJ window setfocus Builder_Entryaction_Numeric_RBOBJ
    if (EntryFieldAction = 'upper') Builder_Entryaction_Uppercase_RBOBJ = 'Y' window modify Builder_Entryaction_Uppercase_RBOBJ window setfocus Builder_Entryaction_Uppercase_RBOBJ
    if (EntryFieldAction = 'lower') Builder_Entryaction_Lowercase_RBOBJ = 'Y' window modify Builder_Entryaction_Lowercase_RBOBJ window setfocus Builder_Entryaction_Lowercase_RBOBJ
    if (EntryFieldAction = 'mix') Builder_Entryaction_Mixedcase_RBOBJ = 'Y' window modify Builder_Entryaction_Mixedcase_RBOBJ window setfocus Builder_Entryaction_Mixedcase_RBOBJ
    if (EntryFieldAction = 'date') Builder_Entryaction_Date_RBOBJ = 'Y' window modify Builder_Entryaction_Date_RBOBJ window setfocus Builder_Entryaction_Date_RBOBJ
    if (EntryFieldAction = 'dollar') Builder_Entryaction_Dollar_RBOBJ = 'Y' window modify Builder_Entryaction_Dollar_RBOBJ window setfocus Builder_Entryaction_Dollar_RBOBJ
    if (EntryFieldAction = 'telephone') Builder_Entryaction_Phone_RBOBJ = 'Y' window modify Builder_Entryaction_Phone_RBOBJ window setfocus Builder_Entryaction_Phone_RBOBJ
    if (EntryFieldAction = 'text') Builder_Entryaction_Text_RBOBJ = 'Y' window modify Builder_Entryaction_Text_RBOBJ window setfocus Builder_Entryaction_Text_RBOBJ
 
!a400_entryaction_done
    window unshade Builder_Entryaction_WIN
    window setfocus Builder_Entryaction_WIN
    window pointer arrow
    return

//******************************
//* Move object in front of other objects
//******************************
!a400_Builder_Control_Front_PBOBJ
    if  (ButtonFocus = null) return
    SearchString = 'Builder_Control_WIN,@ButtonFocus@,'
    file PaintFile
    b
    fs:/@SearchString/
    if (eof) return
    Newline = line
    d;1
    f;*
    direction up
    fs:/Builder_Control_WIN/
    direction down
    i:/@Newline/

    //*************************
    //* Object Text
    //*************************
    scanr:/@ButtonFocus/:/_/
    SearchString = 'Builder_Control_WIN,@left@.Text_Text'
    b
    fs:/@SearchString/
    if  (!eof)
+       Newline = line
+       d;1
+       b
+       SearchString = 'Builder_Control_WIN,@ButtonFocus@,'
+       fs:/@SearchString/
+       i:/@Newline/
+   endif

    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    return

//******************************
//* Move object behind other objects
//******************************
!a400_Builder_Control_Back_PBOBJ
    if  (ButtonFocus = null) return
    SearchString = 'Builder_Control_WIN,@ButtonFocus@,'
    file PaintFile
    b
    fs:/@SearchString/
    if (eof) return
    Newline = line
    d;1
    b;*
    fs:/Builder_Control_WIN/
    if (eof)
+       i:/@Newline/
+   else
+       ib:/@Newline/
+   endif

    //*************************
    //* Object Text
    //*************************
    scanr:/@ButtonFocus/:/_/
    SearchString = 'Builder_Control_WIN,@left@.Text_Text'
    b
    fs:/@SearchString/
    if  (!eof)
+       Newline = line
+       d;1
+       b
+       SearchString = 'Builder_Control_WIN,@ButtonFocus@,'
+       fs:/@SearchString/
+       i:/@Newline/
+   endif

    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    return

//******************************
//* Make a copy of a control
//******************************
!a400_Builder_Control_Duplicate_PBOBJ
    SpecialControlType = null
    NameNumber = 1
    window obtain Builder_Control_WIN
    if  (ButtonFocus = null) return
    Builder_Control_Control_EFOBJ = ButtonFocus
!a400_Builder_Control_Duplicate_PBOBJ_loop
    scan:/@Builder_Control_Control_EFOBJ@/:/_/
    HoldSystemName = left
    scan:/@right/:/_/
    HoldWindowName = left
    scan:/@right/:/_/
    HoldControlName = left
    HoldType = right
    scan:/@HoldControlName/:/./
    if  (found)
+       HoldControlName = left
+       TempWork = right
+       NameNumber = TempWork + 1
+   endif

    Builder_Control_Control_EFOBJ = '@HoldSystemName@_@HoldWindowName@_@HoldControlName@.@NameNumber@_@HoldType@'  

    file Controls error open Controls null
    b
    fs:/@Builder_Control_Control_EFOBJ/
    if (!eof) goto !a400_Builder_Control_Duplicate_PBOBJ_loop
    SearchString = ',@Builder_Control_Control_EFOBJ@,'
    file PaintFile
    b
    fs:/@SearchString/
    if  (!eof) goto !a400_Builder_Control_Duplicate_PBOBJ_loop
    window modify Builder_Control_Control_EFOBJ
    HoldFocus = Builder_Control_Control_EFOBJ
    KeepSizePos = 'y'
    Duplicating = 'y'

    Builder_Control_ControlType_COOBJ = HoldType

    Builder_Control_Button_RBOBJ = 'N'
    Builder_Control_Entry_RBOBJ = 'N'
    Builder_Control_Text_RBOBJ = 'N'
    Builder_Control_Check_RBOBJ = 'N'
    Builder_Control_List_RBOBJ = 'N'
    Builder_Control_Group_RBOBJ = 'N'
    Builder_Control_Radio_RBOBJ = 'N'
    Builder_Control_MLE_RBOBJ = 'N'
    Builder_Control_Combo_RBOBJ = 'N'
    Builder_Control_Drop_RBOBJ = 'N'
    Builder_Control_Rectangle_RBOBJ = 'N'
    Builder_Control_Box_RBOBJ = 'N'
    Builder_Control_Boxcolor_RBOBJ = 'N'
    Builder_Control_Box3D_RBOBJ = 'N'
    Builder_Control_Ellipse_RBOBJ = 'N'
    Builder_Control_Ellipse3D_RBOBJ = 'N'
    Builder_Control_Circle_RBOBJ = 'N'
    Builder_Control_Diamond_RBOBJ = 'N'
    Builder_Control_Line_RBOBJ = 'N'
    Builder_Control_Arrow_RBOBJ = 'N'
    Builder_Control_Textfont_RBOBJ = 'N'
    Builder_Control_TextTilt_RBOBJ = 'N'
    Builder_Control_Bitmap_RBOBJ = 'N'
    Builder_Control_Bitmapfit_RBOBJ = 'N'
    Builder_Control_Rectanglecolor_RBOBJ = 'N'
    Builder_Control_Triangle_RBOBJ = 'N'

    if  (Builder_Control_ControlType_COOBJ = 'Box Color') or (Builder_Control_ControlType_COOBJ = 'Boxcolor') Builder_Control_Boxcolor_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Box Round')  or (Builder_Control_ControlType_COOBJ = 'Boxround') Builder_Control_Boxround_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Box-3D') or (Builder_Control_ControlType_COOBJ = 'Box3D') Builder_Control_Box3D_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Ellipse') Builder_Control_Ellipse_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Ellipse-3D') or (Builder_Control_ControlType_COOBJ = 'Ellipse3D') Builder_Control_Ellipse3D_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Circle') Builder_Control_Circle_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Diamond') Builder_Control_Diamond_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Line') Builder_Control_Line_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ beginswith 'Arrow') Builder_Control_Arrow_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Text Font') or (Builder_Control_ControlType_COOBJ = 'Text') Builder_Control_Textfont_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Text Tilt') or (Builder_Control_ControlType_COOBJ = 'Texttilt') Builder_Control_TextTilt_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Bitmap') Builder_Control_Bitmap_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ = 'Bitmap Fit') or (Builder_Control_ControlType_COOBJ = 'Bitmapfit') Builder_Control_Bitmapfit_RBOBJ = 'Y'
    if  (Builder_Control_ControlType_COOBJ beginswith 'Triangle') Builder_Control_Triangle_RBOBJ = 'Y' SpecialControlType = Builder_Control_ControlType_COOBJ
    if  (Builder_Control_ControlType_COOBJ = 'Rectangle Color') or (Builder_Control_ControlType_COOBJ = 'Rectanglecolor') Builder_Control_Rectanglecolor_RBOBJ = 'Y'

    call !a400_Builder_Control_Create_PBOBJ
    ButtonFocus = HoldFocus
    file PaintFile error open PaintFile null
    b
    window paint Builder_Control_WIN
    return

//******************************
//* Open the Langage Interface Window
//******************************
//!a400_Builder_Control_Language_PBOBJ
//    window pointer wait
//    window hwnd Builder_Language_WIN status error window open Builder_Language_WIN shade
//    window clear Builder_Language_WIN
//    window show Builder_Language_WIN
//    window setfocus Builder_Language_WIN
//    window paint Builder_Language_WIN
//    window pointer arrow
//    return

//******************************
//* Size the Builder Window Frame
//******************************
!a400_Builder_Control_WinSize_PBOBJ
    if  (SizingWindow)
+       SizingWindow = 'n'
+       window enable Builder_Control_Focus_PBOBJ
+       window enable Builder_Control_Delete_PBOBJ
+       HoldAction = Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = "Win"
+       window modify Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = HoldAction
+       call !a400_Builder_Control_Focus_PBOBJ
+       window obtain Builder_Control_Control_EFOBJ
+       pack Builder_Control_Control_EFOBJ
+       ButtonFocus = Builder_Control_Control_EFOBJ      
+       return
+   else
+       SizingWindow = 'y'
+       window disable Builder_Control_Focus_PBOBJ
+       window disable Builder_Control_Delete_PBOBJ
+       HoldAction = Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = "Ctrl"
+       window modify Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = HoldAction
+       window show Builder_Control_Height_STTXT Builder_Control_Height_STTXT = 'Height' window modify Builder_Control_Height_STTXT
+       window show Builder_Control_Height_EFOBJ
+       window show Builder_Control_Length_STTXT Builder_Control_Length_STTXT = 'Length' window modify Builder_Control_Length_STTXT
+       window show Builder_Control_Length_EFOBJ
+       window show Builder_Control_X_STTXT Builder_Control_X_STTXT = 'X-Pos' window modify Builder_Control_X_STTXT
+       window show Builder_Control_X_EFOBJ
+       window show Builder_Control_Y_STTXT Builder_Control_Y_STTXT = 'Y-Pos' window modify Builder_Control_Y_STTXT
+       window show Builder_Control_Y_EFOBJ
+       window show Builder_Control_SizeXMinus_PBOBJ
+       window show Builder_Control_SizeXPlus_PBOBJ
+       window show Builder_Control_SizeYMinus_PBOBJ
+       window show Builder_Control_SizeYPlus_PBOBJ
+       window hide Builder_Control_Swap_PBOBJ
+   endif
    
    window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY

    ButtonFocus = "Builder_Control_WindowSize_GBOBJ"

    window windowpos Builder_Control_WindowSize_GBOBJ ObjectX ObjectY ObjectCX ObjectCY

    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    if (ObjectX < 1) ObjectX = 1
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    if (ObjectY < 1) ObjectY = 1
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ
        
    return

//******************************
//* Set the Focus
//******************************
!a400_Builder_Control_Focus_PBOBJ
    if  (ButtonFocus != 'GroupRectangle') goto !a400_Builder_Control_Focus_PBOBJ_not_focus
    file GroupControls error goto !a400_Builder_Control_Focus_PBOBJ_not_focus
    Lastline = null
!a400_Builder_Control_Focus_loop
    if  (line = Lastline)
+       goto !a400_Builder_Control_Focus_group
+   endif
    scan:/@line/:/.Text_Text/
    if  (found)
+       Lastline = line
+       b;1
+       goto !a400_Builder_Control_Focus_loop
+   endif

!a400_Builder_Control_Focus_group
    if  (ButtonFocus = 'GroupRectangle')
+       file GroupControls error goto !a400_Builder_Control_Focus_PBOBJ_not_focus
+       scan:/@line/:/,/
+       Builder_Control_ControlList_COOBJ = left
+       call !a050_Escape_2
+       ButtonFocus = Builder_Control_ControlList_COOBJ
+       goto !a400_Builder_Control_Focus_PBOBJ_2
+   endif
!a400_Builder_Control_Focus_PBOBJ_not_focus
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
!a400_Builder_Control_Focus_PBOBJ_2
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ = null) return

    scanr:/@Builder_Control_ControlList_COOBJ/:/_/
    //**********************************
    //* Setup the field labels (text)
    //**********************************
    window show Builder_Control_Height_STTXT
    window show Builder_Control_Height_EFOBJ
    window show Builder_Control_Length_STTXT
    window show Builder_Control_Length_EFOBJ
    if-1  (right = 'Text') or (right = 'TextTilt')
+       Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+       if-2  (right = 'Text')
+           window hide Builder_Control_SizeXPlus_PBOBJ
+           window hide Builder_Control_SizeXMinus_PBOBJ
+           window hide Builder_Control_Height_STTXT
+           window hide Builder_Control_Height_EFOBJ
+           Builder_Control_Size_RBOBJ = 'Size' window modify Builder_Control_Size_RBOBJ
+           Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+       else-2
+           window show Builder_Control_SizeXPlus_PBOBJ
+           window show Builder_Control_SizeXMinus_PBOBJ
+           window show Builder_Control_Height_STTXT
+           Builder_Control_Height_STTXT = 'Angle' window modify Builder_Control_Height_STTXT
+           Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+           window show Builder_Control_Height_EFOBJ
+           Builder_Control_Size_RBOBJ = 'Text' window modify Builder_Control_Size_RBOBJ
+   else-1
+       window hide Builder_Control_Fonts_COOBJ
+       window hide Builder_Control_Font_STTXT
+       window hide Builder_Control_Font_PBOBJ
+       window show Builder_Control_SizeXPlus_PBOBJ
+       window show Builder_Control_SizeXMinus_PBOBJ
+       window show Builder_Control_Height_STTXT
+       window show Builder_Control_Height_EFOBJ
+       Builder_Control_Height_STTXT = 'Height' window modify Builder_Control_Height_STTXT
+       Builder_Control_Length_STTXT = 'Length' window modify Builder_Control_Length_STTXT
+       window show Builder_Control_Size_RBOBJ
+       Builder_Control_Size_RBOBJ = 'Size' window modify Builder_Control_Size_RBOBJ
+       if-3 (right = 'Bitmap')
+           window hide Builder_Control_Height_STTXT
+           window hide Builder_Control_Height_EFOBJ
+           window hide Builder_Control_Length_STTXT
+           window hide Builder_Control_Length_EFOBJ
+   endif
    window obtain Builder_Control_Pos_RBOBJ
    if  (Builder_Control_Pos_RBOBJ)
+       if  (right = 'Text') or (right = 'TextTilt')
+           window show Builder_Control_SizeXPlus_PBOBJ
+           window show Builder_Control_SizeXMinus_PBOBJ 
+   endif

    window exists @Builder_Control_ControlList_COOBJ
    if (!status) 
+      goto !a400_Builder_Control_Focus_PaintFile
+   endif

    window disable Builder_Control_Color_PBOBJ

    FocusSet = 'y'
    Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
    window modify Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_ControlList_COOBJ

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ

!a400_Builder_Control_Focus_Controls_set
    file Controls error goto !a400_Builder_Control_Focus_fixcontrols
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ) 
+              scanr:/@line/:/,/
+              Builder_Control_ControlText_EFOBJ = right
+              window modify Builder_Control_ControlText_EFOBJ
+              call !a400_set_control_radio
+              f;*
+       endif  
        f;1        
    until (eof)
    goto !a400_Builder_Control_Focus_fixcontrols

!a400_Builder_Control_Focus_PaintFile
    file PaintFile
    b
    do
        scan:/@line/:/,/
        if-1  (left = 'Builder_Control_WIN')
+           scan:/@right/:/,/
+           if-2  (left = Builder_Control_ControlList_COOBJ)
+               scan:/@right/:/,/
+               scan:/@right/:/,/
+               ObjectX = left
+               scan:/@right/:/,/
+               ObjectY = left
+               scan:/@right/:/,/
+               ObjectCX = left
+               scan:/@right/:/,/
+               ObjectCY = left
+               scan:/@right/:/,/
+               Red = left
+               scan:/@right/:/,/
+               Green = left
+               scan:/@right/:/,/
+               Blue = left
+               call !a400_Builder_Control_Focus_PaintFile_rest
+               FocusSet = 'y'
+               Builder_Control_ControlText_EFOBJ = Text
+               call !a400_set_control_radio_paintfile
+               window modify Builder_Control_ControlText_EFOBJ
+               Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
+               window modify Builder_Control_Control_EFOBJ
+               ButtonFocus = Builder_Control_ControlList_COOBJ
+               Builder_Control_Length_EFOBJ = ObjectCX
+               window modify Builder_Control_Length_EFOBJ
+               Builder_Control_Height_EFOBJ = ObjectCY
+               window modify Builder_Control_Height_EFOBJ
+               ObjectX = ObjectX - MinX
+               Builder_Control_X_EFOBJ = ObjectX
+               window modify Builder_Control_X_EFOBJ
+               ObjectY = ObjectY - MinY
+               Builder_Control_Y_EFOBJ = ObjectY
+               window modify Builder_Control_Y_EFOBJ
+               window enable Builder_Control_Color_PBOBJ
+               scanr:/@Builder_Control_ControlList_COOBJ/:/_/
+               if-3  (right = 'Line') or (right beginswith 'Arrow')
+                   call !a400_Builder_Control_Focus_linearrow
+                   goto !a400_Builder_Control_Focus_fixcontrols
+               else-3
+                   goto !a400_Builder_Control_Focus_fixcontrols
+       endif
        f;1
    until (eof)
    return

!a400_Builder_Control_Focus_linearrow
    if  (right = 'Line')
+       ObjectCX = ObjectCX - MinX
+       Builder_Control_Length_EFOBJ = ObjectCX
+       window modify Builder_Control_Length_EFOBJ
+       ObjectCY = ObjectCY - MinY
+       Builder_Control_Height_EFOBJ = ObjectCY
+       window modify Builder_Control_Height_EFOBJ
+       return
+   endif
    if  (right beginswith 'Arrow')
+       split:/@right/;5
+       TempWork = right
+       if  (TempWork < 5)
+           ObjectCX = ObjectCX - MinX
+           Builder_Control_Length_EFOBJ = ObjectCX
+           window modify Builder_Control_Length_EFOBJ
+           ObjectCY = ObjectCY - MinY
+           Builder_Control_Height_EFOBJ = ObjectCY
+           window modify Builder_Control_Height_EFOBJ
+           return
+   endif
    return

//****************************************
//* Get and Update the Font and Text
//****************************************
!a400_Builder_Control_Focus_PaintFile_rest
    HoldRight = right
    scanr:/@Builder_Control_ControlList_COOBJ/:/_/
    if (right = 'Bitmap')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      CurrFile = left
+      window show Builder_Control_Bitmap_PBOBJ
+      window show Builder_Control_Bitmap_EFOBJ
+      DynamicX = MainCX - 700
+      DynamicY = MainCY - 65
+      DynamicY = 52
+      MacroCommand = 'window size Builder_Control_Bitmap_PBOBJ @DynamicX@ @DynamicY@ 70 20' $MacroCommand
+      DynamicX = DynamicX + 75
+      MacroCommand = 'window size Builder_Control_Bitmap_EFOBJ @DynamicX@ @DynamicY@ 600 20' $MacroCommand
+      Builder_Control_Bitmap_EFOBJ = CurrFile
+      window modify Builder_Control_Bitmap_EFOBJ
+      Text = null
+      return
+   endif
    if (right = 'BitmapFit')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      ObjectCX = left
+      scan:/@right/:/,/
+      ObjectCY = left
+      scan:/@right/:/,/
+      CurrFile = left
+      window show Builder_Control_Bitmap_PBOBJ
+      window show Builder_Control_Bitmap_EFOBJ
+      DynamicX = MainCX - 700
+      DynamicY = MainCY - 65
+      DynamicY = 52
+      MacroCommand = 'window size Builder_Control_Bitmap_PBOBJ @DynamicX@ @DynamicY@ 70 20' $MacroCommand
+      DynamicX = DynamicX + 75
+      MacroCommand = 'window size Builder_Control_Bitmap_EFOBJ @DynamicX@ @DynamicY@ 600 20' $MacroCommand
+      Builder_Control_Bitmap_EFOBJ = CurrFile
+      window modify Builder_Control_Bitmap_EFOBJ
+      Text = null
+      return
+   endif

    window hide Builder_Control_Bitmap_PBOBJ
    window hide Builder_Control_Bitmap_EFOBJ

    if (right = 'Text') or (right = 'TextTilt')
+      scan:/@HoldRight/:/,/
+      CurrFont = left
+      Text = right
+      call !a400_Builder_Control_Create_loadfonts
+       window show Builder_Control_Font_STTXT
+       window show Builder_Control_Font_PBOBJ
+       Builder_Control_Font_STTXT = CurrFont
+       window modify Builder_Control_Font_STTXT
+       window show Builder_Control_Fonts_COOBJ
+       DynamicX = MainCX - 400
+       DynamicY = MainCY - 65
+       DynamicY = 52
+       MacroCommand = 'window size Builder_Control_Font_PBOBJ @DynamicX@ @DynamicY@ 35 20' $MacroCommand
+       DynamicX = DynamicX + 40
+       MacroCommand = 'window size Builder_Control_Fonts_COOBJ @DynamicX@ @DynamicY@ 150 650' $MacroCommand
+       DynamicX = DynamicX + 155
+       MacroCommand = 'window size Builder_Control_Font_STTXT @DynamicX@ @DynamicY@ 150 20' $MacroCommand
+   else
+       window hide Builder_Control_Font_STTXT
+       window hide Builder_Control_Font_PBOBJ
+       window hide Builder_Control_Fonts_COOBJ
+       Text = null
+   endif

    return

!a400_Builder_Control_Focus_fixcontrols
    //*****************************
    //* Get the text data
    //*****************************
    scanr:/@Builder_Control_ControlList_COOBJ/:/_/
    SearchString = 'Builder_Control_WIN,@left@.Text_Text'
    //message = SearchString window message info ok
    file PaintFile error open PaintFile null
    b
    fs:/@SearchString/
    if  (!eof)
+       SearchString = '@left@.Text_Text'
+       scan:/@line/:/,/
+       scan:/@right/:/,/ TextName = left
+       scan:/@right/:/,/
+       scan:/@right/:/,/ TextX = left
+       scan:/@right/:/,/ TextY = left
+       scan:/@right/:/,/ TextCX = left
+       scan:/@right/:/,/ TextCY = left
+       scan:/@right/:/,/ TextRed = left
+       scan:/@right/:/,/ TextGreen = left
+       scan:/@right/:/,/ TextBlue = left
+       scan:/@right/:/,/ TextFont = left
+       TextText = right
+       Builder_Control_ControlText_EFOBJ = TextText
+       window modify Builder_Control_ControlText_EFOBJ
+   else
+       TextName = null
+       TextText = null
+   endif
    //*****************************
    //* Fix the control data
    //*****************************
    scanr:/@Builder_Control_ControlList_COOBJ/:/_/
    if  (right = 'Line')
+       Builder_Control_Height_STTXT = 'CY-Pos' window modify Builder_Control_Height_STTXT
+       Builder_Control_Length_STTXT = 'CX-Pos' window modify Builder_Control_Length_STTXT
+       window show Builder_Control_Swap_PBOBJ
+   else
+       //Builder_Control_Height_STTXT = 'Height' window modify Builder_Control_Height_STTXT
+       //Builder_Control_Length_STTXT = 'Length' window modify Builder_Control_Length_STTXT
+       window hide Builder_Control_Swap_PBOBJ
+   endif

    if-1  (right beginswith 'Arrow')
+       split:/@right/;5
+       TempWork = right
+       if-2  (TempWork < 5)
+           Builder_Control_Height_STTXT = 'CY-Pos' window modify Builder_Control_Height_STTXT
+           Builder_Control_Length_STTXT = 'CX-Pos' window modify Builder_Control_Length_STTXT
+           window show Builder_Control_Swap_PBOBJ
+           scanr:/@Builder_Control_ControlList_COOBJ/:/_/
+       else-2
+           scanr:/@Builder_Control_ControlList_COOBJ/:/_/
+   endif

    if-1  (right = 'Bitmap') or (right = 'BitmapFit')
+       window disable Builder_Control_Color_PBOBJ
+       if-2  (right = 'Bitmap')
+           //Builder_Control_Size_RBOBJ = 'N'
+           //window modify Builder_Control_Size_RBOBJ
+           //Builder_Control_Pos_RBOBJ = 'Y'
+           //window modify Builder_Control_Pos_RBOBJ
+           window hide Builder_Control_Size_RBOBJ
+           window hide Builder_Control_Height_STTXT
+           window hide Builder_Control_Height_EFOBJ
+           window hide Builder_Control_Length_STTXT
+           window hide Builder_Control_Length_EFOBJ
+       else-2
+           window show Builder_Control_Size_RBOBJ
+           window show Builder_Control_Height_STTXT
+           window show Builder_Control_Height_EFOBJ
+           window show Builder_Control_Length_STTXT
+           window show Builder_Control_Length_EFOBJ
+           //Builder_Control_Size_RBOBJ = 'N'
+           //window modify Builder_Control_Size_RBOBJ
+           //Builder_Control_Pos_RBOBJ = 'Y'
+           //window modify Builder_Control_Pos_RBOBJ
+   else-1
+       window show Builder_Control_Color_PBOBJ
+       window enable Builder_Control_Color_PBOBJ
+   endif
    return

//******************************
//* Set the radio buttons
//******************************
!a400_set_control_radio
    Builder_Control_Boxcolor_RBOBJ = 'N' window modify Builder_Control_Boxcolor_RBOBJ
    Builder_Control_Box3D_RBOBJ = 'N' window modify Builder_Control_Box3D_RBOBJ
    Builder_Control_Ellipse_RBOBJ = 'N' window modify Builder_Control_Ellipse_RBOBJ
    Builder_Control_Ellipse3D_RBOBJ = 'N' window modify Builder_Control_Ellipse3D_RBOBJ
    Builder_Control_Circle_RBOBJ = 'N' window modify Builder_Control_Circle_RBOBJ
    Builder_Control_Diamond_RBOBJ = 'N' window modify Builder_Control_Diamond_RBOBJ
    Builder_Control_Line_RBOBJ = 'N' window modify Builder_Control_Line_RBOBJ
    Builder_Control_Arrow_RBOBJ = 'N' window modify Builder_Control_Arrow_RBOBJ
    Builder_Control_Textfont_RBOBJ = 'N' window modify Builder_Control_Textfont_RBOBJ
    Builder_Control_TextTilt_RBOBJ = 'N' window modify Builder_Control_TextTilt_RBOBJ
    Builder_Control_Bitmap_RBOBJ = 'N' window modify Builder_Control_Bitmap_RBOBJ
    Builder_Control_Bitmapfit_RBOBJ = 'N' window modify Builder_Control_Bitmapfit_RBOBJ
    Builder_Control_Diamond_RBOBJ = 'N' window modify Builder_Control_Diamond_RBOBJ
    Builder_Control_Boxround_RBOBJ = 'N' window modify Builder_Control_Boxround_RBOBJ
    Builder_Control_Rectanglecolor_RBOBJ = 'N' window modify Builder_Control_Rectanglecolor_RBOBJ

    scan:/@line/:/,/ 
    scan:/@right/:/,/ 
    //**************************
    //* Push Button
    //**************************
    if  (left = 'PBOBJ1') 
+       Builder_Control_Button_RBOBJ = 'Y'
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Button_RBOBJ = 'N'
+       window disable Builder_Control_Buttonaction_PBOBJ
+   endif
    window modify Builder_Control_Button_RBOBJ

    //**************************
    //* Entry Field
    //**************************
    if  (left = 'EFOBJL') 
+       Builder_Control_Entry_RBOBJ = 'Y' 
+       window enable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Entry_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Entry_RBOBJ

    //**************************
    //* Text
    //**************************
    if  (left = 'STTXT1') 
+       Builder_Control_Text_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Text_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Text_RBOBJ

    //**************************
    //* Check Box
    //**************************
    if  (left = 'CBOBJ1') 
+       Builder_Control_Check_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Check_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Check_RBOBJ

    //**************************
    //* List Box
    //**************************
    if  (left = 'LBOBJ1') 
+       Builder_Control_List_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_List_RBOBJ = 'N'
+   endif
    window modify Builder_Control_List_RBOBJ

    //**************************
    //* Group
    //**************************
    if  (left = 'GBOBJ1') 
+       Builder_Control_Group_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Group_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Group_RBOBJ

    //**************************
    //* Radio Button
    //**************************
    if  (left = 'RBOBJ1') 
+       Builder_Control_Radio_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Radio_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Radio_RBOBJ

    //**************************
    //* Multi-line Entry
    //**************************
    if  (left = 'MLOBJ1') 
+       Builder_Control_MLE_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_MLE_RBOBJ = 'N'
+   endif
    window modify Builder_Control_MLE_RBOBJ

    //**************************
    //* Combo Box
    //**************************
    if  (left = 'COOBJS') 
+       Builder_Control_Combo_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Combo_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Combo_RBOBJ

    //**************************
    //* Dropdown
    //**************************
    if  (left = 'COOBJL') 
+       Builder_Control_Drop_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Drop_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Drop_RBOBJ

    //**************************
    //* Rectangle
    //**************************
    if  (left = 'STTXTF') 
+       Builder_Control_Rectangle_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Rectangle_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Rectangle_RBOBJ

    //**************************
    //* Box
    //**************************
    if  (left = 'STTXTR') 
+       Builder_Control_Box_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Box_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Box_RBOBJ
    return

!a400_set_control_radio_paintfile
    
    Builder_Control_Button_RBOBJ = 'N' window modify Builder_Control_Button_RBOBJ 
    Builder_Control_Entry_RBOBJ = 'N' window modify Builder_Control_Entry_RBOBJ 
    Builder_Control_Text_RBOBJ = 'N' window modify Builder_Control_Text_RBOBJ 
    Builder_Control_Check_RBOBJ = 'N' window modify Builder_Control_Check_RBOBJ 
    Builder_Control_List_RBOBJ = 'N' window modify Builder_Control_List_RBOBJ 
    Builder_Control_Group_RBOBJ = 'N' window modify Builder_Control_Group_RBOBJ 
    Builder_Control_Radio_RBOBJ = 'N' window modify Builder_Control_Radio_RBOBJ 
    Builder_Control_MLE_RBOBJ = 'N' window modify Builder_Control_MLE_RBOBJ 
    Builder_Control_Combo_RBOBJ = 'N' window modify Builder_Control_Combo_RBOBJ 
    Builder_Control_Drop_RBOBJ = 'N' window modify Builder_Control_Drop_RBOBJ 
    Builder_Control_Rectangle_RBOBJ = 'N' window modify Builder_Control_Rectangle_RBOBJ 
    Builder_Control_Box_RBOBJ = 'N' window modify Builder_Control_Box_RBOBJ 

    file PaintFile
    scan:/@line/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/

    //**************************
    //* Box
    //**************************
    if  (left = 'Box') 
+       Builder_Control_Boxcolor_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Boxcolor_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Boxcolor_RBOBJ

    //**************************
    //* Box3D
    //**************************
    if  (left = 'Box3D') 
+       Builder_Control_Box3D_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Box3D_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Box3D_RBOBJ

    //**************************
    //* Ellipse
    //**************************
    if  (left = 'Ellipse') 
+       Builder_Control_Ellipse_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Ellipse_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Ellipse_RBOBJ

    //**************************
    //* Ellipse3D
    //**************************
    if  (left = 'Ellipse3D') 
+       Builder_Control_Ellipse3D_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Ellipse3D_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Ellipse3D_RBOBJ

    //**************************
    //* Circle
    //**************************
    if  (left = 'Circle') 
+       Builder_Control_Circle_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Circle_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Circle_RBOBJ

    //**************************
    //* Diamond
    //**************************
    if  (left = 'Diamond') 
+       Builder_Control_Diamond_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Diamond_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Diamond_RBOBJ

    //**************************
    //* Line
    //**************************
    if  (left = 'Line') 
+       Builder_Control_Line_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Line_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Line_RBOBJ

    //**************************
    //* Arrow
    //**************************
    if  (left beginswith 'Arrow') 
+       Builder_Control_Arrow_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Arrow_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Arrow_RBOBJ

    //**************************
    //* Textfont
    //**************************
    if  (left = 'Text') 
+       Builder_Control_Textfont_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Textfont_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Textfont_RBOBJ

    //**************************
    //* TextTilt
    //**************************
    if  (left = 'TextTilt') 
+       Builder_Control_TextTilt_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window disable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_TextTilt_RBOBJ = 'N'
+   endif
    window modify Builder_Control_TextTilt_RBOBJ

    //**************************
    //* Bitmap
    //**************************
    if  (left = 'Bitmap') 
+       Builder_Control_Bitmap_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window disable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Bitmap_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Bitmap_RBOBJ

    //**************************
    //* BitmapFit
    //**************************
    if  (left = 'BitmapFit') 
+       Builder_Control_Bitmapfit_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Bitmapfit_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Bitmapfit_RBOBJ

    //**************************
    //* Boxround
    //**************************
    if  (left = 'Boxround') 
+       Builder_Control_Boxround_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Boxround_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Boxround_RBOBJ
    //**************************
    //* Rectanglecolor
    //**************************
    if  (left = 'Rectangle') 
+       Builder_Control_Rectanglecolor_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Rectanglecolor_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Rectanglecolor_RBOBJ
    //**************************
    //* Triangle
    //**************************
    if  (left beginswith 'Triangle') 
+       Builder_Control_Triangle_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Triangle_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Triangle_RBOBJ

    return


//******************************
//* Modify a Control
//******************************
!a400_Builder_Control_Modify_PBOBJ
    call !w200_backup_controls
    window enable Builder_Control_Undo_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
    window obtain Builder_Control_Control_EFOBJ
!a400_Builder_Control_Modify_PBOBJ_entry2
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ != null)
+       Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
+       window modify Builder_Control_Control_EFOBJ
+   else
+       window obtain Builder_Control_Control_EFOBJ
+   endif

    scanr:/@Builder_Control_Control_EFOBJ@/:/_/
    if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+       window obtain Builder_Control_WIN
+       call !a400_Builder_Control_restrict_size
+       call !a400_check_text
+       call !a400_Builder_Control_restrict_size
+       return
+   endif
    window exists @Builder_Control_Control_EFOBJ
    if  (!status)
+       message = 'Control doesn't exist'
+       //window message error ok
+       return
+   endif

    window obtain Builder_Control_ControlText_EFOBJ
    ControlText = Builder_Control_ControlText_EFOBJ
    @Builder_Control_Control_EFOBJ = ControlText
    MacroCommand = 'window modify @Builder_Control_Control_EFOBJ@'
    $MacroCommand
    if  (ControlType = 'PBOBJ1') @Builder_Control_Control_EFOBJ = null

    file Controls error open Controls null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ) 
+              scan:/@line/:/,/
+              scan:/@right/:/,/
+              Newline = '@Builder_Control_Control_EFOBJ@,@left@,@ControlText@'
+              r:/@Newline@/
+              f;*
+       endif  
        f;1        
    until (eof)
!a400_control_size
    call !a400_Builder_Control_Size_PBOBJ
    window modify Builder_Control_WIN
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    return

//******************************
//* Check for Object Text
//******************************
!a400_check_text
    Builder_Control_ControlList_COOBJ  = Builder_Control_Control_EFOBJ
    scanr:/@Builder_Control_Control_EFOBJ/:/_/
    if  (right = 'Text') or (right = 'TextTilt') return
    SearchString = "Builder_Control_WIN,@left@.Text_Text/
    file PaintFile //error open PaintFile null
    b
    fs:/@SearchString/
    window obtain Builder_Control_ControlText_EFOBJ
    if-1  (!eof)
+       if-2  (Builder_Control_ControlText_EFOBJ = null)
+           d;1
+           b
+           window paint Builder_Control_WIN
+           return
+       else-2
+           scanr:/@line/:/,/
+           Newline = '@left@,@Builder_Control_ControlText_EFOBJ@'
+           r:/@Newline@/
+           b
+           window paint Builder_Control_WIN
+           return
+   endif
    if  (Builder_Control_ControlText_EFOBJ != null)
+       window obtain Builder_Control_Control_EFOBJ
+       HoldControlName = Builder_Control_Control_EFOBJ
+       window obtain Builder_Control_Height_EFOBJ
+       HoldHeight = Builder_Control_Height_EFOBJ
+       window obtain Builder_Control_Length_EFOBJ
+       HoldLength = Builder_Control_Length_EFOBJ
+       window obtain Builder_Control_X_EFOBJ
+       HoldTextX = Builder_Control_X_EFOBJ
+       window obtain Builder_Control_Y_EFOBJ
+       HoldTextY = Builder_Control_Y_EFOBJ
+       ControlTypeText = ControlType
+       ControlType = 'TextTilt'
+       scanr:/@Builder_Control_Control_EFOBJ/:/_/
+       Builder_Control_Control_EFOBJ = '@left@.Text_Text'
+       window modify Builder_Control_Control_EFOBJ
+       SpecialControlType = null
+       CreateText = 'y'
+       call !b100_text_color
+       call !a400_Builder_Control_Create_PBOBJ
+       Red = TextRed Green = TextGreen Blue = TextBlue
+       CreateText = 'n'
+       file PaintFile
+       b
+       window paint Builder_Control_WIN
+       //******************************
+       //* Put the Actual Control back
+       //******************************
+       Builder_Control_Control_EFOBJ = HoldControlName
+       window modify Builder_Control_Control_EFOBJ
+       ButtonFocus = /@Builder_Control_Control_EFOBJ/
+       Builder_Control_ControlList_COOBJ = ButtonFocus
+       window modify Builder_Control_ControlList_COOBJ
+       Builder_Control_Height_EFOBJ = HoldHeight
+       window modify Builder_Control_Height_EFOBJ
+       Builder_Control_Length_EFOBJ = HoldLength
+       window modify Builder_Control_Length_EFOBJ
+       Builder_Control_X_EFOBJ = HoldTextX
+       window modify Builder_Control_X_EFOBJ
+       Builder_Control_Y_EFOBJ = HoldTextY
+       window modify Builder_Control_Y_EFOBJ
+   endif
    return

//******************************
//* Increase Height of a control
//******************************
!a400_Builder_Control_SizeXPlus_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    call !w200_backup_controls
    if  (SizingWindow)
+       ButtonFocus = "Builder_Control_WindowSize_GBOBJ"
+   endif
    window enable Builder_Control_Undo_PBOBJ
    if  (ButtonFocus = 'GroupRectangle') window obtain Builder_Control_Size_EFOBJ SizeCY = Builder_Control_Size_EFOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeXPlus_window      
+   endif  
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ
    Builder_Control_ControlList_COOBJ = ButtonFocus

    scanr:/@ButtonFocus/:/_/
    if-1 (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+      window obtain Builder_Control_WIN
+      ControlSize = Builder_Control_Size_EFOBJ
+      window obtain Builder_Control_X_EFOBJ
+      ObjectX = Builder_Control_X_EFOBJ
+      window obtain Builder_Control_Y_EFOBJ
+      ObjectY = Builder_Control_Y_EFOBJ
+      window obtain Builder_Control_Length_EFOBJ
+      ObjectCX = Builder_Control_Length_EFOBJ
+      window obtain Builder_Control_Height_EFOBJ
+      ObjectCY = Builder_Control_Height_EFOBJ
+      Builder_Control_ControlList_COOBJ = ButtonFocus
+      if-2 (Builder_Control_Size_RBOBJ)
+         ObjectCY += ControlSize
+         Builder_Control_Height_EFOBJ = ObjectCY
+         window modify Builder_Control_Height_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+      else-2
+         ObjectY += ControlSize
+         Builder_Control_Y_EFOBJ = ObjectY
+         window modify Builder_Control_Y_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+   endif

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif

    window exists @ButtonFocus
    if-2 (!status)
+        message = 'Control doesn't exist'
+        window message error ok
+        return
+   endif
+   if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+   endif
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY += ControlSize
+   else
+       ObjectY += ControlSize
+   endif

    //******************************
    //* Restrict to Window Size
    //******************************
    WinY = ObjectY + ObjectCY
    if  (WinY > MaxY)
+       ObjectY = MaxY - ObjectCY - 1
+   endif

    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeXPlus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY error
+   endif
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY += ControlSize
+   else
+       ObjectY += ControlSize
+   endif

    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Decrease Height of a control
//******************************
!a400_Builder_Control_SizeXMinus_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    call !w200_backup_controls
    if  (SizingWindow)
+       ButtonFocus = "Builder_Control_WindowSize_GBOBJ"
+   endif
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window enable Builder_Control_Undo_PBOBJ
    if  (ButtonFocus = 'GroupRectangle') window obtain Builder_Control_Size_EFOBJ SizeCY = Builder_Control_Size_EFOBJ SizeCY *= -1
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeXMinus_window      
+   endif    

    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ
    Builder_Control_ControlList_COOBJ = ButtonFocus

    scanr:/@ButtonFocus/:/_/
    if-1 (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+      window obtain Builder_Control_WIN
+      ControlSize = Builder_Control_Size_EFOBJ
+      window obtain Builder_Control_X_EFOBJ
+      ObjectX = Builder_Control_X_EFOBJ
+      window obtain Builder_Control_Y_EFOBJ
+      ObjectY = Builder_Control_Y_EFOBJ
+      window obtain Builder_Control_Length_EFOBJ
+      ObjectCX = Builder_Control_Length_EFOBJ
+      window obtain Builder_Control_Height_EFOBJ
+      ObjectCY = Builder_Control_Height_EFOBJ
+      Builder_Control_ControlList_COOBJ = ButtonFocus
+      if-2 (Builder_Control_Size_RBOBJ)
+         ObjectCY -= ControlSize
+         Builder_Control_Height_EFOBJ = ObjectCY
+         window modify Builder_Control_Height_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+      else-2
+         ObjectY -= ControlSize
+         Builder_Control_Y_EFOBJ = ObjectY
+         window modify Builder_Control_Y_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+   endif

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif

    scanr:/@ButtonFocus/:/_/
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'ButtonFocus'
+   endif
    if-1  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (ButtonFocus = 'GroupRectangle) or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+       call !a1100_get_paintfile_object_pos
+   else-1
+       window exists @ButtonFocus
+       if-2 (!status)
+           message = 'Control doesn't exist sizeXminus ButtonFocus[@ButtonFocus@]'
+           window message error ok
+           return
+       else-2
+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+   endif

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY -= ControlSize
+   else
+       ObjectY -= ControlSize
+   endif
    if (ObjectCY < 1) ObjectCY = 1

    //******************************
    //* Restrict to Window Size
    //******************************
    WinY = ObjectY - MinY
    if (WinY < 1) ObjectY = MinY + 1

    scanr:/@ButtonFocus/:/_/
    if-1  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (ButtonFocus = 'GroupRectangle') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+         call !a400_size_paintfile_object
+   else
+         window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_size_paintfile_object
    file PaintFile
    b
    SearchString = 'Builder_Control_WIN,@ControlName@,'
    fs:/@SearchString/
    if (eof) return
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    scan:/@right/:/,/
    HoldRight = right   
    Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@HoldRight@'
    r:/@Newline@/
    return

!a400_SizeXMinus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY error
+   endif
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY -= ControlSize
+   else
+       ObjectY -= ControlSize
+   endif
    if (ObjectCY < 1) ObjectCY = 1
    if (ObjectY < 1) ObjectY = 1
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Increase Length of a control
//******************************
!a400_Builder_Control_SizeYPlus_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    call !w200_backup_controls
    if  (SizingWindow)
+       ButtonFocus = "Builder_Control_WindowSize_GBOBJ"
+   endif
    window enable Builder_Control_Undo_PBOBJ
    if  (ButtonFocus = 'GroupRectangle') window obtain Builder_Control_Size_EFOBJ SizeCX = Builder_Control_Size_EFOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeYPlus_window      
+   endif 
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ
    Builder_Control_ControlList_COOBJ = ButtonFocus

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    scanr:/@ButtonFocus/:/_/
    if-1 (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+      window obtain Builder_Control_WIN
+      ControlSize = Builder_Control_Size_EFOBJ
+      window obtain Builder_Control_X_EFOBJ
+      ObjectX = Builder_Control_X_EFOBJ
+      window obtain Builder_Control_Y_EFOBJ
+      ObjectY = Builder_Control_Y_EFOBJ
+      window obtain Builder_Control_Length_EFOBJ
+      ObjectCX = Builder_Control_Length_EFOBJ
+      window obtain Builder_Control_Height_EFOBJ
+      ObjectCY = Builder_Control_Height_EFOBJ
+      Builder_Control_ControlList_COOBJ = ButtonFocus
+      if-2 (Builder_Control_Size_RBOBJ)
+         ObjectCX += ControlSize
+         Builder_Control_Length_EFOBJ = ObjectCX
+         window modify Builder_Control_Length_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+      else-2
+         ObjectX += ControlSize
+         Builder_Control_X_EFOBJ = ObjectX
+         window modify Builder_Control_X_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+   endif

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif

    window exists @ButtonFocus
    if (!status)
+        message = 'Control doesn't exist'
+        window message error ok
+        return
+   endif
+   if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+        window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+   endif

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX += ControlSize
+   else
+       ObjectX += ControlSize
+   endif

    //******************************
    //* Restrict to Window Size
    //******************************
    WinX = ObjectX + ObjectCX
    if  (WinX > MaxX)
+       ObjectX = MaxX - ObjectCX - 1
+   endif

    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeYPlus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY error
+   endif
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX += ControlSize
+   else
+       ObjectX += ControlSize
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Decrease Length of a control
//******************************
!a400_Builder_Control_SizeYMinus_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    call !w200_backup_controls
    if  (SizingWindow)
+       ButtonFocus = "Builder_Control_WindowSize_GBOBJ"
+   endif
    window enable Builder_Control_Undo_PBOBJ
    if  (ButtonFocus = 'GroupRectangle') window obtain Builder_Control_Size_EFOBJ SizeCX = Builder_Control_Size_EFOBJ SizeCX *= -1
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeYMinus_window      
+   endif 
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ
    Builder_Control_ControlList_COOBJ = ButtonFocus

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    scanr:/@ButtonFocus/:/_/
    if-1 (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+      window obtain Builder_Control_WIN
+      ControlSize = Builder_Control_Size_EFOBJ
+      window obtain Builder_Control_X_EFOBJ
+      ObjectX = Builder_Control_X_EFOBJ
+      window obtain Builder_Control_Y_EFOBJ
+      ObjectY = Builder_Control_Y_EFOBJ
+      window obtain Builder_Control_Length_EFOBJ
+      ObjectCX = Builder_Control_Length_EFOBJ
+      window obtain Builder_Control_Height_EFOBJ
+      ObjectCY = Builder_Control_Height_EFOBJ
+      Builder_Control_ControlList_COOBJ = ButtonFocus
+      if-2 (Builder_Control_Size_RBOBJ)
+         ObjectCX -= ControlSize
+         Builder_Control_Length_EFOBJ = ObjectCX
+         window modify Builder_Control_Length_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+      else-2
+         ObjectX -= ControlSize
+         Builder_Control_X_EFOBJ = ObjectX
+         window modify Builder_Control_X_EFOBJ
+         call !a400_Builder_Control_Modify_PBOBJ_entry2
+         return
+   endif

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif

    window exists @ButtonFocus
    if-2 (!status)
+        message = 'Control doesn't exist sizeyminus'
+        window message error ok
+        return
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+        window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+   endif

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX -= ControlSize
+   else
+       ObjectX -= ControlSize
+   endif
    if (ObjectCX < 1) ObjectCX = 1

    //******************************
    //* Restrict to Window Size
    //******************************
    WinX = ObjectX - MinX
    if (WinX < 1) ObjectX = MinX + 1

    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeYMinus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a1100_get_paintfile_object_pos
+   else
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY error
+   endif
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX -= ControlSize
+   else
+       ObjectX -= ControlSize
+   endif
    if (ObjectCX < 1) ObjectCX = 1
    if (ObjectX < 1) ObjectX = 1
    if  (ButtonFocus = 'GroupRectangle')
+       ControlName = 'GroupRectangle'
+       call !a400_size_paintfile_object
+   else
+       window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY error
+   endif
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Swap Height/Ypos and Length/Xpos for Line and Arrow
//******************************
!a400_Builder_Control_Swap_PBOBJ
    window obtain Builder_Control_WIN
    HoldValue = Builder_Control_Height_EFOBJ
    Builder_Control_Height_EFOBJ = Builder_Control_Y_EFOBJ
    Builder_Control_Y_EFOBJ = HoldValue
    HoldValue = Builder_Control_Length_EFOBJ
    Builder_Control_Length_EFOBJ = Builder_Control_X_EFOBJ
    Builder_Control_X_EFOBJ = HoldValue
    window modify Builder_Control_Height_EFOBJ
    window modify Builder_Control_Length_EFOBJ
    window modify Builder_Control_X_EFOBJ
    window modify Builder_Control_Y_EFOBJ
    call !a400_Builder_Control_Modify_PBOBJ
    return

//******************************
//* View the structure
//******************************
!a400_Builder_Control_View_PBOBJ
    Builder_Language_Commands_MLOBJ = 'view'
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_PBOBJ
    return

//******************************
//* Test the program
//******************************
!a400_Builder_Control_Test_PBOBJ
    Builder_Language_Commands_MLOBJ = 'test'
    window modify Builder_Language_Commands_MLOBJ
    call !a450_Builder_Language_Apply_PBOBJ
    return

//******************************
//* Modify program code
//******************************
!a400_Builder_Control_Code_PBOBJ
    string ModuleFileName error
    string ModuleName     error
    string ModulePrefix   error
    string SearchPrefix   error

    if (BeditDebug) return

    //message = "!a400_Builder_Control_Code_PBOBJ" window message info ok

    if-1 (!CodeOnly)
+      window pointer wait
+      window hwnd Builder_Code_WIN status error window open Builder_Code_WIN shade
+      window center Builder_Code_WIN
+      Builder_Code_WIN = 'Code Selection - System[@SystemName@]'
+      window modify Builder_Code_WIN
+      if-2 (CodeType = 'bedit')
+         window show Builder_Code_Refresh_PBOBJ
+         window show Builder_Code_Test_PBOBJ
+         window show Builder_Code_View_PBOBJ
+      else-2
+         window hide Builder_Code_Refresh_PBOBJ
+         window hide Builder_Code_Test_PBOBJ
+         window hide Builder_Code_View_PBOBJ
+   endif

    //***********************
    //* Open the Module File
    //***********************
    close ModuleFile error
    open ModuleFile null

    close ModuleNameFile error
    open ModuleNameFile null

    //***********************
    //* Create the Code
    //***********************
    GenSystemFilename = "@SystemName@.BED"
    MacroCommand = "    if (!exists @GenSystemFilename@) call !y100_Generate" $MacroCommand

    //***********************
    //* Open the Bedit Code File
    //***********************
    close CodeFile error
    open CodeFile @GenSystemFilename
    ModuleFileName = 'Bedit-code\@SystemName@.bed'
    write CodeFile @ModuleFileName

    //***********************
    //* Clear the listbox
    //***********************
    Builder_Code_Codemodules_LBOBJ = 'ALL'
    window delete Builder_Code_Codemodules_LBOBJ
    window paint Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Add the generic lines
    //***********************
    if  (!CodeOnly) and (CodeType != 'bedit')
+       Builder_Code_Codemodules_LBOBJ = "! Complete Program"
+       window insert end default Builder_Code_Codemodules_LBOBJ
+       //Builder_Code_Codemodules_LBOBJ = "! Global Variables"
+       //window insert end default Builder_Code_Codemodules_LBOBJ
+   endif

    //***********************
    //* Global Variables
    //***********************
    b
    do
        split:/@line/;1
        if  (left != '!')
+           Newline = line
+           file ModuleFile
+           i:/@Newline/
+           file CodeFile
+           f;1
+       endif
    until (left = '!') or (eof)
   
    file ModuleFile
!a400_Builder_Control_Code_firstcomments
    b;1
    if (eof) goto !a400_Builder_Control_Code_firstcomments_done
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      d
+      goto !a400_Builder_Control_Code_firstcomments
+   endif

!a400_Builder_Control_Code_firstcomments_done
    ModuleFileName = 'Bedit-code\Global.bed'

!a400_Builder_Control_Code_module  
    file ModuleFile
    MacroCommand = "    if (!exists @ModuleFileName@) write ModuleFile @ModuleFileName@"  
    $MacroCommand

    if (eof)
+      goto !a400_Builder_Control_Code_Done
+   endif
    ModuleFileName = line
    file ModuleFile
    b
    d;*
    file CodeFile
    Builder_Code_Codemodules_LBOBJ = line
    pack Builder_Code_Codemodules_LBOBJ
    window insert end default Builder_Code_Codemodules_LBOBJ
    file ModuleNameFile
    b
    fs:/@Builder_Code_Codemodules_LBOBJ@/
    if (eof)
+      i:/@Builder_Code_Codemodules_LBOBJ@/
+   endif
    file ModuleFile
    //i:/@Builder_Code_Codemodules_LBOBJ/
    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
    scan:/@Builder_Code_Codemodules_LBOBJ@/:/_/
    if (found)
+      ModulePrefix = left
+   else
+      ModulePrefix = Builder_Code_Codemodules_LBOBJ
+   endif
    if (ModulePrefix = '!a010') and (CodeType != 'bedit')
+      ModulePrefix = null
+   endif
    file CodeFile
!a400_Builder_Control_Code_comments
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !a400_Builder_Control_Code_comments
+   endif

!a400_Builder_Control_Code_loop
    split:/@line/;1
    if (left != '!') or (line = Builder_Code_Codemodules_LBOBJ)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !a400_Builder_Control_Code_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !a400_Builder_Control_Code_next
+   endif    
    file ModuleFile
    b
    ib:/FGB/
    f;*
!a400_Builder_Control_Code_commentdelloop
    pack line
    if (line = null)
+      goto !a400_Builder_Control_Code_commentremove
+   endif
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !a400_Builder_Control_Code_commentremove
+   endif
    goto !a400_Builder_Control_Code_commentdeldone
!a400_Builder_Control_Code_commentremove
    d
    split:/@line/;3
    if (left != 'FGB')
+      goto !a400_Builder_Control_Code_commentdelloop
+   endif

!a400_Builder_Control_Code_commentdeldone
    b
    d  //* Remove FGB line  
    goto !a400_Builder_Control_Code_module

!a400_Builder_Control_Code_next
    file CodeFile
    f;1
    if (!eof)
+      goto !a400_Builder_Control_Code_loop
+   endif
    write ModuleFile @ModuleFileName
    close ModuleFile

!a400_Builder_Control_Code_Done
    close CodeFile

    if  (!CodeOnly)
+       window unshade Builder_Code_WIN
+       window setfocus Builder_Code_WIN
+       window pointer arrow
+   endif

    if (CodeOnly) return

    window obtain Builder_Control_Control_EFOBJ
    if  (Builder_Control_Control_EFOBJ != null)
+       file ModuleNameFile
+       b
+       fs:/@Builder_Control_Control_EFOBJ@/
+       if (!eof)
+          Builder_Code_Codemodules_LBOBJ = line
+          call !a1800_Builder_Code_Ok_PBOBJ-1
+   endif

    return

//******************************
//* Refresh the Control Window
//******************************
!a400_Builder_Control_Refresh_PBOBJ
    call !a400_fix_object_text
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    file PaintFile
    b
    window paint Builder_Control_WIN
    //window hide Builder_Control_WIN
    //window show Builder_Control_WIN
    return

//******************************
//* Fix the position of all .Text objects
//******************************
!a400_fix_object_text
    file PaintFile
    b
    do
        fs:/.Text_Text/
        if-1  (!eof)
+           Newline = 'FGB$*$@line@'
+           r:/@Newline/
+           scan:/@line/:/,/
+           scan:/@right/:/,/
+           scan:/@left@/:/.Text/
+           TextObj = '@left@'
+           SearchString = 'Builder_Control_WIN,@left@_'
+           //message = SearchString window message info ok
+           b
+           fs:/@SearchString/
+           if-2  (!eof)
+               scan:/@line/:/,/ 
+               scan:/@right/:/,/
+               scan:/@right/:/,/
+               scan:/@right/:/,/ TextX = left
+               scan:/@right/:/,/ TextY = left
+               b
+               fs:/FGB$*$/
+               scan:/@line/:/FGB$*$/
+               scan:/@right/:/,/ HoldWindowName = left
+               scan:/@right/:/,/ HoldControlName = left
+               scan:/@right/:/,/ HoldType = left
+               scan:/@right/:/,/ HoldX = left
+               scan:/@right/:/,/ HoldY = left
+               HoldRight = right
+               call !a400_text_offset_entry2
+               file PaintFile
+               Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@TextX@,@TextY@,@HoldRight@'
+               r:/@Newline/ 
+               f;1
+            else-2
+               b
+               fs:/FGB$*$/
+               scan:/@line/:/FGB$*$/
+               r:/@right/
+               f;1
+       endif
    until (eof)
    return

//******************************
//* Save Created Window
//******************************
!a400_Builder_Control_Save_PBOBJ
    //ControlName = 'test'
    //MacroCommand = "window windowpos @ControlName@ SaveX SaveY SaveCX SaveCY" $MacroCommand
    //message = 'Save Control[@ControlName@] SaveX[@SaveX@] SaveY[@SaveY@] SaveCX[@SaveCX@] SaveCY[@SaveCY@]' window message info ok

    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY

    //******************************
    //* Remove GroupRectangle
    //******************************
    file PaintFile error open PaintFile null
    b
    do
        fs:/,GroupRectangle,/
        if (!eof) d;1
    until (eof)
    //******************************
    //* Remove Connectselect
    //******************************
    b
    do
        fs:/Builder_Connectselect_/
        if (!eof) d;1
    until (eof)
    //******************************
    //* Remove Connectselect
    //******************************
    b
    do
        fs:/Builder_StdColors_/
        if (!eof) d;1
    until (eof)

    MouseOK = 'n'

    file BuilderWindowFile
    b
    Newline = 'WINDOW,@SystemName@_@WindowName@'
    fs:/@Newline/
    if (eof) 
+      i:/*******************************************************************/
+      i:/*                           WINDOW                                */
+      i:/*******************************************************************/
+      goto !a400_new
+   endif
    d
//*************************
//* Remove old window data
//*************************
!a400_del_loop
    if (eof) goto !a400_new
    split:/@line/;3
    if (left != '***')
+      d;1
+      goto !a400_del_loop
+   endif
    b;1
    
//*************************
//* Insert new window data
//*************************
!a400_new
    ObjectCX = MaxX + 40
    ObjectCY = MaxY + 40
 
    SystemWindowName = '@SystemName@_@WindowName@_WIN'

    MacroCommand = "window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY" $MacroCommand
    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ ObjectX ObjectY ObjectCX ObjectCY" $MacroCommand

    ObjectX -= MinX
    ObjectY -= MinY
    if  (ObjectX < 1) ObjectX = 1
    if  (ObjectY < 1) ObjectY = 1
    Newline = /WINDOW,@SystemWindowName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@WindowTitle@/
    i:/@Newline@/ 

    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY" $MacroCommand
    file Controls error goto !a400_controls_done
    //write Controls Controls.dat
    b
    if (eof) goto !a400_controls_done
!a400_next
    scan:/@line/:/,/
    ControlName = left
    scan:/@right/:/,/
    ControlType = left
    Text = right
    if (ControlType = 'EFOBJL') or (ControlType = 'EFOBJR') or (ControlType = 'LBOBJ1') or (ControlType = 'COOBJS') or (ControlType = 'COOBJL') or (ControlType = 'MLOBJ1') or (ControlType = 'STTXTF') or (ControlType = 'STTXTR')
+      Text = null
+   endif
    if (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle')
+      Text = null
+   endif

    if  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle')
+       file PaintFile
+       b
+       fs:/@ControlName@/
+       scan:/@line/:/,/
+       scan:/@right/:/,/
+       scan:/@right/:/,/
+       ObjectX = left
+       scan:/@right/:/,/
+       ObjectY = left
+       scan:/@right/:/,/
+       ObjectCX = left
+       scan:/@right/:/,/
+       ObjectCY = left
+       Text = right
+   else
+       MacroCommand = "window windowpos @ControlName@ ObjectX ObjectY ObjectCX ObjectCY" $MacroCommand
+   endif
    //message = 'Walk Control[@ControlName@] ObjectX[@ObjectX@] ObjectY[@ObjectY@] ObjectCX[@ObjectCX@] ObjectCY[@ObjectCY@]' window message info ok

    ObjectX -= MinX
    ObjectY = ObjectY - MinY
    if  (ObjectX < 1) ObjectX = 1
    if  (ObjectY < 1) ObjectY = 1
    if  (ControlType = 'COOBJL') ObjectCY = 200
    Newline = /@ControlType@,@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Text@/
    file BuilderWindowFile
    i:/@Newline@/
    if  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle')
+   else
+       MacroCommand = 'window deletecontrol @ControlName@ error' $MacroCommand
+   endif
    file Controls error open Controls null
    f;1
    if  (!eof) goto !a400_next
!a400_controls_done
    SystemFileName = '@SystemName@.win'
    write BuilderWindowFile @SystemFileName
    write WindowNav @SystemNavFilename
    write Entryaction @EntryactionFilename
    close Controls error

    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ 
    window close Builder_Control_WIN
    if  (GotoWindow = null)
+       window show Builder_Window_WIN
+   endif
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ

    //******************************
    //* Remove old PaintFile Objects
    //******************************
    file PaintFile
    b
    SearchString = '@SystemName@_@WindowName@_WIN'
    do
        fs:/@SearchString/
        if (!eof) d;1
    until (eof)

    //******************************
    //* Convert New Control Objects to Window Objects
    //******************************
    b
    do
        fs:/Builder_Control_WIN/
        if  (!eof)
+           call !a400_process_paintfile_line
+       endif
        f;1
    until (eof)
 
    //******************************
    //* Remove PaintFile Builder_Control_WIN Objects
    //******************************
    file PaintFile
    b
    do
        fs:/Builder_Control_WIN/
        if (!eof) d;1
    until (eof)

    PaintSystemName = '@SystemName@.pnt'
    write PaintFile @PaintSystemName error

    //message = 'ready to generate' window message info ok
    call !y100_Generate   
    return

//******************************
//* Process a PaintFile object line
//******************************
!a400_process_paintfile_line
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    ObjectY = left
    scan:/@right/:/,/
    ObjectCX = left
    scan:/@right/:/,/
    ObjectCY = left
    scan:/@right/:/,/
    Red = left
    scan:/@right/:/,/
    Green = left
    scan:/@right/:/,/
    Blue = left
    HoldRight = right

    if (HoldType = 'Bitmap')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      CurrFile = left
+   endif
    if (HoldType = 'BitmapFit')
+      scan:/@line/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      scan:/@right/:/,/
+      ObjectX = left
+      scan:/@right/:/,/
+      ObjectY = left
+      scan:/@right/:/,/
+      ObjectCX = left
+      scan:/@right/:/,/
+      ObjectCY = left
+      scan:/@right/:/,/
+      CurrFile = left
+   endif

    if (HoldType = 'Text') or (HoldType = 'TextTilt')
+      scan:/@HoldRight/:/,/
+      CurrFont = left
+      Text = right
+   endif

    //message = 'HoldControlName[@HoldControlName@] ObjectX[@ObjectX@] ObjectY[@ObjectY@] MinX[@MinX@] MinY[@MinY@]' window message info ok

    ObjectX -= MinX
    ObjectY -= MinY
    if  (ObjectX < 1) ObjectX = 1
    if  (ObjectY < 1) ObjectY = 1

    if  (HoldType = 'Line')
+       ObjectCX -= MinX
+       ObjectCY -= MinY
+   endif
    if  (HoldType beginswith 'Arrow')
+       split:/@HoldType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           ObjectCX -= MinX
+           ObjectCY -= MinY
+   endif
    if  (HoldControlName != 'Connector')
+       scan:/@HoldControlName@/:/_/
+       scan:/@right/:/_/
+       HoldControlName = '@SystemName@_@WindowName@_@right@'
+   endif
    Newline = '@SystemName@_@WindowName@_WIN,@HoldControlName@,@HoldType@,@ObjectX@,@ObjectY@'

    if-1  (HoldType = 'Bitmap') 
+       Newline = '@Newline@,@CurrFile@'
+   else-1
+       if-2  (HoldType = 'BitmapFit')
+           Newline = '@Newline@,@ObjectCX@,@ObjectCY@,@CurrFile@'
+       else-2
+           Newline = '@Newline@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@'
+           if-3  (HoldType = 'Text') or (HoldType = 'TextTilt')
+               Newline = '@Newline@,@CurrFont@,@Text@'
+   endif
    r:/@Newline/

    return

//******************************
//* Close the Build Window
//******************************
!a400_Builder_Control_Cancel_PBOBJ
    message = 'Are you sure?'
    window message question yesno
    if (!message) return

    //*****************************
    //* remove all Created Controls
    //*****************************
    file Controls error goto !a400_cancel_done
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          ControlName = left
+          //message = 'delete control @ControlName@' window message info ok
+          window deletecontrol @ControlName error
+          f;1
+       endif
    until (eof)
    close Controls

    //*****************************
    //* remove all PaintFile objects
    //*****************************
    file PaintFile
    b
    do
        fs:/Builder_Control_WIN/
        if (!eof) d;1
    until (eof)

!a400_cancel_done
    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ 
    window close Builder_Control_WIN
    window show Builder_Window_WIN
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ
    return

//******************************
//* Cancel/Close Textedit Window
//******************************
!a420_Builder_Textedit_Ok_PBOBJ
    window close Builder_Textedit_WIN
    BubbleFileName = '@SystemName@.bbl'
    close BubbleFile error
    open BubbleFile @BubbleFileName error open BubbleFile null
    window obtain Builder_Textedit_WIN
    pack Builder_Textedit_Bubble_MLOBJ
    Newline = '@Builder_Textedit_Name_EFOBJ@,@Builder_Textedit_Bubble_MLOBJ@'
    SearchString = '@Builder_Textedit_Name_EFOBJ@,'
    b
    fs:/@SearchString/
    if-1  (eof)
+       if-2  (Builder_Textedit_Bubble_MLOBJ != null)
+           i:/@Newline/
+   else-1
+       if-3  (Builder_Textedit_Bubble_MLOBJ != null)
+           r:/@Newline/
+       else-3
+           d;1
+   endif
    
    write BubbleFile @BubbleFileName
    close BubbleFile
    return

//******************************
//* Apply the language interface
//* commands to the window
//******************************
!a450_Builder_Language_Apply_PBOBJ
    call !w200_backup_controls
!a450_Builder_Language_Apply_call
    call BuilderLang.bed
    //*****************************************
    //* Run the LanguageReturn command
    //*****************************************
    if (LanguageReturn != null) 
+      $LanguageReturn error
+   endif

    window setfocus Builder_Language_Commands_MLOBJ

    window hwnd Builder_Control_WIN status error return
    call !a400_Builder_Control_Refresh_PBOBJ

    return

//******************************
//* Close the Langage Interface Window
//******************************
!a450_Builder_Language_Close_PBOBJ
    //window close Builder_Language_WIN
    return

//******************************
//* Clear the Language entry field
//******************************
!a450_Builder_Language_Clean_PBOBJ
    Builder_Language_Commands_MLOBJ = null
    window modify Builder_Language_Commands_MLOBJ
    window setfocus Builder_Language_Commands_MLOBJ
    return

//******************************
//* Goto the Window Pallet
//******************************
!a450_Builder_Language_Gotopallet_PBOBJ
    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ
    Builder_Control_ControlText_EFOBJ = null
    window modify Builder_Control_ControlText_EFOBJ
    window setfocus Builder_Control_WIN
    window setfocus Builder_Control_Control_EFOBJ
    return

//******************************
//* Change the View to XHTML/CSS
//******************************
!a500_Builder_View_Html_PBOBJ
    ObjectCX = 300
    file PaintFile error return
    b
    pattern on
    fs:/Builder_View_WIN*Box3D/
    pattern off
    if  (!eof)
+        scan:/@line/:/,/
+        scan:/@right/:/,/ ObjectName = left
+        scan:/@right/:/,/
+        scan:/@right/:/,/ ObjectX = left
+        scan:/@right/:/,/ ObjectY = left
+        scan:/@right/:/,/ ObjectCX = left
+   endif
    FontSize = 8
    if  (ObjectCX > 70) FontSize = 9 
    if  (ObjectCX > 110) FontSize = 11 
    if  (ObjectCX > 150) FontSize = 13 
    if  (ObjectCX > 190) FontSize = 15 
    if  (ObjectCX > 230) FontSize = 17 
    if  (ObjectCX > 270) FontSize = 18 

    close HTMLFile error
    open HTMLFile null

    i:|<!-- Builder View -->|
    i:|<!DOCTYPE html PUBLIC "-W3C//DTD XHTML 1.0 Trasitional//EN"|
    i:|"http://ww.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">|
    i:|<html>|
    i:|<head>|
    i:|    <style type="text/css">|
    i:|        div {|
    i:|            color:black;|
    i:|            position: absolute;|
    i:|            border-width:1px;|
    i:|            border-color:black;|
    Newline = |            font-size:@FontSize@;| i:/@Newline@/
    i:|        }|
    i:|    </style>|
    i:|</head>|
    i:|<body>|
    i:|</body>|
    i:|</html>|

    //*******************************
    //* Create the Boxes
    //*******************************
    file PaintFile error return
    b
    do
        pattern on
        fs:/Builder_View_WIN*Box3D/
        pattern off
        if  (!eof)
+           scan:/@line/:/,/
+           scan:/@right/:/,/ ObjectName = left
+           scan:/@right/:/,/
+           scan:/@right/:/,/ ObjectX = left
+           scan:/@right/:/,/ ObjectY = left
+           scan:/@right/:/,/ ObjectCX = left
+           scan:/@right/:/,/ ObjectCY = left
+           file HTMLFile
+           b
+           fs:|</style>|
+           b;1
+           Newline = "        #@ObjectName@ {background-color:cyan;top:@ObjectY@px;left:@ObjectX@px;width:@ObjectCX@px;height:@ObjectCY@px;border-style:solid;}"
+           i:/@Newline/
+           fs:|</body>|
+           b;1
+           scanr:/@ObjectName@/:/-/
+           Newline = "    <div id=@ObjectName@>@left@</div>"
+           i:/@Newline/
+       endif
        file PaintFile
        f;1
    until (eof)
    //*******************************
    //* Create the Lines
    //*******************************
    file ViewLines error message = "Unable to open ViewLines file" window message warning ok return
    b
    do
        if  (!eof)
+           scan:/@line/:/,/ ObjectName = left     
+           scan:/@right/:/,/ ObjectX = left
+           scan:/@right/:/,/ ObjectY = left
+           scan:/@right/:/,/ ObjectCX = left ObjectCY = right
+           call !a500_create_line
+           file ViewLines
+           f;1
+       endif
    until (eof)

    //**************************
    //* Fix arrow style lines
    //**************************
    clear
    file HTMLFile
    b
    do
        fs:/{border:3px/
        if  (!eof)
+           cut;1
+       endif
    until (eof)
    b
    fs:|</style>|
    b;1
    paste

    //**************************
    //* Fix arrow para lines
    //**************************
    clear
    file HTMLFile
    b
    do
        fs:|</p>|
        if  (!eof)
+           cut;1
+       endif
    until (eof)
    b
    fs:|<body>|
    paste

    write HTMLFile Builder_View.html
    close HTMLFile
    system:"start Builder_View.html"
    
    return

//********************************
//* Create the HTML Connector Line
//********************************
!a500_create_line
    HTMLArrow = 'n'
    if  (ObjectCY = 1)
+           Newline = "		#@ObjectName@ {position:absolute;top:@ObjectY@px;left:@ObjectX@px;border-top-color:black;border-top-style:solid;width:@ObjectCX@px;}"
+   else
+           Newline = "		#@ObjectName@ {position:absolute;top:@ObjectY@px;left:@ObjectX@px;border-left-color:black;border-left-style:solid;height:@ObjectCY@px;}"
+   endif

    if  (ObjectCX = ObjectCY)
+       //***********************
+       //* Arrow
+       //***********************
+       //Newline = "		#@ObjectName@ {top:@ObjectY@px;left:@ObjectX@px;border-top-color:black;border-top-style:solid;width:@ObjectCX@px;border-width:6px;}"
+       Newline = "		#@ObjectName@ {border:3px solid black;position:absolute;top:@ObjectY@px;left:@ObjectX@px;}"
+       HTMLArrow = 'y'
+   endif
    file HTMLFile
    b
    fs:|</style>|
    b;1
    i:/@Newline/
    if  (HTMLArrow)
+       fs:|<body>|
+       Newline = "    <p id=@ObjectName@></p>"
+   else
+       fs:|</body>|
+       b;1
+       Newline = "    <div id=@ObjectName@></div>"
+   endif
    i:/@Newline/
    return

//******************************
//* Open the View File
//******************************
!a500_Builder_View_Open_PBOBJ
    string StartName error
    StartName = SystemName
    scan:/@StartName@/:/./
    if (found) StartName = left
    MacroCommand = 'start @Builder_Import_Filename_EFOBJ@'
    system:"@MacroCommand@"
    return

//******************************
//* Find a file to Start
//******************************
!a500_Builder_Nav_Find_PBOBJ
    if  (Extension = null) Extension = 'bmp'
    Builder_Nav_Open_RBOBJ = 'N'
    window modify Builder_Nav_Open_RBOBJ
    Builder_Nav_Close_RBOBJ = 'N'
    window modify Builder_Nav_Close_RBOBJ
    Builder_Nav_Start_RBOBJ = 'Y'
    window modify Builder_Nav_Start_RBOBJ
    DirField = "Builder_Nav_Start_EFOBJ"
    FileField = "Builder_Nav_Start_EFOBJ"
    call !s100_directory
    return

//******************************
//* Set the Navigation for a Control
//******************************
!a500_Builder_Nav_Ok_PBOBJ
    window obtain Builder_Nav_WIN
    if-1  (Builder_Nav_Open_RBOBJ)
+       NavAction = 'open'
+   else-1
+       if-2  (Builder_Nav_Close_RBOBJ)
+           NavAction = 'close'
+       else-2
+           NavAction = 'start'
+           window obtain Builder_Nav_Start_EFOBJ
+           pack Builder_Nav_Start_EFOBJ
+           if-3  (Builder_Nav_Start_EFOBJ = null)
+               message = 'Please enter a Start value'
+               window message warning ok
+               window setfocus Builder_Nav_Start_EFOBJ
+               return
+           else-3
+               Builder_Nav_Windowlist_COOBJ = Builder_Nav_Start_EFOBJ
+   endif

    //crush Builder_Nav_Windowlist_COOBJ

    if (Builder_Nav_Windowlist_COOBJ = null) and (Builder_Nav_Windowname_STTXT = null)
+      message = 'Please select a Window Name'
+      window message error ok
+      return
+   endif

    if (Builder_Nav_Windowlist_COOBJ = null)
+      Builder_Nav_Windowlist_COOBJ = Builder_Nav_Windowname_STTXT
+   endif

    file WindowNav
    b
    fs:/@ButtonFocus@/
    Newline = "@ButtonFocus@,@Builder_Nav_Windowlist_COOBJ@,@NavAction@"
    if (eof)
+      i:/@Newline@/
+   else
+      r:/@Newline@/
+   endif
    window close Builder_Nav_WIN
    return


//******************************
//* Cancel Navigation
//******************************
!a500_Builder_Nav_Cancel_PBOBJ
    window close Builder_Nav_WIN
    return

//******************************
//* View the Program Comments
//******************************
!a500_Builder_View_Comments_PBOBJ
    int    CommentCount error
    string CommentCountStr error

    window pointer wait
    window hwnd Builder_Comments_WIN status error window open Builder_Comments_WIN shade
    window center Builder_Comments_WIN
    window clear Builder_Comments_WIN
    Builder_Comments_Module_STTXT = Builder_Import_Filename_EFOBJ
    window modify Builder_Comments_Module_STTXT
    if (Extension = 'COB')
+      call !a500_Builder_View_Comments_Cobol
+   endif
    if (Extension = 'BED')
+      call !a500_Builder_View_Comments_Bedit
+   endif
    if (Extension = 'C')
+      call !a500_Builder_View_Comments_C
+   endif
    if (Extension = 'JAVA')
+      //call !a500_Builder_View_Comments_Java
+   endif
    //window disable Builder_Comments_Comments_LBOBJ
    window unshade Builder_Comments_WIN
    window setfocus Builder_Comments_WIN
    window pointer arrow
    return

//************************************
//* COBOL program comments
//************************************
!a500_Builder_View_Comments_Cobol
    file SOURCECODE error return
    b
    fs:/DATE-COMPILED/
    if (eof)
+      b fs:/DATE-WRITTEN/
+      if (eof)
+         b fs:/PROGRAM-ID/
+   endif
    cols 7,7
    fs:/*/
    noco
    CommentCount = 0
!a500_Builder_View_Comments_Cobol_loop
    if (eof) return
    split:/@line/;6
    split:/@right/;1
    if  (left != '*')
+       return
+   endif
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_Cobol_loop
    return

//************************************
//* Bedit program comments
//************************************
!a500_Builder_View_Comments_Bedit
    file SOURCECODE error return
    b
    CommentCount = 0
!a500_Builder_View_Comments_Bedit_loop
    if (eof) return
    scan:/@line/:word
    split:/@left/;2
    if (left != "//") return
    Newline = line
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_Bedit_loop  
    return

//************************************
//* C program comments
//************************************
!a500_Builder_View_Comments_C
    open CComments @Builder_Import_Filename_EFOBJ error return
    b
    CommentCount = 0
!a500_Builder_View_Comments_C_loop
    if (eof) goto !a500_Builder_View_Comments_C_done
    scan:/@line/:word
    split:/@left/;1
    if (left != "/") goto !a500_Builder_View_Comments_C_done
    Newline = line
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_C_loop  

!a500_Builder_View_Comments_C_done
    close CComments
    return

//******************************
//* Filter the View lines
//******************************
!a500_Builder_View_Filter_PBOBJ
    file ViewFilterList error return
    window pointer wait
    window hwnd Builder_Filter_WIN status error window open Builder_Filter_WIN shade
    window center Builder_Filter_WIN
    window clear Builder_Filter_WIN

    if  (ViewSingleProg) and (!Builder_Import_Viewfiles_RBOBJ) and (!Builder_Import_Viewvars_RBOBJ)
+       window show Builder_Filter_Comments_PBOBJ
+       window show Builder_Filter_View_PBOBJ
+   else
+       window hide Builder_Filter_Comments_PBOBJ
+       window hide Builder_Filter_View_PBOBJ
+   endif

    Builder_Filter_Windowlist_LBOBJ = 'ALL'
    window delete Builder_Filter_Windowlist_LBOBJ
    window paint Builder_Filter_Windowlist_LBOBJ
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if (ViewCobol)
+             Builder_Filter_Windowlist_LBOBJ = left
+             size Builder_Filter_Windowlist_LBOBJ,70
+             scanr:/@line/:/,/
+             Builder_Filter_Windowlist_LBOBJ = "@Builder_Filter_Windowlist_LBOBJ@:\|@right@"
+             window insert end default Builder_Filter_Windowlist_LBOBJ
+       endif
        if (!eof)
+          if (!ViewCobol)
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             Builder_Filter_Windowlist_LBOBJ = left
+             size Builder_Filter_Windowlist_LBOBJ,70
+             scanr:/@line/:/,/
+             Builder_Filter_Windowlist_LBOBJ = "@Builder_Filter_Windowlist_LBOBJ@|@right@"
+             window insert end default Builder_Filter_Windowlist_LBOBJ
+       endif
        f;1
    until (eof)
    Builder_Filter_Windowlist_STTXT = 'Functions'
    if (Extension = 'COB')  Builder_Filter_Windowlist_STTXT = 'Paragraphs'
    if (Extension = 'C')    Builder_Filter_Windowlist_STTXT = 'Functions'
    if (Extension = 'BED')  Builder_Filter_Windowlist_STTXT = 'Modules'
    if (Extension = 'JAVA') Builder_Filter_Windowlist_STTXT = 'Classes'
    if (ViewBuilderWindow = 'y') Builder_Filter_Windowlist_STTXT = 'Windows'
    window modify Builder_Filter_Windowlist_STTXT
    window unshade Builder_Filter_WIN
    window setfocus Builder_Filter_WIN
    window pointer arrow
    return

//******************************
//* Cancel View
//******************************
!a500_Builder_View_Cancel_PBOBJ
    window pointer wait
    ViewSingleProg = 'n'
    file ViewObjects error goto !a500_view_done
    b
!a500_view_loop
    if (eof) goto !a500_view_done
    window deletecontrol @line error
    f;1
    goto !a500_view_loop

!a500_view_done
    close ViewObjects error
    window close Builder_View_WIN

    //**********************************
    //* Delete View Win/Nav Files
    //**********************************
    if (ViewCobol)
+      if (Extension = 'COB')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @CobolWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @CobolNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'BED')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @BeditCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @BeditCodeNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'C')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @CCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @CCodeNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'JAVA')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @JavaCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @JavaCodeNavName@"' $MacroCommand
+   endif
    ViewCobol = 'n'

    //**********************************
    //* Delete Downloaded COBOL Source
    //**********************************
    if  (COBOL3090)
+       MacroCommand = 'system:"del @Programname3090@"' $MacroCommand //message = MacroCommand window message info ok
+       COBOL3090 = 'n'
+   endif

    ViewBuilderWindow = 'n'
    window pointer arrow
    return

//******************************
//* Filter the View Lines drawn
//******************************
!a550_Builder_Filter_OK_PBOBJ
    close PaintFile error
    open PaintFile null
    i:/@EarthBitmapLine@/
    //i:/******************/
    //i:/******************/
    //i:/******************/
    if  (!ClickFilter)
+       window obtain Builder_Filter_Windowlist_LBOBJ
+   endif
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = 'Please select a Filter'
+       window message error ok
+       return
+   endif
    //message = 'Filter[@Builder_Filter_Windowlist_LBOBJ@]' window message info ok
    window pointer wait
    //*********************
    //* Backup ViewList
    //*********************
    file ViewList
    b
    clear
    copy;*
    close ViewListTemp error
    open ViewListTemp null
    paste
    //write ViewListTemp viewlisttemp.dat
    //*********************
    //* Clear ViewList
    //*********************
    //write ViewList viewlist-pre.dat
    file ViewList
    b
    d;*
    //*********************
    //* Find the Selections
    //*********************
    if  (!ClickFilter)
+       Builder_Filter_Windowlist_LBOBJ = 'FIRST'
+   endif

    do  
        if  (!ClickFilter)
+           window obtain Builder_Filter_Windowlist_LBOBJ
+       endif
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'COB')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /
+                  SearchString = ',@left@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'BED')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
+                  SearchString = ',@left@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'C')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+                  SearchString = ',@right@'
+       endif
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'JAVA')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+                  SearchString = ',@right@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (!ViewCobol)
+               scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+               SearchString = ',@right@'
+       endif

        //message = 'Searching for[@SearchString@]' window message info ok



        if  (Builder_Filter_Windowlist_LBOBJ = null)
+           goto !a550_Builder_Filter_done
+       endif

        file ViewListTemp
        b

!a550_Builder_Filter_loop
        //****************************
        //* Screen Name to ViewList
        //****************************
        //message = SearchString window message info ok
        fs:/@SearchString@/
        if (!eof)
+          scan:/@line/:/@SearchString@/
+          pack right
+          if (right = null)
+             clear
+             copy
+             file ViewList
+             paste
+             goto !a550_Builder_Filter_next
+       endif
        if (!eof)
+          f;1
+          goto !a550_Builder_Filter_loop
+       endif

!a550_Builder_Filter_next
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           Builder_Filter_Windowlist_LBOBJ = 'NEXT'
+       endif
        if  (ClickFilter)
+           Builder_Filter_Windowlist_LBOBJ = null
+       endif
    until (Builder_Filter_Windowlist_LBOBJ = null)

!a550_Builder_Filter_done
    //write ViewList ViewList1.dat
    b
    //*********************
    //* Filter WindowNav
    //*********************
    string DeleteRec error
    file WindowNav
    b
    clear
    copy;*
    open WindowNavTemp null error file WindowNavTemp b d;*
    paste
    close ViewListBorder error
    open ViewListBorder null
    file ViewList
    b
    clear
    copy;*
    file ViewListBorder
    paste
    b
    do
        if (!eof)
+          Newline = '@line@+FGB'
+          r:/@Newline@/
+       endif
        f;1
    until (eof)
    file WindowNav
    b
    do-nav  
        DeleteRec = 'n'
        if (!eof)
+          scan:/@line/:/_/
+          scan:/@right/:/_/
+          SearchString = ',@left@+FGB'
+          file ViewListBorder //message = 'Checking 1 [@SearchString@]' window message info ok
+          b
+          fs:/@SearchString@/
+          if (eof)
+             file WindowNav
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             SearchString = ',@left@+FGB'
+             file ViewListBorder //message = 'Checking 2 [@SearchString@]' window message info ok
+             b
+             fs:/@SearchString@/
+             if (eof)
+                DeleteRec = 'y' //message = 'deleting 1' window message info ok
+       endif
        file WindowNav
        if  (DeleteRec)
+           //message = 'deleting 2[@line@]' window message info ok
+           d;1  
+       else
+           //message = 'Keeping 2[@line@]' window message info ok
+           f;1  
+       endif
    until-nav (eof) 
    close ViewListBorder  

    //write WindowNav ViewWindowNavTemp.dat 

    //*********************
    //* Add windows touched
    //*********************
    close ViewListAdd error
    open ViewListAdd null
    file ViewList
    b
!a550_filter_ok_add_touched_loop
    if (eof) goto !a550_filter_touched_done
    scan:/@line/:/,/
    WindowName = right

    file ViewListTemp
    b
    clear
    copy;*
    close ViewListFGB error
    open ViewListFGB null
    paste
    b
    do
        if (!eof)
+          Newline = '@line@+FGB'
+          r:/@Newline@/
+       endif
        f;1
    until (eof)

    file WindowNav
    b

!a550_filter_find_window_loop
    SearchString = "_@WindowName@_"
    fs:/@SearchString@/
    if (eof) goto !a550_filter_touched_next

    scanr:/@line/:/,/
    if (right != 'open') goto !a550_filter_touched_test2
    scan:/@line/:/_/
    scan:/@right/:/_/
    SearchString = left //message = 'Search1[@SearchString@]' window message info ok
    if  (SearchString != WindowName)
+       file ViewListFGB 
+       b
+       SearchString = ',@SearchString@+FGB'
+       fs:/@SearchString@/
+       if (!eof)
+          call !a550_add_filter_window
+   endif

!a550_filter_touched_test2
    file WindowNav
    scanr:/@line/:/,/
    if (right != 'open') goto !a550_filter_find_Window_next
    scan:/@line/:/,/
    scan:/@right/:/,/
    SearchString = left //message = 'Search2[@SearchString@]' window message info ok
    if  (SearchString != WindowName)
+       file ViewListFGB 
+       b
+       SearchString = ',@SearchString@+FGB'
+       fs:/@SearchString@/
+       if (!eof)
+          call !a550_add_filter_window    
+   endif

!a550_filter_find_Window_next
    //***********************
    //* Next WindowNav Record
    //***********************
    file WindowNav
    f;1
    goto !a550_filter_find_window_loop

!a550_filter_touched_next
    //***********************
    //* Next ViewList Record
    //***********************
    file ViewList
    f;1
    goto !a550_filter_ok_add_touched_loop

!a550_filter_touched_done
    close ViewListFGB error
    file ViewListAdd
    b
    clear
    copy;*
    //write ViewListAdd ViewListAdd.dat
    close ViewListAdd

    file ViewList
    f;*
    paste
    //write ViewList ViewWindowListTemp.dat

    //*********************
    //* Delete View Objects
    //*********************
    file ViewObjects error goto !a550_no_objects
    b
    do
        if (!eof)
+          window deletecontrol @line error
+       endif
        f;1
    until (eof)
    close ViewObjects

!a550_no_objects
    window paint Builder_View_WIN
    //message = 'fresh screen' window message info ok

    //*********************
    //* Redraw the View
    //*********************
    call !v200_viewlist_push_levels_down
    //call !v200_viewlist_eliminate_gaps
    call !v100_view_redraw
    window paint Builder_View_WIN

    //*********************
    //* Restore ViewList
    //*********************
    file ViewListTemp
    b
    clear
    copy;*
    file ViewList
    b
    d;*
    paste
    close ViewListTemp


    //*********************
    //* Restore WindowNav
    //*********************
    file WindowNavTemp
    b
    clear
    copy;*
    file WindowNav
    b
    d;*
    paste
    close WindowNavTemp

//    if  (!ClickFilter)
//+       window close Builder_Filter_WIN error
//+   endif
    window hwnd Builder_Filter_WIN status error goto !a550_noclose
    window close Builder_Filter_WIN
!a550_noclose
    ClickFilter = 'n'
    window paint Builder_View_WIN
    window pointer arrow
    return


//****************************
//* Add data to ViewListAdd
//****************************
!a550_add_filter_window
    //message = 'Check Add [@line@]' window message info ok
    Newline = line
    scan:/@Newline/:/+FGB/
    Newline = left
    file ViewListAdd
    b
    fs:/@Newline@/
    if  (eof) i:/@Newline@/ //message = 'Added[@Newline@]' window message info ok
    return
    

//******************************
//* Close the Filter Window
//******************************
!a550_Builder_Filter_Cancel_PBOBJ
    window pointer wait
    //*********************
    //* Delete View Objects
    //*********************
    file ViewObjects error goto !a550_cancel_next
    b
    do
        if (!eof)
+          window deletecontrol @line error
+       endif
        f;1
    until (eof)
!a550_cancel_next
    close ViewObjects error
    call !v100_view
    window close Builder_Filter_WIN
    window paint Builder_View_WIN
    window pointer arrow
    return

//******************************
//* Filter List Action
//******************************
!a550_Builder_Filter_Windowlist_LBOBJ
    call !a550_Builder_Filter_OK_PBOBJ
    return

//******************************
//* Filter List Action
//******************************
//******************************
//* View Comments
//******************************
!a550_Builder_Filter_Comments_PBOBJ
    window obtain Builder_Filter_WIN
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = "Please select a window/process"
+       window message error ok
+       return
+   endif 

    window pointer wait
    window hwnd Builder_Comments_WIN status error window open Builder_Comments_WIN shade
    window clear Builder_Comments_WIN    
    window center Builder_Comments_WIN

    scan:/@Builder_Filter_Windowlist_LBOBJ/:word
    Builder_Comments_Module_STTXT = left
    pack Builder_Comments_Module_STTXT
    window modify Builder_Comments_Module_STTXT
    //*************************************
    //* Fill the Window comments
    //*************************************
    if  (ViewCobol) and (Extension = 'COB')
+       call !j100_cobol_comments
+   endif
    if  (ViewCobol) and (Extension = 'BED')
+       call !j200_bedit_comments
+   endif
    if  (ViewCobol) and (Extension = 'C')
+       call !j300_c_comments
+   endif
    if  (ViewCobol) and (Extension = 'JAVA')
+       //call !j400_java_comments
+   endif

    window disable Builder_Comments_Comments_LBOBJ
    window unshade Builder_Comments_WIN
    window setfocus Builder_Comments_WIN
    window pointer arrow
    return

//******************************
//* View code module
//******************************
!a550_Builder_Filter_View_PBOBJ
    if  (!ClickView)
+       window obtain Builder_Filter_WIN
+   endif
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = "Please select a window/process"
+       window message error ok
+       return
+   endif
    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /
    Builder_Filter_Windowlist_LBOBJ = left
    close ProgModule error
    open ProgModule null

    //*************************************
    //* Fill the Window comments
    //*************************************
    if  (ViewCobol) and (Extension = 'COB')
+       call !k100_cobol_module
+   endif
    if  (ViewCobol) and (Extension = 'BED')
+       call !k200_bedit_module
+   endif
    if  (ViewCobol) and (Extension = 'C')
+       call !k300_c_module
+   endif
    if  (ViewCobol) and (Extension = 'JAVA')
+       //call !k400_java_module
+   endif

    write ProgModule ProgModule.txt
    MacroCommand = 'start ProgModule.txt'
    system:"@MacroCommand@"
    return
    

//******************************
//* Close Comments Window
//******************************
!a560_Builder_Comments_OK_PBOBJ
    window close Builder_Comments_WIN
    return

//******************************
//* Search for COBOL files
//******************************
!a600_Builder_Import_Lookup_PBOBJ
    window obtain Builder_Import_WIN
    if  (Builder_Import_Extension_EFOBJ = null)
+       message = 'Please enter an Extension'
+       window message error ok
+       window setfocus Builder_Import_Extension_EFOBJ
+       return
+   endif
    //**************************
    //* Fix entered Extension
    //**************************
    scan:/@Builder_Import_Extension_EFOBJ@/:/./
    if (found)
+      Builder_Import_Extension_EFOBJ = '@left@@right@'
+   endif
    upper Builder_Import_Extension_EFOBJ
    crush Builder_Import_Extension_EFOBJ
    window modify Builder_Import_Extension_EFOBJ

    if  (Builder_Import_Extension_EFOBJ != 'COB') and (Builder_Import_Extension_EFOBJ != 'BED') and (Builder_Import_Extension_EFOBJ != 'C') and (Builder_Import_Extension_EFOBJ != 'JAVA')
+       message = 'Extension must = 'JAVA (Java), COB (COBOL), BED (BEDIT), C (C code)'
+       window message error ok
+       window setfocus Builder_Import_Extension_EFOBJ
+       return
+   endif
    window pointer wait
    if  (Builder_Import_Directory_EFOBJ = null)
+       MacroCommand = 'dir *.@Builder_Import_Extension_EFOBJ@'
+   else
+       MacroCommand = 'dir @Builder_Import_Directory_EFOBJ@\*.@Builder_Import_Extension_EFOBJ@'
+   endif

    Directory = Builder_Import_Directory_EFOBJ
    Extension = Builder_Import_Extension_EFOBJ  

    open Cobolfiles null
    b d;*
    systemcurr:"@MacroCommand@"
    b
    b
    d;5
    f;*
    b;1
    d;*
    b
    Builder_Import_Files_COOBJ = 'ALL'
    window delete Builder_Import_Files_COOBJ
    window paint Builder_Import_Files_COOBJ
    do
       if (!eof) 
+         scan:/@line/:word
+         scan:/@right/:word
+         scan:/@right/:word
+         scan:/@right/:word
+         Builder_Import_Files_COOBJ = right
+         window insert end default Builder_Import_Files_COOBJ
+         r:/@left@/
+      endif
       f;1
    until (eof)
    close Cobolfiles
    window pointer arrow
    return

//******************************
//* Import a COBOL program
//******************************
!a600_Builder_Import_3090_PBOBJ
    window pointer wait
    window conceal Builder_3090_Password_EFOBJ
    window hwnd Builder_3090_WIN status error window open Builder_3090_WIN shade
    window center Builder_3090_WIN
    window clear Builder_3090_WIN

    //*************************
    //* Update Userid/Password
    //*************************
    if  (Userid3090 != null)
+       Builder_3090_Userid_EFOBJ = Userid3090
+       window modify Builder_3090_Userid_EFOBJ
+   endif
    if  (Password3090 != null)
+       Builder_3090_Password_EFOBJ = Password3090
+       window modify Builder_3090_Password_EFOBJ
+   endif

    //*************************
    //* Update Login Loc
    //*************************
    if (LoginLoc3090 = 'test')
+      Builder_3090_Test_RBOBJ = 'Y'
+      Builder_3090_Prod_RBOBJ = 'N'
+   else
+      Builder_3090_Test_RBOBJ = 'N'
+      Builder_3090_Prod_RBOBJ = 'Y'
+   endif
    window modify Builder_3090_Prod_RBOBJ
    window modify Builder_3090_Test_RBOBJ

    //*************************
    //* Update Source Loc
    //*************************
    if  (SourceLoc3090 = 'test')
+      Builder_3090_Testsrc_RBOBJ = 'Y'
+      Builder_3090_Prodsrc_RBOBJ = 'N'
+   else
+      Builder_3090_Testsrc_RBOBJ = 'N'
+      Builder_3090_Prodsrc_RBOBJ = 'Y'
+   endif
    window modify Builder_3090_Prodsrc_RBOBJ
    window modify Builder_3090_Testsrc_RBOBJ

    //*************************
    //* Update User Full Filename
    //*************************
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/(/
    if (found) Userfilename3090 = '@left@()'
    Builder_3090_Fullname_EFOBJ = Userfilename3090
    window modify Builder_3090_Fullname_EFOBJ

    if (Builder_3090_Userid_EFOBJ != null)
+      if  (Builder_3090_Fullname_EFOBJ = null)
+          window setfocus Builder_3090_Filename_EFOBJ
+   endif
    if (Builder_3090_Userid_EFOBJ != null)
+      if  (Builder_3090_Fullname_EFOBJ != null)
+          window setfocus Builder_3090_Fullname_EFOBJ
+   endif
    
    window unshade Builder_3090_WIN
    window setfocus Builder_3090_WIN
    window pointer arrow
    return

//******************************
//* Import a program
//******************************
!a600_Builder_Import_OK_PBOBJ
    ViewSingleProg = 'y'

    window obtain Builder_Import_WIN

    if  (Builder_Import_Extension_EFOBJ = 'java') or (Builder_Import_Extension_EFOBJ = 'JAVA')
+       Builder_Import_Extension_EFOBJ = 'JAVA'
+       window modify Builder_Import_Extension_EFOBJ
+       Extension = Builder_Import_Extension_EFOBJ
+   endif
    if  (Builder_Import_Files_COOBJ != null)
+       if  (Builder_Import_Directory_EFOBJ = null)
+           Builder_Import_Filename_EFOBJ = Builder_Import_Files_COOBJ
+   endif
    if  (Builder_Import_Files_COOBJ != null)
+       if  (Builder_Import_Directory_EFOBJ != null)
+           Builder_Import_Filename_EFOBJ = '@Builder_Import_Directory_EFOBJ@\@Builder_Import_Files_COOBJ@'
+   endif
    window modify Builder_Import_Filename_EFOBJ

    crush Builder_Import_Filename_EFOBJ
    if (Builder_Import_Filename_EFOBJ = null) and (Extension != 'JAVA')
+      message = 'Please enter a Filename"
+      window message error ok
+      window setfocus Builder_Import_Filename_EFOBJ
+      return
+   else
+      if (Extension = 'JAVA')
+         goto !a600_Builder_Import_OK_java
+   endif

!a600_Builder_Import_OK_bedit_batch
    scanr:/@Builder_Import_Filename_EFOBJ@/:/./
    if  (!found)
+       goto !a600_bad_extension
+   endif
    Extension = right
    upper Extension

    if (Extension = 'COB') goto !a600_good_extension
    if (Extension = 'BED') goto !a600_good_extension
    if (Extension = 'C') goto !a600_good_extension
    if (Extension = 'JAVA') goto !a600_good_extension

!a600_bad_extension
    message = 'Extension must = 'COB (COBOL), BED (BEDIT), C (C), JAVA (Java)'
    window message error ok
    window setfocus Builder_Import_Filename_EFOBJ
    return

!a600_good_extension
    Builder_Import_Extension_EFOBJ = right
    window modify Builder_Import_Extension_EFOBJ
    window pointer wait
    SystemName = Builder_Import_Filename_EFOBJ

    close SOURCECODE error

    open SOURCECODE @Builder_Import_Filename_EFOBJ error goto !a600_Builder_Import_Nofile

!a600_Builder_Import_OK_java
    close ViewFilterList error
    open ViewFilterList null

    if  (Extension = 'COB') call !i100_import_cobol
    if  (Extension = 'BED') call !i200_import_bedit
    if  (Extension = 'C') call !i300_import_c
    if  (Extension = 'JAVA') call !i400_import_java

    //window close Builder_Import_WIN
    close BuilderWindowFile error
    close WindowList error
    open WindowList null
    close WindowNav error
    if  (Extension = 'COB') open BuilderWindowFile @CobolWinName error return
    if  (Extension = 'BED') open BuilderWindowFile @BeditCodeWinName error return
    if  (Extension = 'C') open BuilderWindowFile @CCodeWinName error return
    if  (Extension = 'JAVA') open BuilderWindowFile @JavaCodeWinName error return
    b
    do
        if (!eof)
+          split:/@line/;6
+          if  (left = 'WINDOW')
+              call !a600_builder_inport_windowname
+              file WindowList
+              i:/@WindowName@/
+       endif
        file BuilderWindowFile
        f;1
    until (eof)

    if  (Extension = 'COB') open WindowNav @CobolNavName
    if  (Extension = 'BED') open WindowNav @BeditCodeNavName
    if  (Extension = 'C') open WindowNav @CCodeNavName
    if  (Extension = 'JAVA') open WindowNav @JavaCodeNavName

    ViewCobol = 'y'
    call !a300_Builder_Window_View_PBOBJ_2
    ViewCobol = 'y'
    return

!a600_builder_inport_windowname
    scan:/@line/:/,/
    scan:/@right/:/,/
    WindowName = left
    scan:/@WindowName@/:/_/
    if (found)
+      scan:/@right/:/_/
+      WindowName = left
+   endif
    return

!a600_Builder_Import_Nofile
    window pointer arrow
    message = 'Unable to open @Builder_Import_Filename_EFOBJ@'
    window message error ok
    return

//******************************
//* Cancel View
//******************************
!a600_Builder_Import_Cancel_PBOBJ
    window close Builder_Import_WIN
    close BuilderWindowFile error
    close WindowNav error
    close WindowList error
    return

//******************************
//* Import Directory Lookup
//******************************
!a600_Builder_Import_Browse_PBOBJ
    DirField = "Builder_Import_Directory_EFOBJ"
    FileField = "Builder_Import_Filename_EFOBJ"
    window obtain Builder_Import_Directory_EFOBJ
    Directory = Builder_Import_Directory_EFOBJ
    window obtain Builder_Import_Extension_EFOBJ
    Extension = Builder_Import_Extension_EFOBJ
    call !s100_directory
    return

//******************************
//* Copy Directory Lookup
//******************************
!a600_Builder_Import_Copydir_PBOBJ
    DirField = "Builder_Import_Copydir_EFOBJ"
    FileField = null
    window obtain Builder_Import_Copydir_EFOBJ
    Directory = Builder_Import_Copydir_EFOBJ
    call !s100_directory
    return

//******************************
//* 3090 OK - Download COBOL
//******************************
!a650_Builder_3090_Ok_PBOBJ
    window obtain Builder_3090_WIN

    //*************************
    //* Save 3090 Fields
    //*************************
    crush Builder_3090_Userid_EFOBJ
    if (Builder_3090_Userid_EFOBJ = 'null')
+      message = 'Please enter a 3090 Userid'
+      window message error ok
+      window setfocus Builder_3090_Userid_EFOBJ
+      return
+   endif
    crush Builder_3090_Password_EFOBJ
    if (Builder_3090_Password_EFOBJ = 'null')
+      message = 'Please enter a 3090 Password'
+      window message error ok
+      window setfocus Builder_3090_Password_EFOBJ
+      return
+   endif

    Userid3090 = Builder_3090_Userid_EFOBJ
    Password3090 = Builder_3090_Password_EFOBJ
    if (Builder_3090_Test_RBOBJ)
+      LoginLoc3090 = 'test'
+   else
+      LoginLoc3090 = 'prod'
+   endif

    if (Builder_3090_Testsrc_RBOBJ)
+      SourceLoc3090 = 'test'
+   else
+      SourceLoc3090 = 'prod'
+   endif 

    crush Builder_3090_Fullname_EFOBJ
    Userfilename3090 = Builder_3090_Fullname_EFOBJ
    if (Builder_3090_Fullname_EFOBJ = null) goto !a650_fullname_done
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/(/
    if (found)
+      scan:/@Userfilename3090@/:/)/
+   endif
    if (!found)
+      message = 'Invalid file name, must contain ()'
+      window message error ok
+      window  setfocus Builder_3090_Fullname_EFOBJ
+      return
+   endif

!a650_fullname_done
    crush Builder_3090_Filename_EFOBJ
    if (Builder_3090_Filename_EFOBJ = 'null') and (Builder_3090_Fullname_EFOBJ = 'null')
+      message = 'Please enter a File Name'
+      window message error ok
+      window setfocus Builder_3090_Filename_EFOBJ
+      return
+   endif    

    //*****************************************
    //* FTP get the COBOL source from the 3090
    //*****************************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/

    if (SourceLoc3090 = 'test') and (Builder_3090_Fullname_EFOBJ = null)
+      Programname3090 = '@Builder_3090_Filename_EFOBJ@.cob'
+      Newline = "get '@Testsrcelib3090@(@Builder_3090_Filename_EFOBJ@)' @Programname3090@"
+      goto !a650_ftp
+   endif
    if (SourceLoc3090 = 'prod') and (Builder_3090_Fullname_EFOBJ = null)
+      Programname3090 = '@Builder_3090_Filename_EFOBJ@.cob'
+      Newline = "get '@Prodsrcelib3090@(@Builder_3090_Filename_EFOBJ@)' @Programname3090@"
+      goto !a650_ftp
+   endif
    scan:/@Builder_3090_Fullname_EFOBJ@/:/(/
    scan:/@right/:/)/
    Programname3090 = '@left@.cob'
    Newline = "get '@Builder_3090_Fullname_EFOBJ@' @Programname3090@"

!a650_ftp
    //**********************************
    //* Remove Old File
    //**********************************
    MacroCommand = 'system:"del @Programname3090@"'
    $MacroCommand

    //**********************************
    //* FTP Get
    //**********************************
    i:/@Newline@/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"
    window pointer arrow

    MacroCommand = "    if (!exists @Programname3090@) goto !a650_bad_ftp" $MacroCommand
    //open CobolFile @Programname3090 error goto !a650_bad_ftp
    //close CobolFile
    window close Builder_3090_WIN
    Builder_Import_Filename_EFOBJ = Programname3090
    window modify Builder_Import_Filename_EFOBJ
    Builder_Import_Extension_EFOBJ = 'COB'
    window modify Builder_Import_Extension_EFOBJ
    Builder_Import_Files_COOBJ = null
    window modify Builder_Import_Files_COOBJ
    COBOL3090 = 'y'
    call !a600_Builder_Import_OK_PBOBJ
    return

!a650_bad_ftp
    message = 'Error downloading file from 3090'
    window message error ok
    return   


//******************************
//* Close 3090 Download Screen
//******************************
!a650_Builder_3090_Cancel_PBOBJ
    window close Builder_3090_WIN
    return

//******************************
//* Set the Entry Field Action
//******************************
!a700_Builder_Entryaction_Set_PBOBJ
    window obtain Builder_Entryaction_WIN
    if  (Builder_Entryaction_Size_EFOBJ < 1)
+       message = 'Field Size must be > 0'
+       window message error ok
+       return
+   endif
    if  (Builder_Entryaction_Size_EFOBJ > 100)
+       message = 'Field Size must be <= 100'
+       window message error ok
+       return
+   endif
    EntryFieldAction = null
    if  (Builder_Entryaction_Alpha_RBOBJ) EntryFieldAction = 'alpha'
    if (Builder_Entryaction_Numeric_RBOBJ) EntryFieldAction = 'numeric'
    if (Builder_Entryaction_Uppercase_RBOBJ) EntryFieldAction = 'upper'
    if (Builder_Entryaction_Lowercase_RBOBJ) EntryFieldAction = 'lower'
    if (Builder_Entryaction_Mixedcase_RBOBJ) EntryFieldAction = 'mix'
    if (Builder_Entryaction_Date_RBOBJ) EntryFieldAction = 'date'
    if (Builder_Entryaction_Dollar_RBOBJ) EntryFieldAction = 'dollar' 
    if (Builder_Entryaction_Phone_RBOBJ) EntryFieldAction = 'telephone' Builder_Entryaction_Size_EFOBJ = '14' window modify Builder_Entryaction_Size_EFOBJ
    if (Builder_Entryaction_Text_RBOBJ) EntryFieldAction = 'text'
    if  (EntryFieldAction = null)
+       message = 'Please select an Action'
+       window message error ok
+       return
+   endif

    //message = '[Password[@Builder_Entryaction_Password_CBOBJ@]' window message info ok
    if (Builder_Entryaction_Password_CBOBJ) EntryFieldAction = '@EntryFieldAction@-P'

    Newline = '@Builder_Control_Control_EFOBJ@,@EntryFieldAction@,@Builder_Entryaction_Size_EFOBJ@'
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (!eof)
+      r:/@Newline/
+   else
+      i:/@Newline/
+   endif

    window close Builder_Entryaction_WIN
    return

//******************************
//* Delete the Entry Field Action
//******************************
!a700_Builder_Entryaction_Delete_PBOBJ
    message = 'Are you sure?'
    window message question yesno
    if  (!message) return
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (!eof)
+      d
+   endif
    window close Builder_Entryaction_WIN
    return

//******************************
//* Set the Entry Field Action
//******************************
!a700_Builder_Entryaction_Cancel_PBOBJ
    window close Builder_Entryaction_WIN
    return

//******************************
//* Callflow Directory Lookup
//******************************
!a800_Builder_Callflow_Directory_PBOBJ
    DirField = "Builder_Callflow_Directory_EFOBJ"
    FileField = null
    window obtain Builder_Callflow_Directory_EFOBJ
    Directory = Builder_Callflow_Directory_EFOBJ
    call !s100_directory
    return

//******************************
//* Build the COBOL Callflow
//******************************
!a800_Builder_Callflow_Ok_PBOBJ
    ViewSingleProg = 'n'
    //message = "Builder_Callflow_Ok_PBOBJ" window message info ok
    if  (Reenter) 
+       window setfocus Builder_Progress_Cancel_PBOBJ
+       window paint Builder_Progress_WIN
+       goto !a800_Builder_Callflow_Reenter
+   endif
    string CobolFilename    error
    string CobolFromName    error
    string CobolToName      error

    window obtain Builder_Callflow_Directory_EFOBJ
    pack Builder_Callflow_Directory_EFOBJ
    if  (Builder_Callflow_Directory_EFOBJ = null)
+       message = "Please enter a directory"
+       window message error ok
+       window setfocus Builder_Callflow_Directory_EFOBJ
+       return
+   endif 
    Directory = Builder_Callflow_Directory_EFOBJ

    MacroCommand = "dir @Builder_Callflow_Directory_EFOBJ@\*.cob"

    close CobolCalls error
    open CobolCalls null
    i:/999999 PROCEDURE DIVISION./

    close CobolList error
    open CobolList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b

    write CobolList CobolList.dat
    b

    window hwnd Builder_Progress_WIN status error window open Builder_Progress_WIN shade
    window center Builder_Progress_WIN
    window windowpos Builder_Progress_Progressframe_STTXT Progframex Progframey Progframecx Progframecy
    window windowpos Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    window size Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    ProgressMax = Progcx - 4

    f;*
    ProgressCount = pcount + 1

    if (ProgressCount) Progress = Progcx / ProgressCount
    //message = 'Files[@ProgressCount@] Progress[@Progress@] Progcx[@Progcx@]' window message info ok    
    b

    Progx += 2
    Progy += 2
    Progcx = 1
    Progcy -= 4
    window size Builder_Progress_Progress_STTXT Progx Progy Progcx Progcy
    ProgressShow = Progcx
    window unshade Builder_Progress_WIN
    window setfocus Builder_Progress_WIN

!a800_Builder_Callflow_Reenter
!a800_dirlist_loop
    if (eof) goto !a800_dirlist_done
    ProgressWork = ProgressShow + Progress
    Progcx = ProgressWork
    if  (Progcx > ProgressMax) 
+       Progcx = ProgressMax
+   endif
    ProgressShow = ProgressWork
    window size Builder_Progress_Progress_STTXT @Progx @Progy @Progcx @Progcy
    window size Builder_Progress_Progressframe_STTXT @Progframex @Progframey @Progframecx @Progframecy
    window modify Builder_Progress_Progress_STTXT
    window paint Builder_Progress_Progress_STTXT
    window modify Builder_Progress_Progressframe_STTXT
    window paint Builder_Progress_Progressframe_STTXT
    window paint Builder_Progress_WIN
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    CobolFilename = '@Builder_Callflow_Directory_EFOBJ@\@right@'
    CobolFromName = right
    scan:/@CobolFromName@/:/-/
    if (found) goto !a800_next_cobol
    scan:/@CobolFromName@/:/./
    CobolFromName = left
    close SOURCECODE error
    //message = 'reading[@CobolFilename@] Progress x[@Progx@] y[@Progy@] Progcx[@Progcx@] Progcy[@Progcy@]' window message info ok
    open SOURCECODE @CobolFilename error goto !a800_next_cobol
    //*****************************
    //* Find CICS LINK
    //*****************************
    //message = 'EXEC CICS LINK' window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_transfer_control
    do
        if (eof) goto !a800_transfer_control
        fs:/EXEC CICS LINK/
        if (eof) goto !a800_transfer_control 
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_cics
        scan:/@line/:/ PROGRAM/
        if (!found) goto !a800_next_cics
        scan:/@right/:/'/
        if  (!found) goto !a800_next_cics
        scan:/@right/:/'/
        if  (!found) goto !a800_next_cics
        CobolToName = left
        crush CobolToName
 
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_cics
        file SOURCECODE
        f;1
    until (EOF)

!a800_transfer_control
    //*****************************
    //* Find TRANSFER CONTROL
    //*****************************
    //message = 'TRANSFER CONTROL' window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_call_cobol
    do
        if (eof) goto !a800_call_cobol
        fs:/ TRANSFER CONTROL /
        if (eof) goto !a800_call_cobol
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_transfer
        scan:/@line/:/ TRANSFER CONTROL /
        if (!found) goto !a800_next_transfer
        scan:/@right/:/'/
        if  (!found) goto !a800_next_transfer
        scan:/@right/:/'/
        if  (!found) goto !a800_next_transfer
        CobolToName = left
        crush CobolToName
  
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_transfer
        file SOURCECODE
        f;1
     until (eof)    

!a800_call_cobol
    //*****************************
    //* CALL ' '
    //*****************************
    //message = |CALL ' '| window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_next_cobol
    do
        if (eof) goto !a800_next_cobol
        fs:/ CALL /
        if (eof) goto !a800_next_cobol
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_call
        scan:/@line/:/ CALL /
        if (!found) goto !a800_next_call
        scan:/@right/:/'/
        if  (!found) goto !a800_next_call
        scan:/@right/:/'/
        if  (!found) goto !a800_next_call
        CobolToName = left
        crush CobolToName
  
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_call
        file SOURCECODE
        f;1
     until (eof)    

!a800_next_cobol
    file CobolList
    f;1

    if  (!eof)
+       //*****************************************
+       //* Push OK again and re-enter this process
+       //* Allows for repainting the progress
+       //*****************************************
+       Reenter = 'y' //message = 'pushing Builder_Callflow_Ok_PBOBJ' window message info ok
+       window push Builder_Callflow_Ok_PBOBJ
+       return
+   endif

    goto !a800_dirlist_loop

!a800_dirlist_done 
    Reenter = 'n'
    //*****************************
    //* Remove programs w/o calls
    //*****************************
    goto !a800_pass_del
    file CobolCalls
    b
    do  
        b
        fs:/000000 /
        if (!eof)
+          rs:/000000 /:/999999 /
+       endif 
        if (!eof)
+          split:/@line/;7
+          split:/@right/;1
+          if (left != ' ')
+          f;1
+          scan:/@line/:/ PERFORM /
+          if (!found)
+             b;1
+             d;1
+       endif
    until (eof)
    scan:/@line/:/ PROCEDURE DIVISION/
    if (!found)
+      scan:/@line/:/ PERFORM /
+      if (!found)
+         d
+   endif

!a800_pass_del

    write CobolCalls COBOLCALLS.COB
    close CobolCalls
    //*****************************
    //* Setup for View call
    //*****************************
    //Builder_Import_Directory_EFOBJ = null
    //Directory = null
    Builder_Import_Filename_EFOBJ = 'COBOLCALLS.COB'
    Builder_Import_Extension_EFOBJ = 'COB'
    Extension = 'COB'
    Builder_Import_Files_COOBJ = null
    window close Builder_Progress_WIN
    call !a600_good_extension
    return

//******************************
//* Close the COBOL Callflow Selection Window
//******************************
!a800_Builder_Callflow_Cancel_PBOBJ
    window close Builder_Callflow_WIN
    return

/******************************
//* POM Directory Lookup
//******************************
!a850_Builder_POM_Directory_PBOBJ
    DirField = "Builder_POM_Directory_EFOBJ"
    FileField = null
    window obtain Builder_POM_Directory_EFOBJ
    Directory = Builder_POM_Directory_EFOBJ
    call !s100_directory
    return
//******************************
//* Close the POM Viewer Selection Window
//******************************
!a850_Builder_POM_Cancel_PBOBJ
    window close Builder_POM_WIN
    return

//******************************
//* Build the POM Dependency
//******************************
!a850_Builder_POM_Ok_PBOBJ
    ViewSingleProg = 'n'

    string POMFilename    error
    string POMFromName    error
    string POMToName      error
    int    POMCounter     error

    close POMMain error
    open POMMain null
    close POMCalls error
    open POMCalls null

    close POMDependencies error
    open POMDependencies null

    window obtain Builder_POM_Directory_EFOBJ
    pack Builder_POM_Directory_EFOBJ
    if  (Builder_POM_Directory_EFOBJ = null)
+       message = "Please enter a directory"
+       window message error ok
+       window setfocus Builder_POM_Directory_EFOBJ
+       return
+   endif 
    Directory = Builder_POM_Directory_EFOBJ

    Extension = 'xml'
    close DirFileList error
    call BuilderDirList.bed
    //message = 'POM Filelist created' window message info ok
    file DirFileList
    b
    case off
    do
        if  (!eof)
+           pattern on 
+           scan:/@line/:/pom*.xml/
+           pattern off
+           if (!found)
+              d
+              b;1
+       endif
        f;1
    until (eof)
    case on
    write DirFileList POMList.dat
    file DirFileList
    b

!a850_dirlist_loop
    if (eof) goto !a850_dirlist_done

    POMFilename = line
    POMFromName = line
    scan:/@POMFromName@/:/./
    POMFromName = left
    close SOURCECODE error
    open SOURCECODE @POMFilename error goto !a850_next_POM
    //*****************************
    //* Find First artifactId
    //*****************************
    b
    fs:'</parent>'
    if  (eof)
+       b
+   endif
    fs:/<artifactId>/
    if (eof) goto !a850_next_POM
    scan:/@line/:/<artifactId>/
    scan:/@right/:/</
    POMFromName = left

    //*****************************
    //* Add the From name to POMMain
    //*****************************
    file POMMain
    b
    do 
        fs:/@POMFromName@/
        if (!eof)
+          if  (POMFromName = line)
+              goto !a850_from_exists
+       endif
        f;1
    until (eof)
    i:/@POMFromName/
    write POMMain POMMain.dat

!a850_from_exists
    file SOURCECODE
    f;1

    do-1
        fs:/<artifactId>/
        if  (!eof)
+           scan:/@line/:/<artifactId>/
+           scan:/@right/:/</
+           POMToName = left
+           Newline = '[@POMFromName@]=>[@POMToName@]'
+           file POMDependencies
+           b
+           fs:/@Newline/
+           if  (eof)
+               i:/@Newline@/
+       endif
        //*****************************
        //* Add the To name to POMCalls
         //*****************************
        file POMCalls
        b
        do-2 
            fs:/@POMToName@/
            if-1 (eof)
+              i:/@POMToName/
+           else-1
+              if-2  (POMToName = line)
+                  goto !a850_To_exists
+           endif
            f;1
        until-2 (eof)
        write POMCalls POMCalls.dat

!a850_To_exists       
        file SOURCECODE
        f;1
    until-1 (EOF)
    close SOURCECODE 

!a850_next_POM
    file DirFileList
    f;1
    goto !a850_dirlist_loop

!a850_dirlist_done 
    //*******************************
    //* Remove names in POMCalls if in POMMain
    //*******************************
    file POMCalls
    b
    do
        if  (!eof)
+           POMToName = line
+           call !a850_delete_POMCalls
+       endif
        file POMCalls
        f;1
    until (eof)
    write POMCalls POMCalls.dat2

    //*******************************
    //* Number the Main names
    //*******************************
    file POMMain
    b
    POMCounter = 100
    do
        if  (!eof)
+           Newline = '@POMCounter@-@line@]'
+           r:/@Newline/
+           POMCounter ++
+       endif
        f;1
    until (eof)
    //*******************************
    //* Number the Call names
    //*******************************
    file POMCalls
    b
    POMCounter = 500
    do
        if  (!eof)
+           Newline = '@POMCounter@-@line@]'
+           r:/@Newline/
+           POMCounter ++
+       endif
        f;1
    until (eof)

    //*******************************
    //* Number the Dependencies names
    //*******************************
    string POMLastMain error
    POMLastMain = null
    string SearchString error
    file POMDependencies
    b
    do
        if-1  (!eof)
+           split:/@line/;1
+           scan:/@right/:/]=>[/
+           POMFromName = left
+           scan:/@right/:/]/
+           POMToName = left
+           SearchString = '@POMFromName@]'
+           file POMMain
+           b
+           fs:/@SearchString@/
+           POMFromName = line
+           SearchString = '@POMToName@]'
+           file POMCalls
+           b
+           fs:/@SearchString@/
+           if-2 (eof)
+              file POMMain
+              b
+              fs:/@SearchString@/
+              POMToName = line
+              Newline = '000000     PERFORM @POMToName@'
+              call !a850_add_main
+           else-2
+              POMToName = line
+              Newline = '000000     PERFORM @POMToName@'
+              call !a850_add_main
+       endif
        file POMDependencies
        f;1
    until (eof)
    b
    ib:/000000 PROCEDURE DIVISION./
    rs:/]/://;*

    write POMDependencies POMDependencies.COB
    close POMDependencies
    close DirFileList
    //*****************************
    //* Setup for View call
    //*****************************
    //Builder_Import_Directory_EFOBJ = null
    //Directory = null
    Builder_Import_Filename_EFOBJ = 'POMDependencies.COB'
    Builder_Import_Extension_EFOBJ = 'COB'
    Extension = 'COB'
    Builder_Import_Files_COOBJ = null
    //message = 'Rendering POM Dependencies' window message info ok
    call !a600_good_extension
    return

!a850_delete_POMCalls
    file POMMain
    b
    do
        fs:/@POMToName/
        if  (!eof)
+           if  (POMToName = line)
+               //message = 'deleting [@line@]' window message info ok
+               file POMCalls
+               d;1
+               b;1
+               return
+       endif
    until (eof)
    return

!a850_add_main
    if  (POMFromName = POMLastMain)
+       file POMDependencies
+       r:/@Newline/
+       return
+   endif
    POMLastMain = POMFromName
    file POMDependencies
    r:/@Newline@/
    Newline = '000000 @POMFromName@'
    ib:/@Newline/
    f;1
    return

//******************************
//* Change Object Text Font
//******************************
!a875_Builder_Textedit_Font_PBOBJ
    window obtain Builder_Textedit_Font_COOBJ
    pack Builder_Textedit_Font_COOBJ
    if  (Builder_Textedit_Font_COOBJ = null) return
    TextFont = Builder_Textedit_Font_COOBJ
!a875_modify_text
    window obtain Builder_Textedit_Text_EFOBJ
    Builder_Control_ControlText_EFOBJ = Builder_Textedit_Text_EFOBJ
    window modify Builder_Control_ControlText_EFOBJ
    Newline = 'Builder_Control_WIN,@TextName@,TextTilt,@TextX@,@TextY@,@TextCX@,@TextCY@,@TextRed@,@TextGreen@,@TextBlue@,@TextFont@,@Builder_Textedit_Text_EFOBJ@'
    //message = Newline window message info ok
    file PaintFile
    b
    SearchString = 'Builder_Control_WIN,@TextName@'
    fs:/@SearchString/
    r:/@Newline@/
    Builder_Textedit_Font_EFOBJ = Builder_Textedit_Font_COOBJ
    window modify Builder_Textedit_Font_EFOBJ
    call !a400_Builder_Control_Refresh_PBOBJ
    return

//******************************
//* Textedit Up Button
//******************************
!a875_Builder_Textedit_Yminus_PBOBJ
    window obtain Builder_Textedit_WIN
    if-1  (Builder_Textedit_Size_RBOBJ)
+       TextCY += Builder_Textedit_Size_EFOBJ
+       if-2  (TextCY < 0)
+           TextCY = 0
+           call !a875_modify_text
+           return
+       else-2
+           call !a875_modify_text
+           return
+   endif
    TextFileName = '@SystemName@.txt'
    close TextFile error
    open TextFile @TextFileName error return
    b
    scanr:/@Builder_Textedit_Name_EFOBJ/:/_/
    TextSearch = '@SystemName@_@WindowName@_WIN,@left@,'
    fs:/@TextSearch/
    if (eof) return
    scanr:/@line/:/,/ TextY = right
    scanr:/@left/:/,/ TextX = right
    TextY -= Builder_Textedit_Size_EFOBJ
    Newline = '@left@,@TextX@,@TextY@'
    r:/@Newline/
    write TextFile @TextFileName
    close TextFile
    call !a875_modify_text
    return

//******************************
//* Textedit Down Button
//******************************
!a875_Builder_Textedit_Yplus_PBOBJ
    window obtain Builder_Textedit_WIN
    if-1  (Builder_Textedit_Size_RBOBJ)
+       TextCY -= Builder_Textedit_Size_EFOBJ
+       if-2  (TextCY > 360)
+           TextCY = 360
+           call !a875_modify_text
+           return
+       else-2
+           call !a875_modify_text
+           return
+   endif
    TextFileName = '@SystemName@.txt'
    close TextFile error
    open TextFile @TextFileName error return
    b
    scanr:/@Builder_Textedit_Name_EFOBJ/:/_/
    TextSearch = '@SystemName@_@WindowName@_WIN,@left@,'
    fs:/@TextSearch/
    if (eof) return
    scanr:/@line/:/,/ TextY = right
    scanr:/@left/:/,/ TextX = right
    TextY += Builder_Textedit_Size_EFOBJ
    Newline = '@left@,@TextX@,@TextY@'
    r:/@Newline/
    write TextFile @TextFileName
    close TextFile
    call !a875_modify_text
    return

//******************************
//* Textedit Left Button
//******************************
!a875_Builder_Textedit_Xminus_PBOBJ
    window obtain Builder_Textedit_WIN
    if  (Builder_Textedit_Size_RBOBJ)
+       TextCX -= Builder_Textedit_Size_EFOBJ
+       call !a875_modify_text
+       return
+   endif
    TextFileName = '@SystemName@.txt'
    close TextFile error
    open TextFile @TextFileName error return
    b
    scanr:/@Builder_Textedit_Name_EFOBJ/:/_/
    TextSearch = '@SystemName@_@WindowName@_WIN,@left@,'
    fs:/@TextSearch/
    if (eof) return
    scanr:/@line/:/,/ TextY = right
    scanr:/@left/:/,/ TextX = right
    TextX -= Builder_Textedit_Size_EFOBJ
    Newline = '@left@,@TextX@,@TextY@'
    r:/@Newline/
    write TextFile @TextFileName
    close TextFile 
    call !a875_modify_text
    return

//******************************
//* Textedit Right Button
//******************************
!a875_Builder_Textedit_Xplus_PBOBJ
    window obtain Builder_Textedit_WIN
    if  (Builder_Textedit_Size_RBOBJ)
+       TextCX += Builder_Textedit_Size_EFOBJ
+       call !a875_modify_text
+       return
+   endif
    TextFileName = '@SystemName@.txt'
    close TextFile error
    open TextFile @TextFileName error return
    b
    scanr:/@Builder_Textedit_Name_EFOBJ/:/_/
    TextSearch = '@SystemName@_@WindowName@_WIN,@left@,'
    fs:/@TextSearch/
    if (eof) return
    scanr:/@line/:/,/ TextY = right
    scanr:/@left/:/,/ TextX = right
    TextX += Builder_Textedit_Size_EFOBJ
    Newline = '@left@,@TextX@,@TextY@'
    r:/@Newline/
    write TextFile @TextFileName
    close TextFile
    call !a875_modify_text
    return

//******************************
//* Textedit Color Button
//******************************
!a875_Builder_Textedit_Color_PBOBJ
    SetTextColor = 'y'
    call !c100_Builder_Stdcolors_MSOBJ
    return

//******************************
//* Cancel Progress
//******************************
!a900_Builder_Progress_Cancel_PBOBJ
    window close Builder_Progress_WIN
    return

//******************************
//* Download 3090 files
//******************************
!a1000_Builder_Download3090_Ok_PBOBJ
    string DownloadFilename  error
    int    DownloadFileCount error
    int    Copyfilecount     error

    window obtain Builder_Download3090_WIN
    crush Builder_Download3090_Userid_EFOBJ
    if (Builder_Download3090_Userid_EFOBJ != null)
+      Userid3090 = Builder_Download3090_Userid_EFOBJ
+   else
+      Userid3090 = null
+   endif
    crush Builder_Download3090_Password_EFOBJ
    if (Builder_Download3090_Password_EFOBJ != null)
+      Password3090 = Builder_Download3090_Password_EFOBJ
+   else
+      Password3090 = null
+   endif
    if (Builder_Download3090_Test_RBOBJ)
+      LoginLoc3090 = 'test'
+   else
+      LoginLoc3090 = 'prod'
+   endif
    DownloadFrom = Builder_Download3090_From_EFOBJ
    crush DownloadFrom
    DownloadTo = Builder_Download3090_To_EFOBJ
    crush DownloadTo
    Extension = Builder_Download3090_Extension_EFOBJ
    crush Extension
    scan:/@Extension@/:/./
    if (found)
+      Extension = '@left@@right@'
+   endif
    DownloadFilter = Builder_Download3090_Filter_EFOBJ

    //*******************************
    //* Required Fields
    //*******************************
    if (Userid3090 = null)
+      message = 'Please enter a Userid'
+      window message error ok
+      window setfocus Builder_Download3090_Userid_EFOBJ
+      return
+   endif
    if (Password3090 = null)
+      message = 'Please enter a Password'
+      window message error ok
+      window setfocus Builder_Download3090_Password_EFOBJ
+      return
+   endif
    if (DownloadFrom = null)
+      message = 'Please enter the 3090 source location'
+      window message error ok
+      window setfocus Builder_Download3090_From_EFOBJ
+      return
+   endif
    if (DownloadTo = null)
+      message = 'Please enter the local target location'
+      window message error ok
+      window setfocus Builder_Download3090_To_EFOBJ
+      return
+   endif
    if (Extension = null)
+      message = 'Please enter an Extension to place on download filenames'
+      window message error ok
+      window setfocus Builder_Download3090_Extension_EFOBJ
+      return
+   endif
    //*******************************
    //* Remove ' chars from From
    //*******************************
    scan:/@Builder_Download3090_From_EFOBJ@/:/'/
    if (found) Builder_Download3090_From_EFOBJ = '@left@@right@'
    scan:/@Builder_Download3090_From_EFOBJ@/:/'/
    if (found) Builder_Download3090_From_EFOBJ = '@left@@right@'
    window modify Builder_Download3090_From_EFOBJ
    //*******************************
    //* Remove trailing \ from To
    //*******************************
    crush Builder_Download3090_To_EFOBJ
    splitr:/@Builder_Download3090_To_EFOBJ@/;1
    if (right = '\')
+      Builder_Download3090_To_EFOBJ = left
+      window modify Builder_Download3090_To_EFOBJ
+   endif
    MacroCommand = |if (!exists @Builder_Download3090_To_EFOBJ@) message = "To directory doesn't exist (ensure no spaces in name)" window message error ok window setfocus Builder_Download3090_To_EFOBJ return|
    //message = MacroCommand window message info ok
    $MacroCommand

    //*******************************
    //* Download single file
    //*******************************
    scan:/@DownloadFrom@/:/(/
    if (found)
+      scan:/@right/:/)/
+      if (!found)
+         message = "For a single file please add ')' to 3090 From"
+         window message error ok
+         window setfocus Builder_Download3090_From_EFOBJ
+         return
+   endif
    if (found)
+      DownloadFilename = left
+      crush DownloadFilename
+      DownloadFilename = '@DownloadFilename@.@Extension@'
+      call !a1000_download_file
+      return

    close Copyfiles error
    open Copyfiles null

    //******************************
    //* Download Entire System
    //******************************
    pack DownloadFilter
    DownloadFilterLen = len(DownloadFilter)

    message = 'delete @Builder_Download3090_To_EFOBJ@\*.@Extension@?'
    window message question yesno
    if  (message)
+       MacroCommand = |system:"del @Builder_Download3090_To_EFOBJ@\*.@Extension@"|
+       $MacroCommand
+   endif
    //******************************
    //* Get 3090 Directory List
    //******************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/
    Newline = "cd '@Builder_Download3090_From_EFOBJ@'"
    i:/@Newline/
    i:/dir/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in >GetFile.out/ 
    system:"del GetFile.in"
    window pointer arrow
    open GetFile GetFile.out error goto !a1000_bad_dir_list
    goto !a1000_filter_files

!a1000_bad_dir_list
    message = 'Unable to get 3090 file list'
    window message error ok
    goto !a1000_system_finished

!a1000_filter_files
    b
    fs:/Port request OK/
    if (!eof)
+      fs:/Name/
+   endif
    if (eof)
+      message = 'Bad 3090 file list'
+      window message error ok
+      goto !a1000_system_finished
+   endif
    open DownloadFileList null
    file GetFile
    f;1
    do
        if (!eof) 
+          scan:/@line@/:/List completed/ 
+          if (found)
+             //**************************
+             //* At End of Download List
+             //**************************
+             f;*
+       endif
        if (!eof)
+          if  (DownloadFilter != null)
+              //**************************
+              //* Filter to one system
+              //**************************
+              pattern ?#%~*
+              pattern on
+              scan:/@line/:/@DownloadFilter@/
+              pattern off
+              pattern ?#&~*
+              if (found)
+                 scan:/@line/:word
+                 Newline = |get '@Builder_Download3090_From_EFOBJ@(@left@)' @Builder_Download3090_To_EFOBJ@\@left@.@Extension@|
+                 file DownloadFileList
+                 i:/@Newline@/
+                 file GetFile
+       endif
        if (!eof)
+          if  (DownloadFilter = null)
+             //**************************
+             //* Download all files
+             //**************************
+              scan:/@line/:word
+              Newline = |get '@Builder_Download3090_From_EFOBJ@(@left@)' @Builder_Download3090_To_EFOBJ@\@left@.@Extension@|
+              file DownloadFileList
+              i:/@Newline@/
+              file GetFile
+       endif
        f;1
    until (eof)
    write DownloadFileList GetFile.ok
    file DownloadFileList
    b
    f;*
    DownloadFileCount = pcount + 1
    if  (DownloadFileCount = 1)
+       message = 'y'
+   else
+       message = 'Download @DownloadFileCount@ files, continue?' 
+       window message question yesno
+   endif
    if (message)
+      goto !a1000_system_download
+   else
+      goto !a1000_system_download_complete
+   endif 

!a1000_system_download  
    window pointer wait
    //**************************
    //* Open Progress
    //**************************
    ProgressCount = DownloadFileCount / 5
    call !p100_open_progress

!a1000_system_getfiles_loop
    close GetFile error
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/
    file DownloadFileList
    b
    if (eof) goto !a1000_system_finished
    cut;5
    file GetFile
    paste
    i:/bye/
    //**********************************
    //* FTP Get
    //**********************************
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"

    //**********************************
    //* Download Copies
    //**********************************
    if  (Builder_Download3090_Copies_CBOBJ)
+       file Copyfiles
+       b
+       paste
+       b
+       do
+           if (!eof)
+              scanr:/@line/:/ /
+              r:/@right/
+              f;1
+       until (eof)
+   endif
    if  (Builder_Download3090_Copies_CBOBJ)
+       file Copyfiles
+       b
+       call !a1000_copies
+   endif

    //**************************
    //* Show Progress
    //**************************
    call !p200_show_progress
    goto !a1000_system_getfiles_loop

!a1000_system_finished
    window close Builder_Download3090_WIN
    window pointer arrow

!a1000_system_download_complete
    call !p300_close_progress
    close GetFile error
    close DownloadFileList error
    system:"del GetFile.out"
    system:"del GetFile.ok"
    system:"del GetFile.in"
    close Copyfiles
    return

//******************************
//* Download Single File
//******************************
!a1000_download_file
    MacroCommand = "if (exists @Builder_Download3090_To_EFOBJ@\@DownloadFilename@) message = 'File already exists, overwrite?' window message question yesno if (!message) window setfocus Builder_Download3090_To_EFOBJ return"    
    $MacroCommand
    MacroCommand = 'system:"del @Builder_Download3090_To_EFOBJ@\@DownloadFilename@"'
    $MacroCommand

    //*****************************************
    //* FTP get the COBOL source from the 3090
    //*****************************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/

    Programname3090 = '@Builder_Download3090_To_EFOBJ@\@DownloadFilename@'

    Newline = "get '@Builder_Download3090_From_EFOBJ@' @Programname3090@"
    i:/@Newline/

    //**********************************
    //* FTP Get
    //**********************************
    i:/@Newline@/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"
    window pointer arrow

    MacroCommand = "    if (!exists @Programname3090@) message = 'Error downloading' window message error ok call !p300_close_progress return"
    $MacroCommand

    close Copyfiles error
    open Copyfiles null
    i:/@Programname3090@/
    if  (Builder_Download3090_Copies_CBOBJ)
+       call !a1000_copies
+       close Copyfiles
+   endif
   
    message = 'File successfully downloaded to @Programname3090@'
    window message info ok

    //window close Builder_Download3090_WIN
    return

//******************************
//* Download Copies
//******************************
!a1000_copies
    string Copyfilename error
    string Filename     error
    string Downloadcopy error

    file Copyfiles error return
    b
    do
        Filename = line
        Downloadcopy = 'n'
        //***********************
        //* Prepare the FTP file
        //***********************
        close GetFile error
        open GetFile null
        i:/open/
        if  (LoginLoc3090 = 'test')
+           i:/mvst/
+       else
+           i:/mvs/
+       endif
        i:/user/
        i:/@Userid3090@/
        i:/@Password3090@/
        close COBOLSource error
        open COBOLSource @Filename error goto !a1000_copies_next
        b
!a1000_copy_loop
        fs:/ COPY /
        if (eof) goto !a1000_copies_ftp
        split:/@line/;6
        split:/@right/;1
        if (left = '*') or (left = '/')
+          f;1
+          goto !a1000_copy_loop
+       endif

        scan:/@line/:/ COPY /
        scan:/@right/:word
        if (left = 'IDMS') f goto !a1000_copy_loop
        Copyfilename = left
        scan:/@Copyfilename/:/./
        if (found) Copyfilename = left
        scan:/@Copyfilename/:/'/
        if (found) Copyfilename = "@left@@right@"
        scan:/@Copyfilename/:/'/
        if (found) Copyfilename = "@left@@right@"
        Downloadcopy = 'y'

        file GetFile
        Newline = "get 'g1de00fp.gefs.copylib(@Copyfilename@)' @Builder_Download3090_To_EFOBJ@/@Copyfilename@.cpy"
        i:/@Newline/
        //message = Newline window message info ok
        file COBOLSource
        f;1
        goto !a1000_copy_loop

!a1000_copies_ftp
        if (!Downloadcopy) goto !a1000_copies_next
        //**********************************
        //* FTP Get
        //**********************************
        file GetFile
        i:/@Newline@/
        i:/bye/
        write GetFile GetFile.in
        close GetFile
        window pointer wait
        system:/ftp -n -s:GetFile.in/ 
        //message = 'copy ftp done' window message info ok
        system:"del GetFile.in"
        window pointer arrow

!a1000_copies_next
        close COBOLSource error
        file Copyfiles
        f;1
    until (eof)

    file Copyfiles
    b
    d;*
    close GetFile error
    return

//******************************
//* Download Directory
//******************************
!a1000_download_directory
    return

//******************************
//* Close Download 3090 Window
//******************************
!a1000_Builder_Download3090_Cancel_PBOBJ
    window close Builder_Download3090_WIN
    return

//******************************
//* Download3090 Directory Lookup
//******************************
!a1000_Builder_Download3090_Todir_PBOBJ
    DirField = "Builder_Download3090_To_EFOBJ"
    FileField = null
    window obtain Builder_Download3090_To_EFOBJ
    Directory = Builder_Download3090_To_EFOBJ
    call !s100_directory
    return

//******************************
//* Get the position of the paintfile object
//******************************
!a1100_get_paintfile_object_pos
    file PaintFile
    b
    SearchString = /Builder_Control_WIN,@ControlName@,/
    fs:/@SearchString/
    if  (eof) goto !a1100_get_paintfile_object_pos_return
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    ControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    ObjectY = left
    scan:/@right/:/,/
    ObjectCX = left
    scan:/@right/:/,/
    ObjectCY = left

    if  (ObjectCX = 0) ObjectCX = ObjectCY
    if  (ObjectCY = 0) ObjectCY = ObjectCX

    if  (ActualPosition) goto !a1100_get_paintfile_object_pos_return

    if  (HoldType = 'Circle') or (HoldType = 'Ellipse') or (HoldType = 'Ellipse3D')
+       TempWork = ObjectCX / 2
+       ObjectX -= TempWork
+       TempWork = ObjectCY / 2
+       ObjectY -= TempWork
+   endif
    if  (HoldType = 'Diamond')
+       TempWork = ObjectCX / 2
+       ObjectX -= TempWork
+   endif

!a1100_get_paintfile_object_pos_return
    file GroupControls
    return

//********************************
//* Backup the GroupControls file
//* and remove all .Text objects
//* from GroupControls
//********************************
!a1100_backup_groupcontrols
    file GroupControls
    clear
    b
    copy;*
    close GroupBackup error
    open GroupBackup null
    paste

    //**************************
    //* Remove Object Text objects
    //**************************
    file GroupControls
    b
    do
        fs:/.Text_Text/
        if  (!eof) d;1
    until (eof)
    return

//********************************
//* Restore the GroupControls file
//********************************
!a1100_restore_groupcontrols
    file GroupBackup
    b
    clear
    copy;*
    file GroupControls
    b
    d;*
    paste
    close GroupBackup
    call !a400_Builder_Control_Refresh_PBOBJ
    call !a100_WindowUp3_controls
    return

//******************************
//* Align Controls Top
//******************************
!a1100_Builder_Align_Top_PBOBJ
    call !a1100_backup_groupcontrols
    //**************************
    //* Find Topmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 9999
    do
        if (eof)
+          goto !a1100_Builder_Align_Top_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        if  (ObjectY < GroupMaxPos)
+           GroupMaxPos = ObjectY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Top_Size
    //**************************
    //* Align Controls to Top
    //**************************
    GroupObjYOffset = GroupMaxPos - GroupDragY
    if  (GroupObjYOffset < 1) GroupObjYOffset = 1
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Top_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        GroupObjXOffset = left
        //GroupObjYOffset = right

        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           AlignTop = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+           window size @ControlName @ObjectX @GroupMaxPos @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Top_Done
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    window close Builder_Align_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Align Controls Bottom
//******************************
!a1100_Builder_Align_Bottom_PBOBJ
    call !a1100_backup_groupcontrols
    int BottomY error
    //**************************
    //* Find Bottommost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Bottom_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        scanr:/@ControlName/:/_/
        if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle')
+           TempWork = ObjectCY / 2
+           BottomY = ObjectY + TempWork
+       else
+           BottomY = ObjectY + ObjectCY
+       endif
        if  (BottomY > GroupMaxPos)
+           GroupMaxPos = BottomY
+       endif
        file GroupControls
        f;1
    until (eof)
!a1100_Builder_Align_Bottom_Size
    //**************************
    //* Align Controls to Bottom
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Bottom_Done
+       endif
        scan:/@line/:/,/
        ControlName = left

        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           ActualPosition = 'y'
+           call !a1100_get_paintfile_object_pos
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        GroupObjXOffset = left
        scanr:/@ControlName/:/_/
        if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle')
+           TempWork = ObjectCY / 2
+           ObjectY = GroupMaxPos - TempWork
+       else
+           ObjectY = GroupMaxPos - ObjectCY
+       endif
        if (ObjectY < 1) ObjectY = 1
        GroupObjYOffset = ObjectY - GroupDragY
        if (GroupObjYOffset < 1) GroupObjYOffset = 1
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           AlignBottom = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Bottom_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Align Controls Middle Horizontal
//******************************
!a1100_Builder_Align_Midhoriz_PBOBJ
    int GroupMaxTop error
    int GroupMaxBottom error
    int ObjectBottom error
    int GroupMid error
    int GroupWork error
   
    call !a1100_backup_groupcontrols
    //**************************
    //* Find top & bottom most Controls
    //**************************
    file GroupControls
    b
    GroupMaxTop = 9999
    GroupMaxBottom = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Midhoriz_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        ObjectBottom = ObjectY + ObjectCY
        if  (ObjectBottom > GroupMaxBottom)
+           GroupMaxBottom = ObjectBottom
+       endif
        if (ObjectY < GroupMaxTop)
+          GroupMaxTop = ObjectY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Midhoriz_Size
    GroupMid = GroupMaxBottom - GroupMaxTop
    GroupMid /= 2
    GroupMid += GroupMaxTop
    if  (GroupMid = 0) goto !a1100_Builder_Align_Midhoriz_Done
    //**************************
    //* Align Controls to Middle
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Midhoriz_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           ActualPosition = 'y'
+           call !a1100_get_paintfile_object_pos
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        GroupObjXOffset = left
        
        GroupWork = ObjectCY / 2
        scanr:/@ControlName/:/_/
        if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle')
+           ObjectY = GroupMid
+       else
+           ObjectY = GroupMid - GroupWork
+       endif

        GroupObjYOffset = ObjectY - GroupDragY
        if (GroupObjYOffset < 1) GroupObjYOffset = 1
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           AlignBottom = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Midhoriz_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Align Controls Middle Vertical
//******************************
!a1100_Builder_Align_Midvert_PBOBJ
    int GroupMaxLeft error
    int GroupMaxRight error
    int ObjectRight error
    int GroupMid error
    int GroupWork error
   
    call !a1100_backup_groupcontrols
    //**************************
    //* Find left & right most Controls
    //**************************
    file GroupControls
    b
    GroupMaxLeft = 9999
    GroupMaxRight = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Midvert_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        ObjectRight = ObjectX + ObjectCX
        if  (ObjectRight > GroupMaxRight)
+           GroupMaxRight = ObjectRight
+       endif
        if (ObjectX < GroupMaxLeft)
+          GroupMaxLeft = ObjectX
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Midvert_Size
    GroupMid = GroupMaxRight - GroupMaxLeft
    GroupMid /= 2
    GroupMid += GroupMaxLeft
    if  (GroupMid = 0) goto !a1100_Builder_Align_Midvert_Done
    //**************************
    //* Align Controls to Middle
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Midvert_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           ActualPosition = 'y'
+           call !a1100_get_paintfile_object_pos
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        GroupObjYOffset = right
        
        GroupWork = ObjectCX / 2
        scanr:/@ControlName/:/_/
        if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond')
+           ObjectX = GroupMid
+       else
+           ObjectX = GroupMid - GroupWork
+       endif

        GroupObjXOffset = ObjectX - GroupDragX
        if (GroupObjXOffset < 1) GroupObjXOffset = 1
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           //AlignBottom = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Midvert_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Align Controls Left
//******************************
!a1100_Builder_Align_Left_PBOBJ
    call !a1100_backup_groupcontrols
    //**************************
    //* Find Leftmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 9999
    do
        if (eof)
+          goto !a1100_Builder_Align_Left_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        if  (ObjectX < GroupMaxPos)
+           GroupMaxPos = ObjectX
+       endif
        file GroupControls
        f;1
    until (eof)
!a1100_Builder_Align_Left_Size
    //**************************
    //* Align Controls to Left
    //**************************
    GroupObjXOffset = GroupMaxPos - GroupDragX
    if (GroupObjXOffset < 1) GroupObjXOffset = 1
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Left_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        //GroupObjXOffset = left
        GroupObjYOffset = right
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           AlignLeft = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+           window size @ControlName @GroupMaxPos @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Left_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Align Controls Right
//******************************
!a1100_Builder_Align_Right_PBOBJ
    int RightY error
    call !a1100_backup_groupcontrols
    //**************************
    //* Find Rightmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Right_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        RightY = ObjectX + ObjectCX
        if  (RightY > GroupMaxPos)
+           GroupMaxPos = RightY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Right_Size
    //**************************
    //* Align Controls to Right
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Right_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           ActualPosition = 'y'
+           call !a1100_get_paintfile_object_pos
+           file GroupControls
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        GroupObjXOffset = left
        GroupObjYOffset = right
        scanr:/@ControlName/:/_/
        if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond')
+           TempWork = ObjectCX / 2
+           ObjectX = GroupMaxPos - TempWork
+       else
+          ObjectX = GroupMaxPos - ObjectCX
+       endif
        if (ObjectX < 1) ObjectX = 1
        GroupObjXOffset = ObjectX - GroupDragX
        if (GroupObjXOffset < 1) GroupObjXOffset = 1
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           AlignRight = 'y'
+           call !a100_paintfile_object
+           file GroupControls
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Right_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

//******************************
//* Distribute the controls Vertically
//******************************
!a1100_Builder_Align_Distvert_PBOBJ
    int GroupMaxTop       error
    int GroupMaxBottom    error
    int ObjectBottom      error
    int GroupObjectCount  error

    int TotalObjectSize   error
    int DistribSize       error
    int Spacing           error
    int Newpos            error

    string SortPos        error
   
    call !a1100_backup_groupcontrols
    //**************************
    //* Find top & bottom most Controls
    //**************************
    close GroupControlsSorted error
    open GroupControlsSorted null

    file GroupControls
    b
    GroupMaxTop = 9999
    GroupMaxBottom = 0
    GroupObjectCount = 0
    TotalObjectSize = 0
    
    do
        if (eof)
+          goto !a1100_Builder_Align_Distvert_Size
+       endif
        GroupObjectCount ++
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        SortPos = '00000@ObjectY@' splitr:/@SortPos/;5
        Newline = '@right@,@ControlName@,@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@'
        file GroupControlsSorted
        i:/@Newline@/
        file GroupControls
        TotalObjectSize += ObjectCY
        ObjectBottom = ObjectY + ObjectCY
        if  (ObjectBottom > GroupMaxBottom)
+           GroupMaxBottom = ObjectBottom
+       endif
        if (ObjectY < GroupMaxTop)
+          GroupMaxTop = ObjectY
+       endif
        f;1
    until (eof)

!a1100_Builder_Align_Distvert_Size
    if (GroupObjectCount < 2) goto !a1100_Builder_Align_distvert_Done
    GroupObjectCount --
    DistribSize = GroupMaxBottom - GroupMaxTop
    Spacing = DistribSize - TotalObjectSize
    Spacing = Spacing / GroupObjectCount

    Newpos = GroupMaxTop
    //**************************
    //* Distribute the Controls
    //**************************
    sort GroupControlsSorted,A,1
    file GroupControlsSorted
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Distvert_Done
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        ObjectY = Newpos
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_paintfile_distribute_vert
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        file GroupControlsSorted
        Newline = '@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@'
        r:/@Newline@/
        Newpos = Newpos + ObjectCY
        Newpos = Newpos + Spacing
        f;1
    until (eof)
!a1100_Builder_Align_distvert_Done
    window close Builder_Align_WIN
    close GroupControlsSorted error
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

!a1100_paintfile_distribute_vert
    file PaintFile
    b
    SearchString = 'Builder_Control_WIN,@ControlName@,'
    fs:/@SearchString/
    //message = 'debug SearchString[@SearchString@] line[@line@]' window message info ok
    if (eof) return
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    ObjectX = left
    scan:/@right/:/,/
    HoldRight = right   
    scanr:/@HoldControlName/:/_/
    if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle')
+       TempWork = ObjectCY / 2
+       TempWork += ObjectY
+   else
+       TempWork = ObjectY
+   endif 
    Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@ObjectX@,@TempWork@,@HoldRight@'
    r:/@Newline@/
    return

//******************************
//* Distribute the controls Horizontally
//******************************
!a1100_Builder_Align_Disthoriz_PBOBJ
    int GroupMaxLeft      error
    int GroupMaxRight     error
    int ObjectRight       error
    int GroupObjectCount  error

    int TotalObjectSize   error
    int DistribSize       error
    int Spacing           error
    int Newpos            error

    string SortPos        error
   
    call !a1100_backup_groupcontrols
    //**************************
    //* Find Left and Right most Controls
    //**************************
    close GroupControlsSorted error
    open GroupControlsSorted null

    file GroupControls
    b
    GroupMaxLeft = 9999
    GroupMaxRight = 0
    GroupObjectCount = 0
    TotalObjectSize = 0
    
    do
        if (eof)
+          goto !a1100_Builder_Align_Disthoriz_Size
+       endif
        GroupObjectCount ++
        scan:/@line/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        SortPos = '00000@ObjectX@' splitr:/@SortPos/;5
        Newline = '@right@,@ControlName@,@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@'
        file GroupControlsSorted
        i:/@Newline@/
        file GroupControls
        TotalObjectSize += ObjectCX
        ObjectRight = ObjectX + ObjectCX
        if  (ObjectRight > GroupMaxRight)
+           GroupMaxRight = ObjectRight
+       endif
        if (ObjectX < GroupMaxLeft)
+          GroupMaxLeft = ObjectX
+       endif
        f;1
    until (eof)

!a1100_Builder_Align_Disthoriz_Size
    if (GroupObjectCount < 2) goto !a1100_Builder_Align_disthoriz_Done
    GroupObjectCount --
    DistribSize = GroupMaxRight - GroupMaxLeft
    Spacing = DistribSize - TotalObjectSize
    Spacing = Spacing / GroupObjectCount

    Newpos = GroupMaxLeft
    //**************************
    //* Distribute the Controls
    //**************************
    sort GroupControlsSorted,A,1
    file GroupControlsSorted
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Disthoriz_Done
+       endif
        scan:/@line/:/,/
        scan:/@right/:/,/
        ControlName = left
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_get_paintfile_object_pos
+       else
+           window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
+       endif
        ObjectX = Newpos
        scanr:/@ControlName/:/_/
        if  (right beginswith 'Box') or (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond') or (right = 'Line') or (right beginswith 'Arrow') or (right = 'Text') or (right = 'TextTilt') or (right = 'Bitmap') or (right = 'BitmapFit') or (right beginswith 'Triangle') or (right beginswith 'Rectangle')
+           call !a1100_paintfile_distribute_horiz
+       else
+           window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
+           MacroCommand = 'window paint @ControlName@' $MacroCommand
+       endif
        file GroupControlsSorted
        Newline = '@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@'
        r:/@Newline@/
        Newpos = Newpos + ObjectCX
        Newpos = Newpos + Spacing
        f;1
    until (eof)
!a1100_Builder_Align_disthoriz_Done
    window close Builder_Align_WIN
    call !a100_WindowUp3
    file PaintFile
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    call !a1100_restore_groupcontrols
    return

!a1100_paintfile_distribute_horiz
    file PaintFile
    b
    SearchString = 'Builder_Control_WIN,@ControlName@,'
    fs:/@SearchString/
    //message = 'debug SearchString[@SearchString@] line[@line@]' window message info ok
    if (eof) return
    scan:/@line/:/,/
    HoldWindowName = left
    scan:/@right/:/,/
    HoldControlName = left
    scan:/@right/:/,/
    HoldType = left
    scan:/@right/:/,/
    scan:/@right/:/,/
    ObjectY = left
    HoldRight = right 
    scanr:/@HoldControlName/:/_/
    if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle') or (right = 'Diamond')
+       TempWork = ObjectCX / 2
+       TempWork += ObjectX
+   else
+       TempWork = ObjectX
+   endif  
    Newline = '@HoldWindowName@,@HoldControlName@,@HoldType@,@TempWork@,@ObjectY@,@HoldRight@'
    r:/@Newline@/
    return

//******************************
//* Close the Alignment Window
//******************************
!a1100_Builder_Align_Cancel_PBOBJ
    window close Builder_Align_WIN
    return

//******************************
//* Create a Control
//******************************
!b100_create_control

    window obtain Builder_Control_Control_EFOBJ
    window obtain Builder_Control_ControlText_EFOBJ
    if  (Builder_Control_Control_EFOBJ = null)
+       message = 'Please enter a Control Name'
+       window message error ok
+       window setfocus Builder_Control_Control_EFOBJ
+       return
+   endif

    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY

    window windowpos Builder_Control_Button_RBOBJ ObjectX ObjectY ObjectCX ObjectCY

    if-1  (KeepSizePos)
+       window obtain Builder_Control_Length_EFOBJ
+       ObjectCX = Builder_Control_Length_EFOBJ
+       window obtain Builder_Control_Height_EFOBJ
+       ObjectCY = Builder_Control_Height_EFOBJ
+   else-2
+       if-3  (ControlType beginswith 'Triangle')
+           ObjectCX = 50
+           ObjectCY = 50
+       else-3
+           ObjectCX = 100
+           ObjectCY = 20
+   endif
    if  (ControlType beginswith 'Arrow')
+       split:/@ControlType/;5
+       TempWork = right
+       if  (TempWork = 5) or (TempWork = 6) or (TempWork = 9) or (TempWork = 11) or (TempWork = 12) or (TempWork = 15)
+           ObjectCX = 100
+           ObjectCY = 50)
+   endif
    if  (ControlType beginswith 'Arrow')
+       split:/@ControlType/;5
+       TempWork = right
+       if  (TempWork = 7) or (TempWork = 8) or (TempWork = 10) or (TempWork = 13) or (TempWork = 14) or (TempWork = 16)
+           ObjectCX = 50
+           ObjectCY = 100)
+   endif

    if  (ControlType = 'Bitmap')
+       Builder_Control_Pos_RBOBJ = 'Y'
+       window modify Builder_Control_Pos_RBOBJ
+       Builder_Control_Size_RBOBJ = 'N'
+       window modify Builder_Control_Size_RBOBJ
+       window hide Builder_Control_Size_RBOBJ
+       window hide Builder_Control_Height_STTXT
+       window hide Builder_Control_Height_EFOBJ
+       window hide Builder_Control_Length_STTXT
+       window hide Builder_Control_Length_EFOBJ
+   else
+       window show Builder_Control_Size_RBOBJ
+       window show Builder_Control_Height_STTXT
+       window show Builder_Control_Height_EFOBJ
+       window show Builder_Control_Length_STTXT
+       window show Builder_Control_Length_EFOBJ
+       Builder_Control_Size_RBOBJ = 'N'
+       window modify Builder_Control_Size_RBOBJ
+       Builder_Control_Pos_RBOBJ = 'Y'
+       window modify Builder_Control_Pos_RBOBJ
+   endif

    if-1  (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType beginswith 'Triangle')
+       if-2  (KeepSizePos)
+           window obtain Builder_Control_Length_EFOBJ
+           ObjectCX = Builder_Control_Length_EFOBJ
+           window obtain Builder_Control_Height_EFOBJ
+           ObjectCY = Builder_Control_Height_EFOBJ
+       else-2
+           ObjectCX = 50
+           ObjectCY = 50
+   endif

    if  (ControlType = 'BitmapFit')
+       if  (!KeepSizePos)
+           ObjectCY = 0
+   endif

    message = null
    window exists @Builder_Control_Control_EFOBJ
    if (status) 
+      message = '@Builder_Control_Control_EFOBJ@ exists, re-create?'
+      window message question yesno
+      if (message = 'YES')
+         window deletecontrol @Builder_Control_Control_EFOBJ error
+   endif
    if (message = 'NO') return
    if  (Builder_Control_ControlText_EFOBJ != null)
+       Text = Builder_Control_ControlText_EFOBJ
+   else
+       Text = Builder_Control_Control_EFOBJ
+   endif
    if  (KeepSizePos)
+       window obtain Builder_Control_X_EFOBJ
+       Xpos = Builder_Control_X_EFOBJ
+       Xpos = Xpos + MinX + 5
+       window obtain Builder_Control_Y_EFOBJ
+       Ypos = Builder_Control_Y_EFOBJ
+       Ypos = Ypos + MinY + 5
+   else
+       Xpos = MinX + 1
+       Ypos = MinY + 1
+   endif

    if-1  (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle')
+       if-2  (!KeepSizePos)
+           Xpos += 30
+           Ypos += 30
+   endif
    if-1  (ControlType = 'Diamond')
+       if-2  (!KeepSizePos)
+           Xpos += 50
+   endif


    //*********************************************************
    //* Create Object Text - Setup Text Offsets 
    //*********************************************************
    if  (CreateText)
+       if  (ControlTypeText = 'Ellipse') or (ControlTypeText = 'Ellipse3D') or (ControlTypeText = 'Circle')
+           Xpos -= 20
+           Ypos -= 10
+           TextOffX = -20
+           TextOffY = -10
+   endif
    if  (CreateText)
+       if  (ControlTypeText = 'Diamond')
+           Xpos -= 20
+           Ypos += 2
+           TextOffX = -20
+           TextOffY = 2
+   endif
    if  (CreateText)
+       if  (ControlTypeText beginswith 'Box')
+           Xpos += 10
+           Ypos += 1
+           TextOffX = 10
+           TextOffY = 1
+   endif
    if  (CreateText)
+       if  (ControlTypeText beginswith 'Triangle')
+           Xpos += 5
+           Ypos += 15
+           TextOffX = 5
+           TextOffY = 15
+   endif
    if  (CreateText)
+       if  (ControlTypeText = 'TriangleD') or (ControlTypeText = 'TriangleL')
+           Xpos += 20
+           Ypos += 15
+           TextOffX = 20
+           TextOffY = 15
+   endif
    if  (CreateText)
+       if  (ControlTypeText = 'TriangleC')
+           Xpos += 5
+           Ypos += 15
+           TextOffX = 5
+           TextOffY = 15
+   endif
    if  (CreateText)
+       if  (ControlTypeText = 'TriangleA') or (ControlTypeText = 'TriangleE') or (ControlTypeText = 'TriangleF') or (ControlTypeText = 'TriangleI') or (ControlTypeText = 'TriangleM') or (ControlTypeText = 'TriangleN')
+           Xpos += 10
+           Ypos += 30
+           TextOffX = 10
+           TextOffY = 30
+   endif
    if  (CreateText)
+       if  (ControlTypeText = 'TriangleB') or (ControlTypeText = 'TriangleG') or (ControlTypeText = 'TriangleH') or (ControlTypeText = 'TriangleJ') or (ControlTypeText = 'TriangleO') or (ControlTypeText = 'TriangleP')
+           Xpos += 10
+           Ypos += 5
+           TextOffX = 10
+           TextOffY = 5
+   endif
    ArrowNumber = 0
    if  (CreateText) and (ControlTypeText beginswith "Arrow")
+       scan:/@ControlTypeText@/:/Arrow/
+       ArrowNumber = right
+       Xpos += 15
+       Ypos += 15
+       TextOffX = 15
+       TextOffY = 15
+   endif
    if  (ArrowNumber = 5) or (ArrowNumber = 11)
+       Xpos += 5
+       Ypos += 15
+       TextOffX = 5
+       TextOffY = 15
+   endif
    if  (ArrowNumber = 6) or (ArrowNumber = 9) or (ArrowNumber = 12) or (ArrowNumber = 15)
+       Xpos += 25
+       Ypos += 15
+       TextOffX = 25
+       TextOffY = 15
+   endif

    //*********************************************************
    //* Create Object Text (Remove old text offset first if exists)
    //*********************************************************
    if-1  (CreateText)
+       scan:/@Builder_Control_Control_EFOBJ/:/.Text_/
+       TextObj = left
+       TextSearch = '@SystemName@_@WindowName@_WIN,@TextObj@,'
+       close TextFile error
+       TextFileName = '@SystemName@.txt'
+       open TextFile @TextFileName error open TextFile null
+       b
+       Newline = '@TextSearch@@TextOffX@,@TextOffY@'
+       fs:/@TextSearch/
+       if-2 (!eof)
+          d;1
+          ib:/@Newline/
+          write TextFile @TextFileName
+          close TextFile
+       else-2
+          i:/@Newline/
+          write TextFile @TextFileName
+          close TextFile
+   endif
    file PaintFile error open PaintFile null

    if  (!Restoring) and (!KeepSizePos)
+       Ypos += 10
+   endif
    //message = 'creating control Xpos[@Xpos@] Ypos[@Ypos@] MinX[@MinX@] MinY[@MinY@]' window message info ok

    if  (ControlType = 'COOBJS') or (ControlType = 'LBOBJ1') or (ControlType = 'COOBJD') or (ControlType = 'COOBJL')
+       if  (!KeepSizePos)
+           ObjectCX = 200
+           ObjectCY = 200
+   endif

    if  (ControlType = 'Line')
+       ObjectCX += Xpos
+       ObjectCY += Ypos
+   endif
    if  (ControlType beginswith 'Arrow')
+       split:/@ControlType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           ObjectCX += Xpos
+           ObjectCY += Ypos
+   endif
    //**********************************
    //* Setup the field labels (text)
    //**********************************
    if-1  (ControlType = 'Text') or (ControlType = 'TextTilt')
+       Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+       if-2  (ControlType = 'Text')
+           window hide Builder_Control_SizeXPlus_PBOBJ
+           window hide Builder_Control_SizeXMinus_PBOBJ
+           window hide Builder_Control_Height_STTXT
+           window hide Builder_Control_Height_EFOBJ
+           Builder_Control_Size_RBOBJ = 'Size' window modify Builder_Control_Size_RBOBJ
+           Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+       else-2
+           window show Builder_Control_SizeXPlus_PBOBJ
+           window show Builder_Control_SizeXMinus_PBOBJ
+           window show Builder_Control_Height_STTXT
+           Builder_Control_Height_STTXT = 'Angle' window modify Builder_Control_Height_STTXT
+           Builder_Control_Length_STTXT = 'Size' window modify Builder_Control_Length_STTXT
+           window show Builder_Control_Height_EFOBJ
+           Builder_Control_Size_RBOBJ = 'Text' window modify Builder_Control_Size_RBOBJ
+   else-1
+       window show Builder_Control_SizeXPlus_PBOBJ
+       window show Builder_Control_SizeXMinus_PBOBJ
+       window show Builder_Control_Height_STTXT
+       window show Builder_Control_Height_EFOBJ
+       Builder_Control_Height_STTXT = 'Height' window modify Builder_Control_Height_STTXT
+       Builder_Control_Length_STTXT = 'Length' window modify Builder_Control_Length_STTXT
+       Builder_Control_Size_RBOBJ = 'Size' window modify Builder_Control_Size_RBOBJ
+   endif

    if-1  (CreateText)
+       if-2  (ControlTypeText = 'Ellipse') or (ControlTypeText = 'Ellipse3D') or (ControlTypeText = 'Circle')
+           Xpos -= 20
+           Ypos -= 10
+       else-2
+           if-3  (ControlTypeText = 'Diamond')
+               Xpos -= 20
+               Ypos += 2
+           else-3
+               Xpos += 2
+   endif

    if-1  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Text') or (ControlType = 'TextTilt') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle')
+       file PaintFile error open PaintFile null
+       f;*
+       if-2  (ControlType = 'Text') or (ControlType = 'TextTilt')
+           call !b100_create_text
+           //ObjectCX = 20
+           Builder_Control_Length_EFOBJ = ObjectCY
+           window modify Builder_Control_Length_EFOBJ
+           //ObjectCY = 0
+           Builder_Control_Height_EFOBJ = ObjectCY
+           window modify Builder_Control_Height_EFOBJ
+           MacroCommand = /i:'Builder_Control_WIN,@Builder_Control_Control_EFOBJ@,@ControlType@,@Xpos@,@Ypos@,@ObjectCY@,@ObjectCX@,@Red@,@Green@,@Blue@,@CurrFont@,@Builder_Control_ControlText_EFOBJ@'/ $MacroCommand
+           b 
+           call BuilderConnect.bed!m100_update_connect 
+           file PaintFile b window paint Builder_Control_WIN
+       else-2
+           if-3  (ControlType = 'Bitmap') or (ControlType = 'BitmapFit')
+               MacroCommand = /i:'Builder_Control_WIN,@Builder_Control_Control_EFOBJ@,@ControlType@,@Xpos@,@Ypos@,@ObjectCX@,@ObjectCY@,@CurrFile@'/ $MacroCommand
+               b 
+               call BuilderConnect.bed!m100_update_connect
+               file PaintFile b window paint Builder_Control_WIN
+           else-3
+               MacroCommand = /i:'Builder_Control_WIN,@Builder_Control_Control_EFOBJ@,@ControlType@,@Xpos@,@Ypos@,@ObjectCX@,@ObjectCY@,@Red@,@Green@,@Blue@'/ $MacroCommand
+               b 
+               call BuilderConnect.bed!m100_update_connect
+               file PaintFile b window paint Builder_Control_WIN
+   else-1
+       window createcontrol Builder_Control_WIN @Builder_Control_Control_EFOBJ @Xpos @Ypos @ObjectCX @ObjectCY @ControlType @Text 
+       file Controls error open Controls null
+       Newline = '@Builder_Control_Control_EFOBJ@,@ControlType@,@Text@'
+       i:/@Newline@/
+   endif

    if  (ControlType = 'Line')
+       ObjectCX -= Xpos
+       ObjectCY -= Ypos
+   endif
    if  (ControlType beginswith 'Arrow')
+       split:/@ControlType/;5
+       TempWork = right
+       if  (TempWork < 5)
+           ObjectCX -= Xpos
+           ObjectCY -= Ypos
+   endif

    FocusSet = 'Y'
    Builder_Control_X_EFOBJ = '1'
    window modify Builder_Control_X_EFOBJ
    Builder_Control_Y_EFOBJ = '1'
    window modify Builder_Control_Y_EFOBJ  
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ 
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ 

    Builder_Control_ControlList_COOBJ = "@Builder_Control_Control_EFOBJ@"
    scan:/@Builder_Control_ControlList_COOBJ/:/.Text_/
    if  (!found)
+       call !a300_insert_controllist
+       ButtonFocus = Builder_Control_Control_EFOBJ
+   endif

    if  (ControlType = 'Bitmap')
+       window hide Builder_Control_Height_STTXT
+       window hide Builder_Control_Height_EFOBJ
+   endif

//    if-1  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType = 'Line') or (ControlType beginswith 'Arrow') or (ControlType = 'Bitmap') or (ControlType = 'BitmapFit') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle')
//+       //Builder_Control_ControlText_EFOBJ = null
//+       //window modify Builder_Control_ControlText_EFOBJ
//+   endif

    if  (ControlType = 'Bitmap') or (ControlType = 'BitmapFit')
+       window disable Builder_Control_Color_PBOBJ
+   endif

    if  (ControlType = 'Bitmap')
+       Builder_Control_Pos_RBOBJ = 'Y'
+       window modify Builder_Control_Pos_RBOBJ
+       Builder_Control_Size_RBOBJ = 'N'
+       window modify Builder_Control_Size_RBOBJ
+       window hide Builder_Control_Size_RBOBJ
+       window hide Builder_Control_Height_STTXT
+       window hide Builder_Control_Height_EFOBJ
+       window hide Builder_Control_Length_STTXT
+       window hide Builder_Control_Length_EFOBJ
+   endif
    if  (KeepSizePos)
+       KeepSizePos = 'n'
+       Xpos -= MinX
+       Builder_Control_X_EFOBJ = Xpos
+       window modify Builder_Control_X_EFOBJ
+       Ypos -= MinY
+       Builder_Control_Y_EFOBJ = Ypos
+       window modify Builder_Control_Y_EFOBJ
+   endif

    //*******************************************
    //* Add text field to PaintFile Objects
    //*******************************************
    if  (ControlType beginswith 'Box') or (ControlType = 'Ellipse') or (ControlType = 'Ellipse3D') or (ControlType = 'Circle') or (ControlType = 'Diamond') or (ControlType beginswith 'Triangle') or (ControlType beginswith 'Rectangle') or (ControlType beginswith 'Arrow')
+       if  (Builder_Control_ControlText_EFOBJ != null)
+           TextHoldControlName = Builder_Control_Control_EFOBJ
+           ControlTypeText = ControlType
+           ControlType = 'TextTilt'
+           scanr:/@Builder_Control_Control_EFOBJ/:/_/
+           Builder_Control_Control_EFOBJ = '@left@.Text_Text'
+           window modify Builder_Control_Control_EFOBJ
+           SpecialControlType = null
+           CreateText = 'y'
+           TextHoldRed = Red
+           TextHoldGreen = Green
+           TextHoldBlue = Blue
+           Red = 0 Green = 0 Blue = 0
+           call !a400_Builder_Control_Create_PBOBJ
+           Red = TextRed Green = TextGreen Blue = TextBlue
+           CreateText = 'n'
+           GroupDragX = MinX
+           GroupDragY = MinY
+           GroupDragCX = 200
+           GroupDragCY = 100
+           file PaintFile
+           b
+           window paint Builder_Control_WIN
+           call !a400_Builder_Control_Refresh_PBOBJ
+           //******************************
+           //* Put the Actual Control back
+           //******************************
+           Builder_Control_Control_EFOBJ = TextHoldControlName
+           window modify Builder_Control_Control_EFOBJ
+           ButtonFocus = /@Builder_Control_Control_EFOBJ/
+           Red = TextHoldRed Green = TextHoldGreen Blue = TextHoldBlue
+   endif
    return

//******************************
//* Set the color of the text
//******************************
!b100_text_color
    TextRed = Red TextGreen = Green TextBlue = Blue 
    if  (Red = 255) and (Green = 255) and (Blue = 255)
+       Red = 0 Green = 0 Blue = 0
+   else
+       Red = 255 Green = 255 Blue = 255
+   endif
    if  (ControlTypeText = 'TriangleG') Red = 0 Green = 0 Blue = 0
    if  (ControlTypeText = 'TriangleH') Red = 0 Green = 0 Blue = 0
    if  (ControlTypeText = 'TriangleI') Red = 0 Green = 0 Blue = 0
    if  (ControlTypeText = 'TriangleJ') Red = 0 Green = 0 Blue = 0
    if  (ControlTypeText = 'TriangleK') Red = 0 Green = 0 Blue = 0
    if  (ControlTypeText = 'TriangleL') Red = 0 Green = 0 Blue = 0
    return

//******************************
//* Restrict controls to obj + text
//******************************
!b100_restrict_controls
    scanr:/@Builder_Control_Control_EFOBJ@/:/_/
    SearchString = left
    file GroupControls
    b
    do
        scan:/@line/:/@SearchString@/
        if  (!found)
+           d;1
+       else
+           f;1
+       endif
    until (eof)
    file PaintFile
    b
    fs:/,GroupRectangle,/
    Newline = 'Builder_Control_WIN,GroupRectangle,Box,@GroupDragX@,@GroupDragY@,@GroupDragCX@,@GroupDragCY@,250,250,250'
    if (eof)
+      b
+      i:/@Newline/
+   else
+      r:/@Newline/
+   endif
    b
    window paint Builder_Control_WIN
    return

!b100_create_text
    if  (KeepSizePos) return

    if  (CreateText)
+       ObjectCX = 0
+       ObjectCY = 20
+   else
+       ObjectCX = 20
+       ObjectCY = 0
+   endif

    return

//******************************
//* Add an AND search string
//******************************
!a1200_Builder_Search_And_PBOBJ
    window obtain Builder_Search_String_EFOBJ
    crush Builder_Search_String_EFOBJ
    if (Builder_Search_String_EFOBJ = null)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    SearchLast = 'AND'
    window disable Builder_Search_Or_PBOBJ

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    window paint Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_And_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_And_Done
    //*********************************
    //* Add the Entry Field String
    //*********************************
    SearchCount ++
    SearchCountStr = '0@SearchCount@'
    splitr:/@SearchCountStr@/;2
    if (SearchCount = 1)
+      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_String_EFOBJ@'
+   else
+      Builder_Search_List_LBOBJ = '@right@: AND @Builder_Search_String_EFOBJ@'
+   endif
    window insert end default Builder_Search_List_LBOBJ
    split:/@Builder_Search_List_LBOBJ@/;4
    Newline = right
    i:/@Newline@/

    //***************************************
    //* Clear out the String Entry Field
    //* and Set Focus
    //***************************************
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    window setfocus Builder_Search_String_EFOBJ
    return

//******************************
//* Add an OR search string
//******************************
!a1200_Builder_Search_Or_PBOBJ
    window obtain Builder_Search_String_EFOBJ
    crush Builder_Search_String_EFOBJ
    if (Builder_Search_String_EFOBJ = null)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    SearchLast = 'OR'
    window disable Builder_Search_And_PBOBJ

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    window paint Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Or_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_Or_Done
    //*********************************
    //* Add the Entry Field String
    //*********************************
    SearchCount ++
    SearchCountStr = '0@SearchCount@'
    splitr:/@SearchCountStr@/;2
    if (SearchCount = 1)
+      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_String_EFOBJ@'
+   else
+      Builder_Search_List_LBOBJ = '@right@: OR @Builder_Search_String_EFOBJ@'
+   endif
    window insert end default Builder_Search_List_LBOBJ
    split:/@Builder_Search_List_LBOBJ@/;4
    Newline = right
    i:/@Newline@/

    //***************************************
    //* Clear out the String Entry Field
    //* and Set Focus
    //***************************************
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    window setfocus Builder_Search_String_EFOBJ
    return

//******************************
//* Remove a search string
//******************************
!a1200_Builder_Search_Remove_PBOBJ
    window obtain Builder_Search_List_LBOBJ
    if  (Builder_Search_List_LBOBJ = null)
+      message = 'Please select a search string rule'
+      window message error ok
+      window setfocus Builder_Search_List_LBOBJ
+      return
+   endif
    //*********************************
    //* Remove the entry from the file
    //*********************************
    split:/@Builder_Search_List_LBOBJ@/;4
    file SearchList
    b
    fs:/@right@/
    if (!eof) d

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    window paint Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Remove_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_Remove_Done
    //*********************************
    //* Refresh the list
    //*********************************
    window hide Builder_Search_List_LBOBJ
    window show Builder_Search_List_LBOBJ
    return

//******************************
//* Clear all search strings
//******************************
!a1200_Builder_Search_Clear_PBOBJ
    file SearchList
    b
    d;*
    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    window paint Builder_Search_List_LBOBJ
    //*********************************
    //* Refresh the list
    //*********************************
    window hide Builder_Search_List_LBOBJ
    window show Builder_Search_List_LBOBJ

    //*********************************
    //* Enable the Search Actions
    //*********************************
    window enable Builder_Search_And_PBOBJ
    window enable Builder_Search_Or_PBOBJ
    return

//******************************
//* Search the Directory
//******************************
!a1200_Builder_Search_Search_PBOBJ
    if  (Reenter) 
+       window setfocus Builder_Progress_Cancel_PBOBJ
+       window paint Builder_Progress_WIN
+       goto !a1200_Builder_Search_Search_loop
+   endif
    window obtain Builder_Search_WIN
    crush Builder_Search_Directory_EFOBJ
    crush Builder_Search_String_EFOBJ
    MacroCommand = '    if (!exists @Builder_Search_Directory_EFOBJ@) goto !a1200_Builder_Search_Search_Bad_Directory'
    $MacroCommand
    file SearchList
    b
    if (Builder_Search_String_EFOBJ = null) and (eof)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    pack Builder_Search_Extension_EFOBJ
    if (Builder_Search_Extension_EFOBJ = null)
+      message = "Please enter an Extension"
+      window message error ok
+      window setfocus Builder_Search_Extension_EFOBJ
+      return
+   endif
    upper Builder_Search_Extension_EFOBJ
    Extension = Builder_Search_Extension_EFOBJ
    window modify Builder_Search_Extension_EFOBJ
    //*********************************
    //* Add the Entry field to the list
    //*********************************
    file SearchList
    b
    crush Builder_Search_String_EFOBJ
    if  (Builder_Search_String_EFOBJ = null)
+       goto !a1200_Builder_Search_Search_Add_Done
+   endif
    if (!eof)
+       f;*
+       Newline = /@SearchLast@ @Builder_Search_String_EFOBJ@/
+       i:/@Newline@/
+   else
+       Newline = Builder_Search_String_EFOBJ
+       i:/@Newline@/
+   endif

!a1200_Builder_Search_Search_Add_Done
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    
    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    window paint Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Search_Refresh_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)
!a1200_Builder_Search_Search_Refresh_Done
    goto !a1200_Builder_Search_Search_Find

!a1200_Builder_Search_Search_Bad_Directory
    message = "Directory doesn't exist (ensure no spaces in name)"
    window message error ok
    window setfocus Builder_Search_Directory_EFOBJ    
    return

!a1200_Builder_Search_Search_Find
    string SearchFile error

    window pointer wait
    window hwnd Builder_Searchresults_WIN status error window open Builder_Searchresults_WIN shade
    window clear Builder_Searchresults_WIN
    window center Builder_Searchresults_WIN
  
    //****************************************
    //* Search the Directory for the String
    //****************************************
    close SearchFileList error
    open SearchFileList null

    window obtain Builder_Search_Subdir_CBOBJ
    if (Builder_Search_Subdir_CBOBJ)
+      Dirname = Builder_Search_Directory_EFOBJ
+      call !x100_dirlist
+      file DirFileList
+      b
+      clear
+      copy;*
+      close DirFileList
+      file SearchFileList
+      paste
+      b
+   else
+      MacroCommand = "dir @Builder_Search_Directory_EFOBJ@"
+      systemcurr:"@MacroCommand@"
+      b
+      d;5
+      f;*
+      b;1
+      d;*
+      b
+   endif

    case off
    pattern on
    //**************************
    //* Open Progress
    //**************************
    f;*
    ProgressCount = pcount + 1
    call !p100_open_progress
    b

!a1200_Builder_Search_Search_loop
    file SearchFileList
    if (eof) goto !a1200_Builder_Search_Search_done
    if (Builder_Search_Subdir_CBOBJ)
+      SearchFile = line
+   else
+      scan:/@line/:word
+      scan:/@right/:word
+      scan:/@right/:word
+      scan:/@right/:word
+      SearchFile = '@Builder_Search_Directory_EFOBJ@\@right@' //message = 'Searching @SearchFile@[@line@]' window message info ok
+   endif
    scanr:/@SearchFile@/:/./
    upper right
    if (right != Builder_Search_Extension_EFOBJ)
+      goto !a1200_Builder_Search_Search_next
+   endif   
    open SearchSource @SearchFile error file SearchFileList goto !a1200_Builder_Search_Search_next
    file SearchList
    b
    f;1
    if (eof)
+      SearchAction = 'OR'
+   else
+      scan:/@line/:word
+      SearchAction = left
+   endif
    SearchNotFound = 'n'
    b
!a1200_Builder_Search_Search_String_loop
    if (eof) goto !a1200_Builder_Search_Search_String_loop_done
    scan:/@line/:word
    if (left = 'AND') or (left = 'OR')
+      SearchString = right
+   else
+      SearchString = line
+   endif

    file SearchSource
    b
    fs:/@SearchString@/
    if (!eof) and (SearchAction = 'OR')
+       Builder_Searchresults_Results_LBOBJ = SearchFile
+       window insert end default Builder_Searchresults_Results_LBOBJ
+       goto !a1200_Builder_Search_Search_String_loop_done
+   endif
    if (eof) and (SearchAction = 'AND')
+       SearchNotFound = 'y'
+   endif

    file SearchList
    f;1
    goto !a1200_Builder_Search_Search_String_loop

!a1200_Builder_Search_Search_String_loop_done
    if (SearchAction = 'AND') and (SearchNotFound != 'y')
+       Builder_Searchresults_Results_LBOBJ = SearchFile
+       window insert end default Builder_Searchresults_Results_LBOBJ
+   endif
    close SearchSource error
!a1200_Builder_Search_Search_next
    file SearchFileList
    f;1
    if (eof) goto !a1200_Builder_Search_Search_done
    //**************************
    //* Show Progress
    //**************************
    call !p200_show_progress
    Reenter = 'y'
    window push Builder_Search_Search_PBOBJ
    return
    //goto !a1200_Builder_Search_Search_loop

!a1200_Builder_Search_Search_done
    Reenter = 'n'
    call !p300_close_progress
    case on
    pattern off
    Directory = Builder_Search_Directory_EFOBJ
    Builder_Searchresults_Results_STTXT = "Search Results: @Builder_Search_String_EFOBJ@"
    window modify Builder_Searchresults_Results_STTXT
    window unshade Builder_Searchresults_WIN
    window setfocus Builder_Searchresults_WIN
    window pointer arrow
    return

//******************************
//* Show Help for Search
//******************************
!a1200_Builder_Search_Help_PBOBJ
    window pointer wait
    window hwnd Builder_Help_WIN status error window open Builder_Help_WIN shade
    window center Builder_Help_WIN
    window clear Builder_Help_WIN
    Builder_Help_WIN = 'Help: Searching Files for a String'
    window title Builder_Help_WIN
    Builder_Help_Help_LBOBJ = '1.  Search files for any string entered. Note: The search is not case sensitive.' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '2.  ' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '3.  Searching files for patterns:' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '4.     ? = Match on any Character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '5.     # = Match on any Digit' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '6.     & = Match on any Alpha character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '7.     ~ = Match on any Special character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '8.     * = Match to end or next char e.g. "this*test" will find "this is a test"' window insert end default Builder_Help_Help_LBOBJ
    window unshade Builder_Help_WIN
    window setfocus Builder_Help_WIN
    window pointer arrow
    return

//******************************
//* Close the Search Window
//******************************
!a1200_Builder_Search_Cancel_PBOBJ
    window close Builder_Search_WIN
    return

//******************************
//* Search Directory Lookup
//******************************
!a1200_Builder_Search_Directory_PBOBJ
    DirField = "Builder_Search_Directory_EFOBJ"
    FileField = null
    window obtain Builder_Search_Directory_EFOBJ
    Directory = Builder_Search_Directory_EFOBJ
    call !s100_directory
    return

//******************************
//* Open a Search Result file
//******************************
!a1300_Builder_Searchresults_Open_PBOBJ
    window obtain Builder_Searchresults_Results_LBOBJ
    crush Builder_Searchresults_Results_LBOBJ
    if  (Builder_Searchresults_Results_LBOBJ = null)
+       message = 'Please make a selection'
+       window message error ok
+       return
+   endif
    MacroCommand = 'system:"start @Builder_Searchresults_Results_LBOBJ@"'
    $MacroCommand
    return

//******************************
//* Close the Search Results Window
//******************************
!a1300_Builder_Searchresults_Cancel_PBOBJ
    window close Builder_Searchresults_WIN
    return

//******************************
//* Close the Help Window
//******************************
!a1400_Builder_Help_Ok_PBOBJ
    window close Builder_Help_WIN
    return

//******************************
//* Close the About Window
//******************************
!a1500_Builder_About_Ok_PBOBJ
    window close Builder_About_WIN
    return

//******************************
//* Double-click Browse Sub-dir List
//******************************
!a1600_Builder_Browse_Subdir_LBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    window obtain Builder_Browse_Subdir_LBOBJ
    leftjust Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    splitr:/@Builder_Browse_Directory_EFOBJ@/;1
    if (right = '\')
+      Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@@Builder_Browse_Subdir_LBOBJ@'
+   else  
+      Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Subdir_LBOBJ@'
+   endif
    window modify Builder_Browse_Directory_EFOBJ
    call !s200_show_dir
    return

//******************************
//* Double-click Browse Files List
//******************************
!a1600_Builder_Browse_Files_LBOBJ
    if  (FileField = null)
+       return
+   endif

    window obtain Builder_Browse_WIN
    MacroCommand = '@FileField@ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@"' $MacroCommand
    MacroCommand = 'window modify @FileField@' $MacroCommand
    scanr:/@Builder_Browse_Files_LBOBJ@/:/./
    if (found)
+      Builder_Browse_Extension_EFOBJ = right
+      window modify Builder_Browse_Extension_EFOBJ
+   endif
    call !a1600_Builder_Browse_Ok_PBOBJ
    if  (FileField = 'Builder_Nav_Start_EFOBJ')
+       MacroCommand = '@FileField@ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@"' $MacroCommand
+       MacroCommand = 'window modify @FileField@' $MacroCommand
+       return
+   endif

    if  (FileField = 'Builder_Control_Bitmap_EFOBJ')
+       call !a1600_Builder_Browse_Files_Bitmap
+       MacroCommand = 'window modify @FileField@' $MacroCommand
+       call !a400_Builder_Control_Modify_PBOBJ
+   else
+       call !a600_Builder_Import_OK_PBOBJ
+   endif
    return

//******************************
//* Convert Images to BMP if needed
//******************************
!a1600_Builder_Browse_Files_Bitmap
    upper Extension
    //message = 'Bitmap Conversion Extension[@Extension@] Builder_Browse_Directory_EFOBJ[@Builder_Browse_Directory_EFOBJ@] Builder_Browse_Files_LBOBJ[@Builder_Browse_Files_LBOBJ@]' window message info ok
    if (Extension != 'JPG') and (Extension != 'JPEG') and (Extension != 'WBMP') and (Extension != 'PNG') and (Extension != 'GIF')
+       MacroCommand = '@FileField@ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@' $MacroCommand
+       MacroCommand = 'CurrFile = "@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@' $MacroCommand
+       return
+   endif
    SystemCommand = 'java -jar BuilderImageConverter.jar -i @Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@ -f BMP -o @HomeDirectory@'
    scanr:/@Builder_Browse_Files_LBOBJ/:/./
    Builder_Browse_Files_LBOBJ = '@left@.BMP'
    system:"@SystemCommand@"
    MacroCommand = '@FileField@ = "@HomeDirectory@\@Builder_Browse_Files_LBOBJ@' $MacroCommand    
    MacroCommand = 'CurrFile = "@HomeDirectory@\@Builder_Browse_Files_LBOBJ@' $MacroCommand    
    return

//******************************
//* Refresh the Browse
//******************************
!a1600_Builder_Browse_Refresh_PBOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    call !s200_show_dir
    return

//******************************
//* Back up 1 browse directory
//******************************
!a1600_Builder_Browse_Back_PBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    scanr:/@Builder_Browse_Directory_EFOBJ@/:"\"
    if (found)
+      Builder_Browse_Directory_EFOBJ = left
+      window modify Builder_Browse_Directory_EFOBJ
+      call !s200_show_dir
+   endif
    return

//******************************
//* Accept the current browse dir
//******************************
!a1600_Builder_Browse_Ok_PBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    Directory = Builder_Browse_Directory_EFOBJ
    //**********************************************
    //* Pass directory to Chk3090.bed
    //**********************************************
    if  (DirField = 'Chk3090.dir')
+       open DirFile null
+       i:/@Builder_Browse_Directory_EFOBJ@/
+       i:/ /
+       write DirFile Chk3090.dir
+       close DirFile
+       system:"start 3090check.bat"
+       window close Builder_Browse_WIN
+       return
+   endif
    //**********************************************
    //* Pass directory to calling window dir field
    //**********************************************
    MacroCommand = '@DirField@ = Builder_Browse_Directory_EFOBJ' $MacroCommand 
    MacroCommand = 'window modify @DirField@' $MacroCommand 
    window obtain Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    //**********************************************
    //* Pass File back to View Program Flow
    //**********************************************
    if (FileField = 'Builder_Import_Filename_EFOBJ')
+      Builder_Import_Extension_EFOBJ = Builder_Browse_Extension_EFOBJ
+      Extension = Builder_Browse_Extension_EFOBJ
+      window modify Builder_Import_Extension_EFOBJ
+   endif
    window close Builder_Browse_WIN
    //**********************************************
    //* Process the Lookup on View Program Flow
    //**********************************************
    if  (DirField = 'Builder_Import_Directory_EFOBJ') and (Extension != null)
+       call !a600_Builder_Import_Lookup_PBOBJ
+   endif
    return

//******************************
//* Close the browse window
//******************************
!a1600_Builder_Browse_Cancel_PBOBJ
    window close Builder_Browse_WIN
    return

//******************************
//* Open a file on the Browse Window
//******************************
!a1600_Builder_Browse_Open_PBOBJ
    string FileOpenName error
    window obtain Builder_Browse_WIN
    if (Builder_Browse_Files_LBOBJ = null)
+      message = "Please select a file"
+      window message error ok
+      window setfocus Builder_Browse_Files_LBOBJ
+      return
+   endif
    split:/@Builder_Browse_Directory_EFOBJ@/;3
    FileOpenName = '@left@"@right@\@Builder_Browse_Files_LBOBJ@"'
    MacroCommand = |system:"start @FileOpenName@"| 
    $MacroCommand
    return

//******************************
//* Open the new directory window
//******************************
!a1600_Builder_Browse_Newdir_PBOBJ
    window obtain Builder_Browse_WIN
    window hwnd Builder_Newdir_WIN status error window open Builder_Newdir_WIN shade
    window clear Builder_Newdir_WIN
    window center Builder_Newdir_WIN
    window unshade Builder_Newdir_WIN
    window setfocus Builder_Newdir_WIN
    return

//******************************
//* Create a new directory
//******************************
!a1650_Builder_Newdir_Ok_PBOBJ
    window obtain Builder_Newdir_Name_EFOBJ
    crush Builder_Newdir_Name_EFOBJ
    if (Builder_Newdir_Name_EFOBJ = null)
+      message = "Please enter a Name"
+      window message error ok
+      window setfocus Builder_Newdir_Name_EFOBJ
+      return
+   endif
    MacroCommand = |system:"md @Builder_Browse_Directory_EFOBJ@\@Builder_Newdir_Name_EFOBJ@"|
    $MacroCommand
    Builder_Browse_Directory_EFOBJ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Newdir_Name_EFOBJ@"
    window modify Builder_Browse_Directory_EFOBJ
    window close Builder_Newdir_WIN
    window push Builder_Browse_Refresh_PBOBJ
    return

//******************************
//* Close the new directory window
//******************************
!a1650_Builder_Newdir_Cancel_PBOBJ
    window close Builder_Newdir_WIN
    return

//******************************
//* Codecheck Directory Lookup
//******************************
!a1700_Builder_Codecheck_Directory_PBOBJ
    DirField = "Builder_Codecheck_Directory_EFOBJ"
    FileField = null
    call !s100_directory
    return

//******************************
//* Close the browse window
//******************************
!a1700_Builder_Codecheck_Ok_PBOBJ
    window obtain Builder_Codecheck_WIN
    if (Builder_Codecheck_System_EFOBJ = null)
+      message = 'Please enter a System'
+      window message error ok
+      window setfocus Builder_Codecheck_System_EFOBJ
+      return
+   endif 
    if (Builder_Codecheck_Directory_EFOBJ = null)
+      message = 'Please enter a Directory'
+      window message error ok
+      window setfocus Builder_Codecheck_Directory_EFOBJ
+      return
+   endif
    //*************************************
    //* Create Checkcd.dir for Checkcd.bed
    //*************************************
    open CodeCheck null
    i:/@Builder_Codecheck_System_EFOBJ@/
    i:/@Builder_Codecheck_Directory_EFOBJ@/
    write CodeCheck Checkcd.dir
    close CodeCheck
    //*************************************
    //* Update AppNames.txt
    //*************************************
    Newline = '$*$ @Builder_Codecheck_System_EFOBJ@'
    open AppNames AppNames.txt error open AppNames null
    b
    fs:/@Newline@/
    if (eof)
+      i:/@Newline@/
+      write AppNames AppNames.txt
+   endif
    close AppNames
    
    window close Builder_Codecheck_WIN

    //*************************************
    //* Run Checkcd.bed
    //*************************************
    system:"start codecheck.bat"

    return

//******************************
//* Close the browse window
//******************************
!a1700_Builder_Codecheck_Cancel_PBOBJ
    window close Builder_Codecheck_WIN
    return

//******************************
//* System COOBJ Action
//******************************
!a1700_Builder_Codecheck_System_LBOBJ
    window obtain Builder_Codecheck_System_LBOBJ
    Builder_Codecheck_System_EFOBJ = Builder_Codecheck_System_LBOBJ
    window modify Builder_Codecheck_System_EFOBJ
    open CheckCodeLog checkcd.log error return
    SearchString = "System[@Builder_Codecheck_System_EFOBJ@]"
    direction up
    b f;1 b;1   //*** Prevent EOF on last record of file using f;1 b;1 with direction up (backwards)
    fs:/@SearchString@/
    if (eof) goto !a1700_Builder_Codecheck_System_done
    scan:/@line/:/Dir[/
    if (found)
+      scan:/@right/:/]/
+      if (found)
+         Builder_Codecheck_Directory_EFOBJ = left
+         window modify Builder_Codecheck_Directory_EFOBJ
+         Directory = Builder_Codecheck_Directory_EFOBJ
+   endif

!a1700_Builder_Codecheck_System_done
    direction down
    close CheckCodeLog
    return

//******************************
//* Open the Code Module Window
//******************************
!a1800_Builder_Code_Ok_PBOBJ
    window obtain Builder_Code_WIN

!a1800_Builder_Code_Ok_PBOBJ-1
    string ModuleFileName error

    if  (Builder_Code_Codemodules_LBOBJ = null)
+       window obtain Builder_Code_WIN
+   endif
    pack Builder_Code_Codemodules_LBOBJ
    if (Builder_Code_Codemodules_LBOBJ = null)
+      message = 'Please select a module'
+      window message error ok
+      window setfocus Builder_Code_Codemodules_LBOBJ
+      return
+   endif
    if-complete  (Builder_Code_Codemodules_LBOBJ = '! Complete Program')
+       ModuleFileName = 'Bedit-code\@SystemName@.bed'
+   else-complete
+       if-global  (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+           ModuleFileName = 'Bedit-code\Global.bed'
+       else-global
+           ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
+   endif
    MacroCommand = 'system:"start @ModuleFileName@"'
    $MacroCommand
    Builder_Code_Codemodules_LBOBJ = null
    return

!a1800_Builder_Code_Codemodules_LBOBJ
    Builder_Code_Codemodules_LBOBJ = null
    call !a1800_Builder_Code_Ok_PBOBJ-1
    return

//******************************
//* Close the Code Selection window
//******************************
!a1800_Builder_Code_Cancel_PBOBJ
    window close Builder_Code_WIN
    return

//******************************
//* Open the Code Assist window
//******************************
!a1800_Builder_Code_Assist_PBOBJ
    int    CodeCount       error
    string CodeCountStr    error
    string FullFileName    error
    int    CodeLineNumber  error

    if  (!CodeAssistReenter)   
+       window obtain Builder_Code_WIN
+   endif

    if  (Builder_Code_Codemodules_LBOBJ = null)
+       message = 'Please select a module'
+       window message error ok
+       window setfocus Builder_Code_Codemodules_LBOBJ
+       return
+   endif
    if  (Builder_Code_Codemodules_LBOBJ = '! Complete Program') or (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+       if  (CodeType != 'bedit')
+           message = "Can't use Complete Program for Code Assist"
+           window message error ok
+           window setfocus Builder_Code_Codemodules_LBOBJ
+           return
+   endif
    if  (Builder_Code_Codemodules_LBOBJ = '! Complete Program')
+       message = "Can't use Complete Program for Code Assist"
+       window message error ok
+       window setfocus Builder_Code_Codemodules_LBOBJ
+       return
+   endif

    if  (!CodeAssistReenter)
+       window pointer wait
+       window hwnd Builder_Codeassist_WIN status error window open Builder_Codeassist_WIN shade
+       window center Builder_Codeassist_WIN
+       close DebugConditionsFile error
+       open DebugConditionsFile null
+   endif
    if  (CodeType = 'bedit')
+       window show Builder_Codeassist_Code_PBOBJ
+       window show Builder_Codeassist_Refresh_PBOBJ
+       window show Builder_Codeassist_Test_PBOBJ
+       window show Builder_Codeassist_Log_PBOBJ
+       window show Builder_Codeassist_View_PBOBJ
+       window show Builder_Codeassist_Viewmods_RBOBJ
+       window show Builder_Codeassist_Viewfiles_RBOBJ
+       window show Builder_Codeassist_Viewvars_RBOBJ
+   else
+       window hide Builder_Codeassist_Code_PBOBJ
+       window hide Builder_Codeassist_Refresh_PBOBJ
+       window hide Builder_Codeassist_Test_PBOBJ
+       window hide Builder_Codeassist_Log_PBOBJ
+       //window hide Builder_Codeassist_View_PBOBJ
+       //window hide Builder_Codeassist_Viewmods_RBOBJ
+       //window hide Builder_Codeassist_Viewfiles_RBOBJ
+       //window hide Builder_Codeassist_Viewvars_RBOBJ
+       //window hide Builder_Codeassist_Debug_GBOBJ
+       //window hide Builder_Codeassist_Debugstep_PBOBJ
+       //window hide Builder_Codeassist_Debugstepover_PBOBJ
+       //window hide Builder_Codeassist_Debuggo_PBOBJ
+       //window hide Builder_Codeassist_Debugsetbreak_PBOBJ
+       //window hide Builder_Codeassist_Debugsetbrks_PBOBJ
+       //window hide Builder_Codeassist_Debugcond_PBOBJ
+       //window hide Builder_Codeassist_Debugfiles_PBOBJ
+       //window hide Builder_Codeassist_Debugdelbreak_PBOBJ
+       //window hide Builder_Codeassist_Debugclearbrks_PBOBJ
+       //window hide Builder_Codeassist_Debugstop_PBOBJ
+   endif
    if  (!BeditDebug)
+       //**************************
+       //* Disable the debug controls
+       //**************************
+       window disable Builder_Codeassist_Debugstep_PBOBJ
+       window disable Builder_Codeassist_Debugstepover_PBOBJ
+       window disable Builder_Codeassist_Debuggo_PBOBJ
+       window disable Builder_Codeassist_Debugsetbreak_PBOBJ
+       window disable Builder_Codeassist_Debugsetbrks_PBOBJ
+       window disable Builder_Codeassist_Debugdelbreak_PBOBJ
+       window disable Builder_Codeassist_Debugfiles_PBOBJ
+       window disable Builder_Codeassist_Debugcond_PBOBJ
+       window disable Builder_Codeassist_Debugclearbrks_PBOBJ
+       window disable Builder_Codeassist_Debugstop_PBOBJ
+   endif
    window clear Builder_Codeassist_WIN
    Builder_Codeassist_WIN = 'Code Assist - System[@SystemName@]'
    window title Builder_Codeassist_WIN 

    Builder_Codeassist_Viewmods_RBOBJ = 'Y'
    window modify Builder_Codeassist_Viewmods_RBOBJ
    Builder_Codeassist_Viewfiles_RBOBJ = 'N'
    window modify Builder_Codeassist_Viewfiles_RBOBJ
    Builder_Codeassist_Viewvars_RBOBJ = 'N'
    window modify Builder_Codeassist_Viewvars_RBOBJ

    //************************************
    //* Clear and load the Code list
    //************************************
    CurrModName = Builder_Code_Codemodules_LBOBJ
    if  (BeditDebug) and (CurrModName = OldModName) and (!DebugSetBreaks)
+       goto !a1800_Builder_Code_Assist_samemodule
+   endif    

    Builder_Codeassist_Code_STTXT = "Code: @Builder_Code_Codemodules_LBOBJ@"
    window modify Builder_Codeassist_Code_STTXT
    scan:/@Builder_Codeassist_Code_STTXT/:word
    OldModName = right

    Builder_Codeassist_Code_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Code_LBOBJ
    window paint Builder_Codeassist_Code_LBOBJ

    if  (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+        Builder_Code_Codemodules_LBOBJ = 'Global'
+   endif

    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'

    //**************************
    //* Find the Module start pos
    //**************************
    int    ModuleStartPos error
    int    CheckLinePos   error
    string DebugBreakChar error

    file ModuleStartPosFile error open ModuleStartPosFile null
    b
    //message = ModuleFileName window message info ok 
    SearchString = "@ModuleFileName@:"
    scan:/@SearchString/:|\|
    if (found) SearchString = right
    fs:/@SearchString@/
    if  (!eof)
+       scan:/@line/:/:/
+       ModuleStartPos = right
+   else
+       ModuleStartPos = 0
+   endif

    //**************************
    //* Load the module code into
    //* the code window
    //**************************
    close CodeFile error
    open CodeFile @ModuleFileName error return
    b
    CodeCount = 0     
    do
        if (!eof)
+          CodeCount ++
+          CodeCountStr = '00000@CodeCount@'
+          splitr:/@CodeCountStr@/;5          
+          Builder_Codeassist_Code_LBOBJ = right
+          //message = 'Before a1800_DebugBreakChar[@SearchString@]' window message info ok
+          call !a1800_DebugBreakChar
+          //message = 'After a1800_DebugBreakChar[@DebugBreakChar@]' window message info ok
+          file CodeFile
+          Builder_Codeassist_Code_LBOBJ = '@Builder_Codeassist_Code_LBOBJ@@DebugBreakChar@ @line@'
+          window insert end default Builder_Codeassist_Code_LBOBJ
+          f;1
+       endif
    until (eof)
    Builder_Codeassist_Code_LBOBJ = 'INDEX=1'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

!a1800_Builder_Code_Assist_samemodule
    //*********************************************************
    //* Clear and load the Variables & Modules Lists
    //*********************************************************
    if (BeditDebug)
+      goto !a1800_Builder_Code_Assist_PBOBJ_beditdebug
+   endif

    Builder_Codeassist_Variables_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Variables_LBOBJ
    window paint Builder_Codeassist_Variables_LBOBJ

    Builder_Codeassist_Modules_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Modules_LBOBJ
    window paint Builder_Codeassist_Modules_LBOBJ

    close VariableFile error
    open VariableFile null
    
    //************************************
    //* Load the BED Module and Variable Names
    //************************************
    string VarFileName error

    Builder_Codeassist_Modules_LBOBJ = "! Global Variables"
    window insert end default Builder_Codeassist_Modules_LBOBJ

    FullFileName = 'Bedit-code\@SystemName@.bed'
    open FullFile @FullFileName
    b
    do
        //*********************
        //* Module Name
        //*********************
        split:/@line/;1
        if (left = '!')
+          scan:/@line/:word
+          Builder_Codeassist_Modules_LBOBJ = left
+          window insert end default Builder_Codeassist_Modules_LBOBJ
+       endif
        Builder_Codeassist_Modules_LBOBJ = 'INDEX=1'
        window select Builder_Codeassist_Modules_LBOBJ
        Builder_Codeassist_Modules_LBOBJ = null
        //*********************
        //* Variables
        //*********************
        scan:/@line/:word
        lower left
        if (left = 'int') or (left = 'integer') or (left = 'string') or (left = 'float') or (left = 'dollar')
+          scan:/@right/:word
+          file VariableFile
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+             Builder_Codeassist_Variables_LBOBJ = left
+             window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        //*********************
        //* File open
        //*********************
        file FullFile
        scan:/@line/:word
        split:/@left/;2
        if (left != '//')
+          //scan:/@line/:/ open /
+          split:/@line/;1
+          scan:/@right/:word
+          if  (left = 'open')
+              scan:/@right/:word
+              VarFileName = left
+              subs ^
+              split:/^VarFileName^/;1
+              if (left != '@')
+                 subs @
+                 file VariableFile
+                 b
+                 fs:/@VarFileName/
+                 if (eof)
+                    i:/@VarFileName@/
+                    Builder_Codeassist_Variables_LBOBJ = VarFileName
+                    window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        subs @
        //*********************
        //* File pointer
        //*********************
        file FullFile
        scan:/@line/:word
        split:/@left/;2
        if (left != '//')
+          //scan:/@line/:/ file /
+          split:/@line/;1
+          scan:/@right/:word
+          if  (left = 'file')
+              scan:/@right/:word
+              VarFileName = left
+              subs ^
+              split:/^VarFileName^/;1
+              if (left != '@')
+                 subs @
+                 file VariableFile
+                 b
+                 fs:/@VarFileName/
+                 if (eof)
+                    i:/@VarFileName@/
+                    Builder_Codeassist_Variables_LBOBJ = VarFileName
+                    window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        subs @


        file FullFile
        f;1
    until (eof)
    close FullFile
    //************************************
    //* Load the WIN Variable Names
    //************************************
    FullFileName = '@SystemName@.win'
    open FullFile @FullFileName error goto !a1800_Builder_Code_Assist_system
    do
        scan:/@line/:/,/
        if (found)
+          scan:/@right/:/,/
+          file VariableFile
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+             Builder_Codeassist_Variables_LBOBJ = left
+             window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        file FullFile
        f;1       
    until (eof)
    close FullFile

!a1800_Builder_Code_Assist_system
    //************************************
    //* Insert the system variables
    //************************************
    Builder_Codeassist_Variables_LBOBJ = 'eof' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'line' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'left' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'mid' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'right' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'midright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'rword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'null' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'found' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'partial1' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'partial2' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'functionkey' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'pcount' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lineno' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lline' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lleft' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lmid' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lmidright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'llword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lrword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'calllevel' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'message' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'tab' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'date' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'time' window insert end default Builder_Codeassist_Variables_LBOBJ
    

    //*********************************************************
    //* Clear and load the Commands List
    //*********************************************************
    Builder_Codeassist_Commands_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Commands_LBOBJ
    window paint Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* B-Edit Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = 'b' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bell' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bookmark' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'break' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'buffer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'call' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'case' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'char' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cleankeys' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'clear' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'close' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cls' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'color' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cols' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'copy' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'country' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'crush' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'currdir' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cursor' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cut' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'debug' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'decrypt' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'decryptfile' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dir' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'direction' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'do' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dollar' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dump' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'eol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'erase' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'error' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'exit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'extract' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'f' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'file' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'files' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'filesize' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'filestring' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'float' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'front' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'fs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bedit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'goto' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'i' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'ib' window insert end default Builder_Codeassist_Commands_LBOBJ

    Builder_Codeassist_Commands_LBOBJ = 'if (a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (!a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a = b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a != b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a > b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a >= b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a < b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a <= b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a beginswith b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a endswith b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (numeric a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (digit a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (special a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (alpha a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (found)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (eol)' window insert end default Builder_Codeassist_Commands_LBOBJ

    Builder_Codeassist_Commands_LBOBJ = 'or' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'and' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'else' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'endif' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'initialize' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'input' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'integer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'list' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'leftjust' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'len' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'local' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'logfile' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'lower' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'md' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'mix' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'noco' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'nove' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'p' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pack' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'paste' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pasteb' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pattern' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'perm' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'print' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'printx' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'ps' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'r' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'random' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rd' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'read' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'restore' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'return' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rightjust' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rv' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rvs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'save' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'scan' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'scanr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'size' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'sleep' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'sort' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'split' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'splitr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'status' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'string' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'subs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'system' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'systemcurr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'trace' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'upper' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'until' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'user' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'veri' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'wait' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'waitbell' window insert end default Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* Multi-line Add Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = '*File Processing' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Comments' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Directory List' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Debug Lines' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Pad Left' window insert end default Builder_Codeassist_Commands_LBOBJ
    if (CodeType = 'bedit')
+      Builder_Codeassist_Commands_LBOBJ = '*Clear Screen' window insert end default Builder_Codeassist_Commands_LBOBJ
+      goto !a1800_Builder_Code_Assist_bypass_windows
+   endif

    Builder_Codeassist_Commands_LBOBJ = '*Directory Button' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Window Open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Clear List' window insert end default Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* Window Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = 'window action' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window autotab' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window backcolor' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window bitmap' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window center' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window check' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window clear' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window close' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window color' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window conceal' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window createcontrol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window createwindow' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window delete' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window deletecontrol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window deletewindow' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window default' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window disable' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window edit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window enable' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window fileinsert' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window getfocus' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window getfocuswin' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window hide' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window hwnd' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window insert' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window mask' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window message' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window modify' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window mousepos' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window obtain' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window paint' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window push' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window select' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window selectaction' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window setfocus' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window shade' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window show' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window size' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window sound' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window start' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window stop' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window timer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window title' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window uncheck' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unconceal' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unselect' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unshade' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window windowpos' window insert end default Builder_Codeassist_Commands_LBOBJ

!a1800_Builder_Code_Assist_PBOBJ_beditdebug
!a1800_Builder_Code_Assist_bypass_windows
    call !a1900_Backup_Code

    if  (!CodeAssistReenter)
+       window unshade Builder_Codeassist_WIN
+       window setfocus Builder_Codeassist_WIN
+       window paint Builder_Codeassist_WIN
+   endif
    CodeAssistReenter = 'n'
    window pointer arrow
    return

//******************************
//* Add the DebugBreakCharSet to the line loaded
//* in the code listbox if it's
//* set as a breakpoint
//******************************
!a1800_DebugBreakChar
    string CheckFileLinePos  error
    string TestDebugFilename error
    string FoundBreak        error

    DebugBreakChar = ' '
    //message = 'ModuleStartPos[@ModuleStartPos@] lineno[@lineno@]' window message info ok
    CheckLinePos = ModuleStartPos + lineno
    if (CheckLinePos > 1) CheckLinePos --
    file DebugBreakFile error open DebugBreakFile null
    b
    do
        if (!eof)
+          scan:/@line/:/./
+          if (found)
+             Newline = left
+             r:/@Newline/
+       endif
        f;1
    until (eof)

    CheckFileLinePos = null

    TestDebugFilename = BeditDebugFile
    FoundBreak = 'n'
    b
    do
        scan:/@line/:/:/
        CheckFileLinePos = left
        if-1 (CheckFileLinePos != CheckLinePos)
+          f;1
+       else-1
+          if-2 (TestDebugFilename = right)
+             FoundBreak = 'y'
+          else-2
+             f;1
+       endif
    until (eof) or (FoundBreak)
    if  (FoundBreak)
+       //DebugBreakChar = '®'
+       //DebugBreakChar = '©'
+       //message = 'Debug File[@BeditDebugFile@] - Breakpoint[@right@]' window message info ok
+       DebugBreakChar = DebugBreakCharSet
+   endif
    file CodeFile
    return

//******************************
//* Refresh the Builder_Code_WIN window
//******************************
!a1800_Builder_Code_Refresh_PBOBJ
    call !y500_bedit_code
    Builder_System_SystemList_COOBJ = SystemName
    BatchUpdating = 'y'
    call !a200_Builder_System_Modify_bedit
    BatchUpdating = 'n'
    return

//******************************
//* Test the B-Edit batch program
//******************************
!a1800_Builder_Code_Test_PBOBJ
    string WindowProg error
    WindowProg = 'n'
    MacroCommand = |if (exists @SystemName@.win) WindowProg = 'y'| $MacroCommand
    if-1 (WindowProg)
+      if-2  (BeditDebug)
+          MacroCommand = |system:"start beditwin -D call @SystemName@.bed"|
+          $MacroCommand
+          return 
+      else-2
+          MacroCommand = |system:"start beditwin call @SystemName@.bed"| 
+          $MacroCommand
+          return
+   endif

    if  (BeditDebug)
+       MacroCommand = |system:"start bedit -D call @SystemName@.bed"| 
+   else
+       MacroCommand = |system:"start bedit call @SystemName@.bed"| 
+   endif
    $MacroCommand
    return

//******************************
//* View the B-Edit batch flow
//******************************
!a1800_Builder_Code_View_PBOBJ 
    ViewSingleProg = 'y'
    HoldSystemName = SystemName
    Builder_Import_Filename_EFOBJ = '@SystemName@.bed'
    //message = Builder_Import_Filename_EFOBJ window message info ok
    Builder_Import_Extension_EFOBJ = 'BED'
    Extension = 'BED'
    call !a600_Builder_Import_OK_bedit_batch
    SystemName = HoldSystemName
    return

//******************************
//* Refresh the screen
//******************************
!a1900_Builder_Codeassist_Refresh_PBOBJ 
    string HoldCodeModule error
    HoldCodeModule = Builder_Code_Codemodules_LBOBJ
    CodeAssistReenter = 'y'
    call !a1900_Builder_Codeassist_Ok_PBOBJ
    Builder_Code_Codemodules_LBOBJ = HoldCodeModule
    call !a1800_Builder_Code_Assist_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Test the System
//****************************** 
!a1900_Builder_Codeassist_Test_PBOBJ 
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    CodeAssistReenter = 'y'
    call !a1800_Builder_Code_Test_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Debugger start
//****************************** 
!a1900_Builder_Codeassist_Debugrun_PBOBJ
    Builder_Codeassist_Debug_GBOBJ = 'Debug - @SystemName@ Running' window modify Builder_Codeassist_Debug_GBOBJ
    DEBUGHWND = null
    BeditDebugOldFile = SystemName
    BeditDebugFile = SystemName
    window hide MAIN
    window hide Builder_System_WIN
    window hide Builder_Code_WIN
    //**************************
    //* Turn on debugging
    //**************************
    window timer on 0
    BeditDebug = 'y'
    close DebugBreakFile error
    open DebugBreakFile null
    system:"del beditsem.*"

    //**************************
    //* Disable the window controls
    //**************************
    window disable Builder_Codeassist_Add_PBOBJ
    //window disable Builder_Codeassist_Code_LBOBJ
    window disable Builder_Codeassist_Commands_LBOBJ
    //window disable Builder_Codeassist_Variables_LBOBJ
    //window disable Builder_Codeassist_Modules_LBOBJ
    window disable Builder_Codeassist_Up_PBOBJ 
    window disable Builder_Codeassist_Down_PBOBJ 
    window disable Builder_Codeassist_Left_PBOBJ 
    window disable Builder_Codeassist_Right_PBOBJ 
    window disable Builder_Codeassist_Delete_PBOBJ 
    //window disable Builder_Codeassist_Code_EFOBJ 
    window disable Builder_Codeassist_Modify_PBOBJ 
    window disable Builder_Codeassist_Undo_PBOBJ 
    //window disable Builder_Codeassist_Code_PBOBJ 
    window disable Builder_Codeassist_Refresh_PBOBJ 
    window disable Builder_Codeassist_Ok_PBOBJ 
    window disable Builder_Codeassist_Close_PBOBJ 
    window disable Builder_Codeassist_Test_PBOBJ 
    window disable Builder_Codeassist_Log_PBOBJ 
    window disable Builder_Codeassist_Edit_PBOBJ
    //window disable Builder_Codeassist_View_PBOBJ
    //window disable Builder_Codeassist_Viewmods_RBOBJ
    //window disable Builder_Codeassist_Viewfiles_RBOBJ
    //window disable Builder_Codeassist_Viewvars_RBOBJ

    window disable Builder_Codeassist_Debugrun_PBOBJ
    //**************************
    //* Enable the Debug Controls
    //**************************
    window enable Builder_Codeassist_Debugstep_PBOBJ
    window enable Builder_Codeassist_Debugstepover_PBOBJ
    window enable Builder_Codeassist_Debuggo_PBOBJ
    window enable Builder_Codeassist_Debugsetbreak_PBOBJ
    window enable Builder_Codeassist_Debugsetbrks_PBOBJ
    window enable Builder_Codeassist_Debugdelbreak_PBOBJ
    window enable Builder_Codeassist_Debugcond_PBOBJ
    window enable Builder_Codeassist_Debugfiles_PBOBJ
    window enable Builder_Codeassist_Debugclearbrks_PBOBJ
    //window enable Builder_Codeassist_Debugstop_PBOBJ
    //**************************
    //* Refresh the screen & start debugging
    //**************************
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    CodeAssistReenter = 'y'
    call !a1800_Builder_Code_Test_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Debugger step 1 line
//****************************** 
!a1900_Builder_Codeassist_Debugstep_PBOBJ
    Builder_Codeassist_Debug_GBOBJ = 'Debug - @SystemName@ Running' window modify Builder_Codeassist_Debug_GBOBJ
    DebugAction = null
    //message = 'Step' window message info ok
    close beditsem error
    open beditsem null
    i:/STEP/
    write beditsem beditsem.go
    close beditsem
    return

//******************************
//* Debuger step to next line
//*   e.g. don't walk into call
//****************************** 
!a1900_Builder_Codeassist_Debugstepover_PBOBJ
    Builder_Codeassist_Debug_GBOBJ = 'Debug - @SystemName@ Running' window modify Builder_Codeassist_Debug_GBOBJ
    DebugAction = null
    close beditsem error
    open beditsem null
    i:/BREAKS/
    file DebugBreakFile error goto !a1900_Builder_Codeassist_Debugstepover_PBOBJ_nobreaks
    b
    do
        if (!eof)
+          scan:/@line/:/./
+          if (!found)
+             Newline = "@line@.bed"
+             r:/@Newline@/
+       endif
        f;1
    until (eof)
    b
    clear
    copy;*
    file beditsem
    paste
    BeditDebugLine ++
    string FilenameAdd        error
    FilenameAdd = BeditDebugFile
    if (FilenameAdd = null) FilenameAdd = SystemName
    Newline = /@BeditDebugLine@:@FilenameAdd@.bed/
    i:/@Newline@/
    file DebugConditionsFile error goto !a1900_Builder_Codeassist_Debugstepover_PBOBJ_nobreaks
    clear
    b
    copy;*
    b
    file beditsem
    paste
    //close DebugConditionsFile
    //open DebugConditionsFile null

!a1900_Builder_Codeassist_Debugstepover_PBOBJ_nobreaks
    write beditsem beditsem.go
    close beditsem
    return
    
//******************************
//* Debugger go to next break
//****************************** 
!a1900_Builder_Codeassist_Debuggo_PBOBJ
    Builder_Codeassist_Debug_GBOBJ = 'Debug - @SystemName@ Running' window modify Builder_Codeassist_Debug_GBOBJ
    if  (DEBUGHWND = null) or (DEBUGHWND != '0')
+       window enable Builder_Codeassist_Debugstop_PBOBJ
+   endif
    if  (DEBUGHWND != null) and (DEBUGHWND != '0')
+       window setfocus DEBUGHWND
+   endif
    if  (DebugType = 'bedit')
+       string DebugFocusWindow error
+       DebugFocusWindow = 'BEDIT.exe'
+       window focuswindowname DebugFocusWindow
+   endif
    DebugAction = 'window hide Builder_Codeassist_WIN'
    //message = 'Go' window message info ok
    close beditsem error
    open beditsem null
    i:/BREAKS/
    file DebugBreakFile error goto !a1900_Builder_Codeassist_Debuggo_PBOBJ_nobreaks
    b
    do
        if (!eof)
+          scan:/@line/:/./
+          if (!found)
+             Newline = "@line@.bed"
+             r:/@Newline@/
+       endif
        f;1
    until (eof)
    b
    clear
    copy;*
    file beditsem
    paste
    file DebugConditionsFile error goto !a1900_Builder_Codeassist_Debuggo_PBOBJ_nobreaks
    clear
    b
    copy;*
    file beditsem
    b
    paste
    //close DebugConditionsFile
    //open DebugConditionsFile null

!a1900_Builder_Codeassist_Debuggo_PBOBJ_nobreaks
    write beditsem beditsem.go
    close beditsem
    return

//******************************
//* Debugger set a break point
//****************************** 
!a1900_Builder_Codeassist_Debugsetbreak_PBOBJ
    int    DebugBreakLine  error
    string CheckModuleName error
    int    ModuleStartPos  error
    int    ModuleStartWork error
    int    HoldIndex       error

    Builder_Codeassist_Code_LBOBJ = 'INDEX'
    window obtain Builder_Codeassist_Code_LBOBJ
    pack Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = '0')
+       message = "Please select a Code line"
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif

    OldModName = null
    HoldIndex = Builder_Codeassist_Code_LBOBJ
    DebugBreakLine = Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Code_STTXT
    scan:/@Builder_Codeassist_Code_STTXT@/:word
    ModuleName = right
    //message = 'BeditDebugFile[@BeditDebugFile@] SystemName[@SystemName@]' window message info ok
    if (BeditDebugFile != SystemName)
+       goto !a1900_Builder_Codeassist_Debugsetbreak_nonsystemfile
+   endif

    //*****************************
    //* Locate the module start
    //*****************************
    if (ModuleName = '! Global Variables') ModuleName = 'Global'
    file ModuleStartPosFile
    b
    do
        scan:/@line/:/:/
        CheckModuleName = left
        ModuleStartWork = right
        scan:/@CheckModuleName/:|\|
        if (found) CheckModuleName = right
        scan:/@CheckModuleName@/:/./
        if (found) CheckModuleName = left
        if (CheckModuleName != ModuleName)
+          f;1
+       endif
    until (CheckModuleName = ModuleName) or (eof)
    if  (eof) 
+       message = 'Unable to locate starting position for Module[@ModuleName@]'
+       window message error ok
+       return
+   endif
    ModuleStartPos = ModuleStartWork
    DebugBreakLine += ModuleStartPos
    if  (DebugBreakLine > 1)
+       DebugBreakLine -= 1
+   endif

!a1900_Builder_Codeassist_Debugsetbreak_nonsystemfile
    //message = 'Break at [@DebugBreakLine@]' window message info ok
    //*****************************
    //* Break already exists?
    //*****************************
    file DebugBreakFile
    string FilenameAdd        error
    string CheckBreakFileLine error
    FilenameAdd = BeditDebugFile
    if (FilenameAdd = null) FilenameAdd = SystemName
    Newline = /@DebugBreakLine@:@FilenameAdd@/
    b
    do
        if  (Newline != line)
+           f;1
+       endif
    until (eof) or (Newline = line)
    if (eof)
+      i:/@Newline@/
+   endif

    if  (BeditDebugFile != SystemName)
+       Builder_Codeassist_Code_LBOBJ = null
+       window obtain Builder_Codeassist_Code_LBOBJ 
+       split:/@Builder_Codeassist_Code_LBOBJ@/;5
+       HoldLeft = left
+       split:/@right/;1
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
+       window delete Builder_Codeassist_Code_LBOBJ
+       if (left != DebugBreakCharSet)
+          Builder_Codeassist_Code_LBOBJ = '@HoldLeft@@DebugBreakCharSet@@right@'
+       else
+          Builder_Codeassist_Code_LBOBJ = '@HoldLeft@ @right@'
+   endif
    if  (BeditDebugFile != SystemName)
+       window insert end default Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
+       window select Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif

    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    BumpIndex = HoldIndex + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Set Many Breakpoints
//******************************
!a1900_Builder_Codeassist_Debugsetbrks_PBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ
    if  (Builder_Codeassist_Code_EFOBJ = null)
+       message = 'Please enter a search string'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    string FilenameAdd        error
    FilenameAdd = BeditDebugFile
    if (FilenameAdd = null) FilenameAdd = SystemName
    OldModName = null
    file DebugBreakFile error open DebugBreakFile null
    MacroCommand = 'open SetBreakpointsCodeFile @SystemName@.bed' $MacroCommand
    file SetBreakpointsCodeFile
    b
    do
        fs:/@Builder_Codeassist_Code_EFOBJ@/
        if  (!eof)
+           Newline = /@lineno@:@FilenameAdd@/
+           file DebugBreakFile
+           i:/@Newline@/
+           file SetBreakpointsCodeFile
+           f;1
+       endif
    until (eof)
    b
    fs:/@Builder_Codeassist_Code_EFOBJ@/
    if  (eof)
+       ErrorPos = 1
+   else
+       ErrorPos = lineno
+   endif

    close SetBreakpointsCodeFile
    BatchUpdating = 'y'
    DebugSetBreaks = 'y'

    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    Builder_Find_Find_EFOBJ = Builder_Codeassist_Code_EFOBJ
    file DebugBreakFile
    b
    scan:/@line/:/:/
    ErrorPos = left
    call !a1900_Builder_Codeassist_Log_errorloc
    //call !a1900_Builder_Codeassist_Hilight_Line
    DebugSetBreaks = 'n'
    BatchUpdating = 'n'


    return

//******************************
//* Debugger Conditional Breaks
//****************************** 
!a1900_Builder_Codeassist_Debugcond_PBOBJ
    window pointer wait
    window hwnd Builder_Debugcond_WIN status error window open Builder_Debugcond_WIN shade
    window clear Builder_Debugcond_WIN
    window center Builder_Debugcond_WIN
    window show Builder_Debugcond_WIN
    window pointer arrow

    //*****************************
    //* Load the Variables List
    //*****************************
    Builder_Debugcond_Vars_LBOBJ = 'ALL'
    window delete Builder_Debugcond_Vars_LBOBJ
    window paint Builder_Debugcond_Vars_LBOBJ

    //************************************
    //* Insert the system variables
    //************************************
    Builder_Debugcond_Vars_LBOBJ = 'line' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'left' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'mid' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'right' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'midright' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lword' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'rword' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'null' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'found' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'partial1' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'partial2' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'functionkey' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'pcount' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lineno' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lline' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lleft' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lmid' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lright' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lmidright' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'llword' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'lrword' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'calllevel' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'message' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'tab' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'date' window insert end default Builder_Debugcond_Vars_LBOBJ
    Builder_Debugcond_Vars_LBOBJ = 'time' window insert end default Builder_Debugcond_Vars_LBOBJ


    //************************************
    //* Insert the program variables
    //************************************
    close DebugCondVars error
    open DebugCondVars null
    close DebugCondSource error
    MacroCommand = 'open DebugCondSource @SystemName@.bed' $MacroCommand

    b
    do
        scan:/@line/:word
        lower left
        if (left = 'int') or (left = 'integer') or (left = 'string') or (left = 'float') or (left = 'dollar')
+          scan:/@right/:word
+          file DebugCondVars
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+             Builder_Debugcond_Vars_LBOBJ = left
+             window insert end default Builder_Debugcond_Vars_LBOBJ
+       endif

        file DebugCondSource
        f;1
    until (eof)
    close DebugCondSource 
    close DebugCondVars   

    //*****************************
    //* Load the Conditions List
    //*****************************
    Builder_Debugcond_Conditions_LBOBJ = 'ALL'
    window delete Builder_Debugcond_Conditions_LBOBJ
    window paint Builder_Debugcond_Conditions_LBOBJ
    Builder_Debugcond_Conditions_LBOBJ = '=' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = '!=' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = '>' window insert end default Builder_Debugcond_Conditions_LBOBJ  
    Builder_Debugcond_Conditions_LBOBJ = '>=' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = '<' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = '<=' window insert end default Builder_Debugcond_Conditions_LBOBJ
    Builder_Debugcond_Conditions_LBOBJ = 'TRUE' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = 'FALSE' window insert end default Builder_Debugcond_Conditions_LBOBJ 
    Builder_Debugcond_Conditions_LBOBJ = 'Contains' window insert end default Builder_Debugcond_Conditions_LBOBJ  

    //*****************************
    //* Load the Set Conditions List
    //***************************** 
    file DebugConditionsFile error open DebugConditionsFile null
    b
    do
        if  (!eof)
+           scan:/@line/:/:/
+           scan:/@right/:/,/
+           Builder_Debugcond_Setcond_LBOBJ = left
+           scan:/@right/:/,/
+           Builder_Debugcond_Setcond_LBOBJ = '@Builder_Debugcond_Setcond_LBOBJ@ @left@ @right@'
+           window insert end default Builder_Debugcond_Setcond_LBOBJ
+           f;1
+       endif
    until (eof)

    return

//******************************
//* Debugger remove a break point
//****************************** 
!a1900_Builder_Codeassist_Debugdelbreak_PBOBJ
    int    DebugBreakLine  error
    string CheckModuleName error
    int    ModuleStartPos  error
    int    ModuleStartWork error
    int    DebugHoldPos    error

    Builder_Codeassist_Code_LBOBJ = 'INDEX'
    window obtain Builder_Codeassist_Code_LBOBJ
    pack Builder_Codeassist_Code_LBOBJ
    //message = Builder_Codeassist_Code_LBOBJ window message info ok
    if  (Builder_Codeassist_Code_LBOBJ = '0')
+       message = "Please select a Code line"
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    OldModName = null
    DebugHoldPos = Builder_Codeassist_Code_LBOBJ
    DebugBreakLine = Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Code_STTXT
    scan:/@Builder_Codeassist_Code_STTXT@/:word
    ModuleName = right

    if  (BeditDebugFile != SystemName)
+       goto !a1900_Builder_Codeassist_Debugdelbreak_nonsystemfile
+   endif

    //*****************************
    //* Locate the module start
    //*****************************
    if (ModuleName = '! Global Variables') ModuleName = 'Global'
    file ModuleStartPosFile
    b
    do
        scan:/@line/:/:/
        CheckModuleName = left
        ModuleStartWork = right
        scan:/@CheckModuleName/:|\|
        if (found) CheckModuleName = right
        scan:/@CheckModuleName@/:/./
        if (found) CheckModuleName = left
        if (CheckModuleName != ModuleName)
+          f;1
+       endif
    until (CheckModuleName = ModuleName) or (eof)
    if  (eof) 
+       message = 'Unable to locate starting position for Module[@ModuleName@]'
+       window message error ok
+       return
+   endif
    ModuleStartPos = ModuleStartWork
    DebugBreakLine += ModuleStartPos
    if  (DebugBreakLine > 1)
+       DebugBreakLine -= 1
+   endif
    //message = 'Removing Break at [@DebugBreakLine@][@ModuleStartPos@]' window message info ok

!a1900_Builder_Codeassist_Debugdelbreak_nonsystemfile
    //*****************************
    //* Remove Break
    //*****************************
    Newline = /@DebugBreakLine@:@FilenameAdd@/
    file DebugBreakFile
    string DebugBreakFileLine error
    b
    do
        scan:/@line/:/:/
        DebugBreakFileLine = left
        if  (Newline != line)
+           f;1
+       endif
    until (eof) or (Newline = line)
    if (!eof)
+      d;1
+   endif

    if  (BeditDebugFile != SystemName)
+       Builder_Codeassist_Code_LBOBJ = null
+       window obtain Builder_Codeassist_Code_LBOBJ 
+       split:/@Builder_Codeassist_Code_LBOBJ@/;5
+       HoldLeft = left
+       split:/@right/;1
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
+       window delete Builder_Codeassist_Code_LBOBJ
+       if (left != DebugBreakCharSet)
+          Builder_Codeassist_Code_LBOBJ = '@HoldLeft@@DebugBreakCharSet@@right@'
+       else
+          Builder_Codeassist_Code_LBOBJ = '@HoldLeft@ @right@'
+   endif
    if  (BeditDebugFile != SystemName)
+       window insert end default Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
+       window select Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif

    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    BumpIndex = DebugHoldPos + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window paint Builder_Codeassist_Code_LBOBJ
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@DebugHoldPos@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Debugger clear all breaks
//****************************** 
!a1900_Builder_Codeassist_Debugclearbrks_PBOBJ
    close DebugBreakFile error
    open DebugBreakFile null
    OldModName = null
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    return

//******************************
//* Debugger Show Files
//****************************** 
!a1900_Builder_Codeassist_Debugfiles_PBOBJ
    close Beditsem error
    open Beditsem null
    i:/FILELIST/
    write Beditsem beditsem.go
    close Beditsem
    return

//******************************
//* Debugger stop
//****************************** 
!a1900_Builder_Codeassist_Debugstop_PBOBJ
    if  (DebugType = 'bedit')
+       string CloseWindow error
+       CloseWindow = 'BEDIT.exe'
+       window closewindowname CloseWindow
+   endif
    Builder_Codeassist_Debug_GBOBJ = 'Debug' window modify Builder_Codeassist_Debug_GBOBJ
    if (DEBUGHWND != null) and (DEBUGHWND != 0)
+      window close DEBUGHWND
+      DEBUGHWND = null
+   endif
    window show MAIN
    call !a100_WindowInit
    window show Builder_System_WIN
    window show Builder_Code_WIN
    window hide Builder_Codeassist_WIN
    window show Builder_Codeassist_WIN
    window center Builder_Codeassist_WIN
    //**************************
    //* Turn off debugging
    //**************************
    window timer off
    BeditDebug = 'n'
    system:"del beditsem.*"
    close DebugBreakFile error
    open DebugBreakFile null

    //**************************
    //* Enable the window controls
    //**************************
    window enable Builder_Codeassist_Add_PBOBJ
    window enable Builder_Codeassist_Code_LBOBJ
    window enable Builder_Codeassist_Commands_LBOBJ
    window enable Builder_Codeassist_Variables_LBOBJ
    window enable Builder_Codeassist_Modules_LBOBJ
    window enable Builder_Codeassist_Up_PBOBJ 
    window enable Builder_Codeassist_Down_PBOBJ 
    window enable Builder_Codeassist_Left_PBOBJ 
    window enable Builder_Codeassist_Right_PBOBJ 
    window enable Builder_Codeassist_Delete_PBOBJ 
    window enable Builder_Codeassist_Code_EFOBJ 
    window enable Builder_Codeassist_Modify_PBOBJ 
    window enable Builder_Codeassist_Undo_PBOBJ 
    window enable Builder_Codeassist_Code_PBOBJ 
    window enable Builder_Codeassist_Refresh_PBOBJ 
    window enable Builder_Codeassist_Ok_PBOBJ 
    window enable Builder_Codeassist_Close_PBOBJ 
    window enable Builder_Codeassist_Test_PBOBJ 
    window enable Builder_Codeassist_Log_PBOBJ 
    window enable Builder_Codeassist_Edit_PBOBJ
    window enable Builder_Codeassist_View_PBOBJ
    window enable Builder_Codeassist_Viewmods_RBOBJ
    window enable Builder_Codeassist_Viewfiles_RBOBJ
    window enable Builder_Codeassist_Viewvars_RBOBJ

    window enable Builder_Codeassist_Debugrun_PBOBJ
    //**************************
    //* Disable the debug controls
    //**************************
    window disable Builder_Codeassist_Debugstep_PBOBJ
    window disable Builder_Codeassist_Debuggo_PBOBJ
    window disable Builder_Codeassist_Debugsetbreak_PBOBJ
    window disable Builder_Codeassist_Debugdelbreak_PBOBJ
    window disable Builder_Codeassist_Debugfiles_PBOBJ
    window disable Builder_Codeassist_Debugcond_PBOBJ
    window disable Builder_Codeassist_Debugclearbrks_PBOBJ
    window disable Builder_Codeassist_Debugstop_PBOBJ

    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    return

//******************************
//* Debugger Help
//****************************** 
!a1900_Builder_Codeassist_Debughelp_PBOBJ
    window pointer wait
    window hwnd Builder_Debughelp_WIN status error window open Builder_Debughelp_WIN shade
    window center Builder_Debughelp_WIN
    window clear Builder_Debughelp_WIN
    window show Builder_Debughelp_WIN
    window setfocus Builder_Debughelp_Close_PBOBJ
    window pointer arrow
    return

//******************************
//* Debug Help Close
//****************************** 
!a1900_Builder_Debughelp_Close_PBOBJ
    window close Builder_Debughelp_WIN
    return

//******************************
//* Add a Conditional Break-Point
//******************************
!a1900_Builder_Debugcond_Add_PBOBJ
    Builder_Debugcond_Vars_LBOBJ = null
    window obtain Builder_Debugcond_Vars_LBOBJ
    pack Builder_Debugcond_Vars_LBOBJ
    if  (Builder_Debugcond_Vars_LBOBJ = null)
+       message = 'Please select a Variable'
+       window message error ok
+       window setfocus Builder_Debugcond_Vars_LBOBJ
+       return
+   endif

    Builder_Debugcond_Conditions_LBOBJ = null
    window obtain Builder_Debugcond_Conditions_LBOBJ
    pack Builder_Debugcond_Conditions_LBOBJ
    if  (Builder_Debugcond_Conditions_LBOBJ = null)
+       message = 'Please select a Condition'
+       window message error ok
+       window setfocus Builder_Debugcond_Conditions_LBOBJ
+       return
+   endif

    if-1  (Builder_Debugcond_Conditions_LBOBJ = 'TRUE') or (Builder_Debugcond_Conditions_LBOBJ = 'FALSE')
+       Builder_Debugcond_Value_EFOBJ = Builder_Debugcond_Conditions_LBOBJ
+   else-1
+       window obtain Builder_Debugcond_Value_EFOBJ
+       if-2 (Builder_Debugcond_Value_EFOBJ = null)
+          message = 'Please enter a Value'
+          window message error ok
+          window setfocus Builder_Debugcond_Value_EFOBJ
+          return
+   endif
     
    Builder_Debugcond_Setcond_LBOBJ = '@Builder_Debugcond_Vars_LBOBJ@ @Builder_Debugcond_Conditions_LBOBJ@ @Builder_Debugcond_Value_EFOBJ@'
    window insert end default Builder_Debugcond_Setcond_LBOBJ
    return

//******************************
//* Delete a Conditional Break-Point
//******************************
!a1900_Builder_Debugcond_Delete_PBOBJ
     Builder_Debugcond_Setcond_LBOBJ = 'INDEX'
     window obtain Builder_Debugcond_Setcond_LBOBJ
     if  (Builder_Debugcond_Setcond_LBOBJ = '0')
+        message = 'Please select a Break-Point'
+        window message error ok
+        window setfocus Builder_Debugcond_Setcond_LBOBJ
+        return
+    endif  
     message = 'Are you sure?'
     window message question yesno
     if  (message)   
+        Builder_Debugcond_Setcond_LBOBJ = 'INDEX=@Builder_Debugcond_Setcond_LBOBJ@'
+        window delete Builder_Debugcond_Setcond_LBOBJ
     return

//******************************
//* View the Bedit.log file
//******************************
!a1900_Builder_Debugcond_Ok_PBOBJ
     close DebugConditionsFile error
     open DebugConditionsFile null
     int ConditionCount error
     ConditionCount = 1

     Builder_Debugcond_Setcond_LBOBJ = 'INDEX=@ConditionCount@'
     do
         window obtain Builder_Debugcond_Setcond_LBOBJ
         if  (Builder_Debugcond_Setcond_LBOBJ != null)
+            scan:/@Builder_Debugcond_Setcond_LBOBJ@/:word
+            Newline = 'COND:@left@'
+            scan:/@right/:word
+            Newline = '@Newline@,@left@,@right@'
+            file DebugConditionsFile
+            i:/@Newline@/
+            ConditionCount ++
+            Builder_Debugcond_Setcond_LBOBJ = 'INDEX=@ConditionCount@'
+        endif
     until (Builder_Debugcond_Setcond_LBOBJ = null)
     window close Builder_Debugcond_WIN
     return

//******************************
//* View the Bedit.log file
//******************************
!a1900_Builder_Debugcond_Cancel_PBOBJ
     window close Builder_Debugcond_WIN
     return

//******************************
//* View the Bedit.log file
//******************************
!a1900_Builder_Codeassist_Log_PBOBJ
    if  (exists bedit.log)
+       close LogErrorCode error
+       open LogErrorCode bedit.log
+       b
+       fs:/on line/
+       if (!eof)
+          scan:/@line/:/on line/
+          scan:/@right/:word
+          ErrorPos = left
+          call !a1900_Builder_Codeassist_Log_errorloc
+   endif
    if  (exists bedit.log)
+       system:"start notepad bedit.log"
+   endif
    return

//******************************
//* Edit the Full Program Code
//******************************
!a1900_Builder_Codeassist_Edit_PBOBJ
    window push Builder_Codeassist_Close_PBOBJ
    window push Builder_Code_Cancel_PBOBJ
    window close Builder_Code_WIN
    window close Builder_Window_WIN
    window push Builder_System_Open_PBOBJ
    return

//******************************
//* Find the Module & location of error
//****************************** 
!a1900_Builder_Codeassist_Log_errorloc
    int CheckErrorPos  error
    int ModuleErrorPos error
    int ModulePosStart error
    string ErrorModuleName error
    //message = 'errorloc1' window message info ok
    if (BeditDebug) and (BeditDebugFile != SystemName)
+      ModuleErrorPos = ErrorPos
+      goto !a1900_Builder_Codeassist_Log_errorloc_Select
+   endif

    //message = 'errorloc2' window message info ok
    file ModuleStartPosFile
    b
    //message = 'debug 1 [@ErrorPos@]' window message info ok
    do
        if (!eof)
+          scan:/@line/:/:/
+          CheckErrorPos = right
+          if  (CheckErrorPos <= ErrorPos)
+              f;1
+       endif
    until (CheckErrorPos > ErrorPos) or (eof)
    if (!eof)
+       b;1    
+   endif
    //message = 'debug 2' window message info ok

    //**************************
    //* Calculate the error pos
    //**************************
    scan:/@line/:/:/
    ErrorModuleName = left
    ModulePosStart = right
    scan:/@ErrorModuleName@/:/./
    if (found) ErrorModuleName = left
    if (ErrorModuleName = 'Global') ErrorModuleName = '! Global Variables'
    ModuleErrorPos = ErrorPos - ModulePosStart + 1

    //message = 'Error on [@ErrorPos@] in @line@ f;@ModuleErrorPos@' window message info ok

    //**************************
    //* Load the Module Code
    //**************************
    Builder_Codeassist_Modules_LBOBJ = ErrorModuleName
    call !a1900_Builder_Codeassist_Code_PBOBJ_log

    //message = 'errorloc3' window message info ok

!a1900_Builder_Codeassist_Log_errorloc_Select
    //message = 'errorloc4' window message info ok
    //**************************
    //* Select the Error line
    //**************************
    BumpIndex = ModuleErrorPos + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@ModuleErrorPos@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* View the System Modules
//****************************** 
!a1900_Builder_Codeassist_View_PBOBJ
    window obtain Builder_Codeassist_WIN
    Builder_Import_Viewmods_RBOBJ = Builder_Codeassist_Viewmods_RBOBJ 
    Builder_Import_Viewfiles_RBOBJ = Builder_Codeassist_Viewfiles_RBOBJ 
    Builder_Import_Viewvars_RBOBJ = Builder_Codeassist_Viewvars_RBOBJ 
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    CodeAssistReenter = 'y'
    call !a1800_Builder_Code_View_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Code Assist on Module selection
//******************************
!a1900_Builder_Codeassist_Code_PBOBJ 
    window obtain Builder_Codeassist_Modules_LBOBJ
!a1900_Builder_Codeassist_Code_PBOBJ_log
    split:/@Builder_Codeassist_Modules_LBOBJ/;1
    if  (left != '!')
+       message = 'Please select a Module from the list'
+       window message error ok
+       window setfocus Builder_Codeassist_Modules_LBOBJ
+       return
+   endif
    Builder_Code_Codemodules_LBOBJ = Builder_Codeassist_Modules_LBOBJ
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    return

//******************************
//* Save the new code
//******************************
!a1900_Builder_Codeassist_Ok_PBOBJ
    file CodeFile error return
    write CodeFile @ModuleFileName
    MacroCommand = |open CheckCode @SystemName@.bed| $MacroCommand
    file CodeFile
    b
    do
        pattern on
        fs:/ call*!/
        pattern off
        if (!eof)
+          call !a1900_Builder_Codeassist_Add_New_Module
+       endif
        file CodeFile
        f;1
    until (eof)
    close CheckCode
    close CodeFile
    close CodeBackup
    if (!CodeAssistReenter)
+      window close Builder_Codeassist_WIN
+      window close Builder_Code_WIN
+      if  (WindowDebug)
+          WindowDebug = 'n'
+          CodeType = 'beditwin'
+          window show Builder_Window_WIN
+          window setfocus Builder_Window_WIN
+   endif
    if (CodeType = 'bedit')
+      call !y500_bedit_code
+      //window close Builder_Code_WIN
+      Builder_System_SystemList_COOBJ = SystemName
+      BatchUpdating = 'y'
+      call !a200_Builder_System_Modify_bedit
+      BatchUpdating = 'n'
+   endif
    return


//******************************
//* Add a new module if needed
//******************************
!a1900_Builder_Codeassist_Add_New_Module
    string NewModuleName   error
    string CheckModuleName error

    scan:/@line/:/call/
    scan:/@right/:word
    NewModuleName = left
    file CheckCode
    b
!a1900_Builder_Codeassist_Add_New_Module_loop
    fs:/@NewModuleName@/
    if-1 (!eof)
+      split:/@line/;1
+      if-2 (left != '!')
+         //* Not a Module Header
+         f;1
+         goto !a1900_Builder_Codeassist_Add_New_Module_loop
+      else-2
+         //* Code Exists
+         return
+   endif
    //message = 'adding module @NewModuleName@' window message info ok

    open NewModuleFile null
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |@NewModuleName@| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    MacroCommand = |write NewModuleFile Bedit-code\@NewModuleName@.bed| $MacroCommand 
    close NewModuleFile
    file ModuleNameFile
    i:/@NewModuleName@/
    sort ModuleNameFile,A,1   
    return

//******************************
//* Close the Code Assist window
//******************************
!a1900_Builder_Codeassist_Close_PBOBJ
    close CodeFile error
    close CodeBackup error
    window close Builder_Codeassist_WIN
    window close Builder_Code_WIN
    if  (WindowDebug)
+       WindowDebug = 'n'
+       CodeType = 'beditwin'
+       window show Builder_Window_WIN
+       window setfocus Builder_Window_WIN
+   endif
    return

//******************************
//* Move a code line up
//******************************
!a1900_Builder_Codeassist_Up_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif

    split:/@Builder_Codeassist_Code_LBOBJ@/;5
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile
    if (CodeLineNumber = 1)
+      return
+   endif

    //********************
    //* Move the Line
    //********************
    b
    CodeLineNumber --
    f;@CodeLineNumber
    clear
    if-1 (CodeLineNumber = 1)
+      b
+      cut
+      paste
+   else-1
+      cut
+      if-2 (eof)
+         b;1
+         paste
+      else-2
+         b;2
+         paste
+   endif

    call !a1900_reload_code

    //************************************
    //* Select the line
    //************************************
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    return

//******************************
//* Move a code line Down
//******************************
!a1900_Builder_Codeassist_Down_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    split:/@Builder_Codeassist_Code_LBOBJ@/;1
    scan:/@right@/:word
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Move the Line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    clear
    cut
    if (eof)
+      CodeLineNumber ++
+   else
+      CodeLineNumber = CodeLineNumber + 2
+   endif
    paste

    call !a1900_reload_code

    //************************************
    //* Select the line
    //************************************
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    return

//******************************
//* Delete a line of code
//******************************
!a1900_Builder_Codeassist_Delete_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    split:/@Builder_Codeassist_Code_LBOBJ@/;5
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Delete the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    d;1
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Indent a line to the left
//******************************
!a1900_Builder_Codeassist_Left_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber   error
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    split:/@Builder_Codeassist_Code_LBOBJ@/;5
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Remove Indent from the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    split:/@line/;4
    if (left != '    ') and (left != '+   ')
+      return
+   endif
    if (left = '+   ')
+      Newline = '+@right@'
+   else
+      Newline = right
+   endif
    r:/@Newline@/

    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber ++
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Indent a line to the right
//******************************
!a1900_Builder_Codeassist_Right_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber   error
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    split:/@Builder_Codeassist_Code_LBOBJ@/;5
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Indent the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    split:/@line/;1
    if (left = '!') return
    if (left = '+')
+      Newline = '+   @right@'
+   else
+      Newline = "    @line@"
+   endif
    r:/@Newline@/
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber ++
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Add a Code Line
//******************************
!a1900_Builder_Codeassist_Add_PBOBJ
    if (BeditDebug) return
    integer CodeLineNumber error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_EFOBJ = null)
+       message = 'Please enter a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    file CodeFile

    if (Builder_Codeassist_Code_LBOBJ = null)
+      b
+      f;*
+      CodeLineNumber = pcount + 1
+   else
+      split:/@Builder_Codeassist_Code_LBOBJ@/;5
+      CodeLineNumber = left
+   endif
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok

    //********************
    //* Remove Indent from the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif

//    split:/@Builder_Codeassist_Code_EFOBJ@/;1
//    if (left != '!')
//+      split:/@Builder_Codeassist_Code_EFOBJ@/;2
//+      if  (left != '//') and (left != '  ') and (left != '+ ')
//+          Builder_Codeassist_Code_EFOBJ = '    @Builder_Codeassist_Code_EFOBJ@'
//+   endif

    //******************************
    //* Check for "if"
    //******************************
    split:/@Builder_Codeassist_Code_EFOBJ@/;1
    if (left = '+') goto !a1900_Builder_Codeassist_Add_passif 

    if  (ModifyCode)
+       AddIndent = null
+   else
+       call !a1900_Add_Indent
+   endif
    Builder_Codeassist_Code_EFOBJ = '@AddIndent@@Builder_Codeassist_Code_EFOBJ@'
    goto !a1900_Builder_Codeassist_Add_passif //fgb02032014

    scan:/@line/:word
    lower left
    if (left = 'if')
+      Builder_Codeassist_Code_EFOBJ = '+   @Builder_Codeassist_Code_EFOBJ@'
+   else
+      split:/@line/;1
+      if (left = '+')
+         scan:/@right/:word
+         if (left != 'endif')
+            Builder_Codeassist_Code_EFOBJ = '+   @Builder_Codeassist_Code_EFOBJ@'
+   endif

!a1900_Builder_Codeassist_Add_passif    
    file CodeFile  
    i:/@Builder_Codeassist_Code_EFOBJ@/
    //message = 'ModuleFileName[@ModuleFileName@]' window message info ok
    //write CodeFile @ModuleFileName 
    b
    rs:/$&$Var1/:/@Builder_Codeassist_Variables_LBOBJ@/;*
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber = CodeLineNumber + 2
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    
    VariableType = null
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ string / if (found) VariableType = 'string' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ int / if (found) VariableType = 'int' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ integer / if (found) VariableType = 'integer' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ float / if (found) VariableType = 'float' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ dollar / if (found) VariableType = 'dollar' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ open / if (found) VariableType = 'file' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ file / if (found) VariableType = 'file' goto !a1900_Builder_Codeassist_Add_variable

!a1900_Builder_Codeassist_Add_variable
    if-1 (found)
+      scan:/@right/:word
+      file VariableFile
+      b
+      fs:/@left/
+      if-2 (eof)
+         i:/@left@/
+         Builder_Codeassist_Variables_LBOBJ = left
+         window insert end default Builder_Codeassist_Variables_LBOBJ
+      else-2
+         if-3 (VariableType != 'file') and (!ModifyCode)
+             message = 'Variable already exists!'
+             window message warning ok
+   endif

    Builder_Codeassist_Code_EFOBJ = null
    window modify Builder_Codeassist_Code_EFOBJ
    window setfocus Builder_Codeassist_Code_EFOBJ

    return

//******************************
//* Replace a line of code
//******************************
!a1900_Builder_Codeassist_Modify_PBOBJ
    if (BeditDebug) return
    integer KeepLineNumber error

    call !a1900_Backup_Code


    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    if  (Builder_Codeassist_Code_EFOBJ = null)
+       message = 'Please enter a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif

    file CodeFile
    f;*
    CodeLineNumber = pcount + 1
    call !a1900_Builder_Codeassist_Delete_PBOBJ

    CodeLineNumber ++
    KeepLineNumber = CodeLineNumber

    //************************************
    //* Select the line
    //************************************
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    CodeLineNumber ++
    ModifyCode = 'y'
    call !a1900_Builder_Codeassist_Add_PBOBJ
    ModifyCode = 'n'

    file CodeFile
    b
    rs:/$&$Var1/:/@Builder_Codeassist_Variables_LBOBJ@/;*
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    f;1
    if (!eof)    
+      call !a1900_Builder_Codeassist_Up_PBOBJ
+   endif

    window setfocus Builder_Codeassist_Code_LBOBJ
    window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Undo the last change
//******************************
!a1900_Builder_Codeassist_Undo_PBOBJ
    if (BeditDebug) return
    window obtain Builder_Codeassist_Code_LBOBJ
    file CodeBackup
    clear
    b
    copy;*
    file CodeFile
    b
    d;*
    paste

    call !a1900_find_position
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 1
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Open the Find window
//******************************
!a1900_Builder_Codeassist_Find_PBOBJ
    window pointer wait
    window hwnd Builder_Find_WIN status error window open Builder_Find_WIN shade
    window center Builder_Find_WIN
    window clear Builder_Find_WIN
    window obtain Builder_Codeassist_Code_EFOBJ
    Builder_Find_Find_EFOBJ = Builder_Codeassist_Code_EFOBJ
    window modify Builder_Find_Find_EFOBJ
    window show Builder_Find_WIN
    window pointer arrow

    int    DebugBreakLine  error
    string CheckModuleName error
    int    ModuleStartPos  error
    int    ModuleStartWork error
    int    HoldIndex       error
    string FindReplace     error

    ErrorPos = 1

    return

//******************************
//* Find text in the code
//******************************
!a1900_Builder_Find_Find_PBOBJ
    window obtain Builder_Find_Find_EFOBJ
    if  (Builder_Find_Find_EFOBJ = null)
+       message = 'Please enter a Find string'
+       window message error ok
+       window setfocus Builder_Find_Find_EFOBJ
+       return
+   endif

    Builder_Codeassist_Code_LBOBJ = 'INDEX'
    window obtain Builder_Codeassist_Code_LBOBJ
    pack Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = '0')
+       ErrorPos = 1
+       goto !a1900_Builder_Codeassist_Hilight_Line
+   endif

    HoldIndex = Builder_Codeassist_Code_LBOBJ
    DebugBreakLine = Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Code_STTXT
    scan:/@Builder_Codeassist_Code_STTXT@/:word
    ModuleName = right

    //*****************************
    //* Locate the module start
    //*****************************
    if (ModuleName = '! Global Variables') ModuleName = 'Global'
    file ModuleStartPosFile
    b
    do
        scan:/@line/:/:/
        CheckModuleName = left
        ModuleStartWork = right
        scan:/@CheckModuleName/:|\|
        if (found) CheckModuleName = right
        scan:/@CheckModuleName@/:/./
        if (found) CheckModuleName = left
        if (CheckModuleName != ModuleName)
+          f;1
+       endif
    until (CheckModuleName = ModuleName) or (eof)
    if  (eof) 
+       message = 'Unable to locate starting position for Module[@ModuleName@]'
+       window message error ok
+       return
+   endif
    ModuleStartPos = ModuleStartWork
    DebugBreakLine += ModuleStartPos
    if  (DebugBreakLine > 1)
+       DebugBreakLine -= 1
+   endif
    //message = 'Selected line at [@DebugBreakLine@]' window message info ok
    ErrorPos = DebugBreakLine

!a1900_Builder_Codeassist_Hilight_Line
    string SearchStr1 error
    SearchStr1 = Builder_Find_Find_EFOBJ
    close FindCodeFile error
    MacroCommand = 'open FindCodeFile @SystemName@.bed error return'
    $MacroCommand
    file FindCodeFile
    if (ErrorPos < 1) ErrorPos = 1
    f;@ErrorPos
    if (FindReplace) b;1
    if-1 (!DebugSetBreaks)
+        window obtain Builder_Find_Matchcase_CBOBJ
+        if-2  (Builder_Find_Matchcase_CBOBJ) 
+           case on
+       else-2
+           case off
+   endif
    fs:/@Builder_Find_Find_EFOBJ@/
    case on
    if (eof) and (DebugSetBreaks) return
    if-1  (eof)
+       message = '[@Builder_Find_Find_EFOBJ@] wasn't found, find from top?'
+       window message question yesno
+       if-2  (message)
+           ErrorPos = 1
+           call !a1900_Builder_Codeassist_Log_errorloc
+           goto !a1900_Builder_Find_Find_PBOBJ
+   else-1
+       ErrorPos = lineno
+       call !a1900_Builder_Codeassist_Log_errorloc
+   endif
    close FindCodeFile
    return

//******************************
//* Replace
//******************************
!a1900_Builder_Find_Replace_PBOBJ
    string FindReplace error

    window obtain Builder_Find_Find_EFOBJ
    window obtain Builder_Find_Replace_EFOBJ
    if  (Builder_Find_Find_EFOBJ = null)
+       message = 'Please enter a Find string'
+       window message error ok
+       window setfocus Builder_Find_Find_EFOBJ
+       return
+   endif

    FindReplace = 'y'
    call !a1900_Builder_Find_Find_PBOBJ
    FindReplace = 'n'
    MacroCommand = 'open ReplaceCode @SystemName@.bed' $MacroCommand
    file ReplaceCode
    b
    f;@ErrorPos
    b;1
    rs:/@Builder_Find_Find_EFOBJ@/:/@Builder_Find_Replace_EFOBJ@/
    ErrorPos = lineno
    MacroCommand = 'write ReplaceCode @SystemName@.bed' $MacroCommand
    close ReplaceCode
    BatchUpdating = 'y'
    call !t100_separate_batch_code
    ErrorPos --
    Builder_Find_Find_EFOBJ = Builder_Find_Replace_EFOBJ
    call !a1900_Builder_Codeassist_Hilight_Line
    BatchUpdating = 'n'
    FindReplace = 'n'
    return

//******************************
//* Replace All
//******************************
!a1900_Builder_Find_Replaceall_PBOBJ
    window obtain Builder_Find_Find_EFOBJ
    if  (Builder_Find_Find_EFOBJ = null)
+       message = 'Please enter a search string'
+       window message error ok
+       window setfocus Builder_Find_Find_EFOBJ
+       return
+   endif
    window obtain Builder_Find_Replace_EFOBJ
    MacroCommand = 'open ReplaceAllFile @SystemName@.bed' $MacroCommand
    file ReplaceAllFile
    b
    rs:/@Builder_Find_Find_EFOBJ@/:/@Builder_Find_Replace_EFOBJ@/;*
    MacroCommand = 'write ReplaceAllFile @SystemName@.bed' $MacroCommand
    close ReplaceAllFile
    ErrorPos = 1
    Builder_Find_Find_EFOBJ = Builder_Find_Replace_EFOBJ
    BatchUpdating = 'y'
    call !t100_separate_batch_code
    call !a1900_Builder_Codeassist_Hilight_Line
    BatchUpdating = 'n'
    return

//******************************
//* Close the Find window
//******************************
!a1900_Builder_Find_Cancel_PBOBJ
    window close Builder_Find_WIN
    return

//******************************
//* Backup the Code
//******************************
!a1900_Backup_Code
    file CodeFile error return
    b
    clear
    copy;*
    close CodeBackup error
    open CodeBackup null
    b
    d;*
    paste
    file CodeFile
    return

//******************************
//* Double-click the Code List
//******************************
!a1900_Builder_Codeassist_Code_LBOBJ
    int HoldIndex error

    Builder_Codeassist_Code_LBOBJ = 'INDEX'
    window obtain Builder_Codeassist_Code_LBOBJ
    HoldIndex = Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_Code_LBOBJ
    if-1  (BeditDebug)
+       OldModName = null
+       split:/@Builder_Codeassist_Code_LBOBJ@/;5
+       split:/@right/;1
+       if-2 (left = DebugBreakCharSet)
+          call !a1900_Builder_Codeassist_Debugdelbreak_PBOBJ
+          BumpIndex = HoldIndex + 10
+          Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+          window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
+          Builder_Codeassist_Code_LBOBJ = 'INDEX=@HoldIndex@'
+          window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
+          Builder_Codeassist_Code_LBOBJ = null
+          return
+       else-2
+          call !a1900_Builder_Codeassist_Debugsetbreak_PBOBJ
+          return
+   endif
    split:/@Builder_Codeassist_Code_LBOBJ@/;7
    Builder_Codeassist_Code_EFOBJ = right
    //message = 'LBOBJ[@Builder_Codeassist_Code_LBOBJ@] EFOBJ[@Builder_Codeassist_Code_EFOBJ@]' window message info ok
    window modify Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Double-click the Variables List
//******************************
!a1900_Builder_Codeassist_Variables_LBOBJ

    call !a1900_Backup_Code

    window obtain Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Variables_LBOBJ
    window obtain Builder_Codeassist_Modules_LBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ
    scan:/@Builder_Codeassist_Variables_LBOBJ@/:/System: /
    if (found)
+      Builder_Codeassist_Variables_LBOBJ = right
+   endif
    file CodeFile error Builder_Codeassist_Code_EFOBJ = Builder_Codeassist_Variables_LBOBJ window modify Builder_Codeassist_Code_EFOBJ return
    b
    rs:/$*$Var1/:/@Builder_Codeassist_Variables_LBOBJ/;*
    if (!pcount)
+      b
+      rs:/$*$Var2/:/@Builder_Codeassist_Variables_LBOBJ/;*
+   endif

    if  (!pcount)
+       Builder_Codeassist_Code_EFOBJ = '@Builder_Codeassist_Code_EFOBJ@@Builder_Codeassist_Variables_LBOBJ@ '
+       window modify Builder_Codeassist_Code_EFOBJ
+   endif

    call !a1900_find_position
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 1
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null

    //window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Double-click the Modules List
//******************************
!a1900_Builder_Codeassist_Modules_LBOBJ
    call !a1900_Backup_Code

    window obtain Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Variables_LBOBJ
    window obtain Builder_Codeassist_Modules_LBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ

    if  (BeditDebug)
+       call !a1900_Builder_Codeassist_Code_PBOBJ
+       return
+   endif

    scan:/@Builder_Codeassist_Modules_LBOBJ@/:/System: /
    if (found)
+      Builder_Codeassist_Variables_LBOBJ = right
+   endif
    file CodeFile
    b
    rs:/$*$Var1/:/@Builder_Codeassist_Modules_LBOBJ/;*
    if (!pcount)
+      b
+      rs:/$*$Var2/:/@Builder_Codeassist_Modules_LBOBJ/;*
+   endif

    if  (!pcount)
+       Builder_Codeassist_Code_EFOBJ = '@Builder_Codeassist_Code_EFOBJ@@Builder_Codeassist_Modules_LBOBJ@ '
+       window modify Builder_Codeassist_Code_EFOBJ
+   endif

    call !a1900_find_position
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 1
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null

    //window setfocus Builder_Codeassist_Code_EFOBJ
    //ErrorPos = 1
    //BatchUpdating = 'y'
    //call !a1900_Builder_Codeassist_Hilight_Line
    //BatchUpdating = 'n'
    return

//******************************
//* Double-click the Commands List
//******************************
!a1900_Builder_Codeassist_Commands_LBOBJ
    string AddIndent error

    call !a1900_Backup_Code

    window obtain Builder_Codeassist_Variables_LBOBJ
    scan:/@Builder_Codeassist_Variables_LBOBJ@/:/System: /
    if (found)
+      Builder_Codeassist_Variables_LBOBJ = right
+   endif
    pack Builder_Codeassist_Variables_LBOBJ
    if (Builder_Codeassist_Variables_LBOBJ = null)
+      Builder_Codeassist_Variables_LBOBJ = '$*$Var1'
+   endif
    window obtain Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ

    call !a1900_find_position
    call !a1900_Add_Indent

    //*************************************
    //* Processing Commands
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = '*File Processing')
+       subs & Newline = /    open Filename @FileLoc/ subs @ i:/@Newline@/
+       Newline = /    b/ i:/@Newline@/
+       Newline = /    do/ i:/@Newline@/
+       Newline = /        if  (!eof)/ i:/@Newline@/
+       Newline = |+           // Add Processing Here| i:/@Newline@/
+       Newline = /+       endif/ i:/@Newline@/
+       Newline = /        f;1/ i:/@Newline@/
+       Newline = /    until (eof)/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* Comments
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = '*Comments')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 3
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window obtain Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       Builder_Codeassist_Code_EFOBJ = Builder_Codeassist_Code_LBOBJ 
+       window modify Builder_Codeassist_Code_EFOBJ
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    //*************************************
    //* Clear Screen
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = '*Clear Screen')
+       Newline = |@AddIndent@system:"cls"| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window obtain Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       Builder_Codeassist_Code_EFOBJ = Builder_Codeassist_Code_LBOBJ 
+       window modify Builder_Codeassist_Code_EFOBJ
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    //*************************************
    //* Pad Left
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Pad Left')
+       subs ^ Newline = |^AddIndent^$*$Var1 = '0000000000@$*$Var1@'| subs @ i:/@Newline@/
+       subs ^ Newline = |^AddIndent^splitr:/@$*$Var1@/;5| subs @ i:/@Newline@/
+       Newline = |@AddIndent@$*$Var1 = right| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif
    //*************************************
    //* Directory Button Processing
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Directory Button')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* Directory Button Processing | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@DirField = "$*$Var1"| i:/@Newline@/
+       MacroCommand = \Newline = |@AddIndent@FileField = "$*$Var2"|\ $MacroCommand i:/@Newline@/
+       Newline = |@AddIndent@call @SystemName@Browse.bed!s100_directory| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 5
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif

    //*************************************
    //* Directory List
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Directory List')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* Directory List Processing | i:/@Newline@/
+       Newline = |@AddIndent@//*     Input - "Directory" string contains location | i:/@Newline@/
+       Newline = |@AddIndent@//*             of directory to search| i:/@Newline@/
+       Newline = |@AddIndent@//*           - "Extension" string of extensions to search| i:/@Newline@/
+       Newline = |@AddIndent@//*     Output- DirFileList file of files in Directory | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@string Directory = 'c:\' error| i:/@Newline@/
+       Newline = |@AddIndent@string Extension = null error| i:/@Newline@/
+       Newline = |@AddIndent@call BuilderDirList.bed| i:/@Newline@/
+       Newline = |@AddIndent@file DirFileList| i:/@Newline@/
+       Newline = |@AddIndent@b| i:/@Newline@/
+       Newline = |@AddIndent@| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 9
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       if-type  (CodeType != 'bedit')
+           call !a1900_directory_add
+           return
+       else-type
+           return
+   endif

    //*************************************
    //* Clear List
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Clear List')
+       Newline = |@AddIndent@$*$Var1 = 'ALL'| i:/@Newline@/
+       Newline = |@AddIndent@window delete $*$Var1| i:/@Newline@/
+       Newline = |@AddIndent@window paint $*$Var1| i:/@Newline@/
+       Newline = |@AddIndent@$*$Var1 = null| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif

    //*************************************
    //* Debug Lines
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Debug Lines')
+       if-type  (CodeType = 'bedit')
+           subs ^ Newline = |^AddIndent^print:'Debug $*$Var1[@$*$Var1@] $*$Var2[@$*$Var2@]'| subs @ i:/@Newline@/
+       else-type
+           subs ^ Newline = |^AddIndent^message = 'Debug $*$Var1[@$*$Var1@] $*$Var2[@$*$Var2@]'| subs @ i:/@Newline@/
+           Newline = |@AddIndent@window message info ok| i:/@Newline@/
+   endif

    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Debug Lines')
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif

    //*************************************
    //* if processing
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a)')
+       Newline = /    if  ($*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (!a)')
+       Newline = /    if  (!$*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a = b)')
+       Newline = /    if  ($*$Var1 = $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a != b)')
+       Newline = /    if  ($*$Var1 != $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a > b)')
+       Newline = /    if  ($*$Var1 > $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a >= b)')
+       Newline = /    if  ($*$Var1 >= $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a < b)')
+       Newline = /    if  ($*$Var1 < $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a <= b)')
+       Newline = /    if  ($*$Var1 <= $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a beginswith b)')
+       Newline = /    if  ($*$Var1 beginswith $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a endswith b)')
+       Newline = /    if  ($*$Var1 endswith $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (numeric a)')
+       Newline = /    if  (numeric $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (digit a)')
+       Newline = /    if  (digit $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (special a)')
+       Newline = /    if  (special $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (alpha a)')
+       Newline = /    if  (alpha $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (found)')
+       Newline = /    if  (found)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (eof)')
+       Newline = /    if  (eof)/ i:/@Newline@/
+       call !a1900_if_lines
+       return

    //*************************************
    //* sort
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'sort')
+       Newline = /@AddIndent@sort $*$Var1,A,1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif

    //*************************************
    //* do
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'do')
+       Newline = /@AddIndent@do/ i:/@Newline@/
+       Newline = /@AddIndent@until ($*$Var1)/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif

    //*************************************
    //* window open
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window open') or (Builder_Codeassist_Commands_LBOBJ = '*Window Open')
+       Newline = /@AddIndent@window pointer wait/ i:/@Newline@/
+       Newline = /@AddIndent@window hwnd @Builder_Codeassist_Variables_LBOBJ@ status error window open @Builder_Codeassist_Variables_LBOBJ@ shade/ i:/@Newline@/
+       Newline = /@AddIndent@window center @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window clear @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window unshade @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window setfocus @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window pointer arrow/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif
    //*************************************
    //* window close
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window close')
+       call !a1900_find_position
+       Newline = /@AddIndent@window close @w@ shade/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window message
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window message')
+       call !a1900_find_position
+       Newline = "@AddIndent@message = / /" i:/@Newline@/ 
+       Newline = /@AddIndent@window message info ok/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window insert
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window insert')
+       call !a1900_find_position
+       Newline = /@AddIndent@window insert end default $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window createcontrol
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window createcontrol')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window createcontrol WinName ContName Xpos Ypos Length Width ContType(e.g. PBOBJ) Text/ i:/@Newline@/
+       Newline = /@AddIndent@window createcontrol $*$Var1 $*$Var2 x y cx cy type text/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window createwindow
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window createwindow')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window createwindow WinName Xpos Ypos Length Width Title/ i:/@Newline@/
+       Newline = /@AddIndent@window createcontrol $*$Var1 x y cx cy type text/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window delete
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window delete')
+       call !a1900_find_position
+       Newline = /@AddIndent@window delete $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window deletecontrol
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window deletecontrol')
+       call !a1900_find_position
+       Newline = /@AddIndent@window deletecontrol $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window deletewindow
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window deletewindow')
+       call !a1900_find_position
+       Newline = /@AddIndent@window deletewindow $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window disable
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window disable')
+       call !a1900_find_position
+       Newline = /@AddIndent@window disable $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window enable
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window enable')
+       call !a1900_find_position
+       Newline = /@AddIndent@window enable $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window getfocus
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window getfocus')
+       call !a1900_find_position
+       Newline = /@AddIndent@window getfocus $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window getfocuswin
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window getfocuswin')
+       call !a1900_find_position
+       Newline = /@AddIndent@window getfocuswin $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window hide
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window hide')
+       call !a1900_find_position
+       Newline = /@AddIndent@window hide $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window modify
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window modify')
+       call !a1900_find_position
+       Newline = /@AddIndent@window modify $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window mousepos
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window mousepos')
+       call !a1900_find_position
+       Newline = /@AddIndent@window mousepos $*$Var1 $*$Var2/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window obtain
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window obtain')
+       call !a1900_find_position
+       Newline = /@AddIndent@window obtain $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window open
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window open')
+       call !a1900_find_position
+       Newline = /@AddIndent@window hwnd $*$Var1 status error window open $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window paint
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window paint')
+       call !a1900_find_position
+       Newline = /@AddIndent@window paint $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window pointer
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window pointer')
+       call !a1900_find_position
+       Newline = /@AddIndent@window pointer PointerType/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window push
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window push')
+       call !a1900_find_position
+       Newline = /@AddIndent@window push $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window select 
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window select')
+       call !a1900_find_position
+       subs & Newline = /&AddIndent&    $*$Var1 = 'INDEX=@$*$Var2@'/ subs @ i:/@Newline@/
+       Newline = /@AddIndent@window select $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window setfocus
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window setfocus')
+       call !a1900_find_position
+       Newline = /@AddIndent@window setfocus $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window shade
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window shade')
+       call !a1900_find_position
+       Newline = /@AddIndent@window shade $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window show
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window show')
+       call !a1900_find_position
+       Newline = /@AddIndent@window show $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window size
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window size')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window size ObjectName Xpos Ypos Length Width/ i:/@Newline@/
+       Newline = /@AddIndent@window size $*$Var1 Xpos Ypos Length Width/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window windowpos
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window windowpos')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window windowpos ObjectName Xpos Ypos Length Width/ i:/@Newline@/
+       Newline = /@AddIndent@window size $*$Var1 Xpos Ypos Length Width/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       BumpIndex = CodeLineNumber + 10
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif

    Builder_Codeassist_Code_EFOBJ = '@Builder_Codeassist_Code_EFOBJ@@Builder_Codeassist_Commands_LBOBJ@ '
!a1900_Builder_Codeassist_Commands_update
    window modify Builder_Codeassist_Code_EFOBJ
    //window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Add the rest of the IF lines
//******************************
!a1900_if_lines
    Newline = /+   else/ i:/@Newline@/
    Newline = /+   endif/ i:/@Newline@/
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 2
    BumpIndex = CodeLineNumber + 10
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@BumpIndex@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ window paint Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null
    return

!a1900_directory_add
    //*********************************
    //* Create the SystemBrowse.bed file
    //*********************************
    open BrowseFile BuilderBrowse.bed
    b
    rs:/Builder/:/@SystemName@/;*
    MacroCommand = 'write BrowseFile @SystemName@Browse.bed' $MacroCommand
    close BrowseFile
    //*********************************
    //* Update the System WIN file
    //*********************************
    MacroCommand = 'open BrowseWindowFile @SystemName@.win error return' $MacroCommand
    b
    fs:/_Browse_WIN/
    if-eof (eof)
+       open BuilderBrowseWin Builder.win
+       fs:/_Browse_WIN/
+       b;3
+       clear
+       copy;26
+       close BuilderBrowseWin
+       file BrowseWindowFile
+       f;*
+       paste
+       b
+       MacroCommand = 'rs:/Builder/:/@SystemName@/;*' $MacroCommand
+       MacroCommand = 'write BrowseWindowFile @SystemName@.win' $MacroCommand
+       close BrowseWindowFile
+   endif

!a1900_directory_add_proc
    //*********************************
    //* Update !0005_Main_Processing
    //*********************************
    open MainProc0005 Bedit-code\!0005_Main_Processing.bed
    b
    fs:/!a1600_Browse_Setup/
    if (eof)
+      b
+      fs:/!0005_Main_Processing/
+      MacroCommand = |i:/    call @SystemName@Browse.bed!a1600_Browse_Setup/| $MacroCommand
+      i:/ /
+      write MainProc0005 Bedit-code\!0005_Main_Processing.bed
+   endif
    close MainProc0005
    return

//******************************
//* Find the chars that should 
//* be in front of the variable
//******************************
!a1900_Add_Indent
    AddIndent = null
    split:/@Builder_Codeassist_Code_EFOBJ@/;1
    if (left = ' ') or (left = '+')
+      return
+   endif
    split:/@line/;1
    if (left != ' ') and (left != '+')
+      AddIndent = '    '
+      return
+   endif
    scan:/@line/:word
    lower left
    if (left = 'if')
+      AddIndent = '+@lword@    '
+   else
+      split:/@line/;1
+      if (left = '+')
+         scan:/@right/:word
+         if (left != 'endif')
+            AddIndent = '+@lword@ '
+            if (left = 'else')
+               AddIndent = '+@lword@     '
+   endif
    scan:/@line/:word
    if (left = 'do')
+      AddIndent = '@lword@    '
+   endif
    if (AddIndent = null)
+      scan:/@line/:word
+      AddIndent = lword
+   endif
    if (AddIndent = null)
+      AddIndent = '    '
+   endif
    split:/@AddIndent/;1
    if (left = '+')
+      split:/@right/;1
+      AddIndent = '+@right@'
+   endif
    //message = '!a1900_Add_Indent line[@line@] AddIndent[@AddIndent@]' window message info ok
    return
    
//******************************
//* Clear and load the Code list
//******************************
!a1900_reload_code
    int    ModuleStartPos error
    int    CheckLinePos   error
    string DebugBreakChar error

    Builder_Codeassist_Code_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Code_LBOBJ
    window paint Builder_Codeassist_Code_LBOBJ

    //**************************
    //* Find the Module start pos
    //**************************
    file ModuleStartPosFile open ModuleStartPosFile null
    b
    SearchString = "@ModuleFileName@:"
    scan:/@SearchString/:|\|
    if (found) SearchString = right
    fs:/@SearchString@/
    if  (!eof)
+       scan:/@line/:/:/
+       ModuleStartPos = right
+   else
+       ModuleStartPos = 0
+   endif

    file CodeFile
    b
    CodeCount = 0     
    do
        if (!eof)
+          CodeCount ++
+          CodeCountStr = '00000@CodeCount@'
+          splitr:/@CodeCountStr@/;5
+          Builder_Codeassist_Code_LBOBJ = right
+          //message = 'Before a1800_DebugBreakChar[@SearchString@]' window message info ok
+          call !a1800_DebugBreakChar
+          //message = 'After a1800_DebugBreakChar[@DebugBreakChar@]' window message info ok
+          file CodeFile
+          Builder_Codeassist_Code_LBOBJ = '@Builder_Codeassist_Code_LBOBJ@@DebugBreakChar@ @line@'
+          window insert end default Builder_Codeassist_Code_LBOBJ
+          f;1
+       endif
    until (eof)
    return

//******************************
//* Find the proper position
//******************************
!a1900_find_position
    file CodeFile

    if (Builder_Codeassist_Code_LBOBJ = null)
+      b 
+      f;*
+      CodeLineNumber = pcount + 1
+   else
+      split:/@Builder_Codeassist_Code_LBOBJ@/;5
+      CodeLineNumber = left
+   endif
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok

    b
    CodeLineNumber --
    if (CodeLineNumber > 0)
+      f;@CodeLineNumber
+   endif
    return

//******************************
//* View the Contents of a Debug File
//******************************
!a1900_Builder_Debugfiles_View_PBOBJ
    window obtain Builder_Debugfiles_Filelist_LBOBJ
    pack Builder_Debugfiles_Filelist_LBOBJ
    if  (Builder_Debugfiles_Filelist_LBOBJ = null)
+       message = "Please select a file to view"
+       window message error ok
+       window setfocus Builder_Debugfiles_Filelist_LBOBJ
+       return
+   endif
    if  (Builder_Debugfiles_Filelist_LBOBJ beginswith '*')
+       split:/@Builder_Debugfiles_Filelist_LBOBJ/;2
+       scan:/@right/:word
+   else
+       scan:/@Builder_Debugfiles_Filelist_LBOBJ@/:word
+   endif
    Newline = 'FILEDATA:@left@'
    close beditsem error
    open beditsem null
    i:/@Newline@/
    write beditsem beditsem.go
    close beditsem
    return

//******************************
//* Double-click a View File
//******************************
!a1900_Builder_Debugfiles_Filelist_LBOBJ
    call !a1900_Builder_Debugfiles_View_PBOBJ
    return

//******************************
//* Close the Debug File Viewer
//******************************
!a1900_Builder_Debugfiles_Close_PBOBJ
    window close Builder_Debugfiles_WIN
    return

//******************************
//* Close the Debug File Viewer
//******************************
!a1900_Builder_Debugdata_Close_PBOBJ
    window close Builder_Debugdata_WIN
    window show Builder_Debugfiles_WIN
    window setfocus Builder_Debugfiles_WIN
    window setfocus Builder_Debugfiles_Filelist_LBOBJ
    return

//******************************
//* Update Object Size
//******************************
!b300_object_size
    WinX = ObjectX - MinX
    WinY = ObjectY - MinY
    if-1 (WinX < 1)
+      WinX = MinX + 1
+      Builder_Control_X_EFOBJ = "1"
+      window modify Builder_Control_X_EFOBJ
+      scanr:/@ButtonFocus@/:/_/
+      if-2  (left beginswith 'Box') or (left = "Boxround") or (left = "Boxcolor") or (left = 'Ellipse') or (left = 'Ellipse3D') or (left = 'Circle') or (left = 'Diamond') or (left = 'Line') or (left beginswith 'Arrow') or (left = 'Text') or (left = 'TextTilt') or (left = 'Bitmap') or (left = 'BitmapFit') or (left beginswith 'Triangle') or (left beginswith 'Rectangle')
+      else-2
+          window size @ButtonFocus @MinX @ObjectY @ObjectCX @ObjectCY error
+   endif
    if-1 (WinY < 1)
+      WinY = MinY + 1
+      Builder_Control_Y_EFOBJ = "1"
+      window modify Builder_Control_Y_EFOBJ
+      scanr:/@ButtonFocus@/:/_/
+      if-2  (left beginswith 'Box') or (left = "Boxround") or (left = "Boxcolor") or (left = 'Ellipse') or (left = 'Ellipse3D') or (left = 'Circle') or (left = 'Diamond') or (left = 'Line') or (left beginswith 'Arrow') or (left = 'Text') or (left = 'TextTilt') or (left = 'Bitmap') or (left = 'BitmapFit') or (left beginswith 'Triangle') or (left beginswith 'Rectangle')
+      else-2
+          window size @ButtonFocus @ObjectX @MinY @ObjectCX @ObjectCY error
+   endif
    Builder_Control_X_EFOBJ = WinX
    window modify Builder_Control_X_EFOBJ    
    Builder_Control_Y_EFOBJ = WinY
    window modify Builder_Control_Y_EFOBJ 
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    return

//******************************
//* Repaint to fix some controls
//******************************
!b400_repaint_control
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ')
+       MacroCommand = "window hide Builder_Control_WIN" $MacroCommand
+       MacroCommand = "window show Builder_Control_WIN" $MacroCommand
+   endif
    scanr:/@ButtonFocus@/:/_/
    if  (left beginswith 'Box') or (left = 'Ellipse') or (left = 'Ellipse3D') or (left = 'Circle') or (left = 'Diamond') or (left = 'Line') or (left beginswith 'Arrow') or (left = 'Text') or (left = 'TextTilt') or (left = 'Bitmap') or (left = 'BitmapFit') or (left beginswith 'Triangle') or (left beginswith 'Rectangle')
+      call !b400_paintfile_control
+      return
+   endif
    file Controls error return
    b
    fs:/@ButtonFocus@/
    if (eof) return
    scan:/@line/:/,/
    scan:/@right/:/,/
    if  (left = 'COOBJL') or (left = 'COOBJD') or (left = 'COOBJS') or (left = 'LBOBJ1') or (left = 'STTXTF') or (left = 'STTXTR')
+       goto !b400_repaint
+   else
+       goto !b400_repaint_connectors
+   endif
    
!b400_repaint
    //MacroCommand = "file PaintFile b window paint Builder_Control_WIN" $MacroCommand

    if  (left = 'COOBJL') or (left = 'COOBJD') or (left = 'COOBJS') or (left = 'LBOBJ1')
+       MacroCommand = "window paint @ButtonFocus@" $MacroCommand     // COOBJS, COOBJL
+   else
+       MacroCommand = "window hide @ButtonFocus@" $MacroCommand       //STTXTF, STTXTR
+       MacroCommand = "window show @ButtonFocus@" $MacroCommand
+   endif
!b400_repaint_connectors
    close ConnectFile error 
    ConnectFilename = '@Builder_System_Systemname_EFOBJ@.con'
    open ConnectFile @ConnectFilename error return
    b
    fs:/@ButtonFocus/
    if (!eof)
+      if  (UpdateConnectors) 
+          call BuilderConnect.bed!m100_update_connect 
+          file PaintFile b window paint Builder_Control_WIN
+   endif
    file Controls
    return

!b400_paintfile_control 
    //*********************************
    //* Modify PaintFile
    //*********************************
    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          scan:/@right/:/,/
+          if  (left = ButtonFocus)
+              call !a400_modify_paint
+              f;*
+       endif
        f;1          
    until (eof)
    return

//******************************
//* Standard Colors Open Window
//******************************
!c100_Builder_Stdcolors_MSOBJ
    TestRed = Red
    TestGreen = Green
    TestBlue = Blue
    file PaintFile error open PaintFile null
    b
    do
        fs:/Builder_Stdcolors_WIN/
        if (!eof) d
    until (eof)
    f;*

    //********************
    //* Browns
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,10,10,20,20,150,0,0/
    i:/Builder_Stdcolors_WIN,Test,Box,10,30,20,20,170,30,0/
    i:/Builder_Stdcolors_WIN,Test,Box,10,50,20,20,190,60,0/
    i:/Builder_Stdcolors_WIN,Test,Box,10,70,20,20,210,90,0/
    i:/Builder_Stdcolors_WIN,Test,Box,10,90,20,20,230,120,0/
    i:/Builder_Stdcolors_WIN,Test,Box,10,110,20,20,250,150,0/

    //********************
    //* Reds/Oranges
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,30,10,20,20,255,0,0/
    i:/Builder_Stdcolors_WIN,Test,Box,30,30,20,20,255,30,0/
    i:/Builder_Stdcolors_WIN,Test,Box,30,50,20,20,255,60,0/
    i:/Builder_Stdcolors_WIN,Test,Box,30,70,20,20,255,90,0/
    i:/Builder_Stdcolors_WIN,Test,Box,30,90,20,20,255,120,0/
    i:/Builder_Stdcolors_WIN,Test,Box,30,110,20,20,255,150,0/

    //********************
    //* Yellows
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,50,10,20,20,255,255,0/
    i:/Builder_Stdcolors_WIN,Test,Box,50,30,20,20,255,255,40/
    i:/Builder_Stdcolors_WIN,Test,Box,50,50,20,20,255,255,80/
    i:/Builder_Stdcolors_WIN,Test,Box,50,70,20,20,255,255,120/
    i:/Builder_Stdcolors_WIN,Test,Box,50,90,20,20,255,255,160/
    i:/Builder_Stdcolors_WIN,Test,Box,50,110,20,20,255,255,200/

    //********************
    //* Greens
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,70,10,20,20,0,255,0/
    i:/Builder_Stdcolors_WIN,Test,Box,70,30,20,20,0,255,40/
    i:/Builder_Stdcolors_WIN,Test,Box,70,50,20,20,0,255,80/
    i:/Builder_Stdcolors_WIN,Test,Box,70,70,20,20,0,255,120/
    i:/Builder_Stdcolors_WIN,Test,Box,70,90,20,20,0,255,160/
    i:/Builder_Stdcolors_WIN,Test,Box,70,110,20,20,0,255,200/

    //********************
    //* Dark Greens
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,90,10,20,20,0,90,0/
    i:/Builder_Stdcolors_WIN,Test,Box,90,30,20,20,0,120,0/
    i:/Builder_Stdcolors_WIN,Test,Box,90,50,20,20,0,150,0/
    i:/Builder_Stdcolors_WIN,Test,Box,90,70,20,20,0,180,0/
    i:/Builder_Stdcolors_WIN,Test,Box,90,90,20,20,0,210,0/
    i:/Builder_Stdcolors_WIN,Test,Box,90,110,20,20,0,240,0/

    //********************
    //* Violets
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,110,10,20,20,255,0,255/
    i:/Builder_Stdcolors_WIN,Test,Box,110,30,20,20,255,40,255/
    i:/Builder_Stdcolors_WIN,Test,Box,110,50,20,20,255,80,255/
    i:/Builder_Stdcolors_WIN,Test,Box,110,70,20,20,255,120,255/
    i:/Builder_Stdcolors_WIN,Test,Box,110,90,20,20,255,160,255/
    i:/Builder_Stdcolors_WIN,Test,Box,110,110,20,20,255,200,255/

    //********************
    //* Blues
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,130,10,20,20,0,0,255/
    i:/Builder_Stdcolors_WIN,Test,Box,130,30,20,20,0,50,255/
    i:/Builder_Stdcolors_WIN,Test,Box,130,50,20,20,0,100,255/
    i:/Builder_Stdcolors_WIN,Test,Box,130,70,20,20,0,150,255/
    i:/Builder_Stdcolors_WIN,Test,Box,130,90,20,20,0,200,255/
    i:/Builder_Stdcolors_WIN,Test,Box,130,110,20,20,0,250,255/

    //********************
    //* Black-White
    //********************
    i:/Builder_Stdcolors_WIN,Test,Box,150,10,20,20,0,0,0/
    i:/Builder_Stdcolors_WIN,Test,Box,150,30,20,20,50,50,50/
    i:/Builder_Stdcolors_WIN,Test,Box,150,50,20,20,100,100,100/
    i:/Builder_Stdcolors_WIN,Test,Box,150,70,20,20,150,150,150/
    i:/Builder_Stdcolors_WIN,Test,Box,150,90,20,20,200,200,200/
    i:/Builder_Stdcolors_WIN,Test,Box,150,110,20,20,255,255,255/

    Newline = 'Builder_Stdcolors_WIN,SampleBox,Box,10,135,160,20,@Red@,@Green@,@Blue@'
    i:/@Newline/

    window pointer wait
    window hwnd Builder_Stdcolors_WIN status error window open Builder_Stdcolors_WIN shade
    window center Builder_Stdcolors_WIN
    window unshade Builder_Stdcolors_WIN
    window setfocus Builder_Stdcolors_WIN
    window pointer arrow
    return

//******************************
//* Standard Colors OK
//******************************
!c100_Builder_Stdcolors_Ok_PBOBJ
    if  (SetTextColor)
+       SetTextColor = 'n'
+       TextRed = TestRed
+       TextGreen = TestGreen
+       TextBlue = TestBlue
+       window obtain Builder_Textedit_Font_COOBJ
+       pack Builder_Textedit_Font_COOBJ
+       window obtain Builder_Textedit_Text_EFOBJ
+       Builder_Control_ControlText_EFOBJ = Builder_Textedit_Text_EFOBJ
+       window modify Builder_Control_ControlText_EFOBJ
+       Newline = 'Builder_Control_WIN,@TextName@,TextTilt,@TextX@,@TextY@,@TextCX@,@TextCY@,@TextRed@,@TextGreen@,@TextBlue@,@TextFont@,@Builder_Textedit_Text_EFOBJ@'
+       file PaintFile
+       b
+       SearchString = 'Builder_Control_WIN,@TextName@'
+       fs:/@SearchString/
+       r:/@Newline@/
+       Builder_Textedit_Font_EFOBJ = Builder_Textedit_Font_COOBJ
+       window modify Builder_Textedit_Font_EFOBJ
+       call !a400_Builder_Control_Refresh_PBOBJ
+       goto !c100_Builder_Stdcolors_Ok_remove
+   endif

    Red = TestRed
    Green = TestGreen
    Blue = TestBlue
    Z = Blue

    if  (ButtonFocus = 'GroupRectangle')
+       call !c100_group_colors
+       goto !c100_Builder_Stdcolors_Ok_remove
+   endif

    //*********************************
    //* Modify PaintFile
    //*********************************
    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if  (left = ButtonFocus)
+                  scan:/@line/:/,/
+                  HoldWindowName = left
+                  scan:/@right/:/,/
+                  HoldControlName = left
+                  scan:/@right/:/,/
+                  HoldType = left
+                  scan:/@right/:/,/
+                  ObjectX = left
+                  scan:/@right/:/,/
+                  ObjectY = left
+                  scan:/@right/:/,/
+                  ObjectCX = left
+                  scan:/@right/:/,/
+                  ObjectCY = left
+                  MaintainLengthHeight = 'y'
+                  call !a400_modify_paint
+                  f;*
+       endif
        f;1          
    until (eof)

!c100_Builder_Stdcolors_Ok_remove
    //***********************
    //* Remove colors
    //***********************
    file PaintFile
    b
    do
        fs:/Builder_Stdcolors_WIN/
        if (!eof) d;1
    until (eof)
    call !c100_remove_colors

    window close Builder_Stdcolors_WIN
    Drag = 'n'
    window show Builder_Control_WIN
    return

//******************************
//* Standard Colors Cancel
//******************************
!c100_Builder_Stdcolors_Cancel_PBOBJ
    call !c100_remove_colors
    window close Builder_Stdcolors_WIN
    return

//******************************
//* Remove all PaintFile Colors
//******************************
!c100_remove_colors
    file PaintFile error open PaintFile null
    b
    do
        fs:/Builder_Colors_WIN/
        if (!eof) d;1
    until (eof)
    b
    do
        fs:/ColorPoint/
        if (!eof) d;1
    until (eof)
    return

//******************************
//* Colors OK Button processing
//******************************
!c100_Builder_Colors_Ok_PBOBJ
    window obtain Builder_Colors_WIN
    Z = Builder_Colors_Red_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Red = Z
    KeepRed = Red

    Z = Builder_Colors_Green_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Green = Z
    KeepGreen = Green

    Z = Builder_Colors_Blue_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Blue = Z
    KeepBlue = Blue

    file PaintFile
    b
    do
        fs:/Builder_Colors_WIN/
        if (!eof) d;1
    until (eof)

    call !c100_remove_colors

    window close Builder_Colors_WIN
    //window close Builder_Stdcolors_WIN
    window show Builder_Control_WIN

    if  (SetTextColor)
+       SetTextColor = 'n'
+       TextRed = Red
+       TextGreen = Green
+       TextBlue = Blue
+       window obtain Builder_Textedit_Font_COOBJ
+       pack Builder_Textedit_Font_COOBJ
+       window obtain Builder_Textedit_Text_EFOBJ
+       Builder_Control_ControlText_EFOBJ = Builder_Textedit_Text_EFOBJ
+       window modify Builder_Control_ControlText_EFOBJ
+       Newline = 'Builder_Control_WIN,@TextName@,Text,@TextX@,@TextY@,@TextCX@,@TextCY@,@TextRed@,@TextGreen@,@TextBlue@,@TextFont@,@Builder_Textedit_Text_EFOBJ@'
+       file PaintFile
+       b
+       SearchString = 'Builder_Control_WIN,@TextName@'
+       fs:/@SearchString/
+       r:/@Newline@/
+       Builder_Textedit_Font_EFOBJ = Builder_Textedit_Font_COOBJ
+       window modify Builder_Textedit_Font_EFOBJ
+       call !a400_Builder_Control_Refresh_PBOBJ
+       goto !c100_Builder_Stdcolors_Ok_remove
+       return
+   endif

    if  (ButtonFocus = 'GroupRectangle')
+       call !c100_group_colors
+       return
+   endif

    //*********************************
    //* Modify PaintFile
    //*********************************
    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if  (left = ButtonFocus)
+                  scan:/@line/:/,/
+                  HoldWindowName = left
+                  scan:/@right/:/,/
+                  HoldControlName = left
+                  scan:/@right/:/,/
+                  HoldType = left
+                  scan:/@right/:/,/
+                  ObjectX = left
+                  scan:/@right/:/,/
+                  ObjectY = left
+                  scan:/@right/:/,/
+                  ObjectCX = left
+                  scan:/@right/:/,/
+                  ObjectCY = left
+                  MaintainLengthHeight = 'y'
+                  call !a400_modify_paint
+                  f;*
+       endif
        f;1          
    until (eof)

    return

//******************************
//* Change color of all objects in group
//******************************
!c100_group_colors
    GroupColorChange = 'y'
    //*********************************
    //* Modify PaintFile
    //*********************************
    file GroupControls error return
    b
    
!c100_group_colors_loop
    file GroupControls
    scan:/@line/:/,/
    ButtonFocus = left

    file PaintFile error open PaintFile null
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = 'Builder_Control_WIN')
+              scan:/@right/:/,/
+              if  (left = ButtonFocus)
+                  scan:/@line/:/,/
+                  HoldWindowName = left
+                  scan:/@right/:/,/
+                  HoldControlName = left
+                  scan:/@right/:/,/
+                  HoldType = left
+                  scan:/@right/:/,/
+                  ObjectX = left
+                  scan:/@right/:/,/
+                  ObjectY = left
+                  scan:/@right/:/,/
+                  ObjectCX = left
+                  scan:/@right/:/,/
+                  ObjectCY = left
+                  MaintainLengthHeight = 'y'
+                  call !a400_modify_paint
+                  f;*
+       endif
        f;1          
    until (eof)

    file GroupControls
    f;1
    if (!eof) goto !c100_group_colors_loop  

    ButtonFocus = 'GroupRectangle' 
    GroupColorChange = 'n'

    return

//******************************
//* Colors Cancel Button processing
//******************************
!c100_Builder_Colors_Cancel_PBOBJ
    file PaintFile
    b
    do
        fs:/Builder_Colors_WIN/
        if (!eof) d;1
    until (eof)
    call !c100_remove_colors
    window close Builder_Colors_WIN
    window show Builder_Control_WIN
    return

//******************************
//* Shift Blue Down
//******************************
!c100_Builder_Colors_Bluedown_PBOBJ
    window obtain Builder_Colors_Blue_EFOBJ
    Z = Builder_Colors_Blue_EFOBJ
    Z = Z - 50
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Builder_Colors_Blue_EFOBJ = Z
    window modify Builder_Colors_Blue_EFOBJ
    call !c100_Builder_Colors_Refresh_PBOBJ
    return

//******************************
//* Shift Blue Down
//******************************
!c100_Builder_Colors_Blueup_PBOBJ
    window obtain Builder_Colors_Blue_EFOBJ
    Z = Builder_Colors_Blue_EFOBJ
    Z = Z + 50
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Builder_Colors_Blue_EFOBJ = Z
    window modify Builder_Colors_Blue_EFOBJ
    call !c100_Builder_Colors_Refresh_PBOBJ
    return

//******************************
//* Colors Refresh Button processing
//******************************
!c100_Builder_Colors_Refresh_PBOBJ
    window obtain Builder_Colors_WIN
    Z = Builder_Colors_Red_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Red = Z
    KeepRed = Red
    Builder_Colors_Red_EFOBJ = Red
    window modify Builder_Colors_Red_EFOBJ

    Z = Builder_Colors_Green_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Green = Z
    Builder_Colors_Green_EFOBJ = Green
    window modify Builder_Colors_Green_EFOBJ
    Green = Z
    KeepGreen = Green

    Z = Builder_Colors_Blue_EFOBJ
    if  (Z < 0) Z = 0
    if  (Z > 255) Z = 255
    Blue = Z
    KeepBlue = Blue
    Builder_Colors_Blue_EFOBJ = Blue
    window modify Builder_Colors_Blue_EFOBJ

    call !c100_colors
    return

//******************************************
//* Setup the Colors
//******************************************
!c100_colors
    //***************************
    //* Delete old data
    //***************************
    file PaintFile
    b
    do
        fs:/Builder_Colors_WIN/
        if  (!eof) d;1
    until (eof)

    //***************************
    //* Add new data
    //***************************
    X = 0
    Y = 0
    do-1
        do-2
            PosX = X + 10
            PosY = Y + 10
            Newline = 'Builder_Colors_WIN,ColorPoint,Point,@PosX@,@PosY@,@X@,@Y@,@Z@'
            i:/@Newline@/
            X = X + 1
        until-2 (X > 255)
        X = 0
        Y ++
    until-1 (Y > 255)

    //***************************
    //* Add sampled color box
    //***************************
    Newline = 'Builder_Colors_WIN,SampleBox,Box,296,200,30,30,@Red@,@Green@,@Blue@'
    i:/@Newline@/
    b
    window paint Builder_Colors_WIN
    window setfocus Builder_Control_WIN
    window setfocus Builder_Colors_WIN
    return

//**********************************************************************************************************************
//******************************
//* Import a COBOL program for View
//******************************
!i100_import_cobol
    string HoldRight     error
    string Paragraph     error
    string Perform       error
    string ProgramName   error
    string CobolWinName  error
    string CobolNavName  error
    string ParagraphFull error
    string LastParagraph error
    string PerfParaFull  error
    string Copyfilename  error
    string Copydir       error

    HoldRight = null
    Paragraph = null
    Perform = null

!i100_main

    
    file SOURCECODE
    b
    //***********************
    //* Size the COBOL file
    //***********************
    do
        if (!eof)
+          Newline = line
+          size Newline,72
+          r:/@Newline/
+       endif
+       f;1
    until (eof)
    open COBOLWIN null
    open COBOLNAV null

    ProgramName = Builder_Import_Filename_EFOBJ
    pack Builder_Import_Copydir_EFOBJ
    Copydir = Builder_Import_Copydir_EFOBJ
    scanr:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'COBOL-@ProgramName@'

    //message = 'COBOL program [@ProgramName@]' window message info ok
    
    CobolWinName = '@ProgramName@.win'
    CobolNavName = '@ProgramName@.nav'

    //***************************
    //* Insert COPY code
    //***************************
    file SOURCECODE
    b 
!i100_copy_loop
    fs:/ COPY /
    if (eof) goto !i100_copy_done
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !i100_copy_loop
+   endif

    scan:/@line/:/ COPY /
    scan:/@right/:word
    if (left = 'IDMS') f goto !i100_copy_loop
    Copyfilename = left
    scan:/@Copyfilename/:/./
    if (found) Copyfilename = left
    scan:/@Copyfilename/:/'/
    if (found) Copyfilename = "@left@@right@"
    scan:/@Copyfilename/:/'/
    if (found) Copyfilename = "@left@@right@"
    Copyfilename = "@Copydir@\@Copyfilename@.cpy"
    open CopyFile @Copyfilename error goto !i100_copyfile2
    goto !i100_copyfile_ok

!i100_copyfile2
    scanr:/@Copyfilename@/:/./
    Copyfilename = left
    //message = Copyfilename window message info ok
    open CopyFile @Copyfilename error file SOURCECODE f goto !i100_copy_loop
    
!i100_copyfile_ok
    //message = 'pasting [@Copyfilename@]' window message info ok
    b
    clear
    copy;*
    close CopyFile
    file SOURCECODE
    paste
    goto !i100_copy_loop
!i100_copy_done
    b

    //***************************
    //* Find Starting Position
    //***************************
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof)
+      message = 'Unable to locate PROCEDURE DIVISION' window message error ok
+      return
+   endif
    LastParagraph = null

!i100_loop
    if (eof) goto !i100_done
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !i100_loop
+   endif
    HoldRight = right
    split:/@right/;1
    if (left != ' ')
+      scan:/@HoldRight/:word
+      Paragraph = left
+      call !i110_paragraph
+      file SOURCECODE
+      f;1
+      goto !i100_loop
+   endif

    if (left = ' ')
+      scan:/@line/:/ PERFORM /
+      if (found)
+         Newline = line
+         size Newline,72
+         scan:/@Newline/:/ PERFORM /
+         scan:/@right/:word
+         Perform = left
+         call !i120_perform
+   endif
    file SOURCECODE
    f;1
    goto !i100_loop

!i100_done
    //***************************************
    //* Write Files
    //***************************************
    write COBOLWIN @CobolWinName
    write COBOLNAV @CobolNavName

    //close SOURCECODE
    close COBOLWIN
    close COBOLNAV
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    return

!i110_paragraph
    //**************************************
    //* Process a Paragraph
    //**************************************
    scan:/@Paragraph@/:/./
    if (found) Paragraph = left
    upper Paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/-/
    if (found) 
+      Paragraph = left
+   endif

    crush Paragraph
    split:/@Paragraph@/;5
    if (left = 'UNTIL') return
    if (Paragraph = null) return
    if (Paragraph = "PROCEDURE") Paragraph = null return
    if (Paragraph = "COPY") Paragraph = null return
    if (Paragraph = "UNTIL") Paragraph = null return
    if (Paragraph = "WITH") Paragraph = null return
    if (Paragraph = "TEST") Paragraph = null return
    scan:/@Paragraph/:/-/
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file COBOLWIN
    b
    //Newline = 'WINDOW,COBOL_@Paragraph@_WIN,1,1,50,50,@Paragraph@' // FGB 01-09-2014
    Newline = 'WINDOW,COBOL_@ParagraphFull@_WIN,1,1,50,50,@ParagraphFull@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    //Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@' // FGB 01-09-2014
    Newline = '@ParagraphFull@,@ParagraphFull@,@ParagraphFull@'

!i110_paragraph_ViewFilterList
    //**************************************
    //* Update ViewFilterList
    //**************************************
    //message = 'ViewFilterList Newline[@Newline@]' window message info ok
    file ViewFilterList
    b
    scan:/@Newline/:/,/
    HoldLeft = left
    goto !i110_paragraph_ViewFilterList_add // FGB 01-09-2014
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/-/
    if (found)
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/ //message = 'replaced' window message info ok
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/-/
    if (!found)
+      scan:/@Newline/:/,/                 // 01-16-2014 was scanning line
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         //message = 'skipped' window message info ok
+         return
+   endif

!i110_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@HoldLeft@/
    if (eof) 
+      i:/@Newline@/ //message = 'added' window message info ok
+   else
+      //message = 'skipped 2' window message info ok
+   endif

    return

!i120_perform
    //**************************************
    //* Process a Perform
    //**************************************
    //message = 'PERFORM [@Paragraph@][@Perform@][@line@]' window message info ok
    if  (Paragraph = null) 
+       Paragraph = '0000'
+       ParagraphFull = '0000-PROCEDURE-DIVISION'
+   endif 
    scan:/@Perform@/:/./
    if (found) Perform = left
    upper Perform
    PerfParaFull = Perform
    scan:/@Perform@/:/-/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    split:/@Perform@/;5
    if (left = 'UNTIL') return
    if (left = 'VARYI') return
    if (left = 'WITH') return
    if (left = 'TEST') return
    if (Paragraph = Perform) return
    
    Newline = 'COBOL_@ParagraphFull@_@PerfParaFull@_PBOBJ,@PerfParaFull@,open' // FGB 01-09-2014
    file COBOLNAV
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/ //message = 'New COBOLNAV[@line@]' window message info ok
    file COBOLWIN
    b
    Newline = 'WINDOW,COBOL_@PerfParaFull@_WIN,1,1,50,50,@PerfParaFull@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@ParagraphFull@,@ParagraphFull@'
    call !i110_paragraph_ViewFilterList

    if (ParagraphFull = '0000-PROCEDURE-DIVISION')
+      file COBOLWIN
+      Newline = 'WINDOW,COBOL_@ParagraphFull@_WIN,1,1,50,50,@ParagraphFull@'
+      b
+      fs:/@Newline@/
+      if (eof) 
+         i:/@Newline@/
+   endif

    if (ParagraphFull = '0000-PROCEDURE-DIVISION')
+      Newline = '@ParagraphFull@,@ParagraphFull@,@ParagraphFull@'
+      call !i110_paragraph_ViewFilterList
+   endif

    return

//**********************************************************************************************************************
//******************************
//* Import a BEDIT program for View
//******************************
!i200_import_bedit
    string  HoldRight     error
    string  HoldLeft      error
    string  Paragraph     error
    string  Perform       error
    string  ProgramName   error
    string  BeditCodeWinName  error
    string  BeditCodeNavName  error
    string  ParagraphFull error
    string  LastParagraph error
    string  PerfParaFull  error

    HoldRight = null
    Paragraph = null
    Perform = null

!i200_main
    file SOURCECODE
    b
    //message = 'Builder_Import_Viewmods_RBOBJ[@Builder_Import_Viewmods_RBOBJ@]' window message info ok
    //message = 'Builder_Import_Viewfiles_RBOBJ[@Builder_Import_Viewfiles_RBOBJ@]' window message info ok
    //message = 'Builder_Import_Viewvars_RBOBJ[@Builder_Import_Viewvars_RBOBJ@]' window message info ok
    if  (Builder_Import_Viewfiles_RBOBJ)
+       call !i250_viewfiles
+   endif
    if  (Builder_Import_Viewvars_RBOBJ)
+       call !i260_viewvars
+   endif
    b

    open BeditCodeWin null
    open BeditCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'BEDIT-@ProgramName@'

    //message = 'SOURCECODE program [@ProgramName@]' window message info ok
    
    BeditCodeWinName = '@ProgramName@.win'
    BeditCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b

    //*************************************
    //* Fix string call lines
    //*************************************
    do
        pattern on
        fs:/ string *call /
        pattern off
        if (!eof)
+          scan:/@line/:/ string /
+          scan:/@right/:word
+          Newline = '!@left@'
+          r:/@Newline@/
+          f;1
+          scan:/@right/:/call /
+          splitr:/@right@/;1
+          Newline = '    call @left@' //message = 'replacing [@line@] with [@Newline@]' window message info ok
+          r:/@Newline/
+          f;1
+       endif
    until (eof)
    //write SOURCECODE BEDITSTR.dat

    //***************************
    //* Find Starting Position
    //***************************
    b
    cols 1,1
    fs:/!/
    noco
    if (eof)
+      message = 'Unable to locate first label in the Bedit code'
+      window message error ok
+      return
+   endif

    LastParagraph = null
!i200_loop
    if (eof) goto !i200_done
    split:/@line/;1
    HoldRight = right
    if (left = '!')
+      scan:/@HoldRight/:word
+      Paragraph = left
+      call !i210_paragraph
+      file SOURCECODE
+      f;1
+      goto !i200_loop
+   endif

    if-1 (left = ' ') or (left = '+')
+      scan:/@line/:/ call /
+      if-2 (found)
+         scan:/@right/:word
+         Perform = left
+         split:/@left@/;1
+         if-3 (left = '!')
+            Perform = right
+            call !i220_perform
+         else-3
+            call !i220_perform
+   endif
    file SOURCECODE
    f;1
    goto !i200_loop

!i200_done
    //***************************************
    //* Write Files
    //***************************************
    write BeditCodeWin @BeditCodeWinName
    write BeditCodeNav @BeditCodeNavName

    //close SOURCECODE
    close BeditCodeWin
    close BeditCodeNav

    return

!i210_paragraph
    //**************************************
    //* Process a Paragraph
    //**************************************
    ParagraphFull = Paragraph  
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file BeditCodeWin
    b
    Newline = 'WINDOW,BEDIT_@Paragraph@_WIN,1,1,50,50,@Paragraph@' 
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'

!i210_paragraph_ViewFilterList
    //**************************************
    //* Update ViewFilterList
    //**************************************
    //message = 'ViewFilterList Newline[@Newline@]' window message info ok
    file ViewFilterList
    b
    scan:/@Newline/:/,/
    HoldLeft = left
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/ //message = 'replaced' window message info ok
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/                      // 01-16-2014 was scanning line
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         //message = 'skipped' window message info ok
+         return
+   endif

!i210_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@HoldLeft@/
    if (eof) 
+      i:/@Newline@/ //message = 'added' window message info ok
+   else
+      //message = 'skipped 2' window message info ok
+   endif

    return

!i220_perform
    //**************************************
    //* Process a Perform
    //**************************************
    if  (Paragraph = null) return
    PerfParaFull = Perform
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file BeditCodeNav
    Newline = 'BEDIT_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file BeditCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file BeditCodeWin
    b
    Newline = 'WINDOW,BEDIT_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i210_paragraph_ViewFilterList

    return

//******************************
//* View B-Edit File Structure
//******************************
!i250_viewfiles
    string FileCallName  error

    open FileCallsFile null

    file SOURCECODE
    //**************************
    //* Comment all current calls
    //**************************
    b rs:/ call /:/ removedcall /;*
    b rs:/ window open /:/windowopen/;*
    b
    pattern on
    do
        fs:/print* file /
        if (!eof)
+          d;1
+       endif
    until (eof)
    b
    do
        fs:/print* open /
        if (!eof)
+          d;1
+       endif
    until (eof)
 
    pattern off
    b
    //**************************
    //* Change all File access to calls
    //**************************
    do
        scan:/@line/:word
        split:/@left/;2
        if  (left != '//')
+           //scan:/@line/:/ file /
+           split:/@line/;1
+           scan:/@right/:word
+           if  (left = 'file')
+               scan:/@right/:word
+               call !i251_filecallsfile
+               file SOURCECODE
+               Newline = '    call @FileCallName@'
+               r:/@Newline/
+               file SOURCECODE
+       endif
        scan:/@line/:word
        split:/@left/;2
        if  (left != '//')
+           //scan:/@line/:/ open /
+           split:/@line/;1
+           scan:/@right/:word
+           if  (left = 'open')
+               scan:/@right/:word
+               call !i251_filecallsfile
+               file SOURCECODE
+               if (FileCallName != null)
+                  Newline = '    call @FileCallName@'
+                  r:/@Newline/
+                  file SOURCECODE
+       endif
        f;1
    until (eof)

    //**************************
    //* Remove duplicate module 
    //* prefix's
    //**************************
    file SOURCECODE
    b
    string LastModulePrefix error
    string ModuleName       error
    string ModulePrefix     error
    do
        split:/@line/;1
        if-1  (left = '!')
+           scan:/@line/:word
+           ModuleName = left     
+           scan:/@ModuleName/:/_/
+           if-2  (found)
+               ModulePrefix = left
+               if-3  (ModulePrefix = LastModulePrefix)
+                   Newline = 'Removed@line@'
+                   r:/@Newline/
+               else-3
+                   LastModulePrefix = ModulePrefix
+           else-2
+               ModulePrefix = ModuleName
+               if-2a  (ModulePrefix = LastModulePrefix)
+                   Newline = 'Removed@line@'
+                   r:/@Newline/
+               else-2a
+                   LastModulePrefix = ModulePrefix
+       endif
        f;1
    until (eof)

    //**************************
    //* Remove modules without files
    //**************************
    file SOURCECODE
    b
    ib:/$*$FGB/
    f;*
    direction up
    string KeepModule error
    KeepModule = 'n'
    do
        scan:/@line/:/ call !*/
        if  (found)
+           KeepModule = 'y'
+       endif
        split:/@line/;1
        if-1  (left = '!')
+           if-2 (!KeepModule)
+               Newline = 'Removed@line@'
+               r:/@Newline@/
+           else-2
+               KeepModule = 'n'
+       endif
        f;1
    until (line = '$*$FGB')
    direction down

    //**************************
    //* Add the new called File 
    //* Modules to the Source Code
    //**************************
    file FileCallsFile
    b
    if (eof)
+      goto !b250_done
+   endif
    do
        file FileCallsFile
        if (!eof)
+          Newline = line
+          file SOURCECODE
+          f;*
+          i:/@Newline@/
+          i:/    return/
+          i:/ /
+       endif
        file FileCallsFile
        f;1
    until (eof)

!b250_done
    close FileCallsFile
    file SOURCECODE
    b
    return

//******************************
//* Update the FileCallsFile
//******************************
!i251_filecallsfile
    string TestCallName error
    string ModulePrefix error
    TestCallName = left
    subs ^
    split:/^TestCallName/;1
    if (left = '@')
+      FileCallName = null
+      subs @
+      return
+   endif
    subs @
    file FileCallsFile
    b
!i251_filecallsfile_loop
    fs:/@TestCallName@/
    if (!eof)
+      if (line != TestCallName)
+         //goto !i251_filecallsfile_loop
+   endif
    if (eof)
+      i:/@TestCallName@/
+   endif
    //FileCallName = '!*F@lineno@_@line@/
    ModulePrefix = '00@lineno@'
    splitr:/@ModulePrefix@/;2
    FileCallName = '!*F@right@_@line@/
    return

//******************************
//* View Variables
//******************************
!i260_viewvars
    string FileCallName  error

    open FileCallsFile null
    open FileCallsFileFull null
    file SOURCECODE
    //**************************
    //* Comment all current calls
    //**************************
    b rs:/ call /:/ removedcall /;*
    b
    pattern on
    do
        fs:/print* file /
        if (!eof)
+          d;1
+       endif
    until (eof)
    b
    do
        fs:/print* open /
        if (!eof)
+          d;1
+       endif
    until (eof)

    //*********************************************************
    //* Create the VariableFile
    //*********************************************************
    close VarFileWork error
    open VarFileWork null
    
    //************************************
    //* Load the BED Module and Variable Names
    //************************************
    string VarFileName  error
    strinig VarFileName error
    file SOURCECODE
    b
    do
        //*********************
        //* Variables
        //*********************
        scan:/@line/:word
        lower left
        if (left = 'int') or (left = 'integer') or (left = 'string') or (left = 'float') or (left = 'dollar')
+          scan:/@right/:word
+          file VarFileWork
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+       endif

        file SOURCECODE
        f;1
    until (eof)
    file VarFileWork
    i:/line/
    i:/left/
    i:/mid/
    i:/right/
    i:/midright/
    i:/lword/
    i:/rword/
    i:/null/
    i:/found/
    i:/partial1/
    i:/partial2/
    i:/functionkey/
    i:/pcount/
    i:/lineno/
    i:/lline/
    i:/lleft/
    i:/lmid/
    i:/lright/
    i:/lmidright/
    i:/llword/
    i:/calllevel/
    i:/message/
    i:/staus/
    i:/tab/
    i:/date/
    i:/time/
    i:/eof/

    //**************************
    //* Find the vars in the source
    //**************************
    open PasteVarsFile null

    string SourceLine   error
    string SearchString error

    //**************************
    //* Open Progress
    //**************************
    file SOURCECODE
    b
    f;*
    ProgressCount = pcount + 1
    call !p100_open_progress

    string Bypass error
    Bypass = 'y'

    file SOURCECODE
    b
    do-source
        //**************************
        //* Show Progress
        //**************************
        call !p200_show_progress
 
        file SOURCECODE
        split:/!line/;1
        if  (left = '!')
+           Bypass = 'n'
+       endif
        if (Bypass) goto !i260_bypass
        pack line
        if (line = null) goto !i260_bypass
        scan:/@line/:word
        split:/@left/;2
        if (left = '//') goto !i260_bypass

        SourceLine = line
        clear
        file VarFileWork
        b
        do-vars
            file VarFileWork
            SearchString = line
            scan:/@SourceLine/:/@SearchString/
            if  (found)
+               split:/@right/;1
+               pattern on
+               scan:/@left/:/~/
+               pattern off
+               if (found) or (left = null) or (left = ' ')
+                  call !i261_filecallsfile
+                  Newline = '    call @FileCallName@'
+                  file PasteVarsFile
+                  i:/@Newline/
+           endif
            file VarFileWork
            f;1
        until-vars (eof)
        file PasteVarsFile
        b
        cut;*
        file SOURCECODE
        paste
        clear
!i260_bypass
        f;1   
    until-source (eof)

    //**************************
    //* Close Progress
    //**************************
    call !p300_close_progress

    //**************************************
    //* Sort the FileCallsFileFull file
    //* then change the old var name to new
    //**************************************
    string OldVarName error
    string NewVarName error
    string VarCount   error

    sort FileCallsFileFull,A,1
    file FileCallsFileFull

    b
    do
        if  (!eof)
+           scan:/@line/:/:/
+           OldVarName = right
+           NewVarName = left
+           VarCount = '000@lineno@'
+           splitr:/@VarCount@/;3
+           NewVarName = '!*V@right@_@NewVarName@'
+           file SOURCECODE
+           b
+           rs:/@OldVarName@/:/@NewVarName@/;*
+           file FileCallsFileFull
+       endif
        f;1
    until (eof)


    //**************************
    //* Remove duplicate module 
    //* prefix's
    //**************************
    file SOURCECODE
    b
    string LastModulePrefix error
    string ModuleName       error
    string ModulePrefix     error
    do
        split:/@line/;1
        if-1  (left = '!')
+           scan:/@line/:word
+           ModuleName = left     
+           scan:/@ModuleName/:/_/
+           if-2  (found)
+               ModulePrefix = left
+               if-3  (ModulePrefix = LastModulePrefix)
+                   Newline = 'Removed@line@'
+                   r:/@Newline/
+               else-3
+                   LastModulePrefix = ModulePrefix
+           else-2
+               ModulePrefix = ModuleName
+               if-2a  (ModulePrefix = LastModulePrefix)
+                   Newline = 'Removed@line@'
+                   r:/@Newline/
+               else-2a
+                   LastModulePrefix = ModulePrefix
+       endif
        f;1
    until (eof)

    //**************************
    //* Remove modules without files
    //**************************
    file SOURCECODE
    b
    ib:/$*$FGB/
    f;*
    direction up
    string KeepModule error
    KeepModule = 'n'
    do
        scan:/@line/:/ call !*/
        if  (found)
+           KeepModule = 'y'
+       endif
        split:/@line/;1
        if-1  (left = '!')
+           if-2 (!KeepModule)
+               Newline = 'Removed@line@'
+               r:/@Newline@/
+           else-2
+               KeepModule = 'n'
+       endif
        f;1
    until (line = '$*$FGB')
    direction down

    //**************************
    //* Add the new called File 
    //* Modules to the Source Code
    //**************************
    file FileCallsFile
    b
    if (eof)
+      goto !i260_done
+   endif
    do
        file FileCallsFile
        if (!eof)
+          Newline = line
+          file SOURCECODE
+          f;*
+          i:/@Newline@/
+          i:/    return/
+          i:/ /
+       endif
        file FileCallsFile
        f;1
    until (eof)

!i260_done

    close VarFileWork
    close PasteVarsFile
    close FileCallsFile 
    close FileCallsFileFull
    return

//******************************
//* Update the FileCallsFile
//******************************
!i261_filecallsfile
    string TestCallName error
    string ModulePrefix error
    TestCallName = SearchString
    file FileCallsFile

    b
!i261_filecallsfile_loop
    fs:/@TestCallName@/
    if (!eof)
+      if (line != TestCallName)
+         f;1
+         goto !i261_filecallsfile_loop
+   endif
    if (eof)
+      i:/@TestCallName@/
+   endif
    //FileCallName = '!*F@lineno@_@SearchString@/
    ModulePrefix = '000@lineno@'
    splitr:/@ModulePrefix@/;3
    FileCallName = '!*V@right@_@SearchString@'

    //******************************
    //* Add the var to the full file
    //******************************
    Newline = '@SearchString@:@FileCallName@'
    file FileCallsFileFull
    b
    fs:/@Newline@/
    if  (eof)
+       i:/@Newline@/
+   endif
    return

//**********************************************************************************************************************
//******************************
//* Import a C program for View
//******************************
!i300_import_c
    string  HoldRight     error
    string  HoldLeft      error
    string  Paragraph     error
    string  Perform       error
    string  ProgramName   error
    string  CCodeWinName  error
    string  CCodeNavName  error
    string  ParagraphFull error
    string  LastParagraph error
    string  PerfParaFull  error

    HoldRight = null
    Paragraph = null
    Perform = null

!i300_main
    file SOURCECODE
    b

    open CCodeWin null
    open CCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'C-@ProgramName@'

    //message = 'CCode program [@ProgramName@]' window message info ok
    
    CCodeWinName = '@ProgramName@.win'
    CCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b rs:|"//"|:|"\\"|;*
    b rs:/@tab@/:/     /;*
    b
    //*************************************
    //* Remove Comments
    //*************************************
    do  
        if (!eof)
+          fs:|//|
+          if (!eof)
+             scan:/@line/:|//|
+             r:/@left@/
+       endif
        f;1
    until (eof)
    b
    call !i301_remove_comments

    //*************************************
    //* includes
    //*************************************
    b
    do  
        if (!eof)
+          scan:/@line/:word
+          split:/@left/;1 
+          if (left = '#')
+             r:/ /
+       endif
        f;1
    until (eof)

    //*************************************
    //* Remove Blank Lines
    //*************************************
    file SOURCECODE
    b
!i300_del_lines
    if (eof)
+      goto !i300_del_done
+   endif
    Newline = line
    crush Newline
    if (Newline = null)
+      d;1
+   else
+      f;1
+   endif
    goto !i300_del_lines   

!i300_del_done
    b
    rs:/ call /:/ xxx /
    b

    //write SOURCECODE SOURCECODE.C message = 'C ready for processing' window message info ok

    //*************************************
    //* Find Functions
    //*************************************
    int  BracketCount error
    int  FunctionCount error
    BracketCount = 0
    FunctionCount = 0

    open Functions null 
    file SOURCECODE 
    b  
    do
        if (!eof)
+          scan:/@line/:/(/
+          if (found)
+             if (!BracketCount)
+                call !i302_found_function
+       endif
        file SOURCECODE
        if (!eof)
+          call !i303_count_brackets
+       endif
        //message = 'FunctionCount[@FunctionCount@] BracketCount[@BracketCount@] line[@line@]' window message info ok
        if (BracketCount < 0)
+          message = 'Non-matching brackets [@lineno@][@line@]' 
+          window message warning ok
+          file SOURCECODE
+          f;*
+       endif
        file SOURCECODE
        f;1
    until (eof)

    //write SOURCECODE SOURCECODE.C message = 'C done with brackets' window message info ok

    //*************************************
    //* Replaced called functions with call
    //*************************************
    file Functions
    b
    do
        if (!eof)
+          Paragraph = line
+          call !i305_paragraph
+       endif
        file Functions
        f;1
    until (eof)
    
    //write Functions SOURCECODE-Functions.txt
    close Functions
    //write SOURCECODE SOURCECODE.C
    //window stop

    LastParagraph = null
    Paragraph = null
    file SOURCECODE
    b
!i300_loop
    if (eof) goto !i300_done
    split:/@line/;1
    if (left = '!')
+      scan:/@right/:word
+      Paragraph = left
+      call !i310_paragraph
+      goto !i300_next
+   endif

    scan:/@line/:/ call /
    if  (!found) 
+       scan:/@line/:/ CALL /
+       if (!found)
+          goto !i300_next
+   endif

    HoldRight = right
    HoldLeft = left

    scan:/@HoldRight/:word
    Perform = left
    split:/@Perform/;1
    if  (left = '!') Perform = right
    call !i320_perform

!i300_next
    file SOURCECODE
    f;1
    goto !i300_loop

!i300_done
    write CCodeWin @CCodeWinName
    write CCodeNav @CCodeNavName

    //close SOURCECODE
    close CCodeWin
    close CCodeNav
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    return

//*******************************
//* Remove /* */ comments
//*******************************
!i301_remove_comments
    fs:|/*|
    if (eof) return
    scan:/@line/:|/*|
    HoldLeft = left
    HoldRight = right
    Newline = HoldLeft
    scan:/@right/:|*/|
!i301_loop1
    if  (!found)
+       r:/@Newline@/
+       f;1
+       if (!eof)
+          scan:/@line/:|*/|
+          Newline = null
+          goto !i301_loop1
+   endif
    if (eof) return
    scan:/@line/:|*/|
    if (found)
+      r:/@right/
+      f;1
+      goto !i301_remove_comments
+   else
+      d
+      goto !i301_loop1
+   endif
    return

//*******************************
//* Found a function def line
//*******************************
!i302_found_function
    scanr:/@left/:word
    file Functions
    if (right != null)
+      Newline = right
+   else
+      Newline = left
+   endif
    crush Newline
    //if (Newline = 'main') Newline = '0000_main'
    i:/@Newline@/     
    file SOURCECODE
    Newline = '!@Newline@ @line@'
    r:/@Newline@/ 
    FunctionCount ++
    file SOURCECODE
    return

//*******************************
//* Count Parens
//*******************************
!i303_count_brackets
    Newline = line
    scan:/@Newline/:/{/
!i303_scan_left
    if (found) 
+      BracketCount ++
+      scan:/@right/:/{/
+      goto !i303_scan_left
+   endif

    scan:/@Newline/:/}/
!i303_scan_right
    if (found) 
+      BracketCount --
+      scan:/@right/:/}/
+      goto !i303_scan_right
+   endif

    //Newline = '[@BracketCount@]@line@' r:/@Newline@/

    //message = 'paren count[@line@][@BracketCount@]' window message info ok
    return

//*******************************
//* Add CALL to all called functions
//*******************************
!i305_paragraph
    file SOURCECODE
    b
!i305_loop
    fs:/@Paragraph@/
    if (eof) return
    split:/@line/;1
    if (left = '!') goto !i305_next
    Newline = '@left@ call @Paragraph@ @right@'
    r:/@Newline/
    goto !i305_next
    
!i305_next
    f;1
    if (eof) return
    goto !i305_loop
    

!i310_paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file CCodeWin
    b
    Newline = 'WINDOW,CCode_@Paragraph@_WIN,1,1,50,50,@Paragraph@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'
!i310_paragraph_ViewFilterList
    file ViewFilterList
    b
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@left@,'
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/                     // 01-16-2014 was scanning line
+      SearchString = '@left@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         return
+   endif

!i310_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@Newline@/
    if (eof) i:/@Newline@/
    return

!i320_perform
    if  (Paragraph = null) return
    PerfParaFull = Paragraph
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file CCodeNav
    Newline = 'CCode_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file CCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file CCodeWin
    b
    Newline = 'WINDOW,CCode_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i310_paragraph_ViewFilterList

    return

========================================================================================================================================================
//******************************
//* Import a Java program for View
//******************************
!i400_import_java
    string  HoldRight        error
    string  HoldLeft         error
    string  Paragraph        error
    string  Perform          error
    string  ProgramName      error
    string  JavaCodeWinName  error
    string  JavaCodeNavName  error
    string  ParagraphFull    error
    string  LastParagraph    error
    string  PerfParaFull     error
    string  CurrentClass     error
    string  FunctionName     error

    HoldRight = null
    Paragraph = null
    Perform = null

!i400_main
    window pointer wait
    close SOURCECODE error
    if (Builder_Import_Filename_EFOBJ = null)
+      call !i450_read_java_files
+      Builder_Import_Filename_EFOBJ = 'JAVADIR'
+   else
+      open SOURCECODE @Builder_Import_Filename_EFOBJ
+   endif

    file SOURCECODE
    b
    subs ^
    rs:/@/:/ /;*
    subs @

    open JavaCodeWin null
    open JavaCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'Java-@ProgramName@'

    //message = 'JavaCode program [@ProgramName@]' window message info ok
    
    JavaCodeWinName = '@ProgramName@.win'
    JavaCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b rs:|"//"|:|"\\"|;*
    b rs:/@tab@/:/     /;*
    b
    //*************************************
    //* Remove Comments
    //*************************************
    do  
        if (!eof)
+          fs:|//|
+          if (!eof)
+             scan:/@line/:|//|
+             r:/@left@/
+       endif
        f;1
    until (eof)
    b
    call !i401_remove_comments

    //*************************************
    //* Remove Imports
    //*************************************
    b
    do  
        if (!eof) 
+          scan:/@line/:word
+          if (left = 'import')
+             r:/ /
+       endif
        f;1
    until (eof)

    //*************************************
    //* Remove Blank Lines
    //*************************************
    file SOURCECODE
    b
!i400_del_lines
    if (eof)
+      goto !i400_del_done
+   endif
    Newline = line
    crush Newline
    if (Newline = null)
+      d;1
+   else
+      f;1
+   endif
    goto !i400_del_lines   

!i400_del_done
    b
    rs:/ call /:/ xxx /
    b

    //write SOURCECODE SOURCECODE.java message = 'Java ready for processing' window message info ok

    //*************************************
    //* Create Class for Implements/Extends
    //*************************************
    string ClassName     error
    string ExtendClassName error

    pattern on
    do
        fs:/class *extends/-/class *implements/
        if-eof (!eof)
+          scan:/@line/:/class *extends/
+          if-extends (found)
+             scan:/@line/:/class /
+             scan:/@right/:word
+             ClassName = left
+             scan:/@right/:/extends/
+             scan:/@right/:word
+             ExtendClassName = left
+             Newline = "public void class @ExtendClassName@ () {"
+             ib:/@Newline/
+             Newline = "     @ClassName@ abcd = new @ClassName@ ();"
+             i:/@Newline/
+             f;1
+          else-extends
+             scan:/@line/:/class /
+             scan:/@right/:word
+             ClassName = left
+             scan:/@right/:/implements/
+             scan:/@right/:word
+             ExtendClassName = left
+             Newline = "public void class @ExtendClassName@ () {"
+             ib:/@Newline/
+             Newline = "     @ClassName@ abcd = new @ClassName@ ();"
+             i:/@Newline/
+             f;1
+        endif
         f;1
    until (eof)
    pattern off
    b

    //*************************************
    //* Find Functions/Classes
    //*************************************
    int  BracketCount error
    int  FunctionCount error
    BracketCount = 0
    FunctionCount = 0

    open Functions null 

    file SOURCECODE 
    b  
    do
        if (!eof)
+          scan:/@line/:/class /
+          if (found)
+             call !i402_found_function
+       endif
        file SOURCECODE
        scan:/@line/:/(/
        if (found)
+          scanr:/@left/:word
+          call !i402_found_function
+       endif
        file SOURCECODE
        f;1
    until (eof)

    //write SOURCECODE SOURCECODE.J1 //message = 'Java done with brackets' window message info ok

    //*************************************
    //* Remove 'calls' not in class Function list
    //*************************************
    file SOURCECODE
    b
    do
        fs:/call !/
        if (!eof)
+          scan:/@line/:/call !/
+          scan:/@right/:word
+          Paragraph = '@left@'
+          file Functions
+          b
+          fs:/@Paragraph@/
+          if (eof)
+             file SOURCECODE
+             //message = "Removing Paragraph[@Paragraph@] line[@line@]" window message info ok
+             rs:/call !/:/removecallto !/
+       endif
        file SOURCECODE
        f;1
    until (eof)

    //write SOURCECODE SOURCECODE.J2 //message = 'Java done with brackets' window message info ok

    //*************************************
    //* Make all "new class" names = class name
    //*************************************
    string OldName         error
    string NewFunctionCall error

    file Functions
    b
    do-functions
       split:/@line/;1
       FunctionName = right
       scan:/@FunctionName@/:/./
       if (found) FunctionName = "not-a-class"
       NewFunctionCall = " call !@FunctionName@ "
       SearchString = 'new* @FunctionName@'
       file SOURCECODE
       b
       do-code
          pattern on
          fs:/@SearchString@/
          if (!eof)
+            scan:/@line/:/@SearchString@/
+            scanr:/@left@/:/=/
+            scanr:/@left@/:word
+            OldName = right
+            i:/FGB-Point/
+            b;1
+            call !a405_change_oldname
+            b 
+            fs:/FGB-Point/
+            d
+            b;1
+         endif
          pattern off
          f;1
       until-code (eof)
       file Functions
       f;1
    until-functions (eof)
    b
    
    //write Functions SOURCECODE-Functions.txt
    close Functions
    //write SOURCECODE SOURCECODE.java
    //window stop

    LastParagraph = null
    Paragraph = null
    file SOURCECODE
    b
!i400_loop
    if (eof) goto !i400_done
    split:/@line/;1
    if (left = '!')
+      scan:/@right/:word
+      Paragraph = left
+      call !i410_paragraph
+      goto !i400_next
+   endif

    scan:/@line/:/ call /
    if  (!found) 
+       scan:/@line/:/ CALL /
+       if (!found)
+          goto !i400_next
+   endif

    HoldRight = right
    HoldLeft = left

    scan:/@HoldRight/:word
    Perform = left
    split:/@Perform/;1
    if  (left = '!') Perform = right
    call !i420_perform

!i400_next
    file SOURCECODE
    f;1
    goto !i400_loop

!i400_done
    close ClassesFile error
    open ClassesFile null
    file SOURCECODE
    b
    do
        fs:/call !/
        if (!eof)
+          scan:/@line/:/call !/
+          scan:/@right/:word
+          Newline = '!@left@'
+          file ClassesFile
+          b
+          fs:/@Newline@/
+          if (eof)
+             i:/@Newline/
+             i:/ /
+       endif
        file SOURCECODE
        f;1
    until (eof)
    file ClassesFile
    b
    clear
    copy;*
    file SOURCECODE
    f;*
    paste
    //write SOURCECODE SOURCECODE.j3
    close ClassesFile

    write JavaCodeWin @JavaCodeWinName
    write JavaCodeNav @JavaCodeNavName

    //close SOURCECODE
    close JavaCodeWin
    close JavaCodeNav
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    window pointer arrow
    return

//*******************************
//* Remove /* */ comments
//*******************************
!i401_remove_comments
    fs:|/*|
    if (eof) return
    scan:/@line/:|/*|
    HoldLeft = left
    HoldRight = right
    Newline = HoldLeft
    scan:/@right/:|*/|
!i401_loop1
    if  (!found)
+       r:/@Newline@/
+       f;1
+       if (!eof)
+          scan:/@line/:|*/|
+          Newline = null
+          goto !i401_loop1
+   endif
    if (eof) return
    scan:/@line/:|*/|
    if (found)
+      r:/@right/
+      f;1
+      goto !i401_remove_comments
+   else
+      d
+      goto !i401_loop1
+   endif
    return

//*******************************
//* Found a function def line
//*******************************
!i402_found_function
    string JavaFoundType error  
    string Holdright     error  

    if-class (mid = 'class ')
+      scan:/@right/:word
+      Newline = "@left@"
+      CurrentClass = Newline
+      crush Newline
+      JavaFoundType = 'class'
+   else-class
+      Newline = "@CurrentClass@.@right@"
+      JavaFoundType = 'function'
+      Holdright = right
+      scan:/@line/:/;/
+      if-call (found)
+          Newline = Holdright
+          JavaFoundType = 'call'
+   endif
    scan:/@Newline/:/{/
    if (found) Newline = "@left@@right@"
    scan:/@Newline/:/}/
    if (found) Newline = "@left@@right@"
    crush Newline
    if (Newline = 'for') goto !i402_next

    if  (JavaFoundType = 'class') or (JavaFoundType = 'function')
+       if (Newline != '=')
+          Newline = '!@Newline@'
+          file Functions
+          b
+          fs:/@Newline@/
+          if (eof)
+             i:/@Newline@/
+             FunctionCount ++    
+   endif 

    file SOURCECODE
    if  (JavaFoundType = 'class')
+       Newline = '@Newline@ @line@'
+       r:/@Newline@/ 
+   endif
    if  (JavaFoundType = 'call') and (Newline != '=')
+       Newline = '    call !@Newline@ @line@'
+       r:/@Newline@/ 
+   endif
!i402_next
    file SOURCECODE
    //f;1
    return

//*******************************
//* Count Parens
//*******************************
!i403_count_brackets
    Newline = line
    scan:/@Newline/:/{/
!i403_scan_left
    if (found) 
+      BracketCount ++
+      scan:/@right/:/{/
+      goto !i403_scan_left
+   endif

    scan:/@Newline/:/}/
!i403_scan_right
    if (found) 
+      BracketCount --
+      scan:/@right/:/}/
+      goto !i403_scan_right
+   endif

    //Newline = '[@BracketCount@]@line@' r:/@Newline@/

    //message = 'paren count[@line@][@BracketCount@]' window message info ok
    return    

//*******************************
//* Change all old class names to actual
//*******************************
!a405_change_oldname
   string OldnameSearch error
   string NewReplace    error

   scan:/@line/:/call !/
   if (!found)
+     Newline = '    call !@FunctionName@ @line@'
+     r:/@Newline@/
+   endif

    OldnameSearch = '@OldName@.'
    NewReplace = '@FunctionName@.'
    if  (OldnameSearch = NewReplace) return
    if  (OldnameSearch = '.') return
    pattern off
    b
    //message = 'FunctionName[@FunctionName@] OldName[@OldName@] OldnameSearch[@OldnameSearch@] NewReplace[@NewReplace@] line[@line@]' window message info ok
    do
        fs:/@OldnameSearch/
        if (!eof)
+          scan:/@line/:/@OldnameSearch/
+          if (found)  
+             rs:/@OldnameSearch@/:/@NewReplace@/
+             Newline = '    call !@FunctionName@ - @line@'
+             r:/@Newline@/
+       endif
        //f;1
    until (eof)
    return

//*******************************
//* Found a Paragraph
//*******************************
!i410_paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file JavaCodeWin
    b
    Newline = 'WINDOW,JavaCode_@Paragraph@_WIN,1,1,50,50,@Paragraph@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'
!i410_paragraph_ViewFilterList
    file ViewFilterList
    b
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@left@,'
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/
+      SearchString = '@left@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         return
+   endif

!i410_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@Newline@/
    if (eof) i:/@Newline@/
    return

!i420_perform
    if  (Paragraph = null) return
    PerfParaFull = Paragraph
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file JavaCodeNav
    Newline = 'JavaCode_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file JavaCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file JavaCodeWin
    b
    Newline = 'WINDOW,JavaCode_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i410_paragraph_ViewFilterList

    return

//*************************************
//* Read all java files into one file
//*************************************
!i450_read_java_files
    string TestExtension error
    string JavaFilename  error
    Dirname = Builder_Import_Directory_EFOBJ
    call !x100_dirlist
    file DirFileList
    b
    do
        scanr:/@line/:/./
        TestExtension = right
        upper TestExtension
        if  (TestExtension != Extension)
+           d
+       else
+           f
+       endif
    until (eof)
    close SOURCECODE error
    open SOURCECODE null
    //write DirFileList dirfilelist.dat
    b
    do
        JavaFilename = line
        open TempJavaSource @JavaFilename error goto !i450_next
        //message = 'Merging @JavaFilename@' window message info ok
        subs `
        b 
        clear
        copy;*
        file SOURCECODE
        i:/ /
        paste
        subs @
        close TempJavaSource
        file DirFileList
        f;1
    until (eof)
    //write SOURCECODE SOURCECODE.java
    return

========================================================================================================================================================

//******************************
//* Show COBOL comments for module
//******************************
!j100_cobol_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    SearchString = '@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j100_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;6
    split:/@right/;1
    if (left != ' ')
+      goto !j100_next
+   endif
    scan:/@right/:word
    //message = 'comparing[@left@] to [@SearchString@]' window message info ok
    if  (left != SearchString)
+       goto !j100_next
+   endif
    goto !j100_found
!j100_next
    f;1
    if (eof) goto !j100_done
    goto !j100_loop

!j100_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j100_find_up
    b;1
    if  (Lastline = line) goto j100_keep_down
    Lastline = line
    split:/@line/;6
    split:/@right/;1
    if (left = '*') goto !j100_find_up
    if  (left = ' ')
    split:/@line/;7
    Newline = right
    size Newline,70
    pack Newline
    if (Newline = null) goto !j100_find_up
    f;1
!j100_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j100_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j100_keep_down

!j100_comments_down
    if (eof) goto !j100_done
    split:/@line/;6
    split:/@right/;1
    if  (left = ' ') 
+       split:/@line/;7
+       Newline = right
+       size Newline,65
+       pack Newline
+       if (Newline = null) 
+          goto !j100_next_down
+   endif
    split:/@line/;6
    split:/@right/;1
    if  (left = ' ')
+       goto !j100_done
+   endif
    if (left != '*') goto !j100_next_down
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j100_next_down
    f;1
    if (!eof) goto !j100_comments_down    

!j100_done
    return

//******************************
//* Show BEDIT comments for module
//******************************
!j200_bedit_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    file SOURCECODE
    b
    cols 1,1
    fs:/!/
    noco
    SearchString = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j200_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;1
    if (left != '!')
+      goto !j200_next
+   endif
    scan:/@line/:/@SearchString@/
    if (right != null) goto !j200_next
    goto !j200_found
!j200_next
    f;1
    if (eof) goto !j200_done
    goto !j200_loop

!j200_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j200_find_up
    b;1
    if  (Lastline = line) goto j200_keep_down
    Lastline = line
    scan:/@line/:word
    split:/@left/;2
    if (left = '//') goto !j200_find_up
    f;1
!j200_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j200_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j200_keep_down

!j200_comments_down
    if (eof) goto !j200_done
    scan:/@line/:word
    split:/@left/;2
    if  (left != '//') goto !j200_done
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j200_next_down
    f;1
    if (!eof) goto !j200_comments_down    

!j200_done
    return

//******************************
//* Show C comments for module
//******************************
!j300_c_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    //$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$
    return

    file SOURCECODE
    b
    cols 1,1
    fs:/!/
    noco
    SearchString = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j200_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;1
    if (left != '!')
+      goto !j200_next
+   endif
    scan:/@line/:/@SearchString@/
    if (right != null) goto !j200_next
    goto !j200_found
!j200_next
    f;1
    if (eof) goto !j200_done
    goto !j200_loop

!j200_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j200_find_up
    b;1
    if  (Lastline = line) goto j200_keep_down
    Lastline = line
    scan:/@line/:word
    split:/@left/;2
    if (left = '//') goto !j200_find_up
    f;1
!j200_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j200_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j200_keep_down

!j200_comments_down
    if (eof) goto !j200_done
    scan:/@line/:word
    split:/@left/;2
    if  (left != '//') goto !j200_done
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j200_next_down
    f;1
    if (!eof) goto !j200_comments_down    

!j200_done
    return

//******************************
//* View Cobol Module
//******************************
!k100_cobol_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    if  (ClickView) goto !k100_filter_obtain
    Builder_Filter_Windowlist_LBOBJ = 'FIRST'
    goto !k100_filter_obtain
!k100_filter_loop
    if  (ClickView)
+       Builder_Filter_Windowlist_LBOBJ = null
+   else
+       Builder_Filter_Windowlist_LBOBJ = 'NEXT'
+   endif
!k100_filter_obtain
    if (!ClickView)
+       window obtain Builder_Filter_Windowlist_LBOBJ
+   endif
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k100_done
+   endif 

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/-/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco

    //****************************
    //* Find the correct module
    //****************************
!k100_cobol_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k100_filter_loop
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !k100_cobol_module_loop1
+   endif
    scan:/@right/:word
    ModuleName = left
    scan:/@ModuleName/:/./
    if (found) ModuleName = left
    crush ModuleName

    if (Builder_Filter_Windowlist_LBOBJ != ModuleName)
+      f;1
+      goto !k100_cobol_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       split:/@line/;6
       split:/@right/;1
    until (left != '*') and (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k100_cobol_module_loop2
    clear
    copy;1
    file ProgModule
    paste
    file SOURCECODE
    f;1
    if  (eof) goto !k100_filter_loop
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/') goto !k100_cobol_module_loop2
    split:/@right/;1
    if (left = ' ') goto !k100_cobol_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k100_cobol_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       split:/@line/;6
       split:/@right/;1
       if (left = '*') or (left = '/')
+         d;1
+         split:/@line/;6
+         split:/@right/;1
+      endif
    until (left != '*') and (left != '/')

    goto !k100_filter_loop
!k100_done
    return

//******************************
//* View Bedit Module
//******************************
!k200_bedit_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    if  (!ClickView)
+       Builder_Filter_Windowlist_LBOBJ = 'FIRST'
+   endif
    goto !k200_filter_obtain
!k200_filter_loop
    if  (ClickView)
+       Builder_Filter_Windowlist_LBOBJ = null
+   else
+       Builder_Filter_Windowlist_LBOBJ = 'NEXT'
+   endif
!k200_filter_obtain
    if  (!ClickView)
+       window obtain Builder_Filter_Windowlist_LBOBJ
+   endif
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k200_done
+   endif 

    Builder_Filter_Windowlist_LBOBJ = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    file SOURCECODE
    b

    //****************************
    //* Find the correct module
    //****************************
!k200_bedit_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k200_filter_loop
    scan:/@line/:word
    ModuleName = left
    crush ModuleName

    if (Builder_Filter_Windowlist_LBOBJ != ModuleName)
+      f;1
+      goto !k200_bedit_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       scan:/@line/:word
       split:/@left@/;1
    until (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k200_bedit_module_loop2
    clear
    copy;1
    file ProgModule
    paste
    file SOURCECODE
    f;1
    if  (eof) goto !k200_filter_loop
    split:/@line/;1
    if (left != '!') goto !k200_bedit_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k200_bedit_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       scan:/@line/:word
       split:/@left/;1
       if (left = '/')
+         d;1
+         scan:/@line/:word
+         split:/@left/;1
+      endif
    until (left != '/')

    goto !k200_filter_loop
!k200_done
    return

//******************************
//* View C Module
//******************************
!k300_c_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    if  (!ClickView)
+       Builder_Filter_Windowlist_LBOBJ = 'FIRST'
+   endif
    goto !k300_filter_obtain
!k300_filter_loop
+   if  (ClickView)
+       Builder_Filter_Windowlist_LBOBJ = null
+   else
+       Builder_Filter_Windowlist_LBOBJ = 'NEXT'
+   endif
!k300_filter_obtain
    if  (!ClickView)
+       window obtain Builder_Filter_Windowlist_LBOBJ
+   endif
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k300_done
+   endif 

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    close CSource error
    open CSource @SystemName
   
    b

    //****************************
    //* Find the correct module
    //****************************
!k300_c_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k300_filter_loop
    split:/@line/;1
    if (left = '/') or (left = ' ') or (left = tab)
+     f;1 
+     goto !k300_c_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       scan:/@line/:word
       split:/@left@/;1
    until (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k300_c_module_loop2
    clear
    copy;1
    file ProgModule
    paste
    file CSource
    f;1
    if  (eof) goto !k300_filter_loop
    if (line = null) goto !k300_c_module_loop2
    split:/@line/;1
    if (left = '/') or (left = ' ') or (left = tab) or (left = '{') or (left = '}') goto !k300_c_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k300_c_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       scan:/@line/:word
       split:/@left/;1
       if (left = '/') or (line = null)
+         d;1
+         scan:/@line/:word
+         split:/@left/;1
+      endif
    until (left != '/')

    goto !k300_filter_loop
!k300_done
    return

//****************************************************************************
//* Language Create Commands
//****************************************************************************

//******************************
//* Create a Batch System
//******************************
!l100_create_batch
+       call !a110_Builder_Main_Batch_MSOBJ
+       Builder_System_Systemname_EFOBJ = LangCommand
+       window modify Builder_System_Systemname_EFOBJ
+       Builder_System_Title_EFOBJ = LangCommand
+       window modify Builder_System_Title_EFOBJ
+       Builder_System_Desc_MLOBJ = LangCommand
+       window modify Builder_System_Desc_MLOBJ
+       call !a200_Builder_System_Create_PBOBJ
+       call !a1800_Builder_Code_Assist_PBOBJ
+       window close Builder_Nav_WIN error
+   endif
    window setfocus Builder_Language_Commands_MLOBJ
    return

//******************************
//* Create a Windows System
//******************************
!l100_create_windows
+       call !a110_Builder_Main_Build_MSOBJ
+       Builder_System_Systemname_EFOBJ = LangCommand
+       window modify Builder_System_Systemname_EFOBJ
+       Builder_System_Title_EFOBJ = LangCommand
+       window modify Builder_System_Title_EFOBJ
+       Builder_System_Desc_MLOBJ = LangCommand
+       window modify Builder_System_Desc_MLOBJ
+       call !a200_Builder_System_Create_PBOBJ
+       window close Builder_Nav_WIN error
+   endif
    window setfocus Builder_Language_Commands_MLOBJ
    return

//******************************
//* Create a New Window
//******************************
!l100_create_new_window
    //window hwnd Builder_Control_WIN status window push Builder_Control_Save_PBOBJ error
    window hwnd Builder_Control_WIN status call !a400_Builder_Control_Save_PBOBJ error

    file PaintFile b window paint Builder_Control_WIN error
    Builder_Window_Windowname_EFOBJ = LangCommand
    window modify Builder_Window_Windowname_EFOBJ
    Builder_Window_WindowTitle_EFOBJ = LangCommand
    window modify Builder_Window_WindowTitle_EFOBJ

    window push Builder_Window_Create_PBOBJ
    //call !a300_Builder_Window_Create_PBOBJ
    window setfocus Builder_Language_Commands_MLOBJ
    return

//******************************
//* Change a Windows System
//******************************
!l300_change_windows
    window hwnd Builder_Control_WIN status call !a400_Builder_Control_Save_PBOBJ error
    window close Builder_Window_WIN error
    window close Builder_System_WIN error
    call !a110_Builder_Main_Build_MSOBJ
    Builder_System_SystemList_COOBJ = SystemName
    window modify Builder_System_SystemList_COOBJ
    LanguageCommand = 'y'
    window push Builder_System_Modify_PBOBJ
    return   

//******************************
//* Change a window in a windows system
//******************************
!l300_change_one_window
    window hwnd Builder_Control_WIN status call !a400_Builder_Control_Save_PBOBJ error
    Builder_Window_Windownamelist_COOBJ = LanguageWindow
    window modify Builder_Window_Windownamelist_COOBJ
    LanguageCommand = 'y'
    //message = 'changing @Builder_Window_Windownamelist_COOBJ@' window message info ok
    window push Builder_Window_Modify_PBOBJ
    return
 
//******************************
//* Change a Batch System
//******************************
!l300_change_batch
    window hwnd Builder_Control_WIN status call !a400_Builder_Control_Save_PBOBJ error
    window close Builder_Window_WIN error
    window close Builder_System_WIN error
    call !a110_Builder_Main_Batch_MSOBJ
    Builder_System_SystemList_COOBJ = SystemName
    window modify Builder_System_SystemList_COOBJ
    LanguageCommand = 'y'
    window push Builder_System_Assist_PBOBJ
    return  

//******************************
//* close all open windows
//******************************
!l400_close_all
    window hwnd Builder_View_WIN status call !a500_Builder_View_Cancel_PBOBJ error
    window hwnd Builder_Control_WIN status call !a400_Builder_Control_Save_PBOBJ error
    window close Builder_Codeassist_WIN error
    window close Builder_Window_WIN error
    window close Builder_System_WIN error
    window close Builder_Nav_WIN error
    window close Builder_Entryaction_WIN error
    window close Builder_Filter_WIN error
    window close Builder_Comments_WIN error
    window close Builder_Import_WIN error
    window close Builder_Callflow_WIN error
    window close Builder_3090_WIN error
    window close Builder_Progress_WIN error
    window close Builder_Download3090_WIN error
    window close Builder_Align_WIN error
    window close Builder_Search_WIN error
    window close Builder_Searchresults_WIN error
    window close Builder_Help_WIN error
    window close Builder_About_WIN error
    window close Builder_Browse_WIN error
    window close Builder_Newdir_WIN error
    window close Builder_Codecheck_WIN error
    window close Builder_Code_WIN error
    window close Builder_Find_WIN error
    window close Builder_Debugfiles_WIN error
    window close Builder_Debugdata_WIN error
    window close Builder_Debughelp_WIN error
    window close Builder_Debugcond_WIN error
    return

//******************************
//* Set the Object navigation
//******************************
!n100_navigation
    window pointer wait
    window hwnd Builder_Nav_WIN status error window open Builder_Nav_WIN shade
    //window windowpos Builder_Nav_WIN WinX WinY WinCX WinCY
    //WinX = ObjectX + 10
    //WinY = ObjectY + 45
    //window size Builder_Nav_WIN @WinX @WinY @WinCX @WinCY
    //window center Builder_Nav_WIN
    window clear Builder_Nav_WIN
    Builder_Nav_Controlname_STTXT = ButtonFocus
    window modify Builder_Nav_Controlname_STTXT
    Builder_Nav_Open_RBOBJ = 'Y'
    window modify Builder_Nav_Open_RBOBJ
    Builder_Nav_Windowlist_COOBJ = 'ALL'
    window delete Builder_Nav_Windowlist_COOBJ

    file WindowList error return
    b
!n100_loop
    if (!eof) 
+      Builder_Nav_Windowlist_COOBJ = line
+      window insert end default Builder_Nav_Windowlist_COOBJ
+      f;1
+      goto !n100_loop
+   endif

    file WindowNav
    b
    fs:/@ButtonFocus@/
    if (eof) 
+      Builder_Nav_Windowname_STTXT = null
+      window modify Builder_Nav_Windowname_STTXT
+      goto !n100_unshade
+   endif
    scan:/@line/:/,/
    scan:/@right@/:/,/
    Builder_Nav_Windowlist_COOBJ = left
    Builder_Nav_Windowname_STTXT = left
    window modify Builder_Nav_Windowname_STTXT
    NavAction = right
    if-1  (NavAction = 'open')
+       Builder_Nav_Open_RBOBJ = 'Y'
+       window modify Builder_Nav_Open_RBOBJ
+       Builder_Nav_Close_RBOBJ = 'N'
+       window modify Builder_Nav_Close_RBOBJ
+       Builder_Nav_Start_RBOBJ = 'N'
+       window modify Builder_Nav_Start_RBOBJ
+       Builder_Nav_Windownametext_STTXT = 'Window open'
+       window modify Builder_Nav_Windownametext_STTXT
+   else-1
+       if-2  (NavAction = 'close')
+          Builder_Nav_Open_RBOBJ = 'N'
+          window modify Builder_Nav_Open_RBOBJ
+          Builder_Nav_Close_RBOBJ = 'Y'
+          window modify Builder_Nav_Close_RBOBJ
+          Builder_Nav_Start_RBOBJ = 'N'
+          window modify Builder_Nav_Start_RBOBJ
+          Builder_Nav_Windownametext_STTXT = 'Window close'
+          window modify Builder_Nav_Windownametext_STTXT
+       else-2
+          Builder_Nav_Open_RBOBJ = 'N'
+          window modify Builder_Nav_Open_RBOBJ
+          Builder_Nav_Close_RBOBJ = 'N'
+          window modify Builder_Nav_Close_RBOBJ
+          Builder_Nav_Start_RBOBJ = 'Y'
+          window modify Builder_Nav_Start_RBOBJ
+          Builder_Nav_Windownametext_STTXT = 'Start'
+          window modify Builder_Nav_Windownametext_STTXT
+          Builder_Nav_Start_EFOBJ = Builder_Nav_Windowname_STTXT
+          window modify Builder_Nav_Start_EFOBJ
+   endif

!n100_unshade
    call !a400_Builder_Control_Focus_Controls_set
    window unshade Builder_Nav_WIN
    window setfocus Builder_Nav_WIN
    window pointer arrow    
    return


//******************************
//* Setup the Progress Window 
//* -initialize ProgressCount before calling
//******************************
!p100_open_progress
    close PaintFile error
    open PaintFile null
    i:/@EarthBitmapLine@/
    //i:/******************/
    //i:/******************/
    //i:/******************/
    window hwnd Builder_Progress_WIN status error window open Builder_Progress_WIN shade
    window center Builder_Progress_WIN
    window windowpos Builder_Progress_Progressframe_STTXT Progframex Progframey Progframecx Progframecy
    window windowpos Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    window size Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    ProgressMax = Progcx - 4

    if (ProgressCount) 
+      Progress = Progcx / ProgressCount
+   else
+      Progress = 1
+   endif
    //message = 'Files[@ProgressCount@] Progress[@Progress@] Progcx[@Progcx@]' window message info ok    
    b

    Progx += 2
    Progy += 2
    Progcx = 1
    Progcy -= 4
    window size Builder_Progress_Progress_STTXT Progx Progy Progcx Progcy
    ProgressShow = Progcx
    window unshade Builder_Progress_WIN
    window setfocus Builder_Progress_WIN

    return

//******************************
//* Show Progress
//******************************
!p200_show_progress
    ProgressWork = ProgressShow + Progress
    Progcx = ProgressWork
    if  (Progcx > ProgressMax) 
+       Progcx = ProgressMax
+   endif
    ProgressShow = ProgressWork
    //window size Builder_Progress_Progress_STTXT @Progx @Progy @Progcx @Progcy
    //window size Builder_Progress_Progressframe_STTXT @Progframex @Progframey @Progframecx @Progframecy

    file PaintFile
    b
    fs:/Builder_Progress_WIN/
    if  (!eof) d
    Newline = 'Builder_Progress_WIN,Progress,Box,@Progx@,@Progy@,@Progcx@,@Progcy@,109,88,238'
    i:/@Newline@/

    window paint Builder_Progress_WIN
    return

//******************************
//* Close the Progress Window
//******************************
!p300_close_progress
    window close Builder_Progress_WIN error
    return

//******************************
//* Show Directory Screen
//*     DirField:  should be set to the EFOBJ to update when the Browse OK button is pressed
//*     Directory: Should be set prior to calling s100 to setup the initial directory
//*     Extension: Should be set prior to calling s100 to setup if you want to limit the files selectable
//******************************
!s100_directory
    window pointer wait
    window hwnd Builder_Browse_WIN status error window open Builder_Browse_WIN shade
    window center Builder_Browse_WIN
    window clear Builder_Browse_WIN

    if  (Directory = null)
+       Directory = 'c:\'
+   endif

    Builder_Browse_Directory_EFOBJ = Directory
    window modify Builder_Browse_Directory_EFOBJ
    Builder_Browse_Extension_EFOBJ = Extension
    window modify Builder_Browse_Extension_EFOBJ

    if  (FileField = null)
+       window disable Builder_Browse_Files_STTXT
+       window disable Builder_Browse_Extension_STTXT
+       window disable Builder_Browse_Extension_EFOBJ
+       window disable Builder_Browse_Refresh_PBOBJ
+   else
+       window enable Builder_Browse_Files_STTXT
+       window enable Builder_Browse_Extension_STTXT
+       window enable Builder_Browse_Extension_EFOBJ
+       window enable Builder_Browse_Refresh_PBOBJ
+   endif

    call !a1600_Builder_Browse_Refresh_PBOBJ
    
    window unshade Builder_Browse_WIN
    window setfocus Builder_Browse_WIN
    window pointer arrow
    return

//******************************
//* Show the Browsed Dir
//******************************
!s200_show_dir
    close Directory error
    open Directory null

    window obtain Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    if  (Builder_Browse_Directory_EFOBJ != null)
+       scan:/@Builder_Browse_Directory_EFOBJ@/:/\/
+       if (!found) 
+          Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@\'
+   endif
    window modify Builder_Browse_Directory_EFOBJ

    pack Builder_Browse_Extension_EFOBJ

    //********************************************
    //* Directory in Quotes to allow for spaces
    //********************************************
    MacroCommand = |dir "@Builder_Browse_Directory_EFOBJ@"|
    systemcurr:"@MacroCommand@"

    b
    fs:/Directory of/
    scan:/@line/:/Directory of/
    //scan:/@right/:word
    //window clear Builder_Browse_WIN
    Builder_Browse_Subdir_LBOBJ = 'ALL'
    window delete Builder_Browse_Subdir_LBOBJ
    window paint Builder_Browse_Subdir_LBOBJ
    Builder_Browse_Files_LBOBJ = 'ALL'
    window delete Builder_Browse_Files_LBOBJ
    window paint Builder_Browse_Files_LBOBJ

    Builder_Browse_Subdir_LBOBJ = null
    window modify Builder_Browse_Subdir_LBOBJ
    Builder_Browse_Directory_EFOBJ = right
    leftjust Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    window modify Builder_Browse_Directory_EFOBJ
    b
    //*********************************************
    //* remove top and bottom of directory listing
    //*********************************************
    d;5
    f;*
    b;1 d;*
    b
    //*********************************************
    //* Find all Sub-directories and files
    //*********************************************
    do 
        if-eof (!eof)
+          scan:/@line/:/<DIR>/
+          if-dir (found)
+             //scan:/@right/:word
+             Builder_Browse_Subdir_LBOBJ = right
+             leftjust Builder_Browse_Subdir_LBOBJ
+             pack Builder_Browse_Subdir_LBOBJ
+             if-dots  (Builder_Browse_Subdir_LBOBJ != '.') and (Builder_Browse_Subdir_LBOBJ != '..')
+                 //Builder_Browse_Subdir_LBOBJ = left
+                 window insert end default Builder_Browse_Subdir_LBOBJ
+          else-dir
+             scan:/@line/:word
+             scan:/@right/:word  
+             scan:/@right/:word
+             scan:/@right/:word
+             Builder_Browse_Files_LBOBJ = right
+             leftjust Builder_Browse_Files_LBOBJ
+             if-extension (Builder_Browse_Extension_EFOBJ != null)
+                scanr:/@Builder_Browse_Files_LBOBJ@/:/./
+                upper right
+                if-found (found) and (Builder_Browse_Extension_EFOBJ = right)
+                   window insert end default Builder_Browse_Files_LBOBJ
+             else-extension
+                window insert end default Builder_Browse_Files_LBOBJ
+       endif
        f;1
    until (eof)
    window paint Builder_Browse_Subdir_LBOBJ
    window hide Builder_Browse_Subdir_LBOBJ
    window show Builder_Browse_Subdir_LBOBJ
    return

//******************************
//* Separate B-Edit Batch program code
//******************************
!t100_separate_batch_code
    //message = 't100' window message info ok
    string ModuleFileName error
    string ModuleName     error
    string ModulePrefix   error
    string SearchPrefix   error

    //***********************
    //* Open the Code Modules window
    //***********************
    if (!BatchUpdating)
+      window pointer wait
+      window hwnd Builder_Code_WIN status error window open Builder_Code_WIN shade
+      window center Builder_Code_WIN
+      Builder_Code_WIN = 'Code Selection - System[@SystemName@]'
+      window title Builder_Code_WIN
+   endif
    window show Builder_Code_Refresh_PBOBJ
    window show Builder_Code_Test_PBOBJ
    window show Builder_Code_View_PBOBJ

!t100_separate_batch_code_reload
    //***********************
    //* Open the Module File
    //***********************
    close ModuleFile error
    open ModuleFile null

    close ModuleNameFile error
    open ModuleNameFile null

    GenSystemFilename = "@SystemName@.BED"

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    //***********************
    //* Open the Bedit Code File
    //***********************
    close CodeFile error
    open CodeFile @GenSystemFilename
    ModuleFileName = 'Bedit-code\@SystemName@.bed'
    write CodeFile @ModuleFileName

    //***********************
    //* Clear the listbox
    //***********************
    Builder_Code_Codemodules_LBOBJ = 'ALL'
    window delete Builder_Code_Codemodules_LBOBJ
    window paint Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Add the generic lines
    //***********************
    //Builder_Code_Codemodules_LBOBJ = "! Complete Program"
    //window insert end default Builder_Code_Codemodules_LBOBJ
    Builder_Code_Codemodules_LBOBJ = "! Global Variables"
    window insert end default Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Global Variables
    //***********************
    int ModuleStartPos error
    close ModuleStartPosFile error
    open ModuleStartPosFile null

    ModuleStartPos = 1

    file CodeFile
    b
    do
        split:/@line/;1
        if  (left != '!')
+           Newline = line
+           file ModuleFile
+           i:/@Newline/
+           file CodeFile
+           f;1
+       endif
    until (left = '!') or (eof)
   
    file ModuleFile
    i:/ /
!t100_separate_batch_firstcomments
    b;1
    if (eof) goto !t100_separate_batch_firstcomments_done
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      d
+      goto !t100_separate_batch_firstcomments
+   endif

!t100_separate_batch_firstcomments_done
    ModuleFileName = 'Bedit-code\Global.bed'
    f;*
    d;1

!t100_separate_batch_module
    scan:/@ModuleFileName@/:/\/
    Newline = '@right@:@ModuleStartPos@'
    file ModuleStartPosFile
    i:/@Newline@/
  
    file ModuleFile
    MacroCommand = "    if (!exists @ModuleFileName@) write ModuleFile @ModuleFileName@"  
    $MacroCommand

    if (eof)
+      goto !t100_separate_batch_Done
+   endif
    ModuleFileName = line
    pack ModuleFileName
    file ModuleFile
    b
    d;*
    file CodeFile
    Builder_Code_Codemodules_LBOBJ = line
    pack Builder_Code_Codemodules_LBOBJ
    window insert end default Builder_Code_Codemodules_LBOBJ
    file ModuleNameFile
    i:/@Builder_Code_Codemodules_LBOBJ@/
    file ModuleFile
    //i:/@Builder_Code_Codemodules_LBOBJ/
    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
    scan:/@Builder_Code_Codemodules_LBOBJ@/:/_/
    if (found)
+      ModulePrefix = left
+   else
+      ModulePrefix = Builder_Code_Codemodules_LBOBJ
+   endif
    if (ModulePrefix = '!a010')
+      ModulePrefix = null
+   endif
    file CodeFile
!t100_separate_batch_comments
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !t100_separate_batch_comments
+   endif
    f;1
    ModuleStartPos = lineno
!t100_separate_batch_loop
    split:/@line/;1
    if (left != '!') or (line = Builder_Code_Codemodules_LBOBJ)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !t100_separate_batch_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !t100_separate_batch_next
+   endif    
    file ModuleFile
    b
    ib:/FGB/
    f;*
!t100_separate_batch_commentdelloop
    pack line
    if (line = null)
+      goto !t100_separate_batch_commentremove
+   endif
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !t100_separate_batch_commentremove
+   endif
    goto !t100_separate_batch_commentdeldone
!t100_separate_batch_commentremove
    d
    split:/@line/;3
    if (left != 'FGB')
+      goto !t100_separate_batch_commentdelloop
+   endif

!t100_separate_batch_commentdeldone
    b
    d  //* Remove FGB line  
    goto !t100_separate_batch_module

!t100_separate_batch_next
    file CodeFile
    f;1
    if (!eof)
+      goto !t100_separate_batch_loop
+   endif
    write ModuleFile @ModuleFileName
    close ModuleFile
    scan:/@ModuleFileName@/:/\/
    Newline = '@right@:@ModuleStartPos@'
    file ModuleStartPosFile
    i:/@Newline@/

!t100_separate_batch_Done
    close CodeFile

    if (!BatchUpdating)
+      window unshade Builder_Code_WIN
+      window setfocus Builder_Code_WIN
+      window pointer arrow
+   endif

    return

//******************************
//* Show the System View
//******************************
!v100_view
    close PaintFile error
    open PaintFile null
    i:/@EarthBitmapLine@/
    //i:/******************/
    //i:/******************/
    //i:/******************/
    close BubbleFile error
    call !v200_build_levellist
!v100_view_redraw
    close ViewLines error
    open ViewLines null
    call !v300_view_size
    //message = 'ViewColWins[@ViewColWins@] ViewRowWins[@ViewRowWins@]' window message info ok
    if  (!ViewColWins) or (!ViewRowWins)
+       message = 'No screens to view'
+       window message warning ok
+       return
+   endif
    if  (ViewColWins > 100) or (ViewRowWins > 10)
+       message = 'Too many screens to view, please filter'
+       window message warning ok
+       return
+   endif
    call !v400_view_win_size
    if  (ViewColWins > 20) or (ViewRowWins > 10)
+       message = 'Too many screens to view, do you want to filter?'
+       window message warning yesno
+       if  (message)
+           return
+   endif
    call !v500_draw_view
    window paint Builder_View_WIN
    if  (Presentation = 'HTML') call !a500_Builder_View_Html_PBOBJ
    //write PaintFile fgb.dat
    //write ViewLines fgb2.dat
    return

//******************************
//* Build the LevelList file
//******************************
!v200_build_levellist
    file WindowList
    b
    clear
    copy;*
    close ViewList error
    close ViewListWork error
    open ViewList null
    open ViewListWork null
    paste
    sort ViewListWork,A,1
    //write ViewListWork ViewListWork.dat
    file ViewListWork
    b
!v200_viewlist_level1_loop
    //************************
    //* Find Level 1 Windows
    //************************
    if (eof) goto !v200_viewlist_level1_done
    WindowName = line

    Newline = ',@WindowName@,'
    file WindowNav
    b
!v200_viewlist_level1_nav_loop
    fs:/@Newline/
    if (!eof)
+      scanr:/@line@/:/,/
+      if  (right = 'open')
+          file ViewListWork
+          f;1
+          goto !v200_viewlist_level1_loop
+   endif
    if  (!eof)
+       f;1
+       goto !v200_viewlist_level1_nav_loop 
+   endif
    file ViewListWork
    Newline = 'Level-01,@line@'
    file ViewList
    i:/@Newline@/
    file ViewListWork
    d;1
    goto !v200_viewlist_level1_loop

!v200_viewlist_level1_done
    //write ViewList viewlist.dat
    //message = 'ViewList.dat written' window message info ok
    //write ViewListWork viewwork.dat
    //message = 'Level 1 complete' window message info ok

    file WindowList
    b
    file ViewListWork
    b
    ViewChange = 'n'
    //************************
    //* Set Next Levels
    //************************
!v200_viewlist_nextlevel_loop
    if (eof) goto !v200_viewlist_nextlevel_done
    WindowName = line
    Newline = ',@WindowName@,open'
    file WindowNav
    b
    fs:/@Newline@/
    if (eof)
+      message = 'Error finding open for window [@WindowName@]'
+      window message error ok
+      return
+   endif
    scan:/@line/:/_/
    scan:/@right/:/_/
    file ViewList
    b
    Newline = ',@left@'
    fs:/@Newline@/
    if (eof)
+      file ViewListWork
+      f;1
+      goto !v200_viewlist_nextlevel_loop
+   endif
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    file ViewListWork
    Level ++
    if (Level < 10)
+      Newline = 'Level-0@Level@,@line@'
+   else
+      Newline = 'Level-@Level@,@line@'
+   endif
    file ViewList
    f;*
    i:/@Newline/
    file ViewListWork
    d;1
    ViewChange = 'y'
    goto !v200_viewlist_nextlevel_loop

!v200_viewlist_nextlevel_done
    //write ViewList viewlist.dat
    //write ViewListWork viewwork.dat
    //message = 'Next Level Complete' window message info ok
    file ViewListWork
    b
    if (!eof)
+      if (!ViewChange)
+         message = 'No changes in View Level Pass, missing data in view'
+         //window message error ok
+         goto !v200_viewlist_nextlevel_finish
+   endif
    if (!eof)
+      file ViewListWork
+      b
+      ViewChange = 'n'
+      goto !v200_viewlist_nextlevel_loop
+   endif

!v200_viewlist_nextlevel_finish
!v200_viewlist_push_levels_down
    //goto !v200_viewlist_push_done

    //************************************
    //* Push Levels to lowest level called
    //************************************
    file ViewList
    b
    clear
    copy;*
    file ViewListWork error open ViewListWork null
    paste
    file ViewList
    b
!v200_viewlist_push_loop
    if (eof) goto !v200_viewlist_push_done
    //if (WindowName = '9123') message = '!v200_viewlist_push_loop for [@line@]' window message info ok
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    WindowName = right
    file WindowNav
    b
    NewLevel = Level
!v200_viewlist_push_next_windownav
    SearchString = ',@WindowName@,' //if  (WindowName = '9123') message = SearchString window message info ok
    fs:/@SearchString@/
    if (eof) goto !v200_viewlist_push_highest_done
    scan:/@line/:/_/ //if  (WindowName = '9123') message = 'found[@line@]' window message info ok
    if (!found)
+      scan:/@line@/:/,/
+      ViewFromWin = right
+   else
+      scan:/@right/:/_/
+      ViewFromWin = left
+   endif
    file ViewListWork
    b
!v200_viewlist_push_highest_level
    if (eof) goto !v200_viewlist_push_highest_done
    SearchString = ',@ViewFromWin@'
    fs:/@SearchString@/
    if (eof) goto !v200_viewlist_push_next
    //if  (WindowName = '9123') message = '!v200_viewlist_push_highest_level [@Level@][@line@]' window message info ok
    scan:/@line/:/-/
    scan:/@right/:/,/
    DrawWork = left + 1
    if  (NewLevel < DrawWork) NewLevel = DrawWork 

    file WindowNav
    f;1
    goto !v200_viewlist_push_next_windownav
!v200_viewlist_push_highest_done    
    //if  (WindowName = '9123') message = 'Checking level[@Level@] = [@NewLevel@] for Window[@WindowName@]' window message info ok
    if  (NewLevel = Level) goto !v200_viewlist_push_next
    //if  (WindowName = '9123') message = 'changing level[@Level@] to [@NewLevel@] for Window[@WindowName@]' window message info ok
    file ViewList
    SearchString = line
    file ViewListWork
    b
    fs:/@SearchString@/
    //if  (WindowName = '9123') message = 'Searching [@SearchString@]' window message info ok
    if (eof) goto !v200_viewlist_push_next
    if  (NewLevel < 10)
+       Newline = 'Level-0@NewLevel@,@WindowName@'
+   else
+       Newline = 'Level-@NewLevel@,@WindowName@'
+   endif
    //if  (WindowName = '9123') message = 'Replaced [@Newline@]' window message info ok
    r:/@Newline@/
    file ViewList
    r:/@Newline@/

!v200_viewlist_push_next
    file ViewList
    f;1
    goto !v200_viewlist_push_loop
!v200_viewlist_push_done
    //write ViewList ViewListPush.dat
!v200_viewlist_eliminate_gaps
    //********************************
    //* Resequence Level
    //* Eliminate Level Number Gaps
    //********************************
    sort ViewList,A,1

    int LastLevel error
    int LineLevel error

    Level = 0
    LastLevel = 0

    file ViewList
    b
    if (eof) goto !v200_elim_done
    do
        if (eof) 
+          goto !v200_elim_done
+       endif
        scan:/@line/:/-/
        scan:/@right/:/,/
        LineLevel = left
        WindowName = right
        if (LineLevel != LastLevel)
+           Level ++ 
+           LastLevel = LineLevel
+       endif

        if (Level > 9) Level = 9
        Newline = 'Level-0@Level@,@WindowName@' 
        r:/@Newline@/

        f;1
    until (eof)

    //********************************
    //* Eliminate Duplicate Lines
    //********************************
    b
    Newline = line
    do
        f;1
        if (!eof)
+          //message = 'checking[@Newline@][@line@]' window message info ok
+          if (Newline = line)
+             d
+             b;1
+       endif
        Newline = line
    until (eof)

!v200_elim_done
    //write ViewList viewlistsort.dat
    //write ViewListWork viewwork.dat error

    //*************************************
    //* Float low levels up to just below
    //* Lowest calling level
    //*************************************
    string ViewFromWindow error
    string ViewToWindow   error
    int    NewLevel       error
    int    CheckLevel     error

    file ViewList
    b
    clear
    copy;*
    file ViewListWork
    b
    d;*
    paste
    file ViewList
    b
!v200_float_viewlist_loop
    if (eof) goto !v200_float_done
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    WindowName = right
    file WindowNav
    NewLevel = 0
    b
!v200_float_windownav_loop
    if (eof) goto !v200_float_windownav_done
    scan:/@line/:/_/
    scan:/@right/:/_/
    ViewFromWindow = left
    scan:/@right/:/_/
    ViewToWindow = left
    //message = 'checking WindowName[@WindowName@] ViewToWindow[@ViewToWindow@]' window message info ok
    if (ViewToWindow != WindowName) goto !v200_float_windownav_next
    file ViewListWork
    b
    SearchString = ',@ViewFromWindow@'
    //message = 'searching for SearchString[@SearchString@]' window message info ok
    fs:/@SearchString/
    if (eof) goto !v200_float_windownav_next
    scan:/@line/:/-/
    scan:/@right/:/,/
    CheckLevel = left
    //message = 'checking WindowName[@WindowName@] ViewFromWindow[@ViewFromWindow@] left[@CheckLevel@] > NewLevel[@NewLevel@]' window message info ok
    if  (CheckLevel >= NewLevel)
+       NewLevel = left
+       NewLevel += 1
+       //message = 'NewLevel[@NewLevel@]' window message info ok
+   endif

!v200_float_windownav_next
    file WindowNav
    f;1
    goto !v200_float_windownav_loop

!v200_float_windownav_done
    if  (NewLevel = 0) or (NewLevel > Level) or (NewLevel = Level)
+       goto !v200_float_viewlist_next
+   endif

    //message = 'New Level WindowName[@WindowName@] NewLevel[@NewLevel@] Level[@Level@]' window message info ok

    //**************************************
    //* Update the Lists with the new level
    //**************************************
    file ViewList
    SearchString = line
    if (NewLevel > 9) NewLevel = 9
    Newline = 'Level-0@NewLevel@,@WindowName@' 
    r:/@Newline@/
    file ViewListWork
    b
    fs:/@SearchString@/
    if (!eof)
+      r:/@Newline@/
+   endif

!v200_float_viewlist_next
    file ViewList
    f;1
    goto !v200_float_viewlist_loop

!v200_float_done
    //write ViewList viewlistfloat.dat

    return

//******************************
//* Find View Rows and Cols Windows
//******************************
!v300_view_size
    ViewRowWins = 0
    ViewColWins = 0
    file ViewList
    b
!v300_row_loop
    //****************
    //* Count Rows
    //****************
    if  (eof) goto !v300_row_loop_done
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    if (Level > ViewRowWins)
+      ViewRowWins = Level
+   endif
    f;1
    goto !v300_row_loop

!v300_row_loop_done
    //****************
    //* Count Cols
    //****************
    LevelCount = 0
    LevelRowCount = 0
    if (ViewRowWins < 1) goto !v300_cols_done
    do
        LevelCount ++
        file ViewList
        b
        if (LevelCount < 10)
+          Newline = "Level-0@LevelCount@,"
+       else
+          Newline = "Level-@LevelCount@,"
+       endif
        fs:/@Newline@/;*
        if  (pcount > ViewColWins)
+           ViewColWins = pcount
+       endif
    until (LevelCount = Level)

!v300_cols_done
    return

//******************************
//* Determine the View Window Sizes and Spacing
//******************************
!v400_view_win_size
    window windowpos Builder_View_WIN WinX WinY WinCX WinCY

    //**********************
    //* Calculate Width
    //**********************
    ViewWinCXWork = WinCX / ViewColWins
    ViewWinCXWork -= 20
    ViewWinCX = ViewWinCXWork
    ViewWinCX /= 2
    if  (ViewWinCX > 300) ViewWinCX = 300

    //**********************
    //* Calculate Height
    //**********************
    ViewWinCYWork = WinCY / ViewRowWins 
    ViewWinCYWork -= 20
    ViewWinCY = ViewWinCYWork
    ViewWinCY /= 2
    if  (ViewWinCY > 200) ViewWinCY = 200

    //**********************
    //* Calculate X Start/Spacing
    //**********************   
    if  (ViewColWins = 1)
+       ViewWinXStart = WinCX / 2
+       ViewWinCXWork = ViewWinCX / 2
+       ViewWinXStart = ViewWinXStart - ViewWinCXWork
+   else 
+       ViewWinCXWork = ViewWinCX * ViewColWins
+       ViewWinCXWork = WinCX - ViewWinCXWork
+       ViewWinCXWork -= ViewWinCX
+       ViewWinCXWork = ViewWinCXWork / ViewColWins
+       ViewWinXSpacing = ViewWinCXWork
+       ViewWinXStart = WinX + ViewWinXSpacing
+   endif

    //**********************
    //* Calculate Y Start/Spacing
    //**********************    
    ViewWinCYWork = ViewWinCY * ViewRowWins
    ViewWinCYWork = WinCY - ViewWinCYWork
    ViewWinCYWork -= ViewWinCY
    ViewWinCYWork = ViewWinCYWork / ViewRowWins
    ViewWinYSpacing = ViewWinCYWork
    ViewWinYStart = WinY + ViewWinCY - 40
    if  (ViewWinYStart < 0) ViewWinCY = WinY

    //message = 'View Window Size ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@]' window message info ok
    //message = 'View Window X Start[@ViewWinXStart@] Spacing[@ViewWinXSpacing@]' window message info ok
    //message = 'View Window Y WinCY[@WinY@] ViewWinCY[@ViewWinCY@] Start[@ViewWinYStart@] Spacing[@ViewWinYSpacing@]' window message info ok
    return

//******************************
//* Draw the View
//******************************
!v500_draw_view
    int  BubbleCX error
    int  BubbleCY error
    ViewCount = 0
    //write ViewFilterList ViewFilterList.dat
    close ViewPositions error    
    open ViewPositions null
    b d;*
    close ViewObjects error
    open ViewObjects null
    close BubbleFile error
    open BubbleFile null
    file ViewList
    b
    //message = 'View Draw Level[@Level@] ViewRowWins[@ViewRowWins@] ViewColWins[@ViewColWins@]' window message info ok
    if (!Level) goto !v100_draw_done
    LevelCount = 0
    LevelRowCount = 0
    ViewCurrX = ViewWinXStart
    ViewCurrY = ViewWinYStart
    //*************************
    //* Draw the Windows
    //*************************
    string SizePosError error
    SizePosError = 'n'
    do-levels
        LevelCount ++
        if  (LevelCount < 10)
+           Newline = 'Level-0@LevelCount@,'
+       else
+           Newline = 'Level-@LevelCount@,'
+       endif
        file ViewList        
        b
        fs:/@Newline@/;*
        if (pcount)
+          //********************************
+          //* Shift the window to the right
+          //********************************
+          ViewWork = ViewColWins - pcount
+          ViewWork /= 2
+          if  (ViewWork > 0)
+              do-shift
+                  ViewCurrX = ViewCurrX + ViewWinCX + ViewWinXSpacing
+                  ViewWork --
+              until-shift (ViewWork = 0)
+       endif
        b
        //***********************************
        //* Create View Windows
        //***********************************
        do-windows
            file ViewList
            if (LevelCount < 10)
+              Newline = /Level-0@LevelCount@,/ 
+           else
+              Newline = /Level-@LevelCount@,/ 
+           endif
            fs:/@Newline@/
            CreateWin = 'n'
            if (!eof)
+              CreateWin = 'y'
+              scanr:/@line@/:/,/
+              WindowName = right
+              WindowTitle = right
+              file BuilderWindowFile
+              b
+              Newline = "WINDOW,@SystemName@_@WindowName@_WIN,"
+              fs:/@Newline@/
+              if (!eof)
+                 scanr:/@line/:/,/
+                 WindowTitle = right
+                 pack WindowTitle
+                 if (WindowTitle = null)
+                    WindowTitle = WindowName
+           endif
            if  (CreateWin)
+               ViewCount ++
+               ControlName = '@WindowName@-@ViewCount@'
+               call !v550_window_title
+               call !v560_check_size
+               //message = 'Creating ControlName[@ControlName@] ViewCurrX[@ViewCurrX@] ViewCurrY[@ViewCurrY@] ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@] WindowTitle[@WindowTitle@]' window message info ok
+               //subs ^
+               //MacroCommand = |window createcontrol Builder_View_WIN ^ControlName^ ^ViewCurrX^ ^ViewCurrY^ ^ViewWinCX^ ^ViewWinCY^ GBOBJ1 @WindowTitle|
+               PaintCX = ViewWinCX
+               PaintCY = ViewWinCY
+               Newline = 'Builder_View_WIN,@ControlName@,Box3D,@ViewCurrX@,@ViewCurrY@,@PaintCX@,@PaintCY@,130,166,238' file PaintFile i:/@Newline@/
+               //PaintX = ViewCurrX + 6
+               //PaintY = ViewCurrY + 6
+               //Newline = 'Builder_View_WIN,Text,@PaintX@,@PaintY@,12,12,0,0,0,Arial,@WindowTitle@' file PaintFile i:/@Newline@/
+               PaintX = ViewCurrX + 5
+               PaintY = ViewCurrY + 5
+               Newline = 'Builder_View_WIN,@ControlName@,Text,@PaintX@,@PaintY@,12,12,0,0,0,Times New Roman,@WindowTitle@' file PaintFile i:/@Newline@/
+               //subs @
+               //$MacroCommand
+               call !v501_bubble_fullname
+               file BubbleFile
+               BubbleCX = ViewCurrX + ViewWinCX
+               BubbleCY = ViewCurrY + ViewWinCY
+               Newline = '@ViewCurrX@,@ViewCurrY@,@BubbleCX@,@BubbleCY@,@FullTitle@'
+               i:/@Newline@/
+               file ViewObjects
+               i:/@ControlName@/
+               file ViewPositions
+               Newline = '@WindowName@,@LevelCount@,@ViewCurrX@,@ViewCurrY@,@ViewWinCX@,@ViewWinCY@'
+               i:/@Newline@/
+               ViewCurrX = ViewCurrX + ViewWinCX + ViewWinXSpacing
+           endif
            file ViewList
            f;1
        until-windows (eof) 
        file ViewList
        b   
        ViewCurrY = ViewCurrY + ViewWinCY + ViewWinYSpacing
        ViewCurrX = ViewWinXStart
    until-levels (LevelCount = ViewRowWins)
    //write ViewPositions viewpos.dat

    if  (SizePosError)
+       message = 'Excessive number of windows'
+       //window message warning ok
+   endif

    //*************************
    //* Draw the Connections
    //*************************
    file WindowNav
    b
    do
        scanr:/@line@/:/,/
        if  (right = 'open')
+           scanr:/@left@/:/,/
+           ViewWindowTo = right
+           scan:/@line@/:/_/
+           scan:/@right@/:/_/
+           ViewWindowFrom = left
+           call !v600_draw_line
+       endif
        file WindowNav
        f;1
    until (eof)

    //close ViewList
    close ViewListWork error
    close ViewPositions error
    return

//******************************
//* Get the function fullname for
//* bubble help
//******************************
!v501_bubble_fullname
    file ViewFilterList error return
    b
!v501_loop
    fs:/@FullTitle@/
    if (eof) return
    if  (line beginswith FullTitle)
+       scan:/@line/:/,/
+       FullTitle = left
+   else
+       f;1
+       goto !v501_loop
    return

//******************************
//* Full Window Title for COBOL
//******************************
!v550_window_title
    string FullTitle error
    FullTitle = WindowTitle
    //message = 'v550 ViewColWins[@ViewColWins@]' window message info ok
    //if (!ViewCobol) return
    //message = 'WindowTitle[@WindowTitle@] ViewColWins[@ViewColWins@]' window message info ok
//    if-1 (ViewColWins > 5) and (ViewColWins < 10)
//+      split:/@WindowTitle@/;18
//+      WindowTitle = left
//+      return
//+   endif
    if  (ViewColWins <= 5)
+      split:/@WindowTitle@/;30
+      WindowTitle = left
+      return
+   endif
    if  (ViewColWins = 6)
+      split:/@WindowTitle@/;25
+      WindowTitle = left
+      return
+   endif
    if  (ViewColWins = 7)
+      split:/@WindowTitle@/;20
+      WindowTitle = left
+      return
+   endif
    if  (ViewColWins = 8)
+      split:/@WindowTitle@/;15
+      WindowTitle = left
+      return
+   endif
    if  (ViewColWins = 9)
+      split:/@WindowTitle@/;10
+      WindowTitle = left
+      return
+   endif
    if-1 (ViewColWins >= 10)
+      scan:/@WindowTitle@/:/-/
+      if-2 (found)
+         WindowTitle = left
+         return
+      else-2
+         split:/@WindowTitle/;5
+         WindowTitle = left
+         return
+   endif
    if-1 (ViewColWins >= 10)
+      scan:/@WindowTitle@/:/_/
+      if-2 (found)
+         WindowTitle = left
+         return
+      else-2
+         split:/@WindowTitle/;5
+         WindowTitle = left
+         return
+   endif
    file ViewFilterList error return
    b
!v550_loop
    fs:/@WindowTitle@/ //message = 'WindowTitle[@WindowTitle@] ViewFilterList line[@line@]' window message info ok
    if (eof) return
    scan:/@line/:/,/
    HoldLeft = left
    //**********************
    //* COBOL Separator
    //**********************
    scan:/@HoldLeft@/:/-/
    if (found)
+      if (left != WindowTitle)
+         f;1
+         goto !v550_loop
+   endif
    //**********************
    //* BEDIT Separator
    //**********************
    scan:/@HoldLeft@/:/_/
    if (found)
+      if (left != WindowTitle)
+         f;1
+         goto !v550_loop
+   endif

    WindowTitle = HoldLeft
    return

//******************************
//* Check the size/pos of the window
//******************************
!v560_check_size
    //message = 'ControlName[@ControlName@] ViewCurrX[@ViewCurrX@] ViewCurrY[@ViewCurrY@] ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@]' window message info ok
    if  (ViewCurrX < 5)
+       SizePosError = 'y'
+       ViewCurrX = 10
+   endif
    if  (ViewCurrY < 5)
+       SizePosError = 'y'
+       ViewCurrY = 10
+   endif
    if  (ViewWinCX < 5)
+       SizePosError = 'y'
+       ViewWinCX = 10
+   endif
    if  (ViewWinCY < 5)
+       SizePosError = 'y'
+       ViewWinCY = 10
+   endif
    return

//******************************
//* Draw a line from WindowFrom to WindowTo
//******************************
!v600_draw_line
    string Reverse error
    Reverse = 'n'
    //message = 'Draw from [@ViewWindowFrom@] to [@ViewWindowTo@]' window message info ok
    file ViewPositions
    //************************
    //* Find From Window Pos
    //************************
    b
    SearchString = '@ViewWindowFrom@,'
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to locate From Window[@ViewWindowFrom@] - draw to Window[@ViewWindowTo@]'
+      //window message error ok
+      return
+   endif
    scan:/@line/:/,/ ViewFromWin = left 
    scan:/@right/:/,/ ViewFromLevel = left
    scan:/@right/:/,/ ViewFromWinX = left
    scan:/@right/:/,/ ViewFromWinY = left
    scan:/@right/:/,/ ViewFromWinCX = left
    ViewFromWinCY = right

    //************************
    //* Find To Window Pos
    //************************
    b
    SearchString = '@ViewWindowTo@,'
    fs:/@SearchString@/
    if (eof)
+      //message = 'Unable to locate To Window[@ViewWindowTo@] - draw from Window[@ViewWindowFrom@]'
+      //window message error ok
+      return
+   endif
    scan:/@line/:/,/ ViewToWin = left
    scan:/@right/:/,/ ViewToLevel = left
    scan:/@right/:/,/ ViewToWinX = left
    scan:/@right/:/,/ ViewToWinY = left
    scan:/@right/:/,/ ViewToWinCX = left
    ViewToWinCY = right
    
    //message = 'From ViewFromWin[@ViewFromWin@] ViewFromLevel[@ViewFromLevel@] ViewFromWinX[@ViewFromWinX@] ViewFromWinY[@ViewFromWinY@] ViewFromWinCX[@ViewFromWinCX@] ViewFromWinCY[@ViewFromWinCY@]'
    //window message info ok
    //message = 'From ViewToWin[@ViewToWin@] ViewToLevel[@ViewToLevel@] ViewToWinX[@ViewToWinX@] ViewToWinY[@ViewToWinY@] ViewToWinCX[@ViewToWinCX@] ViewToWinCY[@ViewToWinCY@]'
    //1:03 PM 12/9/2013window message info ok
    if  (ViewFromWin = ViewToWin) return

    if  (ViewFromLevel = ViewToLevel)
+       goto !v600_draw_across
+   endif

    if  (ViewToLevel > ViewFromLevel)
+       goto !v600_draw_down
+   else
+       //****************************
+       //* Invert From/To Windows
+       //****************************
+       //message = 'Inverting From Window[@ViewFromWin@] To Window[@ViewToWin@]' window message info ok
+       ViewHoldWin = ViewFromWin
+       ViewHoldLevel = ViewFromLevel
+       ViewHoldWinX = ViewFromWinX
+       ViewHoldWinY = ViewFromWinY
+       ViewHoldWinCX = ViewFromWinCX
+       ViewHoldWinCY = ViewFromWinCY
+
+       ViewFromWin = ViewToWin
+       ViewFromLevel = ViewToLevel
+       ViewFromWinX = ViewToWinX
+       ViewFromWinY = ViewToWinY
+       ViewFromWinCX = ViewToWinCX
+       ViewFromWinCY = ViewToWinCY
+
+       ViewToWin = ViewHoldWin
+       ViewToLevel = ViewHoldLevel
+       ViewToWinX = ViewHoldWinX
+       ViewToWinY = ViewHoldWinY
+       ViewToWinCX = ViewHoldWinCX
+       ViewToWinCY = ViewHoldWinCY
+       Reverse = 'y'
+       goto !v600_draw_down
+   endif

    return

//************************************************
//* Draw From Window down to To Window
//************************************************
!v600_draw_down
    //*****************************
    //* Draw first line down
    //*****************************
    DrawWork = ViewFromWinCX / 2
    LineX = ViewFromWinX + DrawWork
    LineY = ViewFromWinY + ViewFromWinCY - 1
    LineCX = 1
    LineCY = ViewWinYSpacing / 2
    DrawToNextLevel = ViewToLevel - ViewFromLevel      
    if  (DrawToNextLevel = 1)
+       if  (ViewFromWinX = ViewToWinX)
+           //***********************************
+           //* 1 Level Down, same column
+           //***********************************
+           LineCY = ViewWinYSpacing
+           call !v700_create_line_control
+           if (!Reverse)
+              //*****************************
+              //* Draw Ending Block at bottom
+              //*****************************
+              LineX = LineX - 3
+              LineY = LineY + LineCY - 3
+              LineCX = 6
+              LineCY = 6
+              call !v700_create_line_control
+              return
+   endif
    if  (DrawToNextLevel = 1)
+       if  (ViewFromWinX = ViewToWinX)    
+           if (Reverse)
+              //*****************************
+              //* Draw Ending Block at top
+              //*****************************
+              LineY = LineY - 3
+              LineCX = 6
+              LineCY = 6
+              call !v700_create_line_control
+              return
+   endif
    call !v700_create_line_control

    if  (DrawToNextLevel > 1) goto !v600_down_plus_level

    if  (ViewFromWinX < ViewToWinX)
+        //*****************************
+        //* Draw Right 1 Level Down
+        //***************************** 
+        //message = 'Draw right from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        DrawWork = ViewToWinX + DrawWork
+        DrawWork = DrawWork - LineX
+        LineCX = DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        LineX += LineCX
+        do 
+           LineCX += ViewWinXSpacing
+        until (LineCX > ViewToWinX)
+   else
+        //*****************************
+        //* Draw Left 1 Level Down
+        //***************************** 
+        //message = 'Draw left from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        LineCX = LineX - ViewToWinX - DrawWork
+        LineX = ViewToWinX + DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        DrawWork = ViewToWinX + ViewToWinCX
+        do 
+           LineCX -= ViewWinXSpacing 
+        until (LineCX < DrawWork)
+   endif
    

    //*****************************
    //* Draw Down
    //***************************** 
    DrawWork = ViewWinYSpacing / 2
    LineCY = LineCY + DrawWork
    LineCX = 1
    call !v700_create_line_control

    //*****************************
    //* Draw Ending Block
    //*****************************
    if (!Reverse)
+      LineX = LineX - 3
+      LineY = LineY + LineCY - 3
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control 
+   else
+      DrawWork = ViewFromWinCX / 2
+      LineX = ViewFromWinX + DrawWork - 3
+      LineY = ViewFromWinY + ViewFromWinCY
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control
+   endif
    return

//************************************************
//* Draw Down more than 1 Level
//************************************************
!v600_down_plus_level
    if  (ViewFromWinX < ViewToWinX)
+        //*****************************
+        //* Draw Right 
+        //***************************** 
+        LineY += LineCY
+        LineCX = ViewToWinCX
+        LineCY = 1 
+        call !v700_create_line_control
+        LineX += ViewToWinCX
+   else
+        //*****************************
+        //* Draw Left 
+        //***************************** 
+        LineX = LineX - ViewToWinCX
+        LineY += LineCY
+        LineCX = ViewToWinCX
+        LineCY = 1
+        call !v700_create_line_control
+   endif
    //**********************************
    //* Draw Down
    //**********************************
    DrawWork = ViewToWinCY / 2
    LineCY = ViewToWinY - DrawWork - LineY
    LineCX = 1
    call !v700_create_line_control

    if  (ViewFromWinX <= ViewToWinX)
+        //*****************************
+        //* Draw Right 1 Level Down
+        //***************************** 
+        //message = 'Draw right from[@ViewFromWin@] to[@ViewToWin@] ViewWinXSpacing [@ViewWinXSpacing@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        DrawWork = ViewToWinX + DrawWork
+        DrawWork = DrawWork - LineX
+        LineCX = DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        LineX += LineCX
+        //do 
+        //   LineCX += ViewWinXSpacing
+        //   if (ViewWinXSpaceing = 0)
+        //until (LineCX > ViewToWinX)
+   else
+        //*****************************
+        //* Draw Left 1 Level Down
+        //***************************** 
+        //message = 'Draw left from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        LineCX = LineX - ViewToWinX - DrawWork
+        LineX = ViewToWinX + DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        DrawWork = ViewToWinX + ViewToWinCX
+        //do 
+        //   LineCX -= ViewWinXSpacing 
+        //until (LineCX < DrawWork)
+   endif
    

    //*****************************
    //* Draw Down
    //***************************** 
    DrawWork = ViewWinYSpacing / 2
    LineCY = LineCY + DrawWork
    LineCX = 1
    call !v700_create_line_control

    //*****************************
    //* Draw Ending Block
    //*****************************
    if (!Reverse)
+      LineX = LineX - 3
+      LineY = LineY + LineCY - 3
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control 
+   else
+      DrawWork = ViewFromWinCX / 2
+      LineX = ViewFromWinX + DrawWork - 3
+      LineY = ViewFromWinY + ViewFromWinCY
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control
+   endif 
    return

//************************************************
// Draw line for windows on same level
//************************************************
!v600_draw_across
    if  (ViewFromWinX > ViewToWinX)
+       goto !v600_draw_across_left
+   endif
!v600_draw_across2
    DrawWork = ViewFromWinX + ViewFromWinCX + ViewWinXSpacing + 10
    if  (DrawWork > ViewToWinX)
+       //*****************************
+       //* Draw right to adjacent Window
+       //*****************************
+       LineX = ViewFromWinX + ViewFromWinCX
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCX = ViewWinXSpacing
+       LineCY = 1
+       call !v700_create_line_control
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = LineX + ViewWinXSpacing - 3
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   else
+       //message = 'draw right + from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+       //*****************************
+       //* Draw right to > 1 column
+       //*****************************
+       //*** Right
+       LineX = ViewFromWinX + ViewFromWinCX
+       DrawWork = ViewFromWinCX / 2
+       LineCX = DrawWork
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*** Down
+       LineX = LineX + LineCX
+       LineCX = 1
+       DrawWork = ViewFromWinCY / 3
+       LineCY = ViewFromWinCY - DrawWork
+       call !v700_create_line_control
+
+       //*** Right
+       DrawWork = ViewToWinCX / 2 
+       LineCX = ViewToWinX - LineX - DrawWork
+       LineY = LineY + LineCY
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*** Up
+       LineX = LineX + LineCX
+       LineCX = 1
+       DrawWork = ViewToWinCY / 2
+       LineY = ViewToWinY + DrawWork
+       DrawWork = ViewToWinCY / 3
+       LineCY = ViewToWinCY - DrawWork
+       call !v700_create_line_control
+
+       //*** Right
+       DrawWork = ViewToWinCX / 2 
+       LineCX = DrawWork
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       if  (!Reverse)
+           LineX = LineX + LineCX - 3
+           LineY = LineY + LineCY - 3
+           LineCX = 6
+           LineCY = 6
+           call !v700_create_line_control
+   endif
    return

!v600_draw_across_left
    DrawWork = ViewToWinX + ViewToWinCX + ViewWinXSpacing + 10
    if  (DrawWork > ViewFromWinX)
+       //*****************************
+       //* Draw left to adjacent Window
+       //*****************************
+       LineX = ViewFromWinX - ViewWinXSpacing
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCX = ViewWinXSpacing
+       LineCY = 1
+       call !v700_create_line_control
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = LineX
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   else
+       //message = 'draw left + from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+       //****************************
+       //* Invert From/To Windows
+       //****************************
+       //message = 'Inverting From Window[@ViewFromWin@] To Window[@ViewToWin@]' window message info ok
+       ViewHoldWin = ViewFromWin
+       ViewHoldLevel = ViewFromLevel
+       ViewHoldWinX = ViewFromWinX
+       ViewHoldWinY = ViewFromWinY
+       ViewHoldWinCX = ViewFromWinCX
+       ViewHoldWinCY = ViewFromWinCY
+
+       ViewFromWin = ViewToWin
+       ViewFromLevel = ViewToLevel
+       ViewFromWinX = ViewToWinX
+       ViewFromWinY = ViewToWinY
+       ViewFromWinCX = ViewToWinCX
+       ViewFromWinCY = ViewToWinCY
+
+       ViewToWin = ViewHoldWin
+       ViewToLevel = ViewHoldLevel
+       ViewToWinX = ViewHoldWinX
+       ViewToWinY = ViewHoldWinY
+       ViewToWinCX = ViewHoldWinCX
+       ViewToWinCY = ViewHoldWinCY
+       Reverse = 'y'
+       call !v600_draw_across2
+       Reverse = 'n'
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = ViewFromWinX + ViewFromWinCX
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   endif
    return

//******************************
//* Create Line Control
//******************************
!v700_create_line_control
    int  BubbleX    error
    int  BubbleY    error
    int  BubbleCX   error
    int  BubbleCY   error

    LineCount ++
    ControlName = 'line-@LineCount@'
    if  (LineCX < 1) LineCX = 1
    if  (LineCY < 1) LineCY = 1
    //message = 'Creating line ControlName[@ControlName@] LineX[@LineX@] LineY[@LineY@] LineCX[@LineCX@] LineCY[@LineCY@] WindowTitle[@WindowTitle@]' window message info ok
    window createcontrol Builder_View_WIN @ControlName @LineX @LineY @LineCX @LineCY STTXTR @WindowTitle

    file ViewLines
    Newline = "@ControlName@,@LineX@,@LineY@,@LineCX@,@LineCY@"
    i:/@Newline/
    file ViewObjects
    i:/@ControlName@/
   
    //************************
    //* Create Bubble Help
    //************************
    BubbleX = LineX - 2
    BubbleY = LineY - 2
    BubbleCX = LineX + LineCX + 2
    BubbleCY = LineY + LineCY + 2
    file BubbleFile
    Newline = '@BubbleX@,@BubbleY@,@BubbleCX@,@BubbleCY@,@ViewWindowFrom@->@ViewWindowTo@'
    i:/@Newline@/

    file ViewObjects

    return
    
//******************************
//* Create controls for open file
//******************************
!w100_open_window_build_controls
    file BuilderWindowFile
    b
    Newline = 'WINDOW,@SystemName@_@WindowName@'
    fs:/@Newline/
    if  (eof) 
+       Builder_Control_WindowSize_GBOBJ = WindowTitle
+       window modify Builder_Control_WindowSize_GBOBJ
+       goto !w100_done
+   endif
    scan:/@line/:/,/ ControlType = left
    scan:/@right/:/,/ WindowName = left
    scan:/@right/:/,/ Xpos = left
    scan:/@right/:/,/ Ypos = left
    scan:/@right/:/,/ ObjectCX = left
    scan:/@right/:/,/ ObjectCY = left
    Text = right 
    scan:/@WindowName@/:/_/
    scan:/@right/:/_/
    WindowName = left

    window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    //message = 'Win File x[@Xpos@] y[@Ypos@] MinX[@MinX@] MinY[@MinY@]' window message info ok

    Xpos += MinX
    Ypos += MinY
    MacroCommand = 'window size Builder_Control_WindowSize_GBOBJ @Xpos@ @Ypos@ @ObjectCX@ @ObjectCY@' $MacroCommand
    Builder_Control_WindowSize_GBOBJ = Text
    window modify Builder_Control_WindowSize_GBOBJ

    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY" $MacroCommand
    
!w100_loop
    if (eof) goto !w100_done
    split:/@line/;5
    if  (left = 'PBOBJ') goto !w100_process
    if  (left = 'EFOBJ') goto !w100_process
    if  (left = 'STTXT') goto !w100_process
    if  (left = 'CBOBJ') goto !w100_process
    if  (left = 'GBOBJ') goto !w100_process
    if  (left = 'LBOBJ') goto !w100_process
    if  (left = 'RBOBJ') goto !w100_process
    if  (left = 'COOBJ') goto !w100_process
    if  (left = 'MLOBJ') goto !w100_process
    goto !w100_next

!w100_process
    scan:/@line/:/,/ ControlType = left
    scan:/@right/:/,/ ControlName = left
    scan:/@right/:/,/ Xpos = left
    scan:/@right/:/,/ Ypos = left
    scan:/@right/:/,/ ObjectCX = left
    scan:/@right/:/,/ ObjectCY = left
    Text = right   

    Xpos = Xpos + MinX
    Ypos = Ypos + MinY

    //message = 'creating @ControlName@ @Xpos@ @Ypos@ @ObjectCX@ @ObjectCY@ @ControlType@ @Text@' window message info ok
    window createcontrol Builder_Control_WIN @ControlName @Xpos @Ypos @ObjectCX @ObjectCY @ControlType @Text 

    file Controls error open Controls null
    Newline = '@ControlName@,@ControlType@,@Text@'
    i:/@Newline@/ 

    Builder_Control_ControlList_COOBJ = "@ControlName@"
    call !a300_insert_controllist 

!w100_next
    file BuilderWindowFile
    f;1
    split:/@line/;3
    if  (left != '***') goto !w100_loop
!w100_done
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    return

//*********************************************************
//* Prepare Backup Files
//*********************************************************
!w200_setup_backup
    //************************
    //* Backup Controls
    //************************
    close BackupControls1 error
    close BackupControls2 error
    close BackupControls3 error
    close BackupControls4 error
    close BackupControls5 error
    close BackupControls6 error
    close BackupControls7 error
    close BackupControls8 error
    close BackupControls9 error
    close BackupControls10 error
    open BackupControls1 null
    open BackupControls2 null
    open BackupControls3 null
    open BackupControls4 null
    open BackupControls5 null
    open BackupControls6 null
    open BackupControls7 null
    open BackupControls8 null
    open BackupControls9 null
    open BackupControls10 null
    //************************
    //* Backup PaintFile Objects
    //************************
    close BackupPaintFile1 error
    close BackupPaintFile2 error
    close BackupPaintFile3 error
    close BackupPaintFile4 error
    close BackupPaintFile5 error
    close BackupPaintFile6 error
    close BackupPaintFile7 error
    close BackupPaintFile8 error
    close BackupPaintFile9 error
    close BackupPaintFile10 error
    open BackupPaintFile1 null
    open BackupPaintFile2 null
    open BackupPaintFile3 null
    open BackupPaintFile4 null
    open BackupPaintFile5 null
    open BackupPaintFile6 null
    open BackupPaintFile7 null
    open BackupPaintFile8 null
    open BackupPaintFile9 null
    open BackupPaintFile10 null

    //************************
    //* Backup Controls
    //************************
    call !w200_backup_controls_entry2
    file BackupControls1 b clear copy;* file BackupControls2 b d;* paste
    file BackupControls2 b clear copy;* file BackupControls3 b d;* paste
    file BackupControls3 b clear copy;* file BackupControls4 b d;* paste
    file BackupControls4 b clear copy;* file BackupControls5 b d;* paste
    file BackupControls5 b clear copy;* file BackupControls6 b d;* paste
    file BackupControls6 b clear copy;* file BackupControls7 b d;* paste
    file BackupControls7 b clear copy;* file BackupControls8 b d;* paste
    file BackupControls8 b clear copy;* file BackupControls9 b d;* paste
    file BackupControls9 b clear copy;* file BackupControls10 b d;* paste

    //************************
    //* Backup PaintFile Objects
    //************************
    file BackupPaintFile1 b clear copy;* file BackupPaintFile2 b d;* paste
    file BackupPaintFile2 b clear copy;* file BackupPaintFile3 b d;* paste
    file BackupPaintFile3 b clear copy;* file BackupPaintFile4 b d;* paste
    file BackupPaintFile4 b clear copy;* file BackupPaintFile5 b d;* paste
    file BackupPaintFile5 b clear copy;* file BackupPaintFile6 b d;* paste
    file BackupPaintFile6 b clear copy;* file BackupPaintFile7 b d;* paste
    file BackupPaintFile7 b clear copy;* file BackupPaintFile8 b d;* paste
    file BackupPaintFile8 b clear copy;* file BackupPaintFile9 b d;* paste
    file BackupPaintFile9 b clear copy;* file BackupPaintFile10 b d;* paste

    return

//*********************************************************
//* Backup the Controls on the Control Window
//*********************************************************
!w200_backup_controls
    //************************
    //* Backup Controls
    //************************
    file BackupControls9 b clear copy;* file BackupControls10 b d;* paste
    file BackupControls8 b clear copy;* file BackupControls9 b d;* paste
    file BackupControls7 b clear copy;* file BackupControls8 b d;* paste
    file BackupControls6 b clear copy;* file BackupControls7 b d;* paste
    file BackupControls5 b clear copy;* file BackupControls6 b d;* paste
    file BackupControls4 b clear copy;* file BackupControls5 b d;* paste
    file BackupControls3 b clear copy;* file BackupControls4 b d;* paste
    file BackupControls2 b clear copy;* file BackupControls3 b d;* paste
    file BackupControls1 b clear copy;* file BackupControls2 b d;* paste
    //************************
    //* Backup PaintFile Objects
    //************************
    file BackupPaintFile9 b clear copy;* file BackupPaintFile10 b d;* paste
    file BackupPaintFile8 b clear copy;* file BackupPaintFile9 b d;* paste
    file BackupPaintFile7 b clear copy;* file BackupPaintFile8 b d;* paste
    file BackupPaintFile6 b clear copy;* file BackupPaintFile7 b d;* paste
    file BackupPaintFile5 b clear copy;* file BackupPaintFile6 b d;* paste
    file BackupPaintFile4 b clear copy;* file BackupPaintFile5 b d;* paste
    file BackupPaintFile3 b clear copy;* file BackupPaintFile4 b d;* paste
    file BackupPaintFile2 b clear copy;* file BackupPaintFile3 b d;* paste
    file BackupPaintFile1 b clear copy;* file BackupPaintFile2 b d;* paste
!w200_backup_controls_entry2
    close BackupControls1 error
    open BackupControls1 null
    file Controls error return
    b
    do
        if  (!eof)
+           scan:/@line/:/,/
+           BackupName = left
+           scan:/@right/:/,/
+           BackupType = left
+           BackupText = right
+           call !w200_backup_one
+           file Controls
+       endif
        f;1
    until (eof)
    file PaintFile
    b
    clear
    copy;*
    close BackupPaintFile1 error
    open BackupPaintFile1 null
    paste
    //****************************
    //* Remove GroupRectangle
    //****************************
    b
    do
        fs:/,GroupRectangle,/
        if (!eof) d;1
    until (eof)
    return

!w200_backup_one
    MacroCommand = "window windowpos @BackupName@ BackupX BackupY BackupCX BackupCY" $MacroCommand
    Newline = '@BackupName@,@BackupType@,@BackupX@,@BackupY@,@BackupCX@,@BackupCY@,@BackupText@'
    file BackupControls1
    i:/@Newline/
    return

//*********************************************************
//* Restore the Controls on the Control Window to the last backup
//*********************************************************
!w200_restore_controls
    //message = 'w200_retore_controls' window message info ok
    file BackupControls1
    b
    do
        if (!eof)
+          scan:/@line/:/,/ BackupName = left
+          scan:/@right/:/,/ BackupType = left
+          scan:/@right/:/,/ BackupX = left
+          scan:/@right/:/,/ BackupY = left
+          scan:/@right/:/,/ BackupCX = left
+          scan:/@right/:/,/ BackupCY = left
+          BackupText = right
+          MacroCommand = |@BackupName@ = BackupText| $MacroCommand
+          MacroCommand = |window modify @BackupName@ error| $MacroCommand
+          call !w200_size_control
+          if  (BackupType = 'PBOBJ1')
+              MacroCommand = |@BackupName@ = null| $MacroCommand
+       endif
        f;1
    until (eof)
    file BackupPaintFile1
    b
    f;*
    if  (pcount < 1) 
+       file PaintFile error open PaintFile null
+       b
+       return
+   endif
    b
    clear
    copy;*

    close PaintFile error
    open PaintFile null
    paste
    b
    if  (UpdateConnectors) call BuilderConnect.bed!m100_update_connect file PaintFile b window paint Builder_Control_WIN
    
    //************************
    //* Backup Controls
    //************************
    file BackupControls2 b clear copy;* file BackupControls1 b d;* paste
    file BackupControls3 b clear copy;* file BackupControls2 b d;* paste
    file BackupControls4 b clear copy;* file BackupControls3 b d;* paste
    file BackupControls5 b clear copy;* file BackupControls4 b d;* paste
    file BackupControls6 b clear copy;* file BackupControls5 b d;* paste
    file BackupControls7 b clear copy;* file BackupControls6 b d;* paste
    file BackupControls8 b clear copy;* file BackupControls7 b d;* paste
    file BackupControls9 b clear copy;* file BackupControls8 b d;* paste
    file BackupControls10 b clear copy;* file BackupControls9 b d;* paste
    file BackupControls10 b d;*
    //************************
    //* Backup PaintFile Objects
    //************************
    file BackupPaintFile2 b clear 
    fs:/Builder_Control_WIN,/ if (!eof) b copy;* file BackupPaintFile1 b d;* paste
    file BackupPaintFile3 b clear copy;* file BackupPaintFile2 b d;* paste
    file BackupPaintFile4 b clear copy;* file BackupPaintFile3 b d;* paste
    file BackupPaintFile5 b clear copy;* file BackupPaintFile4 b d;* paste
    file BackupPaintFile6 b clear copy;* file BackupPaintFile5 b d;* paste
    file BackupPaintFile7 b clear copy;* file BackupPaintFile6 b d;* paste
    file BackupPaintFile8 b clear copy;* file BackupPaintFile7 b d;* paste
    file BackupPaintFile9 b clear copy;* file BackupPaintFile8 b d;* paste
    file BackupPaintFile10 b clear copy;* file BackupPaintFile9 b d;* paste
    file BackupPaintFile10 b d;*

    return

!w200_size_control
    window exists @BackupName
    if (!status) return 
    MacroCommand = |window size @BackupName@ @BackupX@ @BackupY@ @BackupCX@ @BackupCY@ error| $MacroCommand
    return

//*********************************************************
//* Create a Directory List of Files
//*********************************************************
!x100_dirlist
    call !x200_init
    call !x300_proc
    call !x400_wrap
    return

//*********************************************************
//* Initialization
//*********************************************************
!x200_init
    string  Newline        error
    string  Dirname        error
    string  Systemcmd      error
    string  Currentdir     error
    integer Splitsize      error
    float   Filecount = 0  error Filecount = 0
    float   Dircount = 0   error Dircount = 0
    string  Displaycount   error
    string  Printcount     error
    int     Lencount       error
    string  sFilecount     error
    string  sDircount      error

    //if (Dirname = null) goto !x200_init
    close Dirfile error
    open Dirfile null
    i:/@Dirname@/
    close DirFileList error
    open DirFileList null
    return

//*********************************************************
//* Process the directory
//*********************************************************
!x300_proc
    file Dirfile
    b
    if (eof) goto !x300_done
    Currentdir = line
    d
    Systemcmd = "dir @Currentdir@ >tempdir.dat"
    system:"@Systemcmd@"
    open tempdir tempdir.dat
    b
    fs:/<DIR>/
    scan:/@line/:/<DIR>/
    if (!found) goto !x300_proc
    scanr:/@line/:word
    Splitsize = lleft + 1
    b   
    fs:/../
    f;1
    clear
    copy;*
    b d;*
    b paste
    Dircount = Dircount + 1
    f;*
    b;1
    d;*
    b
!x300_loop
    if (eof)
+      close tempdir
+      goto !x300_proc
+   endif
    scan:/@line/:/<DIR>/
    if (!found) goto !x300_file
    split:/@line/;@Splitsize
    Newline = "@Currentdir@\@right@"
    file Dirfile
    f;*
    i:/@Newline@/
    file tempdir
    goto !x300_next
    
!x300_file
    split:/@line/;@Splitsize
    Newline = "@Currentdir@\@right@"
    file DirFileList
    i:/@Newline/
    Filecount  = Filecount + 1
    goto !x300_next

!x300_next
    file tempdir
    f;1
    goto !x300_loop
!x300_done
    return

//*********************************************************
//* Wrapup
//*********************************************************
!x400_wrap
    close Dirfile
    //write DirFileList dirfilelist.dat

    Displaycount = Filecount
    call !x450_comma
    sFilecount = Printcount
    if (Printcount = 0) sFilecount = '0'

    Displaycount = Dircount
    call !x450_comma
    sDircount = Printcount
    if (Printcount = 0) sDircount = '0'
    
    return

//*********************************************************
//* Convert number to display with commas
//********************************************************* 
!x450_comma
    scan:/@Displaycount/:/./
    Displaycount = left
    Printcount = null
    
!x450_comma_loop
    Lencount = len(Displaycount)
    if  (Lencount < 4) 
+       Printcount = "@Displaycount@@Printcount@"
+       goto !x450_done
+   endif
    splitr:/@Displaycount/;3
    Printcount = /,@right@/
    Displaycount = left
    goto !x450_comma_loop
!x450_done
    return

//*********************************************
//* Generate the new system BEDITWIN bed code
//*********************************************
!y100_Generate
    GenSystemFilename = "@SystemName@.BED"
    call !y300_backup_code

    Testpntfilename = '@SystemName@.pnt'
    close Testpnt error
    open Testpnt @Testpntfilename error open Testpnt null
    SearchString = '@SystemName@_'
    b
    do
        if-1  (!eof)
+           if-2  (line beginswith @SearchString)
+               f;1
+           else-2
+               d;1
+       endif
    until (eof)
    write Testpnt @Testpntfilename
    close Testpnt

    file WindowList
    b
    FirstWindowName = "@SystemName@_@line@_WIN"
    close GenCode error
    open GenCode null
    Newline = |//*********************************************************************| i:/@Newline/
    Newline = |//* Program   : @GenSystemFilename@| i:/@Newline/
    Newline = |//*             Generated by Forrest Bentley's @System@ @Version@| i:/@Newline/
    Newline = |//* Date      : @date@| i:/@Newline@/
    Newline = |//* Time      : @time@| i:/@Newline@/
    Newline = |//* Desc      : @SystemDesc@| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = || i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Storage Variables| i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    int     Xpos| i:/@Newline@/
    Newline = |    int     Ypos| i:/@Newline@/
    Newline = |    string  MouseOK| i:/@Newline@/
    Newline = |    string  Drag| i:/@Newline@/
    Newline = |    | i:/@Newline@/

    Newline = |    int     ObjectX| i:/@Newline@/
    Newline = |    int     ObjectY| i:/@Newline@/
    Newline = |    int     ObjectCX| i:/@Newline@/
    Newline = |    int     ObjectCY| i:/@Newline@/
    Newline = |    string  MacroCommand| i:/@Newline@/
    Newline = |    string  Newline| i:/@Newline@/
    Newline = |    string  HoldObjectName| i:/@Newline@/
    Newline = |    int     CharCount| i:/@Newline@/
    Newline = |    int     WorkVar| i:/@Newline@/

    Newline = |    string  PaintObjectAction| i:/@Newline@/
    Newline = |    string  HoldWindowName| i:/@Newline@/
    Newline = |    string  HoldPaintLine| i:/@Newline@/
    Newline = |    string  HoldObjectType| i:/@Newline@/
    Newline = |    string  HoldRight| i:/@Newline@/
    Newline = |    int     HoldX| i:/@Newline@/
    Newline = |    int     HoldY| i:/@Newline@/
    Newline = |    int     HoldCX| i:/@Newline@/
    Newline = |    int     HoldCY| i:/@Newline@/
    Newline = |    int     HoldRed| i:/@Newline@/
    Newline = |    int     HoldGreen| i:/@Newline@/
    Newline = |    int     HoldBlue| i:/@Newline@/
    Newline = |    string  HoldNewline| i:/@Newline@/

    Newline = | | i:/@Newline@/
    Newline = |    string  BubbleTest = 'n'| i:/@Newline@/
    Newline = |    string  BubbleObject| i:/@Newline@/
    Newline = |    string  BubbleSearch| i:/@Newline@/
    Newline = |    string  BubbleText| i:/@Newline@/
    Newline = |    string  BubbleWindow| i:/@Newline@/
    Newline = |    int     BubbleX| i:/@Newline@/
    Newline = |    int     BubbleY| i:/@Newline@/
    Newline = |    int     BubbleWinX| i:/@Newline@/
    Newline = |    int     BubbleWinY| i:/@Newline@/
    Newline = |    int     BubbleWinCX| i:/@Newline@/
    Newline = |    int     BubbleWinCY| i:/@Newline@/
    Newline = |    string  BubbleNew| i:/@Newline@/
    Newline = |    string  BubbleLast| i:/@Newline@/
    Newline = |    string  BubbleExists = 'n'| i:/@Newline@/

    Newline = | | i:/@Newline@/
    Newline = |    string  Ban1| i:/@Newline/
    Newline = |    string  Ban2 = '@GenSystemFilename@'| i:/@Newline@/
    Newline = |    string  Ban3| i:/@Newline/
    Newline = |    string  BannerLine1 = Ban1| i:/@Newline/
    Newline = |    string  BannerLine2 = Ban2| i:/@Newline@/
    Newline = |    string  BannerLine3 = Ban3| i:/@Newline/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Special Actions                 | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    string WindowInit                                       = "call !a010_WindowInit"| i:/@Newline@/
    Newline = |    string WindowWrap                                       = "call !a010_WindowWrap"| i:/@Newline@/
    Newline = |    string WindowMouse                                      = "call !a010_WindowMouse"| i:/@Newline@/
    Newline = |    string WindowDown1                                      = "call !a010_WindowDown1"| i:/@Newline@/
    Newline = |    string WindowDown2                                      = "call !a010_WindowDown2"| i:/@Newline@/
    Newline = |    string WindowUp1                                        = "call !a010_WindowUp1"| i:/@Newline@/
    Newline = |    string WindowUp2                                        = "call !a010_WindowUp2"| i:/@Newline@/
    Newline = |    string WindowEscape                                     = "call !a010_Escape"| i:/@Newline@/
    Newline = |    string DefaultWindowProcess                             = "call !a010_Default_Window_Processing"| i:/@Newline@/
    Newline = | 
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Window Menu Actions             | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Window Button Actions           | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Field Edits                     | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* User Defined Global Variables| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!0001_User_Defined_Globals| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Main Processing| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!0005_Main_Processing| i:/@Newline@/
    Newline = |    open WindowFile @SystemName@.win| i:/@Newline@/
    Newline = |    open MenuFile @SystemName@.mnu| i:/@Newline@/
    Newline = |    open PaintFile @SystemName@.pnt error| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    //*************************| i:/@Newline@/
    Newline = |    //* Main Window Loop      | i:/@Newline@/
    Newline = |    //*************************| i:/@Newline@/
    Newline = |    window start noclose| i:/@Newline@/
    Newline = |    exit| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Special Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!a010_Escape| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Default Window Processing| i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_Default_Window_Processing| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Main Window Initialization Routine     | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowInit| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Main Window Wrapup Routine     | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowWrap| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 1 Down    | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowDown1| i:/@Newline@/

    Newline = |    window mousepos Xpos Ypos| i:/@Newline@/
    Newline = |    PaintObjectAction = 'n'| i:/@Newline@/
    Newline = |    file PaintFile error open PaintFile null| i:/@Newline@/
    Newline = |    b| i:/@Newline@/
    Newline = |    do| i:/@Newline@/
    Newline = |        if  (!eof)| i:/@Newline@/
    Newline = |+           call !a010_WindowDown1_paintfile| i:/@Newline@/
    Newline = |+       endif| i:/@Newline@/
    Newline = |        f;1| i:/@Newline@/
    Newline = |    until (eof)| i:/@Newline@/

    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'y'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/

    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |//* Handle PaintFile Button Press| i:/^Newline^/ subs @
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |!a010_WindowDown1_paintfile| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@line/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (left = 'MainWindow') return| i:/^Newline^/ subs @
    subs ^ Newline =  |    MacroCommand = 'window hwnd @left@ status error return'| i:/^Newline^/ subs @
    subs ^ Newline =  |    $MacroCommand| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldWindowName = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldObjectName = left| i:/^Newline^/ subs @

    subs ^ Newline =  |    if  (HoldObjectName = 'Connector') return| i:/^Newline^/ subs @

    subs # Newline =  |    if  (!BubbleTest) subs ^ MacroCommand = 'MacroCommand  = ^HoldObjectName^ error subs @ return' subs @ $MacroCommand| i:/#Newline#/ subs @

    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldObjectType = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectX = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldX = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectY = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldY = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectCX = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldCX = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectCY = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldCY = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldRed = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldGreen = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@right/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldBlue = left| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldRight = right| i:/^Newline^/ subs @

    subs ^ Newline =  |    if  (ObjectCX < 1) ObjectCX = 20| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (ObjectCY < 1) ObjectCY = ObjectCX| i:/^Newline^/ subs @

    subs ^ Newline =  |    scanr:/@HoldObjectName/:/_/ error return| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (right = 'Text') or (right = 'TextTilt')  call !a010_WindowDown1_text| i:/^Newline^/ subs @
    
    subs ^ Newline =  |    if  (right = 'Ellipse') or (right = 'Ellipse3D') or (right = 'Circle')| i:/^Newline^/ subs @
    subs ^ Newline =  |+       WorkVar = ObjectCX / 2| i:/^Newline^/ subs @
    subs ^ Newline =  |+       ObjectX -= WorkVar| i:/^Newline^/ subs @
    subs ^ Newline =  |+       WorkVar = ObjectCY / 2| i:/^Newline^/ subs @
    subs ^ Newline =  |+       ObjectY -= WorkVar| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (right = 'Diamond')| i:/^Newline^/ subs @
    subs ^ Newline =  |+       WorkVar = ObjectCX / 2| i:/^Newline^/ subs @
    subs ^ Newline =  |+       ObjectX -= WorkVar| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @

    subs ^ Newline =  |    ObjectCX += ObjectX| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectCY += ObjectY| i:/^Newline^/ subs @
    subs ^ Newline =  |    if-1  (Xpos >= ObjectX) and (Xpos <= ObjectCX) and (Ypos >= ObjectY) and (Ypos <= ObjectCY)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-2  (BubbleTest)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           BubbleObject = HoldObjectName| i:/^Newline^/ subs @
    subs ^ Newline =  |+           f;*| i:/^Newline^/ subs @
    subs ^ Newline =  |+       else-2| i:/^Newline^/ subs @
    subs ^ Newline =  |+           PaintObjectAction = 'y'| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldPaintLine = line| i:/^Newline^/ subs @
    subs ^ Newline =  |+           call !a010_paintfile_object| i:/^Newline^/ subs @
    subs ^ Newline =  |+           f;*| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    return| i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/

    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |//* Change the PaintFile object| i:/^Newline^/ subs @
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |!a010_paintfile_object| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (HoldObjectType = 'BitmapFit')| i:/^Newline^/ subs @
    subs ^ Newline =  |+       Newline = '@HoldWindowName@,@HoldObjectName@,BitmapFitInvert,@HoldX@,@HoldY@,@HoldCX@,@HoldCY@,@HoldRight@'| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else| i:/^Newline^/ subs @
    subs ^ Newline =  |+       call !a010_paintfile_change_color| i:/^Newline^/ subs @
    subs ^ Newline =  |+       Newline = '@HoldWindowName@,@HoldObjectName@,@HoldObjectType@,@HoldX@,@HoldY@,@HoldCX@,@HoldCY@,@HoldRed@,@HoldGreen@,@HoldBlue@,@HoldRight@'| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    r:/@Newline/| i:/^Newline^/ subs @
    subs ^ Newline =  |    HoldNewline = Newline| i:/^Newline^/ subs @
    subs ^ Newline =  |    b| i:/^Newline^/ subs @
    subs ^ Newline =  |    MacroCommand = 'window paint @HoldWindowName@' $MacroCommand| i:/^Newline^/ subs @
    subs ^ Newline =  |    return| i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |//* Change the Color| i:/^Newline^/ subs @
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |!a010_paintfile_change_color| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    //* Red| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    if-1  (HoldRed = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-2  (HoldGreen = 0) and (HoldBlue = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           if-3  (HoldRed < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldRed += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+           else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldRed -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else-1| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-3  (HoldRed < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldRed += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+       else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldRed -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    //* Green| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    if-1  (HoldGreen = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-2  (HoldRed = 0) and (HoldBlue = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           if-3  (HoldGreen < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldGreen += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+           else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldGreen -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else-1| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-3  (HoldGreen < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldGreen += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+       else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldGreen -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    //* Blue| i:/^Newline^/ subs @
    subs ^ Newline =  |    //*********************| i:/^Newline^/ subs @
    subs ^ Newline =  |    if-1  (HoldBlue = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-2  (HoldRed = 0) and (HoldGreen = 0)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           if-3  (HoldBlue < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldBlue += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+           else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+               HoldBlue -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else-1| i:/^Newline^/ subs @
    subs ^ Newline =  |+       if-3  (HoldBlue < 150)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldBlue += 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+       else-3| i:/^Newline^/ subs @
    subs ^ Newline =  |+           HoldBlue -= 100| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    return| i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/
    subs ^ Newline =  |
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |//* Setup CX and CY for Text| i:/^Newline^/ subs @
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |!a010_WindowDown1_text| i:/^Newline^/ subs @
    subs ^ Newline =  |    CharCount = 0| i:/^Newline^/ subs @
    subs ^ Newline =  |    scanr:/@line/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    do| i:/^Newline^/ subs @
    subs ^ Newline =  |        split:/@right/;1| i:/^Newline^/ subs @
    subs ^ Newline =  |        CharCount ++| i:/^Newline^/ subs @
    subs ^ Newline =  |    until (right = null)| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectCY = ObjectCX| i:/^Newline^/ subs @
    subs ^ Newline =  |    ObjectCX = ObjectCX * CharCount * 2 / 3| i:/^Newline^/ subs @
    subs ^ Newline =  |    return| i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/

    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 1 Up      | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowUp1| i:/@Newline@/

    subs ^ Newline =  |    if  (PaintObjectAction)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       b fs:/@HoldNewline/| i:/^Newline^/ subs @
    subs ^ Newline =  |+       r:/@HoldPaintLine/| i:/^Newline^/ subs @
    subs # Newline =  |+       subs ^ MacroCommand = 'window paint ^HoldWindowName^' $MacroCommand subs @| i:/#Newline#/ subs @
    subs ^ Newline =  |+       subs ^| i:/^Newline^/ subs @
    subs # Newline =  |+       MacroCommand = 'MacroCommand  = ^HoldObjectName^ error return'| i:/#Newline#/ subs @
    subs ^ Newline =  |+       subs @| i:/^Newline^/ subs @
    subs ^ Newline =  |+       $MacroCommand //Find the contents of the variable & store in MacroCommand| i:/^Newline^/ subs @
    subs ^ Newline =  |+       $MacroCommand //Process the contents of the variable| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  | | i:/^Newline^/ subs @

    subs ^ Newline =  |+   if  (BubbleExists)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       window deletecontrol Bubble error| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleExists = 'n'| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @

    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'n'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 2 Down    | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowDown2| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'y'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 2 Up      | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowUp2| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'n'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Movement | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowMouse| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    window mousepos Xpos Ypos| i:/@Newline@/

    Newline = | | i:/@Newline@/
    subs ^ Newline =  |    BubbleNew = '@Xpos@-@Ypos@'| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (BubbleNew = BubbleLast) return| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleLast = BubbleNew| i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/
    subs ^ Newline =  |    BubbleTest = 'y' | i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleObject = null| i:/^Newline^/ subs @
    subs ^ Newline =  |    file PaintFile error open PaintFile null| i:/^Newline^/ subs @
    subs ^ Newline =  |    b| i:/^Newline^/ subs @
    subs ^ Newline =  |    do| i:/^Newline^/ subs @
    subs ^ Newline =  |        if  (!eof)| i:/^Newline^/ subs @
    subs ^ Newline =  |+           call !a010_WindowDown1_paintfile| i:/^Newline^/ subs @
    subs ^ Newline =  |+       endif| i:/^Newline^/ subs @
    subs ^ Newline =  |        f;1| i:/^Newline^/ subs @
    subs ^ Newline =  |    until (eof)| i:/^Newline^/ subs @
    subs ^ Newline =  | | i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (BubbleObject != null)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       call !a010_bubble| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else| i:/^Newline^/ subs @
    subs ^ Newline =  |+       window deletecontrol Bubble error| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleExists = 'n'| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleTest = 'n' | i:/^Newline^/ subs @
    Newline = | | i:/@Newline@/

    Newline = |    if  (!Drag) return| i:/@Newline@/
    Newline = |    return| i:/@Newline@/

    Newline = | | i:/@Newline@/
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |//* Bubble Text| i:/^Newline^/ subs @
    subs ^ Newline =  |//******************************************| i:/^Newline^/ subs @
    subs ^ Newline =  |!a010_bubble| i:/^Newline^/ subs @
    subs ^ Newline =  |    close BubbleFile error| i:/^Newline^/ subs @
    subs ^ Newline =  |    open BubbleFile Test.bbl error return| i:/^Newline^/ subs @
    subs ^ Newline =  |    b| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleSearch = '@BubbleObject@,'| i:/^Newline^/ subs @
    subs ^ Newline =  |    //message = BubbleSearch window message info ok| i:/^Newline^/ subs @
    subs ^ Newline =  |    fs:/@BubbleSearch@/| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (eof) | i:/^Newline^/ subs @
    subs ^ Newline =  |+       close BubbleFile| i:/^Newline^/ subs @
    subs ^ Newline =  |+       return| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    scan:/@line/:/,/| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleText = right| i:/^Newline^/ subs @
    subs ^ Newline =  |    //size BubbleText,99| i:/^Newline^/ subs @
    subs ^ Newline =  |    scanr:/@BubbleObject/:/_/| i:/^Newline^/ subs @
    subs ^ Newline =  |    scanr:/@left@/:/_/| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleWindow = '@left@_WIN'| i:/^Newline^/ subs @

    subs ^ Newline =  |    window windowpos @BubbleWindow BubbleWinX BubbleWinY BubbleWinCX BubbleWinCY| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleWinCX -= 400| i:/^Newline^/ subs @
    subs ^ Newline =  |    BubbleWinCY -= 54| i:/^Newline^/ subs @

    subs ^ Newline =  |    if  (Xpos > BubbleWinCX)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleX = Xpos - 405| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleX = Xpos + 3| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    if  (Ypos > BubbleWinCY)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleY = Ypos - 60| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleY = Ypos + 3| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    if (BubbleX < 1) BubbleX = 1| i:/^Newline^/ subs @
    subs ^ Newline =  |    if (BubbleY < 1) BubbleY = 1| i:/^Newline^/ subs @

    subs ^ Newline =  |    if  (BubbleExists)| i:/^Newline^/ subs @
    subs ^ Newline =  |+       window size Bubble @BubbleX @BubbleY 400 54 error| i:/^Newline^/ subs @
    subs ^ Newline =  |+   else| i:/^Newline^/ subs @
    subs ^ Newline =  |+       BubbleExists = 'y'| i:/^Newline^/ subs @
    subs ^ Newline =  |+       window createcontrol @BubbleWindow Bubble @BubbleX @BubbleY 400 54 MLOBJ1 test error BubbleExists = 'n'| i:/^Newline^/ subs @
    subs ^ Newline =  |+       window disable Bubble error BubbleExists = 'n'| i:/^Newline^/ subs @
    subs ^ Newline =  |+   endif| i:/^Newline^/ subs @
    subs ^ Newline =  |    Bubble = BubbleText error BubbleExists = 'n'| i:/^Newline^/ subs @
    subs ^ Newline =  |    window modify Bubble error BubbleExists = 'n'| i:/^Newline^/ subs @

    Newline = | | i:/@Newline@/    
    subs ^ Newline =  |    return| i:/^Newline^/ subs @

    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Build Menu Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    b fs:/Window Menu Actions/
    f;1
    close ButtonProc error
    open ButtonProc null
    file WindowList
    b
    if  (eof)
+       message = "No windows to navigate to" window message error ok
+       //goto !y100_menu_nav_done
+       return
+   endif

    //**********************************
    //* Create Menu Navigation
    //**********************************
    call !y160_create_menunav

    int NewLen error

    file GenCode
    MenuCount = 0
    Newline = |    string @SystemName@_Main_Exit_MSOBJ | NewLen = len(Newline) if (NewLen < 58) size Newline,60
    Newline = |@Newline@= "call !a090_@SystemName@_Main_Exit_MSOBJ"| i:/@Newline@/

    Newline = |    string @SystemName@_Main_Banneron_MSOBJ | NewLen = len(Newline) if (NewLen < 58) size Newline,60
    Newline = |@Newline@= "call !a090_@SystemName@_Main_Banneron_MSOBJ"| i:/@Newline@/

    Newline = |    string @SystemName@_Main_Banneroff_MSOBJ | NewLen = len(Newline) if (NewLen < 58) size Newline,60
    Newline = |@Newline@= "call !a090_@SystemName@_Main_Banneroff_MSOBJ"| i:/@Newline@/

    Newline = |    string @SystemName@_Main_About_MSOBJ | NewLen = len(Newline) if (NewLen < 58) size Newline,60
    Newline = |@Newline@= "call !a095_@SystemName@_Main_About_MSOBJ"| i:/@Newline@/

    file ButtonProc
    i:|//****************************************|
    Newline = |//* Exit Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a090_@SystemName@_Main_Exit_MSOBJ| i:/@Newline@/
    Newline = |    message = 'Are you sure?'| i:/@Newline@/
    Newline = |    window message question yesno| i:/@Newline@/
    Newline = |    if  (message)| i:/@Newline@/
    Newline = |+       window stop| i:/@Newline@/
    Newline = |+   endif| i:/@Newline@/
    i:|    return|
    i:| |
    i:|//****************************************|
    Newline = |//* Banner On| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a090_@SystemName@_Main_Banneron_MSOBJ| i:/@Newline@/
    Newline = |    BannerLine1 = Ban1| i:/@Newline@/
    Newline = |    BannerLine2 = Ban2| i:/@Newline@/
    Newline = |    BannerLine3 = Ban3| i:/@Newline@/
    Newline = |    window paint MainWindow| i:/@Newline@/
    i:|    return|
    i:| |
    i:|//****************************************|
    Newline = |//* Banner Off| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a090_@SystemName@_Main_Banneroff_MSOBJ| i:/@Newline@/
    Newline = |    BannerLine1 = null| i:/@Newline@/
    Newline = |    BannerLine2 = null| i:/@Newline@/
    Newline = |    BannerLine3 = null| i:/@Newline@/
    Newline = |    window paint MainWindow| i:/@Newline@/
    i:|    return|
    i:| |
    i:|//****************************************|
    Newline = |//* About Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a095_@SystemName@_Main_About_MSOBJ| i:/@Newline@/
    Newline = |    message = ^@SystemDesc@^| i:/@Newline@/
    Newline = |    window message info OK| i:/@Newline@/
    i:|    return|

    file MenuNav
    b
!y100_menu_nav_loop
    if (eof) goto !y100_menu_nav_done
    scan:/@line/:/,/
    MenuName = left
    WindowName = right
    MenuCount += 100
    MenuFunction = '!a@MenuCount@_@MenuName@'
    Newline = |    string @MenuName@ |
    LenNewline = len(Newline)
    if (LenNewline < 58) size Newline,60
    file GenCode
    Newline = |@Newline@= "call !a@MenuCount@_@MenuName@"|
    i:/@Newline@/
    file ButtonProc
    if (MenuCount) i:| |
    i:|//****************************************|
    Newline = |//* @MenuName@ Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a@MenuCount@_@MenuName@| i:/@Newline@/
    Newline = |    window pointer wait| i:/@Newline@/
    //Newline = |    window close @WindowName@_WIN error| i:/@Newline@/
    Newline = |    window hwnd @WindowName@_WIN status error window open @WindowName@_WIN shade| i:/@Newline@/
    Newline = |    window center @WindowName@_WIN| i:/@Newline@/
    Newline = |    window clear @WindowName@_WIN| i:/@Newline@/
    Newline = |    window unshade @WindowName@_WIN| i:/@Newline@/
    Newline = |    window setfocus @WindowName@_WIN| i:/@Newline@/
    Newline = |    window pointer arrow| i:/@Newline@/
    i:|    return|
    file MenuNav
    f;1
    goto !y100_menu_nav_loop
    
!y100_menu_nav_done
    file GenCode
 
    file ButtonProc
    b
    cut;*
    file GenCode
    f;*
    paste
    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Build Window Button Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    b fs:/Window Button Actions/
    f;1
    file WindowNav
    b
    ButtonCount = 0
!y100_button_nav_loop
    if (eof) goto !y100_nav_proc
    scan:/@line/:/,/
    ButtonName = left
    scan:/@right/:/,/
    WindowName = left
    NavAction = right
    ButtonCount += 100
    ButtonFunction = '!b@ButtonCount@_@ButtonName@'
    file GenCode
    Newline = |    string @ButtonName@ |
    LenNewline = len(Newline)
    if (LenNewline < 58) size Newline,60
    Newline = |@Newline@= "call !b@ButtonCount@_@ButtonName@"|
    i:/@Newline@/
    file ButtonProc
    if (ButtonCount) i:| |
    i:|//****************************************|
    Newline = |//* @ButtonName@ Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!b@ButtonCount@_@ButtonName@| i:/@Newline@/
    if  (NavAction = 'close')
+       Newline = |    window close @SystemName@_@WindowName@_WIN| i:/@Newline@/
+   endif
    if  (NavAction = 'open')
+       Newline = |    window pointer wait| i:/@Newline@/
+       //Newline = |    window close @SystemName@_@WindowName@_WIN error| i:/@Newline@/
+       Newline = |    window hwnd @SystemName@_@WindowName@_WIN status error window open @SystemName@_@WindowName@_WIN shade| i:/@Newline@/
+       Newline = |    window center @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window clear @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window unshade @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window setfocus @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window pointer arrow| i:/@Newline@/
+   endif
    if  (NavAction = 'start')
+       Newline = |    system:"start @WindowName@"| i:/@Newline@/
+   endif
    i:|    return|
    file WindowNav
    f;1
    goto !y100_button_nav_loop

!y100_nav_proc
    file ButtonProc
    b
    cut;*
    close ButtonProc
    file GenCode
    f;*
    paste
   
    //*************************************
    //* Add Entry Field Actions
    //*************************************
    b
    fs:/* Field Edits/
    f;1
    file Entryaction
    b
    do
        if (!eof)
+          scan:/@line/:/,/ //message = '[@line@]' window message info ok
+          ControlName = left
+          Newline = '    string @ControlName@ '
+          call !y110_size
+          scan:/@right/:/,/
+          EntryFieldAction = left
+          EntryFieldSize = right
+          scan:/@EntryFieldAction/:/-/     //*** Remove Password if present
+          EntryFieldAction = left
+          Newline = '@Newline@= "call !z999_entryaction_return"'
+          file GenCode
+          i:/@Newline/
+          Newline = '    window action @ControlName@'
+          i:/@Newline/
+          Newline = '    window edit @ControlName@ @EntryFieldAction@ @EntryFieldSize@'
+          i:/@Newline/
+          i:/ /
+          file Entryaction
+       endif
        f;1
    until (eof)

    //*************************************
    //* Add Password Field CONCILE statements
    //*************************************
    file Entryaction
    b
    do-action
        if (!eof)
+          scan:/@line/:/,/
+          ControlName = left
+          scan:/@right/:/,/
+          scan:/@left/:/-/
+          if (found)
+             scan:/@ControlName@/:/_/
+             SearchString = ' @left@_'
+             scan:/@right/:/_/
+             SearchString = '@SearchString@@left@_WIN'
+             Newline = '    window conceal @ControlName@'
+             call !y150_conceal
+       endif
        file Entryaction
        f;1
    until-action (eof)

    file GenCode
    f;*
    i:| |
    i:|//****************************************|
    i:|//* Special return for Entry Field Actions|
    i:|//****************************************|
    Newline = |!z999_entryaction_return| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/

    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//*    End of Program @GenSystemFilename@| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/

    call !y500_bedit_code

    write GenCode @GenSystemFilename
    //message = 'wrote @GenSystemFilename@' window message info ok
    
    b
    f;*
    int CodeLines error
    CodeLines = pcount

    close GenCode

    call !y200_menu_file

    //window close Builder_Window_WIN
    //Newline = 'beditwin call @GenSystemFilename@' system:"@Newline@"
    return

//***********************************************
//* Size the line to 60
//***********************************************
!y110_size
    NewLen = len(Newline) if (NewLen < 58) size Newline,60
    return

//***********************************************
//* Add 'window conceal' logic
//***********************************************
!y150_conceal
    file GenCode
    b
    do
        if (!eof)
+          fs:/@SearchString@/
+          if (!eof)
+             b;1
+             i:/@Newline@/
+             f;1
+       endif
        f;1
    until (eof)
    return

//***********************************************
//* Create the MenuNav file
//***********************************************
!y160_create_menunav
    close MenuNav error
    open MenuNav null

    file BuilderWindowFile
    b
!y160_window_loop
    fs:/WINDOW,/
    if (eof) goto !y160_window_done
    scan:/@line/:/_/
    scan:/@right/:/_/
    WindowName = left
    file WindowNav
    b
    SearchString = '@WindowName@,open'
    fs:/@SearchString@/
    if (!eof)
+      goto !y160_window_next
+   endif
    MenuName = "@SystemName@_@WindowName@_MSOBJ"
    Newline = "@MenuName@,@SystemName@_@WindowName@"
    file MenuNav
    i:/@Newline@/

!y160_window_next
    file BuilderWindowFile
    f;1
    goto !y160_window_loop
       
!y160_window_done
    file MenuNav
    b
    return    

//***********************************************
//* Create the .MNU file
//***********************************************
!y200_menu_file
    close Menu error
    open Menu null
    i:/***********************************/
    i:/* M E N U/
    i:/***********************************/
    Newline = |TITLE,@SystemTitle@| i:/@Newline/
    Newline = |MENU,~Test| i:/@Newline/
    
    file MenuNav
    b
!y200_menu_loop
    if  (eof) goto !y200_menu_done
    Newline = "ITEM,@line@_WIN"
    file Menu
    i:/@Newline@/
    file MenuNav
    f;1
    goto !y200_menu_loop

!y200_menu_done
    file Menu
    Newline = |--------------------| i:/@Newline@/
    Newline = |ITEM,@SystemName@_Main_Exit_MSOBJ,E~xit| i:/@Newline@/
    i:/***********************************/
    i:/* M E N U/
    i:/***********************************/
    Newline = |MENU,~Misc| i:/@Newline/
    Newline = |ITEM,@SystemName@_Main_Banneron_MSOBJ,Banner O~n| i:/@Newline@/
    Newline = |ITEM,@SystemName@_Main_Banneroff_MSOBJ,Banner O~ff| i:/@Newline@/
    i:/***********************************/
    i:/* M E N U/
    i:/***********************************/
    Newline = |MENU,~Help| i:/@Newline/
    Newline = |ITEM,@SystemName@_Main_About_MSOBJ,~About @SystemName@ System| i:/@Newline@/
    
    MenuFilename = "@SystemName@.MNU"
    write Menu @MenuFilename
    return

//*********************************************
//* Backup the original .bed file if it exists
//* to preserve manually entered code
//*********************************************
!y300_backup_code
    MacroCommand = "    if (!exists @SystemName@.bed) return" $MacroCommand
    MacroCommand = "open BackupBed @SystemName@.bed" $MacroCommand

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      //system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    MacroCommand = "write BackupBed Bedit-code\@SystemName@.bed" $MacroCommand
    close BackupBed
    return

//*********************************************
//* Merge the modified code
//*********************************************
!y500_bedit_code
    string CodeFileName error
    string ModuleName   error

    if (CodeType = 'bedit')
+      close GenCode error
+      MacroCommand = 'open GenCode @SystemName@.bed' $MacroCommand
+   endif

    close CodeFile error
    //write ModuleNameFile modname
    file ModuleNameFile error return
    clear
    b
    copy;*
    close ModuleNameFile2 error
    open ModuleNameFile2 null
    i:/TopOfFile/
    paste
    file ModuleNameFile
    b
    fs:/Global/
    if (eof)
+      b
+      ib:/Global/
+   endif
    b
    do-module
        //message = 'ModuleName[@line@]' window message info ok
        if (line = 'Global') and (CodeType != 'bedit') f;1
        ModuleName = line
        CodeFileName = "Bedit-code\@ModuleName@.bed"
        //message = 'opening[@CodeFileName@]' window message info ok
        open CodeFile @CodeFileName error goto !y500_bad_file
        //open CodeFile @CodeFileName error message = 'bad' window message info ok goto !y500_bad_file
        call !y510_remove_old_code
        //write GenCode gencode.bed
        file GenCode
        if (CodeType = 'bedit') and (ModuleName = 'Global') 
+          //* Add Top blank Line
+          b
+          ib:/ /
+       endif
        //message = 'Adding Code[@ModuleName@][@line@]' window message info ok
        file CodeFile
        b
        //*************************
        //* Insert the new code into
        //* the generated code file
        //*************************
        do-code
            //message = 'inserting[@line@]' window message info ok
            Newline = line
            file GenCode
            i:/@Newline/
            file CodeFile
            f;1
        until-code (eof)
        i:/ /
        close CodeFile
        if (CodeType = 'bedit') and (ModuleName = 'Global')
+          //* Remove Top blank Line
+          file GenCode
+          b
+          d
+       endif
        //write GenCode gencode2.bed
        //message = 'Code Added[@ModuleName@]' window message info ok        
!y500_bad_file
        file ModuleNameFile
        f;1
    until-module (eof)

    close CodeFile error
    //*******************************
    //* Remove Second Blank Line
    //*******************************
    //write GenCode GenCode5.bed message = 'gencode5' window message info ok
    file GenCode
    b
    string CurrentLine error
    string LastLine    error
    crush line
    CurrentLine = line 

    do
        f;1
        if (!eof)
+          CurrentLine = line
+          crush CurrentLine
+          if  (CurrentLine = LastLine) and (CurrentLine = null)
+              d;1
+              b;1
+       endif
        LastLine = CurrentLine  
    until (eof)

    if (CodeType = 'bedit')
+      MacroCommand = 'write GenCode @SystemName@.bed' $MacroCommand
+      MacroCommand = 'write GenCode Bedit-code\@SystemName@.bed' $MacroCommand
+      close GenCode
+   endif

    return

//*********************************************
//* Remove the old B-Edit code from the generated file
//*********************************************
!y510_remove_old_code
    //message = 'y510 remove[@ModuleName@]' window message info ok
    string CopyCmts error
    string TopCmts  error

    file GenCode
    b
    clear

!y510_next_global
    //**************************
    //* Remove Global Variables
    //**************************
    if (eof)
+      return
+   endif
    if-1 (ModuleName = 'Global')
+      split:/@line/;1
+      if-2 (left = '!')
+         return
+      else-2
+         d
+         goto !y510_next_global
+   endif
    if-1 (ModuleName = 'Global')
+       f;1
+       goto !y510_next_global
+   endif

!y510_find_module_loop
    cols 1,1
    fs:/!/
    noco
    if  (eof)
+       call !y520_new_module_position
+       return
+   endif
    scan:/@line/:/@ModuleName/
    if (!found)
+      f;1
+      goto !y510_find_module_loop   
+   endif

    scan:/@ModuleName@/:/_/
    if (found)
+      ModulePrefix = left
+   endif
    if (ModulePrefix = '!a010') and (CodeType != 'bedit')
+      ModulePrefix = null
+   endif
    file GenCode

!y510_Builder_Control_Code_comments
    //********************************
    //* Find all header comments
    //********************************
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !y510_Builder_Control_Code_comments
+   endif

    f;1
    TopCmts = 'y'
!y510_Builder_Control_Code_loop
    pack line
    scan:/@line/:word
    split:/@left/;2
    CopyCmts = 'n'
    if (left = '//') and (!TopCmts)
+      CopyCmts = 'y'
+   endif
    if (line = null) and (!TopCmts)
+      CopyCmts = 'y'
+   endif
    //********************************
    //* Copy comments to be pasted back
    //* if they belong to the next module
    //********************************
    if (CopyCmts)
+      //message = 'Copy[@line@]' window message info ok
+      copy;1
+   else
+      split:/@line/;1
+      if (left != '!')
+         //message = 'Clear CopyCmts[@CopyCmts@]TopCmts[@TopCmts@][@line@]' window message info ok
+         clear
+   endif

    //********************************
    //* Clear the comments from the buffer 
    //* if new module has the same prefix
    //********************************
    split:/@line/;1
    if (left = '!')
+      scan:/@line/:/_/
+      if (left = ModulePrefix)
+         clear
+   endif
    split:/@line/;1
    if (left != '!')
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif  
    TopCmts = 'n'
    if (line = ModuleName)
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif

    //message = 'Pasting[@line@]' window message info ok
    //********************************
    //* Replace the module comments
    //********************************
    file GenCode
    ib:/$*$FGB/
    paste
    //write GenCode GenCode4.bed
    //message = 'gencode4' window message info ok
    b
    cols 1,6
    fs:/$*$FGB/
    noco
    d;1
    b;1
    return

!y510_Builder_Control_Code_next
    if (!eof)
+      goto !y510_Builder_Control_Code_loop
+   endif
    //write GenCode GenCode3.bed
    //message = 'eof GenCode' 
    //window message info ok
    return

//*********************************************
//* Find the position for a new module
//*********************************************
!y520_new_module_position
    string CheckModuleName error
    file ModuleNameFile2
    b
    fs:/@ModuleName@/
    if (eof)
+      file GenCode
+      f;*
+      return
+   endif

!y520_new_module_position_down
    file ModuleNameFile2
    f;1
    if (eof) goto !y520_new_module_position_up
    CheckModuleName = line
    file GenCode
    b
!y520_new_module_position_down_module
    cols 1,1
    fs:/!/
    noco
    if (eof) goto !y520_new_module_position_down
    scan:/@line/:/@CheckModuleName@/
    if (!found)
+      f;1
+      goto !y520_new_module_position_down_module
+   endif
    goto !y520_new_module_found

!y520_new_module_position_up
    file ModuleNameFile2
    b;1
    scan:/@line/:/TopOfFile/
    if (found)
+      file GenCode
+      f;*
+      return
+   endif
    CheckModuleName = line
    file GenCode
    b
!y520_new_module_position_up_module
    cols 1,1
    fs:/!/
    noco
    if (eof)
+      goto !y520_new_module_position_up
+   endif
    scan:/@line/:/@CheckModuleName@/
    if (!found)
+      f;1
+      goto !y520_new_module_position_up_module
+   endif
    goto !y520_new_module_found

!y520_new_module_found
    do
        b;1
        split:/@line/;2
    until (left != '//')
    return

//*********************************************
//* Special return for entry fields with edits
//*********************************************
!z999_entry_action_return
    return

//*********************************************************************
//*    End of Program Builder.BED                                     *
//*********************************************************************
