//*******************************************************************************************************************
//* Program   : Builder.BED                                           
//* Author    : Forrest Bentley                                       
//* Date      : 11/15/2013                                            
//* Desc      : This BEDITWIN program will allow the design and        
//*             execution of new BEDITWIN systems and windows.        
//*             When the screens have been layed out for a system and 
//*             button navigation has been set to open/close windows  
//*             you can View the window flow visually. This is a very 
//*             powerful feature to review the screen flow. The COBOL
//*             Viewer uses this feature to allow analysis of program 
//*             paragraph call flow which could be useful to learn    
//*             a COBOL program.                                     
//*                                                                   
//* Builder Files Descriptions 
//* --------------------------------------------
//* 
//* BuilderWindowFile: .WIN file - List of all Windows and Controls on Windows
//* 	WINDOW,WindowName,x,y,cx,cy,Title
//* 	ControlType,ControlName,x,y,cx,cy,Text
//* 
//*         Control                 Control Type
//*         ---------------------   ------------
//*         Push Button 	    PBOBJ1
//* 	    Entry Field 	    EFOBJL
//* 	    Text 		    STTXT1
//* 	    Check Box 		    CBOBJ1
//* 	    Group Box 		    GBOBJ1
//* 	    List Box 		    LBOBJ1
//* 	    Radio Button 	    RBOBJ1
//* 	    Combo Box 		    COOBJS
//* 	    Drop Down List 	    COOBJL
//* 	    Multi-Line Entry 	    MLOBJ1
//* 	    Rectangle 		    STTXTF
//* 	    Box 		    STTXTR
//* 
//* WindowList: Temp List of Windows in the System
//* 	Window Name (without Naming Convention: e.g. Window1 not System_Window1_WIN)
//* 	e.g. Window1
//*              Window2	
//* 
//* WindowNav: .NAV File - Window Button Navigation
//* 	Button Name,Window Name (without Naming Convention: e.g. Window1 not System_Window1_WIN),Action (Open,Close,None)
//*         e.g. Test_Win1_Window2_PBOBJ,Win2,open
//*              Test_Win1_Cancel_PBOBJ,Win1,close
//* 
//* Controls: Temp file containing a list of Controls on a Window
//* 	ControlName,ControlType,Text
//* 	e.g. Test_Win1_Cancel_PBOBJ,PBOBJ1,&Cancel
//* 	
//* GenCode: .BED file - All BEDITWIN logic for the system
//* 
//* ButtonProc: Temp file that holds the .BED Menu & Button Processing for pasting after Vars Created
//* 	.BED Menu/Button Code
//* 
//* MenuNav: .MNU File - Menu Navigation
//* 	TITLE,System Title
//* 	MENU,Menu Text
//* 	ITEM,Menu Selection Text,Window Name to Open
//* 	------- (Menu Separator)
//* 
//* 	e.g. TITLE,Testing 123
//* 	     MENU,~Test
//* 	     ITEM,Test_Win1_MSOBJ,Test_Win1_WIN
//* 	     --------------------
//* 	     ITEM,Test_Main_Exit_MSOBJ,E~xit
//* 
//* Master: .MST File - System Information
//* 	Line1 = System Window Title
//* 	Line2 = System Description
//* 
//* SystemList: Temp List of all .WIN files in directory used in System Window for show Systems to modify
//* 	WindowName
//* 	e.g. Win1
//* 
//* ViewListWork: Temp list of all Windows in the system, used in view
//* 	e.g. Win1
//* 
//* ViewListAdd: Temp copy of ViewList for Filtering (identical to ViewList)
//* 
//* ViewList: Temp list of all Windows in the system with appropriate level numbers
//*     	Level-n,WindowName
//* 	e.g. Level-1,Win1
//* ViewObjects: Temp list of objects on the View screen to be deleted when Cancel is pushed
//* 	WindowName-n
//* 	e.g. Win1-1
//* ViewPositions: Temp list of objects with their positions
//* 	WindowName,Level,x,y,cx,cy
//* 	e.g. Win1,1,109,56,102,74
//* 
//* ViewFilterList: Temp list of Names of Windows
//* 	WindowFullName,ViewDisplayName,WindowListName
//* 	e.g. Builder_Filter_WIN,Filter Window,Filter
//* 
//* Entryaction: .ACT list of Entry Fields and their actions
//* 	EntryFieldName,Action,size
//*              Action = text
//*                       alpha
//*                       numeric
//*                       upper
//*                       lower
//*                       mix
//*                       date
//*                       dollar
//*                       telephone
//*                 Note: Action with a concatinated -P designates a password field
//*                      
//*              
//* 	e.g. Builder_Entry_Size_EFOBJ,numeric,5
//*          TestSystem_Authorization_Password_EFOBO,text-P,10
//* 
//*******************************************************************************************************************
//*                                    C H A N G E        L O G
//*
//*    Date     Author           Description
//* ----------  ---------------  ------------------------------------------------------------------------------------
//* 11/15/2013  Forrest Bentley  Created Program
//* 11/27/2013  Forrest Bentley  View Program Flow Draw Rendering Left/Right Cols
//*                              Eliminate Gaps in Flow Rendering
//*                              Entry Field Edits
//*                              Test button generates code
//* 11/28/2013  Forrest Bentley  Excessive Windows warning
//*                              Program Flow for B-Edit programs
//* 11/29/2013  Forrest Bentley  ViewFilterList sorting
//*                              Fixed View Program Flow "Push down" logic
//*                              Code Check link
//* 11/30/2013  Forrest Bentley  Start Systems bat files
//* 12/02/2013  Forrest Bentley  Added Filter Comments button
//* 12/03/2013  Forrest Bentley  Created Progress Bar processing
//* 12/05/2013  Forrest Bentley  Added Banner processing
//*                              Added Game of Life link
//* 12/07/2013  Forrest Bentley  Added Button Action button
//* 12/07/2013  Forrest Bentley  Added Program Comments button to view
//* 12/08/2013  Forrest Bentley  Added Group Objects Allignment
//* 12/11/2013  Forrest Bentley  Added Search Strings window
//* 12/27/2013  Forrest Bentley  Added functionality to move a selected group using the size/pos arrows
//* 12/28/2013  Forrest Bentley  Changed the About Message Box to a proper About screen
//* 12/30/2013  Forrest Bentley  Added Browsee Buttons on File Entry screens
//* 12/31/2013  Forrest Bentley  Fixed B-Edit code generation logic so there isn't text in the win file for EFOBJ, LBOBJ, COOBJ, STTXTR, STTXTB
//* 01/05/2014  Forrest Bentley  Entry Action Focus
//* 01/07/2014  Forrest Bentley  Added Download 3090 COPIES, and inserting when scanning COBOL code.
//* 01/09/2014  Forrest Bentley  Fixed View Program Flow to properly handle prefixes in modules to be filtered/viewed
//* 01/10/2014  Forrest Bentley  Overhauled the Browse window to be more useful (directories and files list boxes)
//* 01/11/2014  Forrest Bentley  Integration with 3090 Code Checker
//*                              Cleanup in 3090 Code Checker (No comment line error checks, GOTO non-EXIT, GOTO not same paragraph prefix
//*                              Preserve Directory on all screens
//* 01/12/2014  Forrest Bentley  Code Checker Integration
//* 01/14/2014  Forrest Bentley  Added View button to View Program Flow Filter screen to view module code
//* 01/15/2014  Forrest Bentley  Added Menu Selections:
//*                                    GE Fleet
//*                                        Bachman on Net, Bachman Visual, IT Knowledge Gateway, MFO2 Architecture
//*                                    Misc
//*                                        IT Tutorials
//*                              View Button cleanup
//* 01/16/2014  Forrest Bentley  Added Java Source processing to view (fixes pending)
//* 01/17/2014  Forrest Bentley  Added logic to change the filter list title dynamically (Functions, Classes, Modules, Paragraphs)
//*                              Fixed Java View to include all Class Usage (call class.function)
//* 01/19/2014  Forrest Bentley  Added Code Selection Screen & Initial Logic
//* 01/20/2014  Forrest Bentley  Added module breakout logic for Code button
//* 01/21/2014  Forrest Bentley  Added GE Documentation/BPM menu selection
//* 01/23/2014  Forrest Bentley  Added Code modification ability
//*                              Error if trying to create an existing system
//* 01/24/2014  Forrest Bentley  Allow directories with space in name in Directory Window
//*                              Add Extension to Search window
//*                              code Assist
//*                              Added Code Assist preload commands (file processing, windows)
//* 01/26/2014  Forrest Bentley  Added Undo to Code Assist
//*                              Changed Code Assist list boxes to Code, Commands, Variables
//* 01/27/2014  Forrest Bentley  Added Assists *Directory Button
//* 01/28/2014  Forrest Bentley  Added logic to automatically create close code for buttons created
//*                              Added Assist *Directory List
//*                              Added Assist *Clear List
//* 01/29/2014  Forrest Bentley  Added Code Assist IF styles
//* 01/31/2014  Forrest Bentley  Added Assist for B-Edit Batch code menu & initial processing
//* 02/01/2014  Forrest Bentley  Added Assist for B-Edit Batch logic
//* 02/02/2014  Forrest Bentley  Corrected Assist Bug
//*                              Added *Directory List for Bedit Assist
//*                              Corrected missing 1st char of name for View of called .bed file
//*                              Added logic to generate shell for any module created on the Assist window that doesn't exist
//*                              Create variables in the Assist variable list if a new variable is created using add/modify
//* 02/03/2014  Forrest Bentley  Enhanced a1900_add_indent
//*                              Added Code, Refresh, Test, Log, and View buttons to the Code Assist window
//*                              Added Global Variables to Assist Var List
//*                              Update Assist window with Code name above code list
//* 02/04/2014  Forrest Bentley  Added begin/end prints for B-Edit batch programs
//*                              Modified 3090 Download to filter by pattern
//*
//*******************************************************************************************************************

    //***********************************
    //* Work Variables    
    //***********************************
    string  System  = "GECA B-Edit Analysis System"
    string  Version = "v1.2"
    string  Author = "Forrest Bentley"

    string  Ban1 = "GE Capital Americas"
    string  Ban2 = "B-Edit"
    string  Ban3 = "Analysis System"

    string  BannerLine1 = Ban1
    string  BannerLine2 = Ban2
    string  BannerLine3 = Ban3
 
    int     Xpos
    int     Ypos
    int     XposDisplay
    int     YposDisplay
    string  MouseOK
    string  Drag
    string  DragGroupCreate
    int     GroupDragX
    int     GroupDragY
    int     GroupDragCX
    int     GroupDragCY
    int     GroupPosCX
    int     GroupPosCY
    int     GroupObjPosCX
    int     GroupObjPosCY
    int     GroupObjXOffset
    int     GroupObjYOffset
    int     GroupMaxPos

    int     MinX
    int     MaxX
    int     MinY
    int     MaxY

    int     ObjectX
    int     ObjectY
    int     ObjectCX
    int     ObjectCY

    int     WinX
    int     WinY
    int     WinCX
    int     WinCY

    int     ControlSize
    string  SizingWindow

    string  EntryFieldAction
    string  EntryFieldSize

    string  ButtonFocus
    string  FocusSet
    string  WindowTitle
    string  ObjectName

    string  NewSystem
    string  NewObject

    string  Newline
    string  Lastline
    int     LenNewline
    string  ControlType
    string  Text
    string  ControlName
    string  ControlText
    string  HoldControlAction
    string  MacroCommand
    string  SearchString

    string  SystemName = 'NewSys'
    string  WindowName = 'NewWin'
    string  FirstWindowName
    string  SystemWindowName
    string  SystemFileName
    string  SystemNavFilename
    string  GenSystemFilename
    string  EntryactionFilename
    string  MenuFilename
    string  MasterFilename
    string  SystemDesc = "This is a new BEDITWIN system"
    string  SystemTitle = "Generated using @Author@'s @System@ @Version@"

    string  Hwnd
    string  NavAction
    string  HoldAction
    string  ButtonName
    string  ButtonFunction

    string  MenuName
    string  MenuFunction
    
    int     ButtonCount
    int     MenuCount
    int     ViewCount
    int     Level
    int     NewLevel
    int     LevelCount
    int     LevelRowCount

    string  ViewCobol
    string  ViewChange
    int     ViewColWins
    int     ViewRowWins
    int     ViewWinCX
    int     ViewWinCY
    int     ViewWinXStart
    int     ViewWinXSpacing
    int     ViewWinYStart
    int     ViewWinYSpacing
    float   ViewWinCXWork
    float   ViewWinCYWork
    int     ViewCurrX
    int     ViewCurrY
    string  CreateWin
    int     ViewWork
    string  ViewWindowFrom
    string  ViewWindowTo

    string  ViewFromWin 
    int     ViewFromLevel
    int     ViewFromWinX
    int     ViewFromWinY
    int     ViewFromWinCX
    int     ViewFromWinCY

    string  ViewToWin 
    int     ViewToLevel
    int     ViewToWinX
    int     ViewToWinY
    int     ViewToWinCX
    int     ViewToWinCY

    string  ViewHoldWin 
    int     ViewHoldLevel
    int     ViewHoldWinX
    int     ViewHoldWinY
    int     ViewHoldWinCX
    int     ViewHoldWinCY

    int     LineCount
    int     LineX
    int     LineY
    int     LineCX
    int     LineCY
    int     DrawWork
    int     DrawToNextLevel

    string  Directory
    string  Extension

    string  HoldRight
    string  HoldLeft

    string  Userid3090
    string  Password3090
    string  LoginLoc3090
    string  SourceLoc3090
    string  Prodsrcelib3090 = 'g1d800ap.prod.srcelib'
    string  Testsrcelib3090 = 'g1d800at.test.srcelib'
    string  Userfilename3090
    string  Programname3090
    string  COBOL3090
    string  DownloadFrom
    string  DownloadTo
    string  DownloadFilter
    int     DownloadFilterLen

    int     SearchCount
    string  SearchCountStr
    string  SearchLast
    string  SearchAction
    string  SearchNotFound
    string  Dirname

    string  ViewSingleProg
    string  ViewBuilderWindow 

    string  Reenter
   
    string  DirField
    string  FileField

    string  CodeOnly = 'n'

    string  CodeType
    string  BatchUpdating

    string AddIndent
    string ModifyCode = 'n'

    string CodeAssistReenter = 'n'
    string VariableType

    //***********************************
    //* Progress Variables
    //***********************************
    int    Progx            error
    int    Progy            error
    int    Progcx           error
    int    Progcy           error
    float  Progress         error
    float  ProgressShow     error
    int    ProgressCount    error
    int    ProgressMax      error
    float  ProgressWork     error
    int    Progframex       error
    int    Progframey       error
    int    Progframecx      error
    int    Progframecy      error
 
    //***********************************
    //* Special Actions
    //***********************************
 
    string WindowInit                             = "call !a100_WindowInit"
    string WindowWrap                             = "call !a100_WindowWrap"

    string WindowMouse                            = "call !a100_WindowMouse"
    string WindowDown1                            = "call !a100_WindowDown1"
    string WindowDown2                            = "call !a100_WindowDown2"
    string WindowDown3                            = "call !a100_WindowDown3"
    string WindowUp1                              = "call !a100_WindowUp1"
    string WindowUp2                              = "call !a100_WindowUp2"
    string WindowUp3                              = "call !a100_WindowUp3"

    string WindowEscape                           = "call !a050_Escape"

    string DefaultWindowProcess                   = "call !a050_Default_Window_Processing"
 
    //***********************************
    //* Window Menu Actions
    //***********************************
    string Builder_Main_Bedit_MSOBJ               = "call !a110_Builder_Main_Bedit_MSOBJ"
    string Builder_Main_Batch_MSOBJ               = "call !a110_Builder_Main_Batch_MSOBJ"    
    string Builder_Main_Build_MSOBJ               = "call !a110_Builder_Main_Build_MSOBJ"
    string Builder_Main_Import_MSOBJ              = "call !a110_Builder_Main_Import_MSOBJ"
    string Builder_Main_COBOLCall_MSOBJ           = "call !a110_Builder_Main_COBOLCall_MSOBJ"
    string Builder_Main_CodeCheck_MSOBJ           = "call !a110_Builder_Main_CodeCheck_MSOBJ"
    string Builder_Main_3090Check_MSOBJ           = "call !a110_Builder_Main_3090Check_MSOBJ" 
    string Builder_Main_Download_MSOBJ            = "call !a110_Builder_Main_Download_MSOBJ"
    string Builder_Main_Searchdir_MSOBJ           = "call !a110_Builder_Main_Searchdir_MSOBJ"
    string Builder_Main_Exit_MSOBJ                = "call !a110_Builder_Main_Exit_MSOBJ"
    string Builder_Main_About_MSOBJ               = "call !a110_Builder_Main_About_MSOBJ"
    string Builder_Main_ControlManual_MSOBJ       = "call !a110_Builder_Main_ControlManual_MSOBJ"
    string Builder_Main_Overview_MSOBJ            = "call !a110_Builder_Main_Overview_MSOBJ"
    string Builder_Main_Manual_MSOBJ              = "call !a110_Builder_Main_Manual_MSOBJ"
    string Builder_Main_AboutSystem_MSOBJ         = "call !a110_Builder_Main_AboutSystem_MSOBJ"

    string Builder_Main_Eclipse_MSOBJ             = "call !a110_Builder_Main_Eclipse_MSOBJ"
    string Builder_Main_Rumba_MSOBJ               = "call !a110_Builder_Main_Rumba_MSOBJ"
    string Builder_Main_Xampp_MSOBJ               = "call !a110_Builder_Main_Xampp_MSOBJ"
    string Builder_Main_Convert_MSOBJ             = "call !a110_Builder_Main_Convert_MSOBJ"
    string Builder_Main_Calc_MSOBJ                = "call !a110_Builder_Main_Calc_MSOBJ"
    string Builder_Main_Soap_MSOBJ                = "call !a110_Builder_Main_Soap_MSOBJ"
    string Builder_Main_Toad_MSOBJ                = "call !a110_Builder_Main_Toad_MSOBJ"
    string Builder_Main_Fiddler_MSOBJ             = "call !a110_Builder_Main_Fiddler_MSOBJ"
    string Builder_Main_Magnify_MSOBJ             = "call !a110_Builder_Main_Magnify_MSOBJ"
    string Builder_Main_Notepad_MSOBJ             = "call !a110_Builder_Main_Notepad_MSOBJ"
    string Builder_Main_Paint_MSOBJ               = "call !a110_Builder_Main_Paint_MSOBJ"
    string Builder_Main_Search_MSOBJ              = "call !a110_Builder_Main_Search_MSOBJ"
    string Builder_Main_Directory_MSOBJ           = "call !a110_Builder_Main_Directory_MSOBJ"
    string Builder_Main_Dos_MSOBJ                 = "call !a110_Builder_Main_Dos_MSOBJ"
    string Builder_Main_Taskmanager_MSOBJ         = "call !a110_Builder_Main_Taskmanager_MSOBJ"
    string Builder_Main_Performance_MSOBJ         = "call !a110_Builder_Main_Performance_MSOBJ"

    string Builder_Main_BPM_MSOBJ                 = "call !a110_Builder_Main_BPM_MSOBJ"

    string Builder_Main_Bachmannet_MSOBJ          = "call !a110_Builder_Main_Bachmannet_MSOBJ"
    string Builder_Main_Bachman_MSOBJ             = "call !a110_Builder_Main_Bachman_MSOBJ"
    string Builder_Main_Gateway_MSOBJ             = "call !a110_Builder_Main_Gateway_MSOBJ"
    string Builder_Main_MFO2_MSOBJ                = "call !a110_Builder_Main_MFO2_MSOBJ"
    
    string Builder_Main_Banneron_MSOBJ            = "call !a110_Builder_Main_Banneron_MSOBJ"
    string Builder_Main_Banneroff_MSOBJ           = "call !a110_Builder_Main_Banneroff_MSOBJ"
    string Builder_Main_FutureTimeline_MSOBJ      = "call !a110_Builder_Main_FutureTimeline_MSOBJ"
    string Builder_Main_ExplainingFuture_MSOBJ    = "call !a110_Builder_Main_ExplainingFuture_MSOBJ"
    string Builder_Main_Tutorials_MSOBJ           = "call !a110_Builder_Main_Tutorials_MSOBJ"
    string Builder_Main_Pacman_MSOBJ              = "call !a110_Builder_Main_Pacman_MSOBJ"
    string Builder_Main_Life_MSOBJ                = "call !a110_Builder_Main_Life_MSOBJ"
 
    //***********************************
    //* Window Button Actions
    //***********************************
    string Builder_System_Create_PBOBJ            = "call !a200_Builder_System_Create_PBOBJ"
    string Builder_System_Modify_PBOBJ            = "call !a200_Builder_System_Modify_PBOBJ"    
    string Builder_System_Cancel_PBOBJ            = "call !a200_Builder_System_Cancel_PBOBJ"

    string Builder_Window_Create_PBOBJ            = "call !a300_Builder_Window_Create_PBOBJ"
    string Builder_Window_Modify_PBOBJ            = "call !a300_Builder_Window_Modify_PBOBJ"
    string Builder_Window_Save_PBOBJ              = "call !a300_Builder_Window_Save_PBOBJ"
    string Builder_Window_Test_PBOBJ              = "call !a300_Builder_Window_Test_PBOBJ"
    string Builder_Window_View_PBOBJ              = "call !a300_Builder_Window_View_PBOBJ"
    string Builder_Window_Cancel_PBOBJ            = "call !a300_Builder_Window_Cancel_PBOBJ"
    string Builder_Window_Code_PBOBJ              = "call !a300_Builder_Window_Code_PBOBJ"

    string Builder_Control_WinSize_PBOBJ          = "call !a400_Builder_Control_WinSize_PBOBJ"
    string Builder_Control_Focus_PBOBJ            = "call !a400_Builder_Control_Focus_PBOBJ"
    string Builder_Control_Modify_PBOBJ           = "call !a400_Builder_Control_Modify_PBOBJ"
    string Builder_Control_Delete_PBOBJ           = "call !a400_Builder_Control_Delete_PBOBJ"
    string Builder_Control_Create_PBOBJ           = "call !a400_Builder_Control_Create_PBOBJ"
    string Builder_Control_Align_PBOBJ            = "call !a400_Builder_Control_Align_PBOBJ"
    string Builder_Control_Buttonaction_PBOBJ     = "call !a400_Builder_Control_Buttonaction_PBOBJ"
    string Builder_Control_Entryaction_PBOBJ      = "call !a400_Builder_Control_Entryaction_PBOBJ"

    string Builder_Control_SizeXPlus_PBOBJ        = "call !a400_Builder_Control_SizeXPlus_PBOBJ"
    string Builder_Control_SizeXMinus_PBOBJ       = "call !a400_Builder_Control_SizeXMinus_PBOBJ"
    string Builder_Control_SizeYPlus_PBOBJ        = "call !a400_Builder_Control_SizeYPlus_PBOBJ"
    string Builder_Control_SizeYMinus_PBOBJ       = "call !a400_Builder_Control_SizeYMinus_PBOBJ"

    string Builder_Control_Refresh_PBOBJ          = "call !a400_Builder_Control_Refresh_PBOBJ"
    string Builder_Control_Code_PBOBJ             = "call !a400_Builder_Control_Code_PBOBJ"
    string Builder_Control_Save_PBOBJ             = "call !a400_Builder_Control_Save_PBOBJ"
    string Builder_Control_Cancel_PBOBJ           = "call !a400_Builder_Control_Cancel_PBOBJ"

    string Builder_Nav_Ok_PBOBJ                   = "call !a500_Builder_Nav_Ok_PBOBJ"
    string Builder_Nav_Cancel_PBOBJ               = "call !a500_Builder_Nav_Cancel_PBOBJ"

    string Builder_View_Open_PBOBJ                = "call !a500_Builder_View_Open_PBOBJ"
    string Builder_View_Comments_PBOBJ            = "call !a500_Builder_View_Comments_PBOBJ"
    string Builder_View_Filter_PBOBJ              = "call !a500_Builder_View_Filter_PBOBJ"
    string Builder_View_Cancel_PBOBJ              = "call !a500_Builder_View_Cancel_PBOBJ"

    string Builder_Filter_OK_PBOBJ                = "call !a550_Builder_Filter_OK_PBOBJ"
    string Builder_Filter_Comments_PBOBJ          = "call !a550_Builder_Filter_Comments_PBOBJ"
    string Builder_Filter_View_PBOBJ              = "call !a550_Builder_Filter_View_PBOBJ"
    string Builder_Filter_Cancel_PBOBJ            = "call !a550_Builder_Filter_Cancel_PBOBJ"
    string Builder_Filter_Windowlist_LBOBJ        = "call !a550_Builder_Filter_Windowlist_LBOBJ"
    window action Builder_Filter_Windowlist_LBOBJ

    string Builder_Comments_Ok_PBOBJ              = "call !a560_Builder_Comments_OK_PBOBJ"

    string Builder_Import_Lookup_PBOBJ            = "call !a600_Builder_Import_Lookup_PBOBJ"
    string Builder_Import_3090_PBOBJ              = "call !a600_Builder_Import_3090_PBOBJ"
    string Builder_Import_Ok_PBOBJ                = "call !a600_Builder_Import_OK_PBOBJ"
    string Builder_Import_Copydir_PBOBJ           = "call !a600_Builder_Import_Copydir_PBOBJ"
    string Builder_Import_Cancel_PBOBJ            = "call !a600_Builder_Import_Cancel_PBOBJ"
    string Builder_Import_Browse_PBOBJ            = "call !a600_Builder_Import_Browse_PBOBJ"

    string Builder_3090_Ok_PBOBJ                  = "call !a650_Builder_3090_Ok_PBOBJ"
    string Builder_3090_Cancel_PBOBJ              = "call !a650_Builder_3090_Cancel_PBOBJ"

    string Builder_Entryaction_Set_PBOBJ          = "call !a700_Builder_Entryaction_Set_PBOBJ"
    string Builder_Entryaction_Delete_PBOBJ       = "call !a700_Builder_Entryaction_Delete_PBOBJ"
    string Builder_Entryaction_Cancel_PBOBJ       = "call !a700_Builder_Entryaction_Cancel_PBOBJ"

    string Builder_Callflow_Directory_PBOBJ       = "call !a800_Builder_Callflow_Directory_PBOBJ"
    string Builder_Callflow_Ok_PBOBJ              = "call !a800_Builder_Callflow_Ok_PBOBJ"
    string Builder_Callflow_Cancel_PBOBJ          = "call !a800_Builder_Callflow_Cancel_PBOBJ"

    string Builder_Progress_Cancel_PBOBJ          = "call !a900_Builder_Progress_Cancel_PBOBJ"

    string Builder_Download3090_Ok_PBOBJ          = "call !a1000_Builder_Download3090_Ok_PBOBJ"
    string Builder_Download3090_Cancel_PBOBJ      = "call !a1000_Builder_Download3090_Cancel_PBOBJ"
    string Builder_Download3090_Todir_PBOBJ       = "call !a1000_Builder_Download3090_Todir_PBOBJ"

    string Builder_Align_Top_PBOBJ                = "call !a1100_Builder_Align_Top_PBOBJ"
    string Builder_Align_Bottom_PBOBJ             = "call !a1100_Builder_Align_Bottom_PBOBJ"
    string Builder_Align_Midhoriz_PBOBJ           = "call !a1100_Builder_Align_Midhoriz_PBOBJ"
    string Builder_Align_Midvert_PBOBJ            = "call !a1100_Builder_Align_Midvert_PBOBJ"
    string Builder_Align_Left_PBOBJ               = "call !a1100_Builder_Align_Left_PBOBJ"
    string Builder_Align_Right_PBOBJ              = "call !a1100_Builder_Align_Right_PBOBJ"
    string Builder_Align_Cancel_PBOBJ             = "call !a1100_Builder_Align_Cancel_PBOBJ"

    string Builder_Search_And_PBOBJ               = "call !a1200_Builder_Search_And_PBOBJ"
    string Builder_Search_Or_PBOBJ                = "call !a1200_Builder_Search_Or_PBOBJ"
    string Builder_Search_Remove_PBOBJ            = "call !a1200_Builder_Search_Remove_PBOBJ"
    string Builder_Search_Clear_PBOBJ             = "call !a1200_Builder_Search_Clear_PBOBJ"
    string Builder_Search_Search_PBOBJ            = "call !a1200_Builder_Search_Search_PBOBJ"
    string Builder_Search_Help_PBOBJ              = "call !a1200_Builder_Search_Help_PBOBJ"
    string Builder_Search_Cancel_PBOBJ            = "call !a1200_Builder_Search_Cancel_PBOBJ"
    string Builder_Search_Directory_PBOBJ         = "call !a1200_Builder_Search_Directory_PBOBJ"

    string Builder_Searchresults_Open_PBOBJ       = "call !a1300_Builder_Searchresults_Open_PBOBJ"
    string Builder_Searchresults_Cancel_PBOBJ     = "call !a1300_Builder_Searchresults_Cancel_PBOBJ"
    string Builder_Searchresults_Results_LBOBJ    = "call !a1300_Builder_Searchresults_Open_PBOBJ"
    window action Builder_Searchresults_Results_LBOBJ

    string Builder_Help_Ok_PBOBJ                  = "call !a1400_Builder_Help_Ok_PBOBJ"
    string Builder_About_Ok_PBOBJ                 = "call !a1500_Builder_About_Ok_PBOBJ"

    string Builder_Browse_Refresh_PBOBJ           = "call !a1600_Builder_Browse_Refresh_PBOBJ"
    string Builder_Browse_Back_PBOBJ              = "call !a1600_Builder_Browse_Back_PBOBJ"
    string Builder_Browse_Ok_PBOBJ                = "call !a1600_Builder_Browse_Ok_PBOBJ"
    string Builder_Browse_Cancel_PBOBJ            = "call !a1600_Builder_Browse_Cancel_PBOBJ"
    string Builder_Browse_Newdir_PBOBJ            = "call !a1600_Builder_Browse_Newdir_PBOBJ"
    string Builder_Browse_Open_PBOBJ              = "call !a1600_Builder_Browse_Open_PBOBJ"
    string Builder_Browse_Subdir_LBOBJ            = "call !a1600_Builder_Browse_Subdir_LBOBJ"
    window action Builder_Browse_Subdir_LBOBJ
    string Builder_Browse_Files_LBOBJ             = "call !a1600_Builder_Browse_Files_LBOBJ"
    window action Builder_Browse_Files_LBOBJ

    string Builder_Newdir_Ok_PBOBJ                = "call !a1650_Builder_Newdir_Ok_PBOBJ"
    string Builder_Newdir_Cancel_PBOBJ            = "call !a1650_Builder_Newdir_Cancel_PBOBJ"

    string Builder_Codecheck_Directory_PBOBJ      = "call !a1700_Builder_Codecheck_Directory_PBOBJ"
    string Builder_Codecheck_Ok_PBOBJ             = "call !a1700_Builder_Codecheck_Ok_PBOBJ"
    string Builder_Codecheck_Cancel_PBOBJ         = "call !a1700_Builder_Codecheck_Cancel_PBOBJ"
    string Builder_Codecheck_System_LBOBJ         = "call !a1700_Builder_Codecheck_System_LBOBJ"    
    window action Builder_Codecheck_System_LBOBJ

    string Builder_Code_Ok_PBOBJ                  = "call !a1800_Builder_Code_Ok_PBOBJ"
    string Builder_Code_Cancel_PBOBJ              = "call !a1800_Builder_Code_Cancel_PBOBJ"
    string Builder_Code_Assist_PBOBJ              = "call !a1800_Builder_Code_Assist_PBOBJ"  
    string Builder_Code_Refresh_PBOBJ             = "call !a1800_Builder_Code_Refresh_PBOBJ"
    string Builder_Code_Test_PBOBJ                = "call !a1800_Builder_Code_Test_PBOBJ"   
    string Builder_Code_View_PBOBJ                = "call !a1800_Builder_Code_View_PBOBJ"         
    string Builder_Code_Codemodules_LBOBJ         = "call !a1800_Builder_Code_Codemodules_LBOBJ"
    window action Builder_Code_Codemodules_LBOBJ

    string Builder_Codeassist_Ok_PBOBJ            = "call !a1900_Builder_Codeassist_Ok_PBOBJ"
    string Builder_Codeassist_Cancel_PBOBJ        = "call !a1900_Builder_Codeassist_Cancel_PBOBJ"
    string Builder_Codeassist_Up_PBOBJ            = "call !a1900_Builder_Codeassist_Up_PBOBJ"
    string Builder_Codeassist_Down_PBOBJ          = "call !a1900_Builder_Codeassist_Down_PBOBJ"
    string Builder_Codeassist_Right_PBOBJ         = "call !a1900_Builder_Codeassist_Right_PBOBJ"
    string Builder_Codeassist_Left_PBOBJ          = "call !a1900_Builder_Codeassist_Left_PBOBJ"
    string Builder_Codeassist_Delete_PBOBJ        = "call !a1900_Builder_Codeassist_Delete_PBOBJ"
    string Builder_Codeassist_Add_PBOBJ           = "call !a1900_Builder_Codeassist_Add_PBOBJ"
    string Builder_Codeassist_Modify_PBOBJ        = "call !a1900_Builder_Codeassist_Modify_PBOBJ"
    string Builder_Codeassist_Undo_PBOBJ          = "call !a1900_Builder_Codeassist_Undo_PBOBJ"
    string Builder_Codeassist_Code_PBOBJ          = "call !a1900_Builder_Codeassist_Code_PBOBJ"
    string Builder_Codeassist_Refresh_PBOBJ       = "call !a1900_Builder_Codeassist_Refresh_PBOBJ"
    string Builder_Codeassist_Test_PBOBJ          = "call !a1900_Builder_Codeassist_Test_PBOBJ"
    string Builder_Codeassist_Log_PBOBJ           = "call !a1900_Builder_Codeassist_Log_PBOBJ"
    string Builder_Codeassist_View_PBOBJ          = "call !a1900_Builder_Codeassist_View_PBOBJ"
    string Builder_Codeassist_Code_LBOBJ          = "call !a1900_Builder_Codeassist_Code_LBOBJ"
    window action Builder_Codeassist_Code_LBOBJ
    string Builder_Codeassist_Variables_LBOBJ     = "call !a1900_Builder_Codeassist_Variables_LBOBJ"
    window action Builder_Codeassist_Variables_LBOBJ
    string Builder_Codeassist_Commands_LBOBJ      = "call !a1900_Builder_Codeassist_Commands_LBOBJ"
    window action Builder_Codeassist_Commands_LBOBJ

    //***********************************
    //* Field Edits
    //***********************************
    string Builder_3090_Userid_EFOBJ             = "call !z999_entry_action_return"
    window action Builder_3090_Userid_EFOBJ
    window edit Builder_3090_Userid_EFOBJ upper 8

    string Builder_3090_Password_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Password_EFOBJ
    window edit Builder_3090_Password_EFOBJ upper 8

    string Builder_3090_Filename_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Filename_EFOBJ
    window edit Builder_3090_Filename_EFOBJ upper 8

    string Builder_3090_Fullname_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_3090_Fullname_EFOBJ
    window edit Builder_3090_Fullname_EFOBJ upper 50

    string Builder_Download3090_Userid_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Userid_EFOBJ
    window edit Builder_Download3090_Userid_EFOBJ upper 8

    string Builder_Download3090_Password_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Password_EFOBJ
    window edit Builder_Download3090_Password_EFOBJ upper 8

    string Builder_Download3090_From_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_From_EFOBJ
    window edit Builder_Download3090_From_EFOBJ upper 60

    string Builder_Download3090_To_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_To_EFOBJ
    window edit Builder_Download3090_To_EFOBJ lower 60

    string Builder_Download3090_Filter_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Filter_EFOBJ
    window edit Builder_Download3090_Filter_EFOBJ upper 8

    string Builder_Download3090_Extension_EFOBJ           = "call !z999_entry_action_return"
    window action Builder_Download3090_Extension_EFOBJ
    window edit Builder_Download3090_Extension_EFOBJ lower 3
 
//*********************************************************************
//* Main Processing
//*********************************************************************
    open WindowFile Builder.win
    open MenuFile Builder.mnu

    //*************************
    //* Main Window Loop      *
    //*************************
    //trace=log
    window start noclose 
    print:"Processing Complete.
    exit
 
//*********************************************************************
//* Special Actions
//*********************************************************************
!a050_Escape
    window deletecontrol GroupRectangle error
    DragGroupCreate = 'n'
    ButtonFocus = null
    window disable Builder_Control_Align_PBOBJ
    return

//******************************************
//* Default Window Processing
//******************************************
!a050_Default_Window_Processing
    window getfocus ButtonFocus
    //message = "Default window processing for @ButtonFocus@" window message info ok
    window getfocus ButtonFocus
    Builder_Control_Control_EFOBJ = ButtonFocus
    FocusSet = 'y'
    window modify Builder_Control_Control_EFOBJ
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ

    call !a400_Builder_Control_Focus_Controls_set
    return

//******************************************
//* Main Window Initialization Routine     *
//******************************************
!a100_WindowInit
    return
 
//******************************************
//* Main Window Wrapup Routine             *
//******************************************
!a100_WindowWrap
    return
 
//******************************************
//* Mouse Button 1 Down                    *
//******************************************
!a100_WindowDown1
    if  (!MouseOK) return
    Drag = 'y'
    return

//******************************************
//* Mouse Button 1 Up                      *
//******************************************
!a100_WindowUp1
    if  (!MouseOK) return
    Drag = 'n'
    return

//******************************************
//* Mouse Button 2 Down                    *
//******************************************
!a100_WindowDown2
    if  (!MouseOK) return
    Drag = 'y'
    return

//******************************************
//* Mouse Button 2 Up                      *
//******************************************
!a100_WindowUp2
    if  (!MouseOK) return
    Drag = 'y'
    ButtonFocus = 'GroupRectangle'
    return

//******************************************
//* Mouse Button 3 Down                    *
//******************************************
!a100_WindowDown3
    if  (!MouseOK) return
    FocusSet = 'n'
    DragGroupCreate = 'y'
    window deletecontrol GroupRectangle error
    Text = null
    GroupDragX = Xpos
    GroupDragY = Ypos
    GroupDragCX = 2
    GroupDragCY = 2
    window createcontrol Builder_Control_WIN GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY STTXTR @Text
    return

//******************************************
//* Mouse Button 3 Up                      *
//******************************************
!a100_WindowUp3
    if  (!MouseOK) return
    DragGroupCreate = 'n'
    //Drag = 'y'
    ButtonFocus = 'GroupRectangle'
    FocusSet = 'n'

    //***********************************
    //* Find the Controls in the Group
    //***********************************
    GroupPosCX = GroupDragX + GroupDragCX
    GroupPosCY = GroupDragY + GroupDragCY

    close GroupControls error
    open GroupControls null
    file Controls
    b
    do
        if (eof) goto !a100_WindowUp3_done
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY        
        GroupObjPosCX = ObjectX + ObjectCX
        GroupObjPosCY = ObjectY + ObjectCY
        if  (ObjectX >= GroupDragX) and (ObjectY >= GroupDragY) and (GroupObjPosCX <= GroupPosCX) and (GroupObjPosCY <= GroupPosCY)
+           file GroupControls
+           call !a100_WindowUp3_Offset
+           Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
+           i:/@Newline@/
+       endif
        file Controls
        f;1
    until (eof)
    write GroupControls GroupControls.dat
    window enable Builder_Control_Align_PBOBJ

!a100_WindowUp3_done
    return

//********************************
//* Calculate the Object's Offset
//********************************
!a100_WindowUp3_Offset
    GroupObjXOffset = ObjectX - GroupDragX
    if (GroupObjXOffset < 1)
+      GroupObjXOffset = 1
+   endif
    GroupObjYOffset = ObjectY - GroupDragY
    if (GroupObjYOffset < 1)
+      GroupObjYOffset = 1
+   endif
    return

//******************************************
//* Mouse Movement                         *
//******************************************
!a100_WindowMouse
    if  (!MouseOK) return
    window mousepos Xpos Ypos

    if  (Xpos < MinX) or (Xpos > MaxX) or (Ypos < MinY) or (Ypos > MaxY) return

    Xpos ++
    Ypos ++

    XposDisplay = Xpos - MinX
    YposDisplay = Ypos - MinY

    Builder_Control_Xpos_STTXT = XposDisplay
    window modify Builder_Control_Xpos_STTXT
    Builder_Control_Ypos_STTXT = YposDisplay
    window modify Builder_Control_Ypos_STTXT

    //*********************************************
    //* Update the Height/Length of Focus Window
    //*********************************************    
    if  (FocusSet)
+       window obtain @Builder_Control_Control_EFOBJ
+       ButtonFocus = Builder_Control_Control_EFOBJ
+       window exists @ButtonFocus
+       if (status)
+          window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+          Builder_Control_Length_EFOBJ = ObjectCX
+          window modify Builder_Control_Length_EFOBJ
+          Builder_Control_Height_EFOBJ = ObjectCY
+          window modify Builder_Control_Height_EFOBJ
+          ObjectX = ObjectX - MinX
+          Builder_Control_X_EFOBJ = ObjectX
+          window modify Builder_Control_X_EFOBJ
+          ObjectY = ObjectY - MinY
+          Builder_Control_Y_EFOBJ = ObjectY
+          window modify Builder_Control_Y_EFOBJ
+   endif

    //******************************************
    //* Restrict Control Scrolling Beyond Window
    //******************************************
    if  (FocusSet) and (status) and (Drag)
+       //*** Right
+       WinX = Xpos + ObjectCX 
+       if  (WinX > MaxX)
+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+           ObjectX = MaxX - ObjectCX - 5 
+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+           ObjectX -= MinX
+           Builder_Control_X_EFOBJ = ObjectX
+           window modify Builder_Control_X_EFOBJ
+           return
+   endif
    //***
    if  (FocusSet) and (status) and (Drag)
+       //*** Down
+       WinY = Ypos + ObjectCY
+       if  (WinY > MaxY)
+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+           ObjectY = MaxY - ObjectCY - 5
+           window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+           ObjectY -= MinY
+           Builder_Control_Y_EFOBJ = ObjectY
+           window modify Builder_Control_Y_EFOBJ
+           return
+   endif

    if (!DragGroupCreate)
+      goto !a100_WindowMouse_Drag
+   endif
    //**********************************
    //* Size the Group Drag Rectangle
    //**********************************
    GroupDragCX = Xpos - GroupDragX
    GroupDragCY = Ypos - GroupDragY
    if (GroupDragCX < 2)
+        GroupDragCX = 2
+   endif
    if (GroupDragCY < 2)
+        GroupDragCY = 2
+   endif
    window size GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY
    //***********************
    //* Repaint Controls
    //***********************
    file Controls
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          MacroCommand = 'window paint @left@'
+          $MacroCommand
+       endif
        f;1
    until (eof)
    //window paint GroupRectangle
    return

!a100_WindowMouse_Drag
    if  (!Drag) return
    if (ButtonFocus = 'GroupRectangle')
+      goto !a100_WindowMouse_Drag_Group
+   endif

    window getfocus @ButtonFocus
    if (FocusSet)
+      window obtain @Builder_Control_Control_EFOBJ
+      ButtonFocus = Builder_Control_Control_EFOBJ
+   endif
    //*********************************************
    //* Don't drag control Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) 
+      return
+   endif

    window exists @ButtonFocus
    if (!status) return

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window size @ButtonFocus @Xpos @Ypos @ObjectCX @ObjectCY

    call !b400_repaint_control

    return

//******************************
//* Move the Group
//******************************
!a100_WindowMouse_Drag_Group
    GroupDragX = Xpos
    GroupDragY = Ypos

    //******************************************
    //* Restrict Control Scrolling Beyond Window
    //******************************************
    WinX = Xpos + GroupDragCX 
    if  (WinX > MaxX)
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+       GroupDragX = MaxX - GroupDragCX - 5 
+       GroupDragX -= MinX
+       return
+   endif

    //*** Down
    WinY = Ypos + GroupDragCY
    if  (WinY > MaxY)
+       window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
+       GroupDragY = MaxY - GroupDragCY - 5
+       GroupDragY -= MinY
+       return
+   endif

    //***********************
    //* Move Objects in Rect
    //***********************
    file GroupControls
    b
    do
        if (eof)
+          goto !a100_WindowMouse_Drag_Group_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        GroupObjXOffset = left
        GroupObjYOffset = right
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        ObjectX = GroupDragX + GroupObjXOffset
        ObjectY = GroupDragY + GroupObjYOffset
        window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
        file GroupControls
        f;1
    until (eof)

!a100_WindowMouse_Drag_Group_Done
    window size GroupRectangle @GroupDragX @GroupDragY @GroupDragCX @GroupDragCY
    window paint GroupRectangle
    //***********************
    //* Repaint Controls
    //***********************
    file Controls
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          MacroCommand = 'window paint @left@'
+          $MacroCommand
+       endif
        f;1
    until (eof)
    return
 
//*********************************************************************
//* Main Menu Actions
//*********************************************************************

//******************************
//* Start Bedit Interactive
//******************************
!a110_Builder_Main_Bedit_MSOBJ
    system:"start bedit"
    return

//******************************
//* Open the System Window for Bedit
//******************************
!a110_Builder_Main_Batch_MSOBJ
    CodeType = "bedit"
    window pointer wait
    window open Builder_System_WIN shade
    window center Builder_System_WIN
    window clear Builder_System_WIN
    Builder_System_WIN = 'Builder System - B-Edit Batch'
    window title Builder_System_WIN

    Builder_System_Systemname_STTXT = 'Program'
    window modify Builder_System_Systemname_STTXT
    Builder_System_Title_STTXT = 'Author'
    window modify Builder_System_Title_STTXT

    MacroCommand = "dir *.bed"
    close SystemList error
    open SystemList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b
!a110_dirlist_batch_loop
    if (eof) goto !a110_dirlist_batch_done
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    Newline = right
    lower Newline
    scanr:/@Newline/:/.bed/
    Builder_System_SystemList_COOBJ = left
    mix Builder_System_SystemList_COOBJ
    if (Builder_System_SystemList_COOBJ != 'Builder')
+       window insert end default Builder_System_SystemList_COOBJ
+   endif
    r:/@left@/
    f;1
    goto !a110_dirlist_batch_loop
!a110_dirlist_batch_done
    window unshade Builder_System_WIN
    window pointer arrow
    return

//******************************
//* Open the System Window for Windows
//******************************
!a110_Builder_Main_Build_MSOBJ
    CodeType = "beditwin"
    window pointer wait
    window open Builder_System_WIN shade
    window center Builder_System_WIN
    window clear Builder_System_WIN

    Builder_System_WIN = 'Builder System - B-Edit Windows'
    window title Builder_System_WIN

    Builder_System_Systemname_STTXT = 'System'
    window modify Builder_System_Systemname_STTXT
    Builder_System_Title_STTXT = 'Title'
    window modify Builder_System_Title_STTXT

    MacroCommand = "dir *.win"
    close SystemList error
    open SystemList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b
!a110_dirlist_loop
    if (eof) goto !a110_dirlist_done
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    Newline = right
    lower Newline
    scanr:/@Newline/:/.win/
    Builder_System_SystemList_COOBJ = left
    mix Builder_System_SystemList_COOBJ
    if (Builder_System_SystemList_COOBJ != 'Builder')
+       window insert end default Builder_System_SystemList_COOBJ
+   endif
    r:/@left@/
    f;1
    goto !a110_dirlist_loop
!a110_dirlist_done
    window unshade Builder_System_WIN
    window pointer arrow
    return

//******************************
//* Open the COBOL import screen
//******************************
!a110_Builder_Main_Import_MSOBJ
    window pointer wait
    window open Builder_Import_WIN shade
    window center Builder_Import_WIN
    window clear Builder_Import_WIN

    Builder_Import_Directory_EFOBJ = Directory
    window modify Builder_Import_Directory_EFOBJ
    Builder_Import_Extension_EFOBJ = Extension
    window modify Builder_Import_Extension_EFOBJ

    Builder_Import_Viewmods_RBOBJ = 'Y'
    window modify Builder_Import_Viewmods_RBOBJ
    Builder_Import_Viewfiles_RBOBJ = 'N'
    window modify Builder_Import_Viewfiles_RBOBJ
    Builder_Import_Viewvars_RBOBJ = 'N'
    window modify Builder_Import_Viewvars_RBOBJ

    if  (Builder_Import_Extension_EFOBJ = 'COB') or (Builder_Import_Extension_EFOBJ = 'BED') or (Builder_Import_Extension_EFOBJ = 'C') or (Builder_Import_Extension_EFOBJ = 'JAVA')
+       call !a600_Builder_Import_Lookup_PBOBJ
+   endif

    window unshade Builder_Import_WIN
    window pointer arrow
    close ViewList error
    return

//******************************
//* Open the COBOL Call screen
//******************************
!a110_Builder_Main_COBOLCall_MSOBJ
    window pointer wait
    window open Builder_Callflow_WIN shade
    window center Builder_Callflow_WIN
    window clear Builder_Callflow_WIN
    Builder_Callflow_Directory_EFOBJ = Directory
    window modify Builder_Callflow_Directory_EFOBJ
    window setfocus Builder_Callflow_Directory_EFOBJ
    window unshade Builder_Callflow_WIN
    window pointer arrow
    return

//******************************
//* Open the 3090 Download Screen
//******************************
!a110_Builder_Main_Download_MSOBJ
    window pointer wait
    window conceal Builder_Download3090_Password_EFOBJ
    window open Builder_Download3090_WIN shade
    window center Builder_Download3090_WIN
    window clear Builder_Download3090_WIN
    //***********************************
    //* Initialize the fields
    //***********************************
    if  (Userid3090 != null)
+       Builder_Download3090_Userid_EFOBJ = Userid3090
+       window modify Builder_Download3090_Userid_EFOBJ
+   endif
    if  (Password3090 != null)
+       Builder_Download3090_Password_EFOBJ = Password3090
+       window modify Builder_Download3090_Password_EFOBJ
+   endif
    if  (Userid3090 != null) and (Password3090 != null)
+       window setfocus Builder_Download3090_From_EFOBJ
+   endif

    if  (Userid3090 = null) 
+       window setfocus Builder_Download3090_Userid_EFOBJ
+   else
+       if  (Password3090 = null)
+           window setfocus Builder_Download3090_Password_EFOBJ
+   endif
    if  (Userid3090 != null) and (Password3090 != null)
+       window setfocus Builder_Download3090_From_EFOBJ
+   endif

    if (LoginLoc3090 = 'test')
+      Builder_Download3090_Test_RBOBJ = 'Y'
+      Builder_Download3090_Prod_RBOBJ = 'N'
+   else
+      Builder_Download3090_Test_RBOBJ = 'N'
+      Builder_Download3090_Prod_RBOBJ = 'Y'
+   endif
    window modify Builder_Download3090_Prod_RBOBJ
    window modify Builder_Download3090_Test_RBOBJ

    Builder_Download3090_From_EFOBJ = DownloadFrom
    window modify Builder_Download3090_From_EFOBJ
    Builder_Download3090_To_EFOBJ = DownloadTo
    window modify Builder_Download3090_To_EFOBJ
    Builder_Download3090_Filter_EFOBJ = DownloadFilter
    window modify Builder_Download3090_Filter_EFOBJ
    Builder_Download3090_Extension_EFOBJ = Extension
    window modify Builder_Download3090_Extension_EFOBJ

    Builder_Download3090_To_EFOBJ = Directory
    window modify Builder_Download3090_To_EFOBJ

    window unshade Builder_Download3090_WIN
    window pointer arrow
    return

//******************************
//* Search files for String
//******************************
!a110_Builder_Main_Searchdir_MSOBJ
    string SearchDir error
    window pointer wait
    window open Builder_Search_WIN shade
    window center Builder_Search_WIN
    window clear Builder_Search_WIN
    window setfocus Builder_Search_Directory_EFOBJ
    window unshade Builder_Search_WIN

    close SearchList error
    open SearchList null
    SearchLast = 'OR'

    Builder_Search_Directory_EFOBJ = Directory
    window modify Builder_Search_Directory_EFOBJ
    if (Directory != null)
+      window setfocus Builder_Search_String_EFOBJ
+   endif
    Builder_Search_Extension_EFOBJ = Extension
    window modify Builder_Search_Extension_EFOBJ

    window enable Builder_Search_And_PBOBJ
    window enable Builder_Search_Or_PBOBJ

    window pointer arrow
    return

//******************************
//* Integrate with Code Checker
//******************************
!a110_Builder_Main_CodeCheck_MSOBJ
    window pointer wait
    window open Builder_Codecheck_WIN shade
    window center Builder_Codecheck_WIN
    window clear Builder_Codecheck_WIN

    //******************************
    //* Load the System Combo Box
    //******************************
    Builder_Codecheck_System_LBOBJ = 'All'
    window delete Builder_Codecheck_System_LBOBJ
    open Appnames appnames.txt error goto !a110_Builder_Main_CodeCheck_noappnames
    b
    do
       if (!eof)
+         split:/@line/;4
+         Builder_Codecheck_System_LBOBJ = right
+         pack Builder_Codecheck_System_LBOBJ
+         window insert end default Builder_Codecheck_System_LBOBJ
+         f;1
+      endif
    until (eof)
    close Appnames

    Builder_Codecheck_Directory_EFOBJ = Directory
    window modify Builder_Codecheck_Directory_EFOBJ

!a110_Builder_Main_CodeCheck_noappnames
    window setfocus Builder_Codecheck_System_EFOBJ
    window unshade Builder_Codecheck_WIN
    window pointer arrow
    return

//******************************
//* Integrate with Code Checker
//******************************
!a110_Builder_Main_3090Check_MSOBJ
    DirField = "Chk3090.dir"
    FileField = null
    call !s100_directory
    return

//******************************
//* Exit the System?
//******************************
!a110_Builder_Main_Exit_MSOBJ
    message = "Exit Verification, Are You Sure?"
    window message question yesno
    if  (message)
+       window stop
+   endif
    return

//******************************
//* Display About
//****************************** 
!a110_Builder_Main_About_MSOBJ
    window pointer wait
    window open Builder_About_WIN shade
    window center Builder_About_WIN
    window clear Builder_About_WIN

    Builder_About_System_EFOBJ = System
    window modify Builder_About_System_EFOBJ
    Builder_About_Version_EFOBJ = Version
    window modify Builder_About_Version_EFOBJ
    Builder_About_Author_EFOBJ = Author
    window modify Builder_About_Author_EFOBJ
    Builder_About_Desc_MLOBJ = |GE Capital Americas B-Edit Analysis System assists with B-Edit code development and provides analysis tools such as code standards checking, and visual program flow display. B-Edit is a language designed for manipulating text files using strong string functions (see B-Edit User's Guide/Language Reference). For questions contact @Author@.|
    window modify Builder_About_Desc_MLOBJ

    window disable Builder_About_Desc_MLOBJ

    window unshade Builder_About_WIN
    window pointer arrow
    return

//******************************
//* B-Edit Control User's Guide
//******************************
!a110_Builder_Main_ControlManual_MSOBJ
    system:"start builderguide.bat"
    return

//******************************
//* About System
//****************************** 
!a110_Builder_Main_Manual_MSOBJ
    system:"start beditguide.bat"
    return

//******************************
//* Bedit Overview
//****************************** 
!a110_Builder_Main_Overview_MSOBJ
    system:"start c:\bedit\bedit-overview.ppsx"
    return

//******************************
//* About System
//****************************** 
!a110_Builder_Main_AboutSystem_MSOBJ
    system:"start msinfo32.exe"
    return

//******************************
//* Eclipse
//****************************** 
!a110_Builder_Main_Eclipse_MSOBJ
    system:"start eclipse.bat"
    return

//******************************
//* 3090 Rumba
//****************************** 
!a110_Builder_Main_Rumba_MSOBJ
    system:"start rumba.bat"
    return

//******************************
//* XAMPP
//****************************** 
!a110_Builder_Main_Xampp_MSOBJ
    system:"start xampp.bat"
    return

//******************************
//* Convert CICS to DC-COBOL
//****************************** 
!a110_Builder_Main_Convert_MSOBJ
    system:"start Convert.bat"
    return

//******************************
//* SOAP UI
//****************************** 
!a110_Builder_Main_Soap_MSOBJ
    system:"start soapui.bat"
    return

//******************************
//* Toad
//****************************** 
!a110_Builder_Main_Toad_MSOBJ
    system:"start toad.bat"
    return

//******************************
//* Fiddler
//****************************** 
!a110_Builder_Main_Fiddler_MSOBJ
    system:"start Fiddler.bat"
    return

//******************************
//* Calculator
//****************************** 
!a110_Builder_Main_Calc_MSOBJ
    system:"start calc"
    return

//******************************
//* Magnify
//****************************** 
!a110_Builder_Main_Magnify_MSOBJ
    system:"start magnify"
    return

//******************************
//* Notepad
//****************************** 
!a110_Builder_Main_Notepad_MSOBJ
    system:"start notepad"
    return

//******************************
//* Paint
//****************************** 
!a110_Builder_Main_Paint_MSOBJ
    system:"start mspaint"
    return

//******************************
//* Search
//****************************** 
!a110_Builder_Main_Search_MSOBJ
    system:"start ransack.bat"
    return

//******************************
//* Task Manager
//****************************** 
!a110_Builder_Main_Taskmanager_MSOBJ
    system:"start taskmgr"
    return

//******************************
//* Performance Monitor
//****************************** 
!a110_Builder_Main_Performance_MSOBJ
    message = |To run the Performance Monitor you must allow User Account Control access. Look for the access icon in the toolbar at the bottom of your screen (Blinking Shield) asking "Do you want to allow the forllowing program to make changes to this computer?" and click 'Yes'.|
    window message info ok
    system:"start perfmon"
    return


//******************************
//* BPM Documentation
//****************************** 
!a110_Builder_Main_BPM_MSOBJ
    system:"start http://sc.ge.com/*EAMiddleware"
    return

//******************************
//* Directory Explorer
//****************************** 
!a110_Builder_Main_Directory_MSOBJ
    system:"start explorer"
    return

//******************************
//* DOS Window
//******************************
!a110_Builder_Main_Dos_MSOBJ
    system:"start CMD"
    return

//******************************
//* Bachman Visual
//******************************
!a110_Builder_Main_Bachman_MSOBJ
    system:'start T:\ITDOC\Strategy"&Planning\Presentations\Bentley\3090_Bachman.pdf'
    return

//******************************
//* Vachman on the Net
//******************************
!a110_Builder_Main_Bachmannet_MSOBJ
    system:"start http://bachman.dev.comfin.ge.com/scripts/mainPage.asp"
    return

//******************************
//* Knowledge Gateway
//******************************
!a110_Builder_Main_Gateway_MSOBJ
    system:"start http://libraries.ge.com/foldersIndex.do?entity_id=17338873101&sid=101&SF=1&prod_id=168811#17338873101"
    return

//******************************
//* MFO2 Architecture
//******************************
!a110_Builder_Main_MFO2_MSOBJ
    system:"start http://libraries.ge.com/foldersIndex.do?entity_id=20934729101&sid=101&SF=1"
    return


//******************************
//* Turn the Banner On
//******************************
!a110_Builder_Main_Banneron_MSOBJ
    BannerLine1 = Ban1
    BannerLine2 = Ban2
    BannerLine3 = Ban3
    window paint MainWindow
    return

//******************************
//* Turn the Banner Off
//******************************
!a110_Builder_Main_Banneroff_MSOBJ
    BannerLine1 = null
    BannerLine2 = null
    BannerLine3 = null
    window paint MainWindow
    return

//******************************
//* Future Timeline
//******************************
!a110_Builder_Main_FutureTimeline_MSOBJ
    system:"start FutureTimeline.bat"
    return

//******************************
//* Explaining the Future
//******************************
!a110_Builder_Main_ExplainingFuture_MSOBJ
    system:"start ExplainFuture.bat"
    return

//******************************
//* The New Boston Tutorials
//****************************** 
!a110_Builder_Main_Tutorials_MSOBJ
    system:"start http://thenewboston.org/tutorials.php"
    return

//******************************
//* Pacman
//****************************** 
!a110_Builder_Main_Pacman_MSOBJ
    message = 'Use the cursor arrow keys to control the Pacman. This program runs in a DOS CMD window, and for the best presentation maximize the CMD window before starting the game."
    window message info ok
    system:"start Pacman.bat"
    return

//******************************
//* Life
//****************************** 
!a110_Builder_Main_Life_MSOBJ
    message = 'This program runs in a DOS CMD window, and for best presentation maximize the CMD window before beginning the program."
    window message info ok
    system:"start life.bat"
    return

//*********************************************************************
//* Build Window Button Actions
//*********************************************************************
//******************************
//* Open the Builder Window Control Maintenance Window
//******************************
!a200_Builder_System_Create_PBOBJ
    window obtain Builder_System_WIN
    crush Builder_System_Systemname_EFOBJ
    mix Builder_System_Systemname_EFOBJ
    if (Builder_System_Systemname_EFOBJ = null)
+      message = "Please enter a System Name"
+      window message error ok
+      window setfocus Builder_System_Systemname_EFOBJ
+      return
+   endif
    MacroCommand = "    if (exists @Builder_System_Systemname_EFOBJ@.bed) message = 'System already exists' window message error ok window setfocus Builder_System_Systemname_EFOBJ return"
    $MacroCommand
    if (CodeType = 'bedit')
+      message = "Please enter an Author"
+   else
+      message = "Please enter a Title"
+   endif
    if (Builder_System_Title_EFOBJ = null)
+      window message error ok
+      window setfocus Builder_System_Title_EFOBJ
+      return
+   endif
    if (Builder_System_Desc_MLOBJ = null)
+      message = "Please enter a Description"
+      window message error ok
+      window setfocus Builder_System_Desc_MLOBJ
+      return
+   endif
    Builder_System_SystemList_COOBJ = Builder_System_Systemname_EFOBJ
    window insert end default Builder_System_SystemList_COOBJ 
    file SystemList
    b
    case off
    fs:/@Builder_System_Systemname_EFOBJ@/ 
    if (!eof)
+      if (line = Builder_System_Systemname_EFOBJ)
+         case on
+         message = "@Builder_System_Systemname_EFOBJ@.win already exists, overwrite?"
+         window message question yesno
+         if  (!message)
+             return
+   endif
    case on

    if  (Builder_System_Title_EFOBJ != null) SystemTitle = Builder_System_Title_EFOBJ
    if  (Builder_System_Desc_MLOBJ != null) SystemDesc = Builder_System_Desc_MLOBJ

    mix Builder_System_Systemname_EFOBJ
    window modify Builder_System_Systemname_EFOBJ
    SystemName = Builder_System_Systemname_EFOBJ

    if (CodeType = 'bedit')
+      call !a200_Builder_System_Create_bedit
+   return

    //****************************
    //* Open Control Files
    //****************************
    close BuilderWindowFile error
    close WindowList error
    close WindowNav error
    open BuilderWindowFile null error file BuilderWindowFile b d;*
    open WindowList null error file WindowList b d;*
    open WindowNav null error file WindowNav b d;*
    EntryactionFilename = '@SystemName@.act'
    close Entryaction error
    open Entryaction null error file Entryaction b d;*

    close Master error
    MasterFilename = "@SystemName@.mst"
    close Master error
    open Master @MasterFilename error open Master null
    i:/@SystemTitle@/
    i:/@SystemDesc@/
    write Master @MasterFilename
    close Master

    SystemNavFilename = "@Builder_System_Systemname_EFOBJ@.nav'

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    window hide Builder_System_WIN
    window pointer wait
    window open Builder_Window_WIN shade
    window center Builder_Window_WIN
    window clear Builder_Window_WIN
    Builder_Window_WIN = "Window Maintenance - System[@SystemName@]"
    window title Builder_Window_WIN
    Builder_Window_Systemname_STTXT = SystemName
    window modify Builder_Window_Systemname_STTXT
    //window disable Builder_Window_Test_PBOBJ
    window unshade Builder_Window_WIN
    window pointer arrow   
    return

//******************************
//* Create a Bedit batch program
//******************************
!a200_Builder_System_Create_bedit
    close GenCode error
    open GenCode null
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//* Program : @SystemName@.bed| i:/@Newline@/
    Newline = |//* Author  : @Builder_System_Title_EFOBJ@| i:/@Newline@/
    Newline = |//* Date    : @date@| i:/@Newline@/
    Newline = |//* Desc    : @Builder_System_Desc_MLOBJ@| i:/@Newline@/
    Newline = |//* | i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//*              M A I N T E N A N C E       L O G| i:/@Newline@/
    Newline = |//*| i:/@Newline@/
    Newline = |//* Date       Author           Description| i:/@Newline@/
    Newline = |//* ---------- ---------------- --------------------------------------------------| i:/@Newline@/
    Newline = |//*| i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Main Procesing| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!a100_main| i:/@Newline@/
    Newline = |    call !b100_init| i:/@Newline@/
    Newline = |    call !b200_proc| i:/@Newline@/
    Newline = |    call !b300_wrap| i:/@Newline@/
    Newline = |    exit| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Initialization| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b100_init| i:/@Newline@/
    Newline = |    system:"cls"| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    print:"* Begin @SystemName@.bed    @date@ - @time@"| i:/@Newline@/
    Newline = |    print:"* @Builder_System_Desc_MLOBJ@"| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Process| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b200_proc| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* Wrapup| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!b300_wrap| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    print:"* @SystemName@ Processing Complete    @date@ - @time@"| i:/@Newline@/
    Newline = |    print:"******************************************************************"| i:/@Newline@/
    Newline = |    wait| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* End of Program| i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |!z999_end_of_program| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/
    Newline = |//* End of program @SystemName@.bed| i:/@Newline@/
    Newline = |//********************************************************************************| i:/@Newline@/

    MacroCommand = 'write GenCode @SystemName@.bed' $MacroCommand
    close GenCode
    //**************************
    //* Separate the batch code
    //**************************
    call !t100_separate_batch_code
    return

//******************************
//* Modify a System
//******************************
!a200_Builder_System_Modify_PBOBJ
    window obtain Builder_System_WIN
    if (Builder_System_SystemList_COOBJ = null)
+      message = "Please select a System Name from the list"
+      window setfocus Builder_System_SystemList_COOBJ
+      window message error ok
+      return
+   endif

!a200_Builder_System_Modify_bedit
    //message = 'a200 CodeType[@CodeType@]' window message info ok
    if  (CodeType = 'bedit')
+       //**************************
+       //* Separate the batch code
+       //**************************
+       SystemName = Builder_System_SystemList_COOBJ
+       call !t100_separate_batch_code
+       return
+   endif

    //****************************
    //* Open Control Files
    //****************************
    Builder_System_Systemname_EFOBJ = Builder_System_SystemList_COOBJ
    crush Builder_System_Systemname_EFOBJ
    mix Builder_System_Systemname_EFOBJ
    window modify Builder_System_Systemname_EFOBJ
    SystemName = Builder_System_Systemname_EFOBJ
    SystemFileName = '@Builder_System_Systemname_EFOBJ@.win'
    close BuilderWindowFile error
    open BuilderWindowFile @SystemFileName error goto !a200_file_bad
    close Entryaction error
    EntryactionFilename = '@SystemName@.act'
    open Entryaction @EntryactionFilename error open Entryaction null
    goto !a200_file_ok

!a200_file_bad
    message = /File doesn't exist: @SystemFileName@/ 
    window message error ok 
    return

!a200_file_ok
    close Master error
    MasterFilename = "@SystemName@.mst"
    open Master @MasterFilename error open Master null i:/@SystemTitle@/ i:/@SystemDesc@/
    b
    SystemTitle = line
    f;1
    SystemDesc = line
    if  (Builder_System_Title_EFOBJ != null) 
+       SystemTitle = Builder_System_Title_EFOBJ
+       b
+       r:/@SystemTitle@/
+   endif
    if  (Builder_System_Desc_MLOBJ != null) 
+       SystemDesc = Builder_System_Desc_MLOBJ
+       b
+       f;1
+       r:/@SystemDesc@/
+   endif
    write Master @MasterFilename
    close Master

    SystemNavFilename = "@Builder_System_Systemname_EFOBJ@.nav'
    close WindowNav error
    open WindowNav @SystemNavFilename error open WindowNav null 

    close WindowList error
    open WindowList null 

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    SystemName = Builder_System_Systemname_EFOBJ
    window hide Builder_System_WIN
    window pointer wait
    window open Builder_Window_WIN shade
    window center Builder_Window_WIN
    window clear Builder_Window_WIN
    Builder_Window_WIN = "Window Maintenance - System[@SystemName@]"
    window title Builder_Window_WIN
    Builder_Window_Systemname_STTXT = SystemName
    window modify Builder_Window_Systemname_STTXT
    file BuilderWindowFile
    b

!a200_window_loop
    cols 1,6
    fs:/WINDOW/
    noco
    if (!eof)
+      scan:/@line/:/,/
+      scan:/@right/:/_/
+      scan:/@right/:/_/
+      file WindowList
+      i:/@left@/
+      Builder_Window_Windownamelist_COOBJ = left
+      window insert end default Builder_Window_Windownamelist_COOBJ
+      file BuilderWindowFile
+      f;1
+      if  (!eof)
+          goto !a200_window_loop
+   endif
    //window disable Builder_Window_Test_PBOBJ

    CodeOnly = 'y'
    call !a400_Builder_Control_Code_PBOBJ 
    CodeOnly = 'n'

    window unshade Builder_Window_WIN
    window pointer arrow    
    return

//******************************
//* Close the System Window
//******************************
!a200_Builder_System_Cancel_PBOBJ
    //message = "Are you sure?"
    //window message question yesno
    //if (!message) 
    window close Builder_System_WIN
    return

//******************************
//* Open the Window Controls Window
//******************************
!a300_Builder_Window_Create_PBOBJ
    if  (CodeType = 'bedit')
+       call !a350_create_bedit_code
+       return
+   endif
    open Controls null error file Controls b d;*
    window obtain Builder_Window_WIN
    crush Builder_Window_Windowname_EFOBJ
    if  (Builder_Window_Windowname_EFOBJ = null)
+      message = "Please enter a Window Name"
+      window message error ok
+      window setfocus Builder_Window_Windowname_EFOBJ
+      return
+   endif
    if  (Builder_Window_WindowTitle_EFOBJ = null)
+      message = "Please enter a Window Title"
+      window message error ok
+      window setfocus Builder_Window_WindowTitle_EFOBJ
+      return
+   endif

    WindowTitle = Builder_Window_WindowTitle_EFOBJ
    mix Builder_Window_Windowname_EFOBJ
    window modify Builder_Window_Windowname_EFOBJ
    file WindowList
    b
    fs:/@Builder_Window_Windowname_EFOBJ@/
    if (!eof)
+      message = "Duplicate Window Name"
+      window message error ok
+      return
+   endif

    Builder_Window_Windownamelist_COOBJ = Builder_Window_Windowname_EFOBJ
    window insert end default Builder_Window_Windownamelist_COOBJ
    file WindowList
    f;*
    i:/@Builder_Window_Windowname_EFOBJ@/

!a300_Builder_Window_Create_PBOBJ_Mod
    WindowName = Builder_Window_Windowname_EFOBJ
    window pointer wait
    window open Builder_Control_WIN shade
    //window center Builder_Control_WIN
    window clear Builder_Control_WIN
    Builder_Control_WIN = "Builder Window Control Maintenance - System[@SystemName@] Window[@WindowName@]"
    window deletecontrol GroupRectangle error
    window disable Builder_Control_Align_PBOBJ
    window title Builder_Control_WIN
    Builder_Control_Size_EFOBJ = '10'
    window modify Builder_Control_Size_EFOBJ
    Builder_Control_Size_RBOBJ = 'Y'
    window modify Builder_Control_Size_RBOBJ

    //********************************
    //* Creating New Window - Defaults
    //********************************
    //window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY
    //window size Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY
    //message = 'Reset Window Size MinX[@MinX@] MinY[@MinY@] MaxX[@MaxX@] MaxY[@MaxY@]' window message info ok

    call !w100_open_window_build_controls

    window disable Builder_Control_Buttonaction_PBOBJ
    window disable Builder_Control_Entryaction_PBOBJ

    window unshade Builder_Control_WIN
    MouseOK = 'y'
    SizingWindow = 'n'
    ButtonFocus = null
    window pointer arrow
    return

//******************************
//* Modify a Window
//******************************
!a300_Builder_Window_Modify_PBOBJ
    window obtain Builder_Window_Windownamelist_COOBJ
    crush Builder_Window_Windownamelist_COOBJ
    if  (Builder_Window_Windownamelist_COOBJ = null)
+      message = "Please select a Window Name"
+      window message error ok
+      return
+   endif

    Builder_Window_Windowname_EFOBJ = Builder_Window_Windownamelist_COOBJ
    window modify Builder_Window_Windowname_EFOBJ
    window obtain Builder_Window_WindowTitle_EFOBJ
    if  (Builder_Window_WindowTitle_EFOBJ != null)
+       WindowTitle = Builder_Window_WindowTitle_EFOBJ
+       //goto !a300_Builder_Window_Modify_New_Title
    file BuilderWindowFile
    b
    Newline = "WINDOW,@SystemName@_@Builder_Window_Windowname_EFOBJ@_WIN"
    fs:/@Newline@/ 
    if (!eof) and (Builder_Window_WindowTitle_EFOBJ != null) 
+      scanr:/@line/:/,/
+      Newline = '@left@',@Builder_Window_WindowTitle_EFOBJ@'
+      r:/@Newline@/
+   endif
    if (!eof) 
+      scanr:/@line/:/,/ 
+      Builder_Window_WindowTitle_EFOBJ = right
+      WindowTitle = right
+      window modify Builder_Window_WindowTitle_EFOBJ
+   endif
!a300_Builder_Window_Modify_New_Title
    call !a300_Builder_Window_Create_PBOBJ_Mod
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ
    return

//******************************
//* Generate the New System
//******************************
!a300_Builder_Window_Save_PBOBJ
    call !y100_Generate
    message = 'The new system code is located at @GenSystemFilename@ (@CodeLines@ lines of BEDITWIN code Generated). To run it use [beditwin call @GenSystemFilename@]'
    window message info ok
    //window enable Builder_Window_Test_PBOBJ
    return

//******************************
//* Test the New System
//******************************
!a300_Builder_Window_Test_PBOBJ
    call !y100_Generate
    MacroCommand = 'beditwin call @GenSystemFilename@' 
    system:"@MacroCommand@"
    window setfocus Builder_Window_WIN
    window setfocus Builder_Window_Windowname_EFOBJ
    return

//******************************
//* View the System
//******************************
!a300_Builder_Window_View_PBOBJ
    ViewSingleProg = 'n'
    ViewBuilderWindow = 'y'
!a300_Builder_Window_View_PBOBJ_2
    window pointer wait
    window open Builder_View_WIN shade
    if  (ViewSingleProg)
+       window show Builder_View_Comments_PBOBJ
+       window show Builder_View_Open_PBOBJ
+   else
+       window hide Builder_View_Comments_PBOBJ
+       window hide Builder_View_Open_PBOBJ
+   endif
    //window center Builder_View_WIN
    window clear Builder_View_WIN
    Builder_View_WIN = "Builder Window Viewer - System[@SystemName@]"
    window title Builder_View_WIN
    if  (ViewCobol) goto !a300_filterlist_done
    close ViewFilterList error
    open ViewFilterList null
    file BuilderWindowFile
    b
    do
        if (!eof)
+          SearchString = 'WINDOW,'
+          fs:/@SearchString@/
+          if (!eof)
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             WindowName = left
+             scanr:/@line/:/,/
+             WindowTitle = right
+             scan:/@WindowName@/:/_/
+             scan:/@right/:/_/
+             Newline = '@WindowName@,@WindowTitle@,@left@'
+             file ViewFilterList
+             i:/@Newline@/
+             file BuilderWindowFile
+       endif
+       f;1
    until (eof)
!a300_filterlist_done
    ViewCobol = 'n'
    call !v100_view

!a300_view_done
    window unshade Builder_View_WIN
    window pointer arrow
    return

//******************************
//* Close Window Maintenance
//******************************
!a300_Builder_Window_Code_PBOBJ
    CodeType = 'beditwin'
    call !a400_Builder_Control_Code_PBOBJ
    return

//******************************
//* Close Window Maintenance
//******************************
!a300_Builder_Window_Cancel_PBOBJ
    message = "Are you sure?"
    window message question yesno
    if (message)
+      window close Builder_Window_WIN
+      window unshade Builder_System_WIN
+      close BuilderWindowFile
+      close Entryaction error
+   endif
    return

//******************************
//* Create Bedit Code
//******************************
!a350_create_bedit_code
    return

//******************************
//* Size a control
//******************************
!a400_Builder_Control_Size_PBOBJ
    window obtain Builder_Control_Control_EFOBJ
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    //******************************
    //* Size X
    //******************************
    window obtain Builder_Control_X_EFOBJ
    if (Builder_Control_X_EFOBJ < 1) 
+      Builder_Control_X_EFOBJ = '1'
+      window modify Builder_Control_X_EFOBJ
+   endif

    //******************************
    //* Size Y
    //******************************
    window obtain Builder_Control_Y_EFOBJ
    if (Builder_Control_Y_EFOBJ < 1) 
+      Builder_Control_Y_EFOBJ = '1'
+      window modify Builder_Control_Y_EFOBJ
+   endif

    //******************************
    //* Size CX
    //******************************
    window obtain Builder_Control_Height_EFOBJ
    if (Builder_Control_Height_EFOBJ < 1) 
+      Builder_Control_Height_EFOBJ = '1'
+      window modify Builder_Control_Height_EFOBJ
+   endif

    //******************************
    //* Size CY
    //******************************
    window obtain Builder_Control_Length_EFOBJ
    if (Builder_Control_Length_EFOBJ < 1) 
+      Builder_Control_Length_EFOBJ = '1'
+      window modify Builder_Control_Length_EFOBJ
+   endif

    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      window message error ok
+      return
+   endif

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    ObjectX = Builder_Control_X_EFOBJ
    ObjectX += MinX
    ObjectY = Builder_Control_Y_EFOBJ
    ObjectY += MinY
    ObjectCX = Builder_Control_Length_EFOBJ
    ObjectCY = Builder_Control_Height_EFOBJ

    //******************************
    //* Restrict to Window Size
    //******************************
    //*** Left
    WinX = ObjectX - MinX
    if (WinX < 1) 
+       ObjectX = MinX + 1
+       WinX = ObjectX - MinX
+       Builder_Control_X_EFOBJ = WinX
+       window modify Builder_Control_X_EFOBJ
+   endif
    //*** Right
    WinX = ObjectX + ObjectCX
    if  (WinX > MaxX)
+       ObjectX = MaxX - ObjectCX - 1
+       WinX = ObjectX - MinX
+       Builder_Control_X_EFOBJ = WinX
+       window modify Builder_Control_X_EFOBJ
+   endif

    //*** Up
    WinY = ObjectY - MinY
    if  (WinY < 1) 
+       ObjectY = MinY + 1
+       WinY = ObjectY - MinY
+       Builder_Control_Y_EFOBJ = WinY
+       window modify Builder_Control_Y_EFOBJ
+   endif
    //*** Down
    WinY = ObjectY + ObjectCY
    if  (WinY > MaxY)
+       ObjectY = MaxY - ObjectCY - 1
+       WinY = ObjectY - MinY
+       Builder_Control_Y_EFOBJ = WinY
+       window modify Builder_Control_Y_EFOBJ
+   endif

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b400_repaint_control
    return

//******************************
//* Create Button
//******************************
!a400_Builder_Control_Create_PBOBJ
    //*** Reenable Control Updating
    window enable Builder_Control_Focus_PBOBJ
    window enable Builder_Control_Delete_PBOBJ
    HoldAction = Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = "Size Window"
    window modify Builder_Control_WinSize_PBOBJ
    Builder_Control_WinSize_PBOBJ = HoldAction

    window obtain Builder_Control_WIN
    ControlType = null
    if  (Builder_Control_Button_RBOBJ)    ControlType = 'PBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window enable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Entry_RBOBJ)     ControlType = 'EFOBJL' window enable Builder_Control_Entryaction_PBOBJ  window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Text_RBOBJ)      ControlType = 'STTXT1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Check_RBOBJ)     ControlType = 'CBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Group_RBOBJ)     ControlType = 'GBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_List_RBOBJ)      ControlType = 'LBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Radio_RBOBJ)     ControlType = 'RBOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Combo_RBOBJ)     ControlType = 'COOBJS' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Drop_RBOBJ)      ControlType = 'COOBJL' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_MLE_RBOBJ)       ControlType = 'MLOBJ1' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Rectangle_RBOBJ) ControlType = 'STTXTF' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (Builder_Control_Box_RBOBJ)       ControlType = 'STTXTR' window disable Builder_Control_Entryaction_PBOBJ window disable Builder_Control_Buttonaction_PBOBJ
    if  (ControlType = null)
+       message = 'Please select a Control Type'
+       window message error ok
+       return
+   endif
    crush Builder_Control_Control_EFOBJ

    //*********************
    //* Modify to Default
    //*********************
    scan:/@Builder_Control_Control_EFOBJ/:/@SystemName@/
    if (!found)
+      scan:/@Builder_Control_Control_EFOBJ/:/@WindowName@/
+      if  (!found)
+          scan:/@Builder_Control_Control_EFOBJ/:/@ControlType@/
+          if (!found)
+             mix Builder_Control_Control_EFOBJ
+             splitr:/@ControlType@/;1
+             ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@left@'
+             Builder_Control_Control_EFOBJ = ControlName
+   endif
    scan:/@Builder_Control_Control_EFOBJ@/:/_/
    if (!found)
+      mix Builder_Control_Control_EFOBJ
+      splitr:/@ControlType@/;1
+      ControlName = '@SystemName@_@WindowName@_@Builder_Control_Control_EFOBJ@_@left@'
+      Builder_Control_Control_EFOBJ = ControlName
+   endif 
    window modify Builder_Control_Control_EFOBJ

!a400_Builder_Control_Create_PBOBJ_Create
    //*********************
    //* Add close to Nav
    //*********************
    NavAction = 'close'
    file WindowNav
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    Newline = "@Builder_Control_Control_EFOBJ@,@WindowName@,@NavAction@"
    if (eof)
+      i:/@Newline@/
+   endif

    //*********************
    //* Create the Control
    //*********************
    call !b100_create_control
    return

//******************************
//* Open the Alignment Window
//******************************
!a400_Builder_Control_Align_PBOBJ
    window pointer wait
    window open Builder_Align_WIN shade
    window windowpos Builder_Control_Align_PBOBJ ObjectX ObjectY ObjectCX ObjectCY
    window windowpos Builder_Align_WIN WinX WinY WinCX WinCY
    WinX = ObjectX
    WinY = ObjectY
    window size Builder_Align_WIN @WinX @WinY @WinCX @WinCY
    window unshade Builder_Align_WIN
    window pointer arrow
    return

//******************************
//* Delete a Control
//******************************
!a400_Builder_Control_Delete_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ != null)
+       Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
+       window modify Builder_Control_Control_EFOBJ
+   else
+       window obtain Builder_Control_Control_EFOBJ
+   endif

    window exists @Builder_Control_Control_EFOBJ
    if  (!status)
+       message = 'Control doesn't exist'
+       window message error ok
+       return
+   endif
    message = 'Are you sure you want to delete @Builder_Control_Control_EFOBJ@?'
    window message question yesno
    if (!message)
+      return
+   endif
    window deletecontrol @Builder_Control_Control_EFOBJ
    file Controls
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ)
+              d
+              f;*
+       endif
        f;1          
    until (eof)
    window delete Builder_Control_ControlList_COOBJ 
    return

//******************************
//* Set Button Actions
//******************************
!a400_Builder_Control_Buttonaction_PBOBJ
    call !n100_navigation
    return

//******************************
//* Set Entry Field Actions
//******************************
!a400_Builder_Control_Entryaction_PBOBJ
    window pointer wait
    window open Builder_Entryaction_WIN shade
    window center Builder_Entryaction_WIN
    window clear Builder_Entryaction_WIN

    Builder_Entryaction_Fieldname_STTXT = Builder_Control_Control_EFOBJ
    window modify Builder_Entryaction_Fieldname_STTXT 
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (eof) goto !a400_entryaction_done

    scan:/@line/:/,/
    scan:/@right/:/,/
    EntryFieldAction = left
    Builder_Entryaction_Size_EFOBJ = right
    scan:/@EntryFieldAction@/:/-P/
    if (found)
+      EntryFieldAction = left
+      Builder_Entryaction_Password_CBOBJ = 'Y'
+   else
+      Builder_Entryaction_Password_CBOBJ = 'N'
+   endif
    window modify Builder_Entryaction_Password_CBOBJ
    
    window modify Builder_Entryaction_Size_EFOBJ
    if (EntryFieldAction = 'alpha') Builder_Entryaction_Alpha_RBOBJ = 'Y' window modify Builder_Entryaction_Alpha_RBOBJ window setfocus Builder_Entryaction_Alpha_RBOBJ
    if (EntryFieldAction = 'numeric') Builder_Entryaction_Numeric_RBOBJ = 'Y' window modify Builder_Entryaction_Numeric_RBOBJ window setfocus Builder_Entryaction_Numeric_RBOBJ
    if (EntryFieldAction = 'upper') Builder_Entryaction_Uppercase_RBOBJ = 'Y' window modify Builder_Entryaction_Uppercase_RBOBJ window setfocus Builder_Entryaction_Uppercase_RBOBJ
    if (EntryFieldAction = 'lower') Builder_Entryaction_Lowercase_RBOBJ = 'Y' window modify Builder_Entryaction_Lowercase_RBOBJ window setfocus Builder_Entryaction_Lowercase_RBOBJ
    if (EntryFieldAction = 'mix') Builder_Entryaction_Mixedcase_RBOBJ = 'Y' window modify Builder_Entryaction_Mixedcase_RBOBJ window setfocus Builder_Entryaction_Mixedcase_RBOBJ
    if (EntryFieldAction = 'date') Builder_Entryaction_Date_RBOBJ = 'Y' window modify Builder_Entryaction_Date_RBOBJ window setfocus Builder_Entryaction_Date_RBOBJ
    if (EntryFieldAction = 'dollar') Builder_Entryaction_Dollar_RBOBJ = 'Y' window modify Builder_Entryaction_Dollar_RBOBJ window setfocus Builder_Entryaction_Dollar_RBOBJ
    if (EntryFieldAction = 'telephone') Builder_Entryaction_Phone_RBOBJ = 'Y' window modify Builder_Entryaction_Phone_RBOBJ window setfocus Builder_Entryaction_Phone_RBOBJ
    if (EntryFieldAction = 'text') Builder_Entryaction_Text_RBOBJ = 'Y' window modify Builder_Entryaction_Text_RBOBJ window setfocus Builder_Entryaction_Text_RBOBJ
 
!a400_entryaction_done
    window unshade Builder_Entryaction_WIN
    window pointer arrow
    return

//******************************
//* Size the Builder Window Frame
//******************************
!a400_Builder_Control_WinSize_PBOBJ
    if  (SizingWindow)
+       SizingWindow = 'n'
+       window enable Builder_Control_Focus_PBOBJ
+       window enable Builder_Control_Delete_PBOBJ
+       HoldAction = Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = "Size Window"
+       window modify Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = HoldAction
+   else
+       SizingWindow = 'y'
+       window disable Builder_Control_Focus_PBOBJ
+       window disable Builder_Control_Delete_PBOBJ
+       HoldAction = Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = "Size Controls"
+       window modify Builder_Control_WinSize_PBOBJ
+       Builder_Control_WinSize_PBOBJ = HoldAction
+   endif
    
    window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY

    ButtonFocus = "Builder_Control_WindowSize_GBOBJ"

    window windowpos Builder_Control_WindowSize_GBOBJ ObjectX ObjectY ObjectCX ObjectCY

    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    if (ObjectX < 1) ObjectX = 1
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    if (ObjectY < 1) ObjectY = 1
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ
        
    return

//******************************
//* Set the Focus
//******************************
!a400_Builder_Control_Focus_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ = null) return
    window exists @Builder_Control_ControlList_COOBJ
    if (!status) return

    FocusSet = 'y'
    Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
    window modify Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_ControlList_COOBJ

    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    ObjectX = ObjectX - MinX
    Builder_Control_X_EFOBJ = ObjectX
    window modify Builder_Control_X_EFOBJ
    ObjectY = ObjectY - MinY
    Builder_Control_Y_EFOBJ = ObjectY
    window modify Builder_Control_Y_EFOBJ

!a400_Builder_Control_Focus_Controls_set
    file Controls
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ) 
+              scanr:/@line/:/,/
+              Builder_Control_ControlText_EFOBJ = right
+              window modify Builder_Control_ControlText_EFOBJ
+              call !a400_set_control_radio
+              f;*
+       endif  
        f;1        
    until (eof)
    return

//******************************
//* Set the radio buttons
//******************************
!a400_set_control_radio
    scan:/@line/:/,/ 
    scan:/@right/:/,/ 
    //**************************
    //* Push Button
    //**************************
    if  (left = 'PBOBJ1') 
+       Builder_Control_Button_RBOBJ = 'Y'
+       window disable Builder_Control_Entryaction_PBOBJ
+       window enable Builder_Control_Buttonaction_PBOBJ
+   else
+       Builder_Control_Button_RBOBJ = 'N'
+       window disable Builder_Control_Buttonaction_PBOBJ
+   endif
    window modify Builder_Control_Button_RBOBJ

    //**************************
    //* Entry Field
    //**************************
    if  (left = 'EFOBJL') 
+       Builder_Control_Entry_RBOBJ = 'Y' 
+       window enable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Entry_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Entry_RBOBJ

    //**************************
    //* Text
    //**************************
    if  (left = 'STTXT1') 
+       Builder_Control_Text_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Text_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Text_RBOBJ

    //**************************
    //* Check Box
    //**************************
    if  (left = 'CBOBJ1') 
+       Builder_Control_Check_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Check_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Check_RBOBJ

    //**************************
    //* List Box
    //**************************
    if  (left = 'LBOBJ1') 
+       Builder_Control_List_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_List_RBOBJ = 'N'
+   endif
    window modify Builder_Control_List_RBOBJ

    //**************************
    //* Group
    //**************************
    if  (left = 'GBOBJ1') 
+       Builder_Control_Group_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Group_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Group_RBOBJ

    //**************************
    //* Radio Button
    //**************************
    if  (left = 'RBOBJ1') 
+       Builder_Control_Radio_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Radio_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Radio_RBOBJ

    //**************************
    //* Multi-line Entry
    //**************************
    if  (left = 'MLOBJ1') 
+       Builder_Control_MLE_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_MLE_RBOBJ = 'N'
+   endif
    window modify Builder_Control_MLE_RBOBJ

    //**************************
    //* Combo Box
    //**************************
    if  (left = 'COOBJS') 
+       Builder_Control_Combo_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Combo_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Combo_RBOBJ

    //**************************
    //* Dropdown
    //**************************
    if  (left = 'COOBJL') 
+       Builder_Control_Drop_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Drop_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Drop_RBOBJ

    //**************************
    //* Rectangle
    //**************************
    if  (left = 'STTXTF') 
+       Builder_Control_Rectangle_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Rectangle_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Rectangle_RBOBJ

    //**************************
    //* Box
    //**************************
    if  (left = 'STTXTR') 
+       Builder_Control_Box_RBOBJ = 'Y' 
+       window disable Builder_Control_Entryaction_PBOBJ
+   else
+       Builder_Control_Box_RBOBJ = 'N'
+   endif
    window modify Builder_Control_Box_RBOBJ

    return


//******************************
//* Modify a Control
//******************************
!a400_Builder_Control_Modify_PBOBJ
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    window obtain Builder_Control_ControlList_COOBJ
    pack Builder_Control_ControlList_COOBJ
    if  (Builder_Control_ControlList_COOBJ != null)
+       Builder_Control_Control_EFOBJ = Builder_Control_ControlList_COOBJ
+       window modify Builder_Control_Control_EFOBJ
+   else
+       window obtain Builder_Control_Control_EFOBJ
+   endif

    window exists @Builder_Control_Control_EFOBJ
    if  (!status)
+       message = 'Control doesn't exist'
+       window message error ok
+       return
+   endif

    window obtain Builder_Control_ControlText_EFOBJ
    ControlText = Builder_Control_ControlText_EFOBJ
    @Builder_Control_Control_EFOBJ = ControlText
    MacroCommand = 'window modify @Builder_Control_Control_EFOBJ@'
    $MacroCommand
    if  (ControlType = 'PBOBJ1') @Builder_Control_Control_EFOBJ = null

    file Controls
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if  (left = Builder_Control_Control_EFOBJ) 
+              scan:/@line/:/,/
+              scan:/@right/:/,/
+              Newline = '@Builder_Control_Control_EFOBJ@,@left@,@ControlText@'
+              r:/@Newline@/
+              f;*
+       endif  
        f;1        
    until (eof)
!a400_control_size
    call !a400_Builder_Control_Size_PBOBJ
    window modify Builder_Control_WIN

    return

//******************************
//* Increase Height of a control
//******************************
!a400_Builder_Control_SizeXPlus_PBOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeXPlus_window      
+   endif  
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      //window message error ok
+      return
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY += ControlSize
+   else
+       ObjectY += ControlSize
+   endif

    //******************************
    //* Restrict to Window Size
    //******************************
    WinY = ObjectY + ObjectCY
    if  (WinY > MaxY)
+       ObjectY = MaxY - ObjectCY - 1
+   endif

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeXPlus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY += ControlSize
+   else
+       ObjectY += ControlSize
+   endif

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Decrease Height of a control
//******************************
!a400_Builder_Control_SizeXMinus_PBOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeXMinus_window      
+   endif    

    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      //window message error ok
+      return
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY -= ControlSize
+   else
+       ObjectY -= ControlSize
+   endif
    if (ObjectCY < 1) ObjectCY = 1

    //******************************
    //* Restrict to Window Size
    //******************************
    WinY = ObjectY - MinY
    if (WinY < 1) ObjectY = MinY + 1

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeXMinus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCY -= ControlSize
+   else
+       ObjectY -= ControlSize
+   endif
    if (ObjectCY < 1) ObjectCY = 1
    if (ObjectY < 1) ObjectY = 1
    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Increase Length of a control
//******************************
!a400_Builder_Control_SizeYPlus_PBOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeYPlus_window      
+   endif 
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      //window message error ok
+      return
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX += ControlSize
+   else
+       ObjectX += ControlSize
+   endif

    //******************************
    //* Restrict to Window Size
    //******************************
    WinX = ObjectX + ObjectCX
    if  (WinX > MaxX)
+       ObjectX = MaxX - ObjectCX - 1
+   endif

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeYPlus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX += ControlSize
+   else
+       ObjectX += ControlSize
+   endif
    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Decrease Length of a control
//******************************
!a400_Builder_Control_SizeYMinus_PBOBJ
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ') or (ButtonFocus = 'GroupRectangle')
+       goto !a400_SizeYMinus_window      
+   endif 
    window obtain @Builder_Control_Control_EFOBJ
    ButtonFocus = Builder_Control_Control_EFOBJ

    //*********************************************
    //* Don't size Builder Window Controls
    //*********************************************
    scan:/@ButtonFocus/:/Builder_Control/
    if (found) return

    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window exists @ButtonFocus
    if (!status)
+      message = 'Control doesn't exist'
+      //window message error ok
+      return
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY

    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX -= ControlSize
+   else
+       ObjectX -= ControlSize
+   endif
    if (ObjectCX < 1) ObjectCX = 1

    //******************************
    //* Restrict to Window Size
    //******************************
    WinX = ObjectX - MinX
    if (WinX < 1) ObjectX = MinX + 1

    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b300_object_size
    call !b400_repaint_control
    return

!a400_SizeYMinus_window
    window obtain Builder_Control_Size_EFOBJ
    ControlSize = Builder_Control_Size_EFOBJ
    if  (ControlSize < 1)
+       Builder_Control_Size_EFOBJ = '5'
+       window modify Builder_Control_Size_EFOBJ
+       ControlSize = Builder_Control_Size_EFOBJ
+   endif
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window obtain Builder_Control_Size_RBOBJ
    if  (Builder_Control_Size_RBOBJ)
+       ObjectCX -= ControlSize
+   else
+       ObjectX -= ControlSize
+   endif
    if (ObjectCX < 1) ObjectCX = 1
    if (ObjectX < 1) ObjectX = 1
    window size @ButtonFocus @ObjectX @ObjectY @ObjectCX @ObjectCY
    call !b400_repaint_control
    if  (ButtonFocus = 'GroupRectangle')
+       Xpos = ObjectX
+       Ypos = ObjectY
+       call !a100_WindowMouse_Drag_Group
+   endif
    return

//******************************
//* Modify program code
//******************************
!a400_Builder_Control_Code_PBOBJ
    string ModuleFileName error
    string ModuleName     error
    string ModulePrefix   error
    string SearchPrefix   error

    //message = "!a400_Builder_Control_Code_PBOBJ" window message info ok

    if-1 (!CodeOnly)
+      window pointer wait
+      window open Builder_Code_WIN shade
+      window center Builder_Code_WIN
+      Builder_Code_WIN = 'Code Selection - System[@SystemName@]'
+      window modify Builder_Code_WIN
+      if-2 (CodeType = 'bedit')
+         window show Builder_Code_Refresh_PBOBJ
+         window show Builder_Code_Test_PBOBJ
+         window show Builder_Code_View_PBOBJ
+      else-2
+         window hide Builder_Code_Refresh_PBOBJ
+         window hide Builder_Code_Test_PBOBJ
+         window hide Builder_Code_View_PBOBJ
+   endif

    //***********************
    //* Open the Module File
    //***********************
    close ModuleFile error
    open ModuleFile null

    close ModuleNameFile error
    open ModuleNameFile null

    //***********************
    //* Create the Code
    //***********************
    GenSystemFilename = "@SystemName@.BED"
    MacroCommand = "    if (!exists @GenSystemFilename@) call !y100_Generate" $MacroCommand

    //***********************
    //* Open the Bedit Code File
    //***********************
    close CodeFile error
    open CodeFile @GenSystemFilename
    ModuleFileName = 'Bedit-code\@SystemName@.bed'
    write CodeFile @ModuleFileName

    //***********************
    //* Clear the listbox
    //***********************
    Builder_Code_Codemodules_LBOBJ = 'ALL'
    window delete Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Add the generic lines
    //***********************
    if  (!CodeOnly) and (CodeType != 'bedit')
+       Builder_Code_Codemodules_LBOBJ = "! Complete Program"
+       window insert end default Builder_Code_Codemodules_LBOBJ
+       //Builder_Code_Codemodules_LBOBJ = "! Global Variables"
+       //window insert end default Builder_Code_Codemodules_LBOBJ
+   endif

    //***********************
    //* Global Variables
    //***********************
    b
    do
        split:/@line/;1
        if  (left != '!')
+           Newline = line
+           file ModuleFile
+           i:/@Newline/
+           file CodeFile
+           f;1
+       endif
    until (left = '!') or (eof)
   
    file ModuleFile
!a400_Builder_Control_Code_firstcomments
    b;1
    if (eof) goto !a400_Builder_Control_Code_firstcomments_done
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      d
+      goto !a400_Builder_Control_Code_firstcomments
+   endif

!a400_Builder_Control_Code_firstcomments_done
    ModuleFileName = 'Bedit-code\Global.bed'

!a400_Builder_Control_Code_module  
    file ModuleFile
    MacroCommand = "    if (!exists @ModuleFileName@) write ModuleFile @ModuleFileName@"  
    $MacroCommand

    if (eof)
+      goto !a400_Builder_Control_Code_Done
+   endif
    ModuleFileName = line
    file ModuleFile
    b
    d;*
    file CodeFile
    Builder_Code_Codemodules_LBOBJ = line
    window insert end default Builder_Code_Codemodules_LBOBJ
    file ModuleNameFile
    b
    fs:/@Builder_Code_Codemodules_LBOBJ@/
    if (eof)
+      i:/@Builder_Code_Codemodules_LBOBJ@/
+   endif
    file ModuleFile
    //i:/@Builder_Code_Codemodules_LBOBJ/
    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
    scan:/@Builder_Code_Codemodules_LBOBJ@/:/_/
    if (found)
+      ModulePrefix = left
+   else
+      ModulePrefix = Builder_Code_Codemodules_LBOBJ
+   endif
    if (ModulePrefix = '!a010')
+      ModulePrefix = null
+   endif
    file CodeFile
!a400_Builder_Control_Code_comments
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !a400_Builder_Control_Code_comments
+   endif

!a400_Builder_Control_Code_loop
    split:/@line/;1
    if (left != '!') or (line = Builder_Code_Codemodules_LBOBJ)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !a400_Builder_Control_Code_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !a400_Builder_Control_Code_next
+   endif    
    file ModuleFile
    b
    ib:/FGB/
    f;*
!a400_Builder_Control_Code_commentdelloop
    pack line
    if (line = null)
+      goto !a400_Builder_Control_Code_commentremove
+   endif
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !a400_Builder_Control_Code_commentremove
+   endif
    goto !a400_Builder_Control_Code_commentdeldone
!a400_Builder_Control_Code_commentremove
    d
    split:/@line/;3
    if (left != 'FGB')
+      goto !a400_Builder_Control_Code_commentdelloop
+   endif

!a400_Builder_Control_Code_commentdeldone
    b
    d  //* Remove FGB line  
    goto !a400_Builder_Control_Code_module

!a400_Builder_Control_Code_next
    file CodeFile
    f;1
    if (!eof)
+      goto !a400_Builder_Control_Code_loop
+   endif
    write ModuleFile @ModuleFileName
    close ModuleFile

!a400_Builder_Control_Code_Done
    close CodeFile

    if  (!CodeOnly)
+       window unshade Builder_Code_WIN
+       window pointer arrow
+   endif

    if (CodeOnly) return

    window obtain Builder_Control_Control_EFOBJ
    if  (Builder_Control_Control_EFOBJ != null)
+       file ModuleNameFile
+       b
+       fs:/@Builder_Control_Control_EFOBJ@/
+       if (!eof)
+          Builder_Code_Codemodules_LBOBJ = line
+          call !a1800_Builder_Code_Ok_PBOBJ-1
+   endif

    return

//******************************
//* Refresh the Control Window
//******************************
!a400_Builder_Control_Refresh_PBOBJ
    window paint Builder_Control_WIN
    //window hide Builder_Control_WIN
    //window show Builder_Control_WIN
    return

//******************************
//* Save Created Window
//******************************
!a400_Builder_Control_Save_PBOBJ
    //ControlName = 'test'
    //MacroCommand = "window windowpos @ControlName@ SaveX SaveY SaveCX SaveCY" $MacroCommand
    //message = 'Save Control[@ControlName@] SaveX[@SaveX@] SaveY[@SaveY@] SaveCX[@SaveCX@] SaveCY[@SaveCY@]' window message info ok
    
    MouseOK = 'n'

    file BuilderWindowFile
    b
    Newline = 'WINDOW,@SystemName@_@WindowName@'
    fs:/@Newline/
    if (eof) 
+      i:/*******************************************************************/
+      i:/*                           WINDOW                                */
+      i:/*******************************************************************/
+      goto !a400_new
+   endif
    d
!a400_del_loop
    if (eof) goto !a400_new
    split:/@line/;3
    if (left != '***')
+      d;1
+      goto !a400_del_loop
+   endif
    b;1
    
!a400_new
    ObjectCX = MaxX + 40
    ObjectCY = MaxY + 40
 
    SystemWindowName = '@SystemName@_@WindowName@_WIN'

    MacroCommand = "window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY" $MacroCommand
    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ ObjectX ObjectY ObjectCX ObjectCY" $MacroCommand

    ObjectX -= MinX
    ObjectY -= MinY
    if  (ObjectX < 1) ObjectX = 1
    if  (ObjectY < 1) ObjectY = 1
    Newline = /WINDOW,@SystemWindowName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@WindowTitle@/
    i:/@Newline@/ 

    file Controls error goto !a400_controls_done
    write Controls Controls.dat
    b
    if (eof) goto !a400_controls_done
    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY" $MacroCommand
!a400_next
    scan:/@line/:/,/
    ControlName = left
    scan:/@right/:/,/
    ControlType = left
    Text = right
    if (ControlType = 'EFOBJL') or (ControlType = 'EFOBJR') or (ControlType = 'LBOBJ1') or (ControlType = 'COOBJS') or (ControlType = 'COOBJL') or (ControlType = 'MLOBJ1') or (ControlType = 'STTXTF') or (ControlType = 'STTXTR')
+      Text = null
+   endif

    MacroCommand = "window windowpos @ControlName@ ObjectX ObjectY ObjectCX ObjectCY" $MacroCommand
    //message = 'Walk Control[@ControlName@] ObjectX[@ObjectX@] ObjectY[@ObjectY@] ObjectCX[@ObjectCX@] ObjectCY[@ObjectCY@]' window message info ok

    ObjectX -= MinX
    ObjectY -= MinY
    if  (ControlType = 'COOBJL') ObjectCY = 200
    Newline = /@ControlType@,@ControlName@,@ObjectX@,@ObjectY@,@ObjectCX@,@ObjectCY@,@Text@/
    file BuilderWindowFile
    i:/@Newline@/
    MacroCommand = 'window deletecontrol @ControlName@' $MacroCommand
    file Controls
    f;1
    if  (!eof) goto !a400_next
!a400_controls_done
    SystemFileName = '@SystemName@.win'
    write BuilderWindowFile @SystemFileName
    write WindowNav @SystemNavFilename
    write Entryaction @EntryactionFilename
    close Controls error

    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ 
    window close Builder_Control_WIN
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ
    call !y100_Generate    
    return

//******************************
//* Close the Build Window
//******************************
!a400_Builder_Control_Cancel_PBOBJ
    message = 'Are you sure?'
    window message question yesno
    if (!message) return

    //*****************************
    //* remove all Created Controls
    //*****************************
    file Controls error goto !a400_cancel_done
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          ControlName = left
+          //message = 'delete control @ControlName@' window message info ok
+          window deletecontrol @ControlName
+          f;1
+       endif
    until (eof)
    close Controls
!a400_cancel_done
    Builder_Control_Control_EFOBJ = null
    window modify Builder_Control_Control_EFOBJ 
    window close Builder_Control_WIN
    Builder_Window_WindowTitle_EFOBJ = null
    window modify Builder_Window_WindowTitle_EFOBJ
    return


//******************************
//* Open the View File
//******************************
!a500_Builder_View_Open_PBOBJ
    MacroCommand = 'start @SystemName@'
    system:"@MacroCommand@"
    return

//******************************
//* Set the Navigation for a Control
//******************************
!a500_Builder_Nav_Ok_PBOBJ
    window obtain Builder_Nav_WIN
    if  (Builder_Nav_Open_RBOBJ)
+       NavAction = 'open'
+   else
+       NavAction = 'close'
+   endif

    crush Builder_Nav_Windowlist_COOBJ

    if (Builder_Nav_Windowlist_COOBJ = null) and (Builder_Nav_Windowname_STTXT = null)
+       message = 'Please select a Window Name'
+       window message error ok
+       return
+   endif

    if (Builder_Nav_Windowlist_COOBJ = null)
+      Builder_Nav_Windowlist_COOBJ = Builder_Nav_Windowname_STTXT
+   endif

    file WindowNav
    b
    fs:/@ButtonFocus@/
    Newline = "@ButtonFocus@,@Builder_Nav_Windowlist_COOBJ@,@NavAction@"
    if (eof)
+      i:/@Newline@/
+   else
+      r:/@Newline@/
+   endif
    window close Builder_Nav_WIN
    return


//******************************
//* Cancel Navigation
//******************************
!a500_Builder_Nav_Cancel_PBOBJ
    window close Builder_Nav_WIN
    return

//******************************
//* View the Program Comments
//******************************
!a500_Builder_View_Comments_PBOBJ
    int    CommentCount error
    string CommentCountStr error

    window pointer wait
    window open Builder_Comments_WIN shade
    window center Builder_Comments_WIN
    window clear Builder_Comments_WIN
    Builder_Comments_Module_STTXT = Builder_Import_Filename_EFOBJ
    window modify Builder_Comments_Module_STTXT
    if (Extension = 'COB')
+      call !a500_Builder_View_Comments_Cobol
+   endif
    if (Extension = 'BED')
+      call !a500_Builder_View_Comments_Bedit
+   endif
    if (Extension = 'C')
+      call !a500_Builder_View_Comments_C
+   endif
    if (Extension = 'JAVA')
+      //call !a500_Builder_View_Comments_Java
+   endif
    //window disable Builder_Comments_Comments_LBOBJ
    window unshade Builder_Comments_WIN
    window pointer arrow
    return

//************************************
//* COBOL program comments
//************************************
!a500_Builder_View_Comments_Cobol
    file SOURCECODE error return
    b
    fs:/DATE-COMPILED/
    if (eof)
+      b fs:/DATE-WRITTEN/
+      if (eof)
+         b fs:/PROGRAM-ID/
+   endif
    cols 7,7
    fs:/*/
    noco
    CommentCount = 0
!a500_Builder_View_Comments_Cobol_loop
    if (eof) return
    split:/@line/;6
    split:/@right/;1
    if  (left != '*')
+       return
+   endif
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_Cobol_loop
    return

//************************************
//* Bedit program comments
//************************************
!a500_Builder_View_Comments_Bedit
    file SOURCECODE error return
    b
    CommentCount = 0
!a500_Builder_View_Comments_Bedit_loop
    if (eof) return
    scan:/@line/:word
    split:/@left/;2
    if (left != "//") return
    Newline = line
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_Bedit_loop  
    return

//************************************
//* C program comments
//************************************
!a500_Builder_View_Comments_C
    open CComments @Builder_Import_Filename_EFOBJ error return
    b
    CommentCount = 0
!a500_Builder_View_Comments_C_loop
    if (eof) goto !a500_Builder_View_Comments_C_done
    scan:/@line/:word
    split:/@left/;1
    if (left != "/") goto !a500_Builder_View_Comments_C_done
    Newline = line
    CommentCount ++
    CommentCountStr = '000@CommentCount@'
    splitr:/@CommentCountStr@/;3
    Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
    window insert end default Builder_Comments_Comments_LBOBJ
    f;1
    goto !a500_Builder_View_Comments_C_loop  

!a500_Builder_View_Comments_C_done
    close CComments
    return

//******************************
//* Filter the View lines
//******************************
!a500_Builder_View_Filter_PBOBJ
    file ViewFilterList error return
    window pointer wait
    window open Builder_Filter_WIN shade
    window center Builder_Filter_WIN
    window clear Builder_Filter_WIN

    if  (ViewSingleProg)
+       window show Builder_Filter_Comments_PBOBJ
+       window show Builder_Filter_View_PBOBJ
+   else
+       window hide Builder_Filter_Comments_PBOBJ
+       window hide Builder_Filter_View_PBOBJ
+   endif

    Builder_Filter_Windowlist_LBOBJ = 'ALL'
    window delete Builder_Filter_Windowlist_LBOBJ
    b
    do
        if (!eof)
+          scan:/@line/:/,/
+          if (ViewCobol)
+             Builder_Filter_Windowlist_LBOBJ = left
+             size Builder_Filter_Windowlist_LBOBJ,70
+             scanr:/@line/:/,/
+             Builder_Filter_Windowlist_LBOBJ = "@Builder_Filter_Windowlist_LBOBJ@:\|@right@"
+             window insert end default Builder_Filter_Windowlist_LBOBJ
+       endif
        if (!eof)
+          if (!ViewCobol)
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             Builder_Filter_Windowlist_LBOBJ = left
+             size Builder_Filter_Windowlist_LBOBJ,70
+             scanr:/@line/:/,/
+             Builder_Filter_Windowlist_LBOBJ = "@Builder_Filter_Windowlist_LBOBJ@|@right@"
+             window insert end default Builder_Filter_Windowlist_LBOBJ
+       endif
        f;1
    until (eof)
    Builder_Filter_Windowlist_STTXT = 'Functions'
    if (Extension = 'COB')  Builder_Filter_Windowlist_STTXT = 'Paragraphs'
    if (Extension = 'C')    Builder_Filter_Windowlist_STTXT = 'Functions'
    if (Extension = 'BED')  Builder_Filter_Windowlist_STTXT = 'Modules'
    if (Extension = 'JAVA') Builder_Filter_Windowlist_STTXT = 'Classes'
    if (ViewBuilderWindow = 'y') Builder_Filter_Windowlist_STTXT = 'Windows'
    window modify Builder_Filter_Windowlist_STTXT
    window unshade Builder_Filter_WIN
    window pointer arrow
    return

//******************************
//* Cancel View
//******************************
!a500_Builder_View_Cancel_PBOBJ
    window pointer wait
    ViewSingleProg = 'n'
    file ViewObjects error goto !a500_view_done
    b
!a500_view_loop
    if (eof) goto !a500_view_done
    window deletecontrol @line
    f;1
    goto !a500_view_loop

!a500_view_done
    close ViewObjects error
    window close Builder_View_WIN

    //**********************************
    //* Delete View Win/Nav Files
    //**********************************
    if (ViewCobol)
+      if (Extension = 'COB')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @CobolWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @CobolNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'BED')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @BeditCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @BeditCodeNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'C')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @CCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @CCodeNavName@"' $MacroCommand
+   endif
    if (ViewCobol)
+      if (Extension = 'JAVA')
+         close SOURCECODE error
+         MacroCommand = 'system:"del @JavaCodeWinName@"' $MacroCommand
+         MacroCommand = 'system:"del @JavaCodeNavName@"' $MacroCommand
+   endif
    ViewCobol = 'n'

    //**********************************
    //* Delete Downloaded COBOL Source
    //**********************************
    if  (COBOL3090)
+       MacroCommand = 'system:"del @Programname3090@"' $MacroCommand //message = MacroCommand window message info ok
+       COBOL3090 = 'n'
+   endif

    ViewBuilderWindow = 'n'
    window pointer arrow
    return

//******************************
//* Filter the View Lines drawn
//******************************
!a550_Builder_Filter_OK_PBOBJ
    window obtain Builder_Filter_Windowlist_LBOBJ
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = 'Please select a Filter'
+       window message error ok
+       return
+   endif
    window pointer wait
    //*********************
    //* Backup ViewList
    //*********************
    file ViewList
    b
    copy;*
    close ViewListTemp error
    open ViewListTemp null
    paste
    write ViewListTemp viewlisttemp.dat
    //*********************
    //* Clear ViewList
    //*********************
    write ViewList viewlist-pre.dat
    file ViewList
    b
    d;*
    //*********************
    //* Find the Selections
    //*********************
    Builder_Filter_Windowlist_LBOBJ = 'FIRST'

    do  
        window obtain Builder_Filter_Windowlist_LBOBJ
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'COB')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /
+                  SearchString = ',@left@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'BED')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
+                  SearchString = ',@left@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'C')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+                  SearchString = ',@right@'
+       endif
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (ViewCobol)
+              if  (Extension = 'JAVA')
+                  scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+                  SearchString = ',@right@'
+       endif

        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           if (!ViewCobol)
+               scan:/@Builder_Filter_Windowlist_LBOBJ@/:/|/
+               SearchString = ',@right@'
+       endif

        //message = 'Searching for[@SearchString@]' window message info ok



        if  (Builder_Filter_Windowlist_LBOBJ = null)
+           goto !a550_Builder_Filter_done
+       endif

        file ViewListTemp
        b

!a550_Builder_Filter_loop
        //****************************
        //* Copy Screen Name to ViewList
        //****************************
        //message = SearchString window message info ok
        fs:/@SearchString@/
        if (!eof)
+          scan:/@line/:/@SearchString@/
+          pack right
+          if (right = null)
+             copy
+             file ViewList
+             paste
+             goto !a550_Builder_Filter_next
+       endif
        if (!eof)
+          f;1
+          goto !a550_Builder_Filter_loop
+       endif

!a550_Builder_Filter_next
        if  (Builder_Filter_Windowlist_LBOBJ != null)
+           Builder_Filter_Windowlist_LBOBJ = 'NEXT'
+       endif
    until (Builder_Filter_Windowlist_LBOBJ = null)

!a550_Builder_Filter_done
    write ViewList ViewList1.dat
    b

    //*********************
    //* Filter WindowNav
    //*********************
    string DeleteRec error
    file WindowNav
    b
    copy;*
    open WindowNavTemp null error file WindowNavTemp b d;*
    paste
    close ViewListBorder error
    open ViewListBorder null
    file ViewList
    b
    copy;*
    file ViewListBorder
    paste
    b
    do
        if (!eof)
+          Newline = '@line@+FGB'
+          r:/@Newline@/
+       endif
        f;1
    until (eof)
    file WindowNav
    b
    do-nav  
        DeleteRec = 'n'
        if (!eof)
+          scan:/@line/:/_/
+          scan:/@right/:/_/
+          SearchString = ',@left@+FGB'
+          file ViewListBorder //message = 'Checking 1 [@SearchString@]' window message info ok
+          b
+          fs:/@SearchString@/
+          if (eof)
+             file WindowNav
+             scan:/@line/:/,/
+             scan:/@right/:/,/
+             SearchString = ',@left@+FGB'
+             file ViewListBorder //message = 'Checking 2 [@SearchString@]' window message info ok
+             b
+             fs:/@SearchString@/
+             if (eof)
+                DeleteRec = 'y' //message = 'deleting 1' window message info ok
+       endif
        file WindowNav
        if  (DeleteRec)
+           //message = 'deleting 2[@line@]' window message info ok
+           d;1  
+       else
+           //message = 'Keeping 2[@line@]' window message info ok
+           f;1  
+       endif
    until-nav (eof) 
    close ViewListBorder  

    write WindowNav ViewWindowNavTemp.dat 

    //*********************
    //* Add windows touched
    //*********************
    close ViewListAdd error
    open ViewListAdd null
    file ViewList
    b
!a550_filter_ok_add_touched_loop
    if (eof) goto !a550_filter_touched_done
    scan:/@line/:/,/
    WindowName = right

    file ViewListTemp
    b
    copy;*
    close ViewListFGB error
    open ViewListFGB null
    paste
    b
    do
        if (!eof)
+          Newline = '@line@+FGB'
+          r:/@Newline@/
+       endif
        f;1
    until (eof)

    file WindowNav
    b

!a550_filter_find_window_loop
    SearchString = "_@WindowName@_"
    fs:/@SearchString@/
    if (eof) goto !a550_filter_touched_next

    scanr:/@line/:/,/
    if (right != 'open') goto !a550_filter_touched_test2
    scan:/@line/:/_/
    scan:/@right/:/_/
    SearchString = left //message = 'Search1[@SearchString@]' window message info ok
    if  (SearchString != WindowName)
+       file ViewListFGB 
+       b
+       SearchString = ',@SearchString@+FGB'
+       fs:/@SearchString@/
+       if (!eof)
+          call !a550_add_filter_window
+   endif

!a550_filter_touched_test2
    file WindowNav
    scanr:/@line/:/,/
    if (right != 'open') goto !a550_filter_find_Window_next
    scan:/@line/:/,/
    scan:/@right/:/,/
    SearchString = left //message = 'Search2[@SearchString@]' window message info ok
    if  (SearchString != WindowName)
+       file ViewListFGB 
+       b
+       SearchString = ',@SearchString@+FGB'
+       fs:/@SearchString@/
+       if (!eof)
+          call !a550_add_filter_window    
+   endif

!a550_filter_find_Window_next
    //***********************
    //* Next WindowNav Record
    //***********************
    file WindowNav
    f;1
    goto !a550_filter_find_window_loop

!a550_filter_touched_next
    //***********************
    //* Next ViewList Record
    //***********************
    file ViewList
    f;1
    goto !a550_filter_ok_add_touched_loop

!a550_filter_touched_done
    close ViewListFGB error
    file ViewListAdd
    b
    clear
    copy;*
    write ViewListAdd ViewListAdd.dat
    close ViewListAdd

    file ViewList
    f;*
    paste
    write ViewList ViewWindowListTemp.dat

    //*********************
    //* Delete View Objects
    //*********************
    file ViewObjects error goto !a550_no_objects
    b
    do
        if (!eof)
+          window deletecontrol @line
+       endif
        f;1
    until (eof)
    close ViewObjects

!a550_no_objects
    window paint Builder_View_WIN
    //message = 'fresh screen' window message info ok

    //*********************
    //* Redraw the View
    //*********************
    call !v200_viewlist_push_levels_down
    //call !v200_viewlist_eliminate_gaps
    call !v100_view_redraw
    window paint Builder_View_WIN

    //*********************
    //* Restore ViewList
    //*********************
    file ViewListTemp
    b
    copy;*
    file ViewList
    b
    d;*
    paste
    close ViewListTemp


    //*********************
    //* Restore WindowNav
    //*********************
    file WindowNavTemp
    b
    copy;*
    file WindowNav
    b
    d;*
    paste
    close WindowNavTemp

    window close Builder_Filter_WIN
    window paint Builder_View_WIN
    window pointer arrow
    return


//****************************
//* Add data to ViewListAdd
//****************************
!a550_add_filter_window
    //message = 'Check Add [@line@]' window message info ok
    Newline = line
    scan:/@Newline/:/+FGB/
    Newline = left
    file ViewListAdd
    b
    fs:/@Newline@/
    if  (eof) i:/@Newline@/ //message = 'Added[@Newline@]' window message info ok
    return
    

//******************************
//* Close the Filter Window
//******************************
!a550_Builder_Filter_Cancel_PBOBJ
    window pointer wait
    //*********************
    //* Delete View Objects
    //*********************
    file ViewObjects error goto !a550_cancel_next
    b
    do
        if (!eof)
+          window deletecontrol @line
+       endif
        f;1
    until (eof)
!a550_cancel_next
    close ViewObjects error
    call !v100_view
    window close Builder_Filter_WIN
    window paint Builder_View_WIN
    window pointer arrow
    return

//******************************
//* Filter List Action
//******************************
!a550_Builder_Filter_Windowlist_LBOBJ
    call !a550_Builder_Filter_OK_PBOBJ
    return

//******************************
//* Filter List Action
//******************************
//******************************
//* View Comments
//******************************
!a550_Builder_Filter_Comments_PBOBJ
    window obtain Builder_Filter_WIN
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = "Please select a window/process"
+       window message error ok
+       return
+   endif 

    window pointer wait
    window open Builder_Comments_WIN shade
    window clear Builder_Comments_WIN    
    window center Builder_Comments_WIN

    scan:/@Builder_Filter_Windowlist_LBOBJ/:word
    Builder_Comments_Module_STTXT = left
    pack Builder_Comments_Module_STTXT
    window modify Builder_Comments_Module_STTXT
    //*************************************
    //* Fill the Window comments
    //*************************************
    if  (ViewCobol) and (Extension = 'COB')
+       call !j100_cobol_comments
+   endif
    if  (ViewCobol) and (Extension = 'BED')
+       call !j200_bedit_comments
+   endif
    if  (ViewCobol) and (Extension = 'C')
+       call !j300_c_comments
+   endif
    if  (ViewCobol) and (Extension = 'JAVA')
+       //call !j400_java_comments
+   endif

    window disable Builder_Comments_Comments_LBOBJ
    window unshade Builder_Comments_WIN
    window pointer arrow
    return

//******************************
//* View code module
//******************************
!a550_Builder_Filter_View_PBOBJ
    window obtain Builder_Filter_WIN
    if  (Builder_Filter_Windowlist_LBOBJ = null)
+       message = "Please select a window/process"
+       window message error ok
+       return
+   endif
    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /
    Builder_Filter_Windowlist_LBOBJ = left
    close ProgModule error
    open ProgModule null

    //*************************************
    //* Fill the Window comments
    //*************************************
    if  (ViewCobol) and (Extension = 'COB')
+       call !k100_cobol_module
+   endif
    if  (ViewCobol) and (Extension = 'BED')
+       call !k200_bedit_module
+   endif
    if  (ViewCobol) and (Extension = 'C')
+       call !k300_c_module
+   endif
    if  (ViewCobol) and (Extension = 'JAVA')
+       //call !k400_java_module
+   endif

    write ProgModule ProgModule.txt
    MacroCommand = 'start ProgModule.txt'
    system:"@MacroCommand@"
    return
    

//******************************
//* Close Comments Window
//******************************
!a560_Builder_Comments_OK_PBOBJ
    window close Builder_Comments_WIN
    return

//******************************
//* Search for COBOL files
//******************************
!a600_Builder_Import_Lookup_PBOBJ
    window obtain Builder_Import_WIN
    if  (Builder_Import_Extension_EFOBJ = null)
+       message = 'Please enter an Extension'
+       window message error ok
+       window setfocus Builder_Import_Extension_EFOBJ
+       return
+   endif
    //**************************
    //* Fix entered Extension
    //**************************
    scan:/@Builder_Import_Extension_EFOBJ@/:/./
    if (found)
+      Builder_Import_Extension_EFOBJ = '@left@@right@'
+   endif
    upper Builder_Import_Extension_EFOBJ
    crush Builder_Import_Extension_EFOBJ
    window modify Builder_Import_Extension_EFOBJ

    if  (Builder_Import_Extension_EFOBJ != 'COB') and (Builder_Import_Extension_EFOBJ != 'BED') and (Builder_Import_Extension_EFOBJ != 'C') and (Builder_Import_Extension_EFOBJ != 'JAVA')
+       message = 'Extension must = 'JAVA (Java), COB (COBOL), BED (BEDIT), C (C code)'
+       window message error ok
+       window setfocus Builder_Import_Extension_EFOBJ
+       return
+   endif
    window pointer wait
    if  (Builder_Import_Directory_EFOBJ = null)
+       MacroCommand = 'dir *.@Builder_Import_Extension_EFOBJ@'
+   else
+       MacroCommand = 'dir @Builder_Import_Directory_EFOBJ@\*.@Builder_Import_Extension_EFOBJ@'
+   endif

    Directory = Builder_Import_Directory_EFOBJ
    Extension = Builder_Import_Extension_EFOBJ  

    open Cobolfiles null
    b d;*
    systemcurr:"@MacroCommand@"
    b
    b
    d;5
    f;*
    b;1
    d;*
    b
    Builder_Import_Files_COOBJ = 'ALL'
    window delete Builder_Import_Files_COOBJ
    do
       if (!eof) 
+         scan:/@line/:word
+         scan:/@right/:word
+         scan:/@right/:word
+         scan:/@right/:word
+         Builder_Import_Files_COOBJ = right
+         window insert end default Builder_Import_Files_COOBJ
+         r:/@left@/
+      endif
       f;1
    until (eof)
    close Cobolfiles
    window pointer arrow
    return

//******************************
//* Import a COBOL program
//******************************
!a600_Builder_Import_3090_PBOBJ
    window pointer wait
    window conceal Builder_3090_Password_EFOBJ
    window open Builder_3090_WIN shade
    window center Builder_3090_WIN
    window clear Builder_3090_WIN

    //*************************
    //* Update Userid/Password
    //*************************
    if  (Userid3090 != null)
+       Builder_3090_Userid_EFOBJ = Userid3090
+       window modify Builder_3090_Userid_EFOBJ
+   endif
    if  (Password3090 != null)
+       Builder_3090_Password_EFOBJ = Password3090
+       window modify Builder_3090_Password_EFOBJ
+   endif

    //*************************
    //* Update Login Loc
    //*************************
    if (LoginLoc3090 = 'test')
+      Builder_3090_Test_RBOBJ = 'Y'
+      Builder_3090_Prod_RBOBJ = 'N'
+   else
+      Builder_3090_Test_RBOBJ = 'N'
+      Builder_3090_Prod_RBOBJ = 'Y'
+   endif
    window modify Builder_3090_Prod_RBOBJ
    window modify Builder_3090_Test_RBOBJ

    //*************************
    //* Update Source Loc
    //*************************
    if  (SourceLoc3090 = 'test')
+      Builder_3090_Testsrc_RBOBJ = 'Y'
+      Builder_3090_Prodsrc_RBOBJ = 'N'
+   else
+      Builder_3090_Testsrc_RBOBJ = 'N'
+      Builder_3090_Prodsrc_RBOBJ = 'Y'
+   endif
    window modify Builder_3090_Prodsrc_RBOBJ
    window modify Builder_3090_Testsrc_RBOBJ

    //*************************
    //* Update User Full Filename
    //*************************
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/(/
    if (found) Userfilename3090 = '@left@()'
    Builder_3090_Fullname_EFOBJ = Userfilename3090
    window modify Builder_3090_Fullname_EFOBJ

    if (Builder_3090_Userid_EFOBJ != null)
+      if  (Builder_3090_Fullname_EFOBJ = null)
+          window setfocus Builder_3090_Filename_EFOBJ
+   endif
    if (Builder_3090_Userid_EFOBJ != null)
+      if  (Builder_3090_Fullname_EFOBJ != null)
+          window setfocus Builder_3090_Fullname_EFOBJ
+   endif
    
    window unshade Builder_3090_WIN
    window pointer arrow
    return

//******************************
//* Import a program
//******************************
!a600_Builder_Import_OK_PBOBJ
    ViewSingleProg = 'y'

    window obtain Builder_Import_WIN

    if  (Builder_Import_Extension_EFOBJ = 'java') or (Builder_Import_Extension_EFOBJ = 'JAVA')
+       Builder_Import_Extension_EFOBJ = 'JAVA'
+       window modify Builder_Import_Extension_EFOBJ
+       Extension = Builder_Import_Extension_EFOBJ
+   endif
    if  (Builder_Import_Files_COOBJ != null)
+       if  (Builder_Import_Directory_EFOBJ = null)
+           Builder_Import_Filename_EFOBJ = Builder_Import_Files_COOBJ
+   endif
    if  (Builder_Import_Files_COOBJ != null)
+       if  (Builder_Import_Directory_EFOBJ != null)
+           Builder_Import_Filename_EFOBJ = '@Builder_Import_Directory_EFOBJ@\@Builder_Import_Files_COOBJ@'
+   endif
    window modify Builder_Import_Filename_EFOBJ

    crush Builder_Import_Filename_EFOBJ
    if (Builder_Import_Filename_EFOBJ = null) and (Extension != 'JAVA')
+      message = 'Please enter a Filename"
+      window message error ok
+      window setfocus Builder_Import_Filename_EFOBJ
+      return
+   else
+      if (Extension = 'JAVA')
+         goto !a600_Builder_Import_OK_java
+   endif

!a600_Builder_Import_OK_bedit_batch
    scanr:/@Builder_Import_Filename_EFOBJ@/:/./
    if  (!found)
+       goto !a600_bad_extension
+   endif
    Extension = right
    upper Extension

    if (Extension = 'COB') goto !a600_good_extension
    if (Extension = 'BED') goto !a600_good_extension
    if (Extension = 'C') goto !a600_good_extension
    if (Extension = 'JAVA') goto !a600_good_extension

!a600_bad_extension
    message = 'Extension must = 'COB (COBOL), BED (BEDIT), C (C), JAVA (Java)'
    window message error ok
    window setfocus Builder_Import_Filename_EFOBJ
    return

!a600_good_extension
    Builder_Import_Extension_EFOBJ = right
    window modify Builder_Import_Extension_EFOBJ
    window pointer wait
    SystemName = Builder_Import_Filename_EFOBJ

    close SOURCECODE error

    open SOURCECODE @Builder_Import_Filename_EFOBJ error goto !a600_Builder_Import_Nofile

!a600_Builder_Import_OK_java
    close ViewFilterList error
    open ViewFilterList null

    if  (Extension = 'COB') call !i100_import_cobol
    if  (Extension = 'BED') call !i200_import_bedit
    if  (Extension = 'C') call !i300_import_c
    if  (Extension = 'JAVA') call !i400_import_java

    //window close Builder_Import_WIN
    close BuilderWindowFile error
    close WindowList error
    open WindowList null
    close WindowNav error
    if  (Extension = 'COB') open BuilderWindowFile @CobolWinName error return
    if  (Extension = 'BED') open BuilderWindowFile @BeditCodeWinName error return
    if  (Extension = 'C') open BuilderWindowFile @CCodeWinName error return
    if  (Extension = 'JAVA') open BuilderWindowFile @JavaCodeWinName error return
    b
    do
        if (!eof)
+          split:/@line/;6
+          if  (left = 'WINDOW')
+              call !a600_builder_inport_windowname
+              file WindowList
+              i:/@WindowName@/
+       endif
        file BuilderWindowFile
        f;1
    until (eof)

    if  (Extension = 'COB') open WindowNav @CobolNavName
    if  (Extension = 'BED') open WindowNav @BeditCodeNavName
    if  (Extension = 'C') open WindowNav @CCodeNavName
    if  (Extension = 'JAVA') open WindowNav @JavaCodeNavName

    ViewCobol = 'y'
    call !a300_Builder_Window_View_PBOBJ_2
    ViewCobol = 'y'
    return

!a600_builder_inport_windowname
    scan:/@line/:/,/
    scan:/@right/:/,/
    WindowName = left
    scan:/@WindowName@/:/_/
    if (found)
+      scan:/@right/:/_/
+      WindowName = left
+   endif
    return

!a600_Builder_Import_Nofile
    window pointer arrow
    message = 'Unable to open @Builder_Import_Filename_EFOBJ@'
    window message error ok
    return

//******************************
//* Cancel View
//******************************
!a600_Builder_Import_Cancel_PBOBJ
    window close Builder_Import_WIN
    close BuilderWindowFile error
    close WindowNav error
    close WindowList error
    return

//******************************
//* Import Directory Lookup
//******************************
!a600_Builder_Import_Browse_PBOBJ
    DirField = "Builder_Import_Directory_EFOBJ"
    FileField = "Builder_Import_Filename_EFOBJ"
    window obtain Builder_Import_Directory_EFOBJ
    Directory = Builder_Import_Directory_EFOBJ
    window obtain Builder_Import_Extension_EFOBJ
    Extension = Builder_Import_Extension_EFOBJ
    call !s100_directory
    return

//******************************
//* Copy Directory Lookup
//******************************
!a600_Builder_Import_Copydir_PBOBJ
    DirField = "Builder_Import_Copydir_EFOBJ"
    FileField = null
    window obtain Builder_Import_Copydir_EFOBJ
    Directory = Builder_Import_Copydir_EFOBJ
    call !s100_directory
    return

//******************************
//* 3090 OK - Download COBOL
//******************************
!a650_Builder_3090_Ok_PBOBJ
    window obtain Builder_3090_WIN

    //*************************
    //* Save 3090 Fields
    //*************************
    crush Builder_3090_Userid_EFOBJ
    if (Builder_3090_Userid_EFOBJ = 'null')
+      message = 'Please enter a 3090 Userid'
+      window message error ok
+      window setfocus Builder_3090_Userid_EFOBJ
+      return
+   endif
    crush Builder_3090_Password_EFOBJ
    if (Builder_3090_Password_EFOBJ = 'null')
+      message = 'Please enter a 3090 Password'
+      window message error ok
+      window setfocus Builder_3090_Password_EFOBJ
+      return
+   endif

    Userid3090 = Builder_3090_Userid_EFOBJ
    Password3090 = Builder_3090_Password_EFOBJ
    if (Builder_3090_Test_RBOBJ)
+      LoginLoc3090 = 'test'
+   else
+      LoginLoc3090 = 'prod'
+   endif

    if (Builder_3090_Testsrc_RBOBJ)
+      SourceLoc3090 = 'test'
+   else
+      SourceLoc3090 = 'prod'
+   endif 

    crush Builder_3090_Fullname_EFOBJ
    Userfilename3090 = Builder_3090_Fullname_EFOBJ
    if (Builder_3090_Fullname_EFOBJ = null) goto !a650_fullname_done
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/'/
    if (found) Userfilename3090 = '@left@@right@'
    scan:/@Userfilename3090@/:/(/
    if (found)
+      scan:/@Userfilename3090@/:/)/
+   endif
    if (!found)
+      message = 'Invalid file name, must contain ()'
+      window message error ok
+      window  setfocus Builder_3090_Fullname_EFOBJ
+      return
+   endif

!a650_fullname_done
    crush Builder_3090_Filename_EFOBJ
    if (Builder_3090_Filename_EFOBJ = 'null') and (Builder_3090_Fullname_EFOBJ = 'null')
+      message = 'Please enter a File Name'
+      window message error ok
+      window setfocus Builder_3090_Filename_EFOBJ
+      return
+   endif    

    //*****************************************
    //* FTP get the COBOL source from the 3090
    //*****************************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/

    if (SourceLoc3090 = 'test') and (Builder_3090_Fullname_EFOBJ = null)
+      Programname3090 = '@Builder_3090_Filename_EFOBJ@.cob'
+      Newline = "get '@Testsrcelib3090@(@Builder_3090_Filename_EFOBJ@)' @Programname3090@"
+      goto !a650_ftp
+   endif
    if (SourceLoc3090 = 'prod') and (Builder_3090_Fullname_EFOBJ = null)
+      Programname3090 = '@Builder_3090_Filename_EFOBJ@.cob'
+      Newline = "get '@Prodsrcelib3090@(@Builder_3090_Filename_EFOBJ@)' @Programname3090@"
+      goto !a650_ftp
+   endif
    scan:/@Builder_3090_Fullname_EFOBJ@/:/(/
    scan:/@right/:/)/
    Programname3090 = '@left@.cob'
    Newline = "get '@Builder_3090_Fullname_EFOBJ@' @Programname3090@"

!a650_ftp
    //**********************************
    //* Remove Old File
    //**********************************
    MacroCommand = 'system:"del @Programname3090@"'
    $MacroCommand

    //**********************************
    //* FTP Get
    //**********************************
    i:/@Newline@/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"
    window pointer arrow

    MacroCommand = "    if (!exists @Programname3090@) goto !a650_bad_ftp" $MacroCommand
    //open CobolFile @Programname3090 error goto !a650_bad_ftp
    //close CobolFile
    window close Builder_3090_WIN
    Builder_Import_Filename_EFOBJ = Programname3090
    window modify Builder_Import_Filename_EFOBJ
    Builder_Import_Extension_EFOBJ = 'COB'
    window modify Builder_Import_Extension_EFOBJ
    Builder_Import_Files_COOBJ = null
    window modify Builder_Import_Files_COOBJ
    COBOL3090 = 'y'
    call !a600_Builder_Import_OK_PBOBJ
    return

!a650_bad_ftp
    message = 'Error downloading file from 3090'
    window message error ok
    return   


//******************************
//* Close 3090 Download Screen
//******************************
!a650_Builder_3090_Cancel_PBOBJ
    window close Builder_3090_WIN
    return

//******************************
//* Set the Entry Field Action
//******************************
!a700_Builder_Entryaction_Set_PBOBJ
    window obtain Builder_Entryaction_WIN
    if  (Builder_Entryaction_Size_EFOBJ < 1)
+       message = 'Field Size must be > 0'
+       window message error ok
+       return
+   endif
    if  (Builder_Entryaction_Size_EFOBJ > 100)
+       message = 'Field Size must be <= 100'
+       window message error ok
+       return
+   endif
    EntryFieldAction = null
    if  (Builder_Entryaction_Alpha_RBOBJ) EntryFieldAction = 'alpha'
    if (Builder_Entryaction_Numeric_RBOBJ) EntryFieldAction = 'numeric'
    if (Builder_Entryaction_Uppercase_RBOBJ) EntryFieldAction = 'upper'
    if (Builder_Entryaction_Lowercase_RBOBJ) EntryFieldAction = 'lower'
    if (Builder_Entryaction_Mixedcase_RBOBJ) EntryFieldAction = 'mix'
    if (Builder_Entryaction_Date_RBOBJ) EntryFieldAction = 'date'
    if (Builder_Entryaction_Dollar_RBOBJ) EntryFieldAction = 'dollar' 
    if (Builder_Entryaction_Phone_RBOBJ) EntryFieldAction = 'telephone' Builder_Entryaction_Size_EFOBJ = '14' window modify Builder_Entryaction_Size_EFOBJ
    if (Builder_Entryaction_Text_RBOBJ) EntryFieldAction = 'text'
    if  (EntryFieldAction = null)
+       message = 'Please select an Action'
+       window message error ok
+       return
+   endif

    //message = '[Password[@Builder_Entryaction_Password_CBOBJ@]' window message info ok
    if (Builder_Entryaction_Password_CBOBJ) EntryFieldAction = '@EntryFieldAction@-P'

    Newline = '@Builder_Control_Control_EFOBJ@,@EntryFieldAction@,@Builder_Entryaction_Size_EFOBJ@'
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (!eof)
+      r:/@Newline/
+   else
+      i:/@Newline/
+   endif

    window close Builder_Entryaction_WIN
    return

//******************************
//* Delete the Entry Field Action
//******************************
!a700_Builder_Entryaction_Delete_PBOBJ
    message = 'Are you sure?'
    window message question yesno
    if  (!message) return
    file Entryaction
    b
    fs:/@Builder_Control_Control_EFOBJ@/
    if (!eof)
+      d
+   endif
    window close Builder_Entryaction_WIN
    return

//******************************
//* Set the Entry Field Action
//******************************
!a700_Builder_Entryaction_Cancel_PBOBJ
    window close Builder_Entryaction_WIN
    return

//******************************
//* Callflow Directory Lookup
//******************************
!a800_Builder_Callflow_Directory_PBOBJ
    DirField = "Builder_Callflow_Directory_EFOBJ"
    FileField = null
    window obtain Builder_Callflow_Directory_EFOBJ
    Directory = Builder_Callflow_Directory_EFOBJ
    call !s100_directory
    return

//******************************
//* Build the COBOL Callflow
//******************************
!a800_Builder_Callflow_Ok_PBOBJ
    ViewSingleProg = 'n'
    //message = "Builder_Callflow_Ok_PBOBJ" window message info ok
    if  (Reenter) 
+       window setfocus Builder_Progress_Cancel_PBOBJ
+       window paint Builder_Progress_WIN
+       goto !a800_Builder_Callflow_Reenter
+   endif
    string CobolFilename    error
    string CobolFromName    error
    string CobolToName      error

    window obtain Builder_Callflow_Directory_EFOBJ
    pack Builder_Callflow_Directory_EFOBJ
    if  (Builder_Callflow_Directory_EFOBJ = null)
+       message = "Please enter a directory"
+       window message error ok
+       window setfocus Builder_Callflow_Directory_EFOBJ
+       return
+   endif 
    Directory = Builder_Callflow_Directory_EFOBJ

    MacroCommand = "dir @Builder_Callflow_Directory_EFOBJ@\*.cob"

    close CobolCalls error
    open CobolCalls null
    i:/999999 PROCEDURE DIVISION./

    close CobolList error
    open CobolList null
    systemcurr:"@MacroCommand@"
    b
    d;5
    f;*
    b;1
    d;*
    b

    write CobolList CobolList.dat
    b

    window open Builder_Progress_WIN shade
    window center Builder_Progress_WIN
    window windowpos Builder_Progress_Progressframe_STTXT Progframex Progframey Progframecx Progframecy
    window windowpos Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    window size Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    ProgressMax = Progcx - 4

    f;*
    ProgressCount = pcount + 1

    if (ProgressCount) Progress = Progcx / ProgressCount
    //message = 'Files[@ProgressCount@] Progress[@Progress@] Progcx[@Progcx@]' window message info ok    
    b

    Progx += 2
    Progy += 2
    Progcx = 1
    Progcy -= 4
    window size Builder_Progress_Progress_STTXT Progx Progy Progcx Progcy
    ProgressShow = Progcx
    window unshade Builder_Progress_WIN

!a800_Builder_Callflow_Reenter
!a800_dirlist_loop
    if (eof) goto !a800_dirlist_done
    ProgressWork = ProgressShow + Progress
    Progcx = ProgressWork
    if  (Progcx > ProgressMax) 
+       Progcx = ProgressMax
+   endif
    ProgressShow = ProgressWork
    window size Builder_Progress_Progress_STTXT @Progx @Progy @Progcx @Progcy
    window size Builder_Progress_Progressframe_STTXT @Progframex @Progframey @Progframecx @Progframecy
    window modify Builder_Progress_Progress_STTXT
    window paint Builder_Progress_Progress_STTXT
    window modify Builder_Progress_Progressframe_STTXT
    window paint Builder_Progress_Progressframe_STTXT
    window paint Builder_Progress_WIN
    scan:/@line/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    CobolFilename = '@Builder_Callflow_Directory_EFOBJ@\@right@'
    CobolFromName = right
    scan:/@CobolFromName@/:/-/
    if (found) goto !a800_next_cobol
    scan:/@CobolFromName@/:/./
    CobolFromName = left
    close SOURCECODE error
    //message = 'reading[@CobolFilename@] Progress x[@Progx@] y[@Progy@] Progcx[@Progcx@] Progcy[@Progcy@]' window message info ok
    open SOURCECODE @CobolFilename error goto !a800_next_cobol
    //*****************************
    //* Find CICS LINK
    //*****************************
    //message = 'EXEC CICS LINK' window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_transfer_control
    do
        if (eof) goto !a800_transfer_control
        fs:/EXEC CICS LINK/
        if (eof) goto !a800_transfer_control 
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_cics
        scan:/@line/:/ PROGRAM/
        if (!found) goto !a800_next_cics
        scan:/@right/:/'/
        if  (!found) goto !a800_next_cics
        scan:/@right/:/'/
        if  (!found) goto !a800_next_cics
        CobolToName = left
        crush CobolToName
 
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_cics
        file SOURCECODE
        f;1
    until (EOF)

!a800_transfer_control
    //*****************************
    //* Find TRANSFER CONTROL
    //*****************************
    //message = 'TRANSFER CONTROL' window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_call_cobol
    do
        if (eof) goto !a800_call_cobol
        fs:/ TRANSFER CONTROL /
        if (eof) goto !a800_call_cobol
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_transfer
        scan:/@line/:/ TRANSFER CONTROL /
        if (!found) goto !a800_next_transfer
        scan:/@right/:/'/
        if  (!found) goto !a800_next_transfer
        scan:/@right/:/'/
        if  (!found) goto !a800_next_transfer
        CobolToName = left
        crush CobolToName
  
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_transfer
        file SOURCECODE
        f;1
     until (eof)    

!a800_call_cobol
    //*****************************
    //* CALL ' '
    //*****************************
    //message = |CALL ' '| window message info ok
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof) goto !a800_next_cobol
    do
        if (eof) goto !a800_next_cobol
        fs:/ CALL /
        if (eof) goto !a800_next_cobol
        //message = line window message info ok
        split:/@line/;6
        split:/@right/;1
        if (left != ' ') goto !a800_next_call
        scan:/@line/:/ CALL /
        if (!found) goto !a800_next_call
        scan:/@right/:/'/
        if  (!found) goto !a800_next_call
        scan:/@right/:/'/
        if  (!found) goto !a800_next_call
        CobolToName = left
        crush CobolToName
  
        //***********************
        //* Update CobolCalls 
        //***********************
        file CobolCalls
        f;*
        Newline = '000000 @CobolFromName@-'
        i:/@Newline@/
        Newline = '000000      PERFORM @CobolToName@- THRU @CobolToName@-EXIT.'
        i:/@Newline@/
!a800_next_call
        file SOURCECODE
        f;1
     until (eof)    

!a800_next_cobol
    file CobolList
    f;1

    if  (!eof)
+       //*****************************************
+       //* Push OK again and re-enter this process
+       //* Allows for repainting the progress
+       //*****************************************
+       Reenter = 'y' //message = 'pushing Builder_Callflow_Ok_PBOBJ' window message info ok
+       window push Builder_Callflow_Ok_PBOBJ
+       return
+   endif

    goto !a800_dirlist_loop

!a800_dirlist_done 
    Reenter = 'n'
    //*****************************
    //* Remove programs w/o calls
    //*****************************
    goto !a800_pass_del
    file CobolCalls
    b
    do  
        b
        fs:/000000 /
        if (!eof)
+          rs:/000000 /:/999999 /
+       endif 
        if (!eof)
+          split:/@line/;7
+          split:/@right/;1
+          if (left != ' ')
+          f;1
+          scan:/@line/:/ PERFORM /
+          if (!found)
+             b;1
+             d;1
+       endif
    until (eof)
    scan:/@line/:/ PROCEDURE DIVISION/
    if (!found)
+      scan:/@line/:/ PERFORM /
+      if (!found)
+         d
+   endif

!a800_pass_del

    write CobolCalls COBOLCALLS.COB
    close CobolCalls
    //*****************************
    //* Setup for View call
    //*****************************
    //Builder_Import_Directory_EFOBJ = null
    //Directory = null
    Builder_Import_Filename_EFOBJ = 'COBOLCALLS.COB'
    Builder_Import_Extension_EFOBJ = 'COB'
    Extension = 'COB'
    Builder_Import_Files_COOBJ = null
    window close Builder_Progress_WIN
    call !a600_good_extension
    return

//******************************
//* Build the COBOL Callflow
//******************************
!a800_Builder_Callflow_Cancel_PBOBJ
    window close Builder_Callflow_WIN
    return

//******************************
//* Cancel Progress
//******************************
!a900_Builder_Progress_Cancel_PBOBJ
    window close Builder_Progress_WIN
    return

//******************************
//* Download 3090 files
//******************************
!a1000_Builder_Download3090_Ok_PBOBJ
    string DownloadFilename  error
    int    DownloadFileCount error
    int    Copyfilecount     error

    window obtain Builder_Download3090_WIN
    crush Builder_Download3090_Userid_EFOBJ
    if (Builder_Download3090_Userid_EFOBJ != null)
+      Userid3090 = Builder_Download3090_Userid_EFOBJ
+   else
+      Userid3090 = null
+   endif
    crush Builder_Download3090_Password_EFOBJ
    if (Builder_Download3090_Password_EFOBJ != null)
+      Password3090 = Builder_Download3090_Password_EFOBJ
+   else
+      Password3090 = null
+   endif
    if (Builder_Download3090_Test_RBOBJ)
+      LoginLoc3090 = 'test'
+   else
+      LoginLoc3090 = 'prod'
+   endif
    DownloadFrom = Builder_Download3090_From_EFOBJ
    crush DownloadFrom
    DownloadTo = Builder_Download3090_To_EFOBJ
    crush DownloadTo
    Extension = Builder_Download3090_Extension_EFOBJ
    crush Extension
    scan:/@Extension@/:/./
    if (found)
+      Extension = '@left@@right@'
+   endif
    DownloadFilter = Builder_Download3090_Filter_EFOBJ

    //*******************************
    //* Required Fields
    //*******************************
    if (Userid3090 = null)
+      message = 'Please enter a Userid'
+      window message error ok
+      window setfocus Builder_Download3090_Userid_EFOBJ
+      return
+   endif
    if (Password3090 = null)
+      message = 'Please enter a Password'
+      window message error ok
+      window setfocus Builder_Download3090_Password_EFOBJ
+      return
+   endif
    if (DownloadFrom = null)
+      message = 'Please enter the 3090 source location'
+      window message error ok
+      window setfocus Builder_Download3090_From_EFOBJ
+      return
+   endif
    if (DownloadTo = null)
+      message = 'Please enter the local target location'
+      window message error ok
+      window setfocus Builder_Download3090_To_EFOBJ
+      return
+   endif
    if (Extension = null)
+      message = 'Please enter an Extension to place on download filenames'
+      window message error ok
+      window setfocus Builder_Download3090_Extension_EFOBJ
+      return
+   endif
    //*******************************
    //* Remove ' chars from From
    //*******************************
    scan:/@Builder_Download3090_From_EFOBJ@/:/'/
    if (found) Builder_Download3090_From_EFOBJ = '@left@@right@'
    scan:/@Builder_Download3090_From_EFOBJ@/:/'/
    if (found) Builder_Download3090_From_EFOBJ = '@left@@right@'
    window modify Builder_Download3090_From_EFOBJ
    //*******************************
    //* Remove trailing \ from To
    //*******************************
    crush Builder_Download3090_To_EFOBJ
    splitr:/@Builder_Download3090_To_EFOBJ@/;1
    if (right = '\')
+      Builder_Download3090_To_EFOBJ = left
+      window modify Builder_Download3090_To_EFOBJ
+   endif
    MacroCommand = |if (!exists @Builder_Download3090_To_EFOBJ@) message = "To directory doesn't exist (ensure no spaces in name)" window message error ok window setfocus Builder_Download3090_To_EFOBJ return|
    //message = MacroCommand window message info ok
    $MacroCommand

    //*******************************
    //* Download single file
    //*******************************
    scan:/@DownloadFrom@/:/(/
    if (found)
+      scan:/@right/:/)/
+      if (!found)
+         message = "For a single file please add ')' to 3090 From"
+         window message error ok
+         window setfocus Builder_Download3090_From_EFOBJ
+         return
+   endif
    if (found)
+      DownloadFilename = left
+      crush DownloadFilename
+      DownloadFilename = '@DownloadFilename@.@Extension@'
+      call !a1000_download_file
+      return

    close Copyfiles error
    open Copyfiles null

    //******************************
    //* Download Entire System
    //******************************
    pack DownloadFilter
    DownloadFilterLen = len(DownloadFilter)

    message = 'delete @Builder_Download3090_To_EFOBJ@\*.@Extension@?'
    window message question yesno
    if  (!message)
+       goto !a1000_system_download_complete
+   endif
    MacroCommand = |system:"del @Builder_Download3090_To_EFOBJ@\*.@Extension@"|
    $MacroCommand
    //******************************
    //* Get 3090 Directory List
    //******************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/
    Newline = "cd '@Builder_Download3090_From_EFOBJ@'"
    i:/@Newline/
    i:/dir/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in >GetFile.out/ 
    system:"del GetFile.in"
    window pointer arrow
    open GetFile GetFile.out error goto !a1000_bad_dir_list
    goto !a1000_filter_files

!a1000_bad_dir_list
    message = 'Unable to get 3090 file list'
    window message error ok
    goto !a1000_system_finished

!a1000_filter_files
    b
    fs:/Port request OK/
    if (!eof)
+      fs:/Name/
+   endif
    if (eof)
+      message = 'Bad 3090 file list'
+      window message error ok
+      goto !a1000_system_finished
+   endif
    open DownloadFileList null
    file GetFile
    f;1
    do
        if (!eof) 
+          scan:/@line@/:/List completed/ 
+          if (found)
+             //**************************
+             //* At End of Download List
+             //**************************
+             f;*
+       endif
        if (!eof)
+          if  (DownloadFilter != null)
+              //**************************
+              //* Filter to one system
+              //**************************
+              pattern ?#%~*
+              pattern on
+              scan:/@line/:/@DownloadFilter@/
+              pattern off
+              pattern ?#&~*
+              if (found)
+                 scan:/@line/:word
+                 Newline = |get '@Builder_Download3090_From_EFOBJ@(@left@)' @Builder_Download3090_To_EFOBJ@\@left@.@Extension@|
+                 file DownloadFileList
+                 i:/@Newline@/
+                 file GetFile
+       endif
        if (!eof)
+          if  (DownloadFilter = null)
+             //**************************
+             //* Download all files
+             //**************************
+              scan:/@line/:word
+              Newline = |get '@Builder_Download3090_From_EFOBJ@(@left@)' @Builder_Download3090_To_EFOBJ@\@left@.@Extension@|
+              file DownloadFileList
+              i:/@Newline@/
+              file GetFile
+       endif
        f;1
    until (eof)
    write DownloadFileList GetFile.ok
    file DownloadFileList
    b
    f;*
    DownloadFileCount = pcount + 1
    message = 'Download @DownloadFileCount@ files, continue?' 
    window message question yesno
    if (message)
+      goto !a1000_system_download
+   else
+      goto !a1000_system_download_complete
+   endif 

!a1000_system_download  
    window pointer wait
    //**************************
    //* Open Progress
    //**************************
    ProgressCount = DownloadFileCount / 5
    call !p100_open_progress

!a1000_system_getfiles_loop
    close GetFile error
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/
    file DownloadFileList
    b
    if (eof) goto !a1000_system_finished
    cut;5
    file GetFile
    paste
    i:/bye/
    //**********************************
    //* FTP Get
    //**********************************
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"

    //**********************************
    //* Download Copies
    //**********************************
    if  (Builder_Download3090_Copies_CBOBJ)
+       file Copyfiles
+       b
+       paste
+       b
+       do
+           if (!eof)
+              scanr:/@line/:/ /
+              r:/@right/
+              f;1
+       until (eof)
+   endif
    if  (Builder_Download3090_Copies_CBOBJ)
+       file Copyfiles
+       b
+       call !a1000_copies
+   endif

    //**************************
    //* Show Progress
    //**************************
    call !p200_show_progress
    goto !a1000_system_getfiles_loop

!a1000_system_finished
    window close Builder_Download3090_WIN
    window pointer arrow

!a1000_system_download_complete
    call !p300_close_progress
    close GetFile error
    close DownloadFileList error
    system:"del GetFile.out"
    system:"del GetFile.ok"
    system:"del GetFile.in"
    close Copyfiles
    return

//******************************
//* Download Single File
//******************************
!a1000_download_file
    MacroCommand = "if (exists @Builder_Download3090_To_EFOBJ@\@DownloadFilename@) message = 'File already exists, overwrite?' window message question yesno if (!message) window setfocus Builder_Download3090_To_EFOBJ return"    
    $MacroCommand
    MacroCommand = 'system:"del @Builder_Download3090_To_EFOBJ@\@DownloadFilename@"'
    $MacroCommand

    //*****************************************
    //* FTP get the COBOL source from the 3090
    //*****************************************
    open GetFile null
    i:/open/
    if  (LoginLoc3090 = 'test')
+       i:/mvst/
+   else
+       i:/mvs/
+   endif
    i:/user/
    i:/@Userid3090@/
    i:/@Password3090@/

    Programname3090 = '@Builder_Download3090_To_EFOBJ@\@DownloadFilename@'

    Newline = "get '@Builder_Download3090_From_EFOBJ@' @Programname3090@"
    i:/@Newline/

    //**********************************
    //* FTP Get
    //**********************************
    i:/@Newline@/
    i:/bye/
    write GetFile GetFile.in
    close GetFile
    window pointer wait
    system:/ftp -n -s:GetFile.in/ 
    system:"del GetFile.in"
    window pointer arrow

    MacroCommand = "    if (!exists @Programname3090@) message = 'Error downloading' window message error ok call !p300_close_progress return"
    $MacroCommand

    close Copyfiles error
    open Copyfiles null
    i:/@Programname3090@/
    if  (Builder_Download3090_Copies_CBOBJ)
+       call !a1000_copies
+       close Copyfiles
+   endif
   
    message = 'File successfully downloaded to @Programname3090@'
    window message info ok

    //window close Builder_Download3090_WIN
    return

//******************************
//* Download Copies
//******************************
!a1000_copies
    string Copyfilename error
    string Filename     error
    string Downloadcopy error

    file Copyfiles error return
    b
    do
        Filename = line
        Downloadcopy = 'n'
        //***********************
        //* Prepare the FTP file
        //***********************
        close GetFile error
        open GetFile null
        i:/open/
        if  (LoginLoc3090 = 'test')
+           i:/mvst/
+       else
+           i:/mvs/
+       endif
        i:/user/
        i:/@Userid3090@/
        i:/@Password3090@/
        close COBOLSource error
        open COBOLSource @Filename error goto !a1000_copies_next
        b
!a1000_copy_loop
        fs:/ COPY /
        if (eof) goto !a1000_copies_ftp
        split:/@line/;6
        split:/@right/;1
        if (left = '*') or (left = '/')
+          f;1
+          goto !a1000_copy_loop
+       endif

        scan:/@line/:/ COPY /
        scan:/@right/:word
        if (left = 'IDMS') f goto !a1000_copy_loop
        Copyfilename = left
        scan:/@Copyfilename/:/./
        if (found) Copyfilename = left
        scan:/@Copyfilename/:/'/
        if (found) Copyfilename = "@left@@right@"
        scan:/@Copyfilename/:/'/
        if (found) Copyfilename = "@left@@right@"
        Downloadcopy = 'y'

        file GetFile
        Newline = "get 'g1de00fp.gefs.copylib(@Copyfilename@)' @Builder_Download3090_To_EFOBJ@/@Copyfilename@.cpy"
        i:/@Newline/
        //message = Newline window message info ok
        file COBOLSource
        f;1
        goto !a1000_copy_loop

!a1000_copies_ftp
        if (!Downloadcopy) goto !a1000_copies_next
        //**********************************
        //* FTP Get
        //**********************************
        file GetFile
        i:/@Newline@/
        i:/bye/
        write GetFile GetFile.in
        close GetFile
        window pointer wait
        system:/ftp -n -s:GetFile.in/ 
        //message = 'copy ftp done' window message info ok
        system:"del GetFile.in"
        window pointer arrow

!a1000_copies_next
        close COBOLSource error
        file Copyfiles
        f;1
    until (eof)

    file Copyfiles
    b
    d;*
    close GetFile error
    return

//******************************
//* Download Directory
//******************************
!a1000_download_directory
    return

//******************************
//* Close Download 3090 Window
//******************************
!a1000_Builder_Download3090_Cancel_PBOBJ
    window close Builder_Download3090_WIN
    return

//******************************
//* Download3090 Directory Lookup
//******************************
!a1000_Builder_Download3090_Todir_PBOBJ
    DirField = "Builder_Download3090_To_EFOBJ"
    FileField = null
    window obtain Builder_Download3090_To_EFOBJ
    Directory = Builder_Download3090_To_EFOBJ
    call !s100_directory
    return

//******************************
//* Align Controls Top
//******************************
!a1100_Builder_Align_Top_PBOBJ
    //**************************
    //* Find Topmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 9999
    do
        if (eof)
+          goto !a1100_Builder_Align_Top_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        if  (ObjectY < GroupMaxPos)
+           GroupMaxPos = ObjectY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Top_Size
    //**************************
    //* Align Controls to Top
    //**************************
    GroupObjYOffset = GroupMaxPos - GroupDragY
    if  (GroupObjYOffset < 1) GroupObjYOffset = 1
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Top_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        GroupObjXOffset = left
        //GroupObjYOffset = right
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        window size @ControlName @ObjectX @GroupMaxPos @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Top_Done
    window close Builder_Align_WIN
    return

//******************************
//* Align Controls Bottom
//******************************
!a1100_Builder_Align_Bottom_PBOBJ
    int BottomY error
    //**************************
    //* Find Bottommost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Bottom_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        BottomY = ObjectY + ObjectCY
        if  (BottomY > GroupMaxPos)
+           GroupMaxPos = BottomY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Bottom_Size
    //**************************
    //* Align Controls to Bottom
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Bottom_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        scan:/@right/:/,/
        GroupObjXOffset = left
        ObjectY = GroupMaxPos - ObjectCY
        if (ObjectY < 1) ObjectY = 1
        GroupObjYOffset = ObjectY - GroupDragY
        if (GroupObjYOffset < 1) GroupObjYOffset = 1
        window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Bottom_Done
    window close Builder_Align_WIN
    return

//******************************
//* Align Controls Middle Horizontal
//******************************
!a1100_Builder_Align_Midhoriz_PBOBJ
    int GroupMaxTop error
    int GroupMaxBottom error
    int ObjectBottom error
    int GroupMid error
    int GroupWork error
   
    //**************************
    //* Find top & bottom most Controls
    //**************************
    file GroupControls
    b
    GroupMaxTop = 9999
    GroupMaxBottom = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Midhoriz_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        ObjectBottom = ObjectY + ObjectCY
        if  (ObjectBottom > GroupMaxBottom)
+           GroupMaxBottom = ObjectBottom
+       endif
        if (ObjectY < GroupMaxTop)
+          GroupMaxTop = ObjectY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Midhoriz_Size
    GroupMid = GroupMaxBottom - GroupMaxTop
    GroupMid /= 2
    GroupMid += GroupMaxTop
    if  (GroupMid = 0) goto !a1100_Builder_Align_Midhoriz_Done
    //**************************
    //* Align Controls to Middle
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Midhoriz_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        scan:/@right/:/,/
        GroupObjXOffset = left
        
        GroupWork = ObjectCY / 2
        ObjectY = GroupMid - GroupWork

        GroupObjYOffset = ObjectY - GroupDragY
        if (GroupObjYOffset < 1) GroupObjYOffset = 1
        window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Midhoriz_Done
    window close Builder_Align_WIN
    return

//******************************
//* Align Controls Middle Vertical
//******************************
!a1100_Builder_Align_Midvert_PBOBJ
    int GroupMaxLeft error
    int GroupMaxRight error
    int ObjectRight error
    int GroupMid error
    int GroupWork error
   
    //**************************
    //* Find left & right most Controls
    //**************************
    file GroupControls
    b
    GroupMaxLeft = 9999
    GroupMaxRight = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Midvert_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        ObjectRight = ObjectX + ObjectCX
        if  (ObjectRight > GroupMaxRight)
+           GroupMaxRight = ObjectRight
+       endif
        if (ObjectX < GroupMaxLeft)
+          GroupMaxLeft = ObjectX
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Midvert_Size
    GroupMid = GroupMaxRight - GroupMaxLeft
    GroupMid /= 2
    GroupMid += GroupMaxLeft
    if  (GroupMid = 0) goto !a1100_Builder_Align_Midvert_Done
    //**************************
    //* Align Controls to Middle
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Midvert_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        scan:/@right/:/,/
        GroupObjYOffset = right
        
        GroupWork = ObjectCX / 2
        ObjectX = GroupMid - GroupWork

        GroupObjXOffset = ObjectX - GroupDragX
        if (GroupObjXOffset < 1) GroupObjXOffset = 1
        window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Midvert_Done
    window close Builder_Align_WIN
    return

//******************************
//* Align Controls Left
//******************************
!a1100_Builder_Align_Left_PBOBJ
    //**************************
    //* Find Leftmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 9999
    do
        if (eof)
+          goto !a1100_Builder_Align_Left_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        if  (ObjectX < GroupMaxPos)
+           GroupMaxPos = ObjectX
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Left_Size
    //**************************
    //* Align Controls to Left
    //**************************
    GroupObjXOffset = GroupMaxPos - GroupDragX
    if (GroupObjXOffset < 1) GroupObjectXOffset = 1
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Left_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        scan:/@right/:/,/
        //GroupObjXOffset = left
        GroupObjYOffset = right
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        window size @ControlName @GroupMaxPos @ObjectY @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Left_Done
    window close Builder_Align_WIN
    return

//******************************
//* Align Controls Right
//******************************
!a1100_Builder_Align_Right_PBOBJ
    int RightY error
    //**************************
    //* Find Rightmost Control
    //**************************
    file GroupControls
    b
    GroupMaxPos = 0
    do
        if (eof)
+          goto !a1100_Builder_Align_Right_Size
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        RightY = ObjectX + ObjectCX
        if  (RightY > GroupMaxPos)
+           GroupMaxPos = RightY
+       endif
        f;1
    until (eof)
!a1100_Builder_Align_Right_Size
    //**************************
    //* Align Controls to Right
    //**************************
    b
    do
        if (eof)
+          goto !a1100_Builder_Align_Right_Done
+       endif
        scan:/@line/:/,/
        ControlName = left
        window windowpos @ControlName ObjectX ObjectY ObjectCX ObjectCY
        scan:/@right/:/,/
        GroupObjXOffset = left
        GroupObjYOffset = right
        ObjectX = GroupMaxPos - ObjectCX
        if (ObjectX < 1) ObjectX = 1
        GroupObjXOffset = ObjectX - GroupDragX
        if (GroupObjXOffset < 1) GroupObjXOffset = 1
        window size @ControlName @ObjectX @ObjectY @ObjectCX @ObjectCY
        MacroCommand = 'window paint @ControlName@' $MacroCommand
        Newline = '@ControlName@,@GroupObjXOffset@,@GroupObjYOffset@'
        r:/@Newline@/
        f;1
    until (eof)
!a1100_Builder_Align_Right_Done
    window close Builder_Align_WIN
    return

//******************************
//* Close the Alignment Window
//******************************
!a1100_Builder_Align_Cancel_PBOBJ
    window close Builder_Align_WIN
    return

//******************************
//* Create a Control
//******************************
!b100_create_control

    window obtain Builder_Control_Control_EFOBJ
    window obtain Builder_Control_ControlText_EFOBJ
    if  (Builder_Control_Control_EFOBJ = null)
+       message = 'Please enter a Control Name'
+       window message error ok
+       window setfocus Builder_Control_Control_EFOBJ
+       return
+   endif

    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY

    window windowpos Builder_Control_Button_RBOBJ ObjectX ObjectY ObjectCX ObjectCY

    message = null
    window exists @Builder_Control_Control_EFOBJ
    if (status) 
+      message = '@Builder_Control_Control_EFOBJ@ exists, re-create?'
+      window message question yesno
+      if (message = 'YES')
+         window deletecontrol @Builder_Control_Control_EFOBJ
+   endif
    if (message = 'NO') return
    if  (Builder_Control_ControlText_EFOBJ != null)
+       Text = Builder_Control_ControlText_EFOBJ
+   else
+       Text = Builder_Control_Control_EFOBJ
+   endif
    Xpos = MinX + 1
    Ypos = MinY + 1
    //message = 'creating control Xpos[@Xpos@] Ypos[@Ypos@] MinX[@MinX@] MinY[@MinY@]' window message info ok

    if  (ControlType = 'COOBJS') or (ControlType = 'LBOBJ1') or (ControlType = 'COOBJD') or (ControlType = 'COOBJL')
+       ObjectCX = 200
+       ObjectCY = 200
+   endif

    window createcontrol Builder_Control_WIN @Builder_Control_Control_EFOBJ @Xpos @Ypos @ObjectCX @ObjectCY @ControlType @Text 

    file Controls error open Controls null
    Newline = '@Builder_Control_Control_EFOBJ@,@ControlType@,@Text@'
    i:/@Newline@/
    FocusSet = 'Y'
    Builder_Control_X_EFOBJ = '1'
    window modify Builder_Control_X_EFOBJ
    Builder_Control_Y_EFOBJ = '1'
    window modify Builder_Control_Y_EFOBJ  
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ 
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ 

    Builder_Control_ControlList_COOBJ = "@Builder_Control_Control_EFOBJ@"
    window insert end default Builder_Control_ControlList_COOBJ

    return

//******************************
//* Add an AND search string
//******************************
!a1200_Builder_Search_And_PBOBJ
    window obtain Builder_Search_String_EFOBJ
    crush Builder_Search_String_EFOBJ
    if (Builder_Search_String_EFOBJ = null)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    SearchLast = 'AND'
    window disable Builder_Search_Or_PBOBJ

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_And_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_And_Done
    //*********************************
    //* Add the Entry Field String
    //*********************************
    SearchCount ++
    SearchCountStr = '0@SearchCount@'
    splitr:/@SearchCountStr@/;2
    if (SearchCount = 1)
+      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_String_EFOBJ@'
+   else
+      Builder_Search_List_LBOBJ = '@right@: AND @Builder_Search_String_EFOBJ@'
+   endif
    window insert end default Builder_Search_List_LBOBJ
    split:/@Builder_Search_List_LBOBJ@/;4
    Newline = right
    i:/@Newline@/

    //***************************************
    //* Clear out the String Entry Field
    //* and Set Focus
    //***************************************
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    window setfocus Builder_Search_String_EFOBJ
    return

//******************************
//* Add an OR search string
//******************************
!a1200_Builder_Search_Or_PBOBJ
    window obtain Builder_Search_String_EFOBJ
    crush Builder_Search_String_EFOBJ
    if (Builder_Search_String_EFOBJ = null)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    SearchLast = 'OR'
    window disable Builder_Search_And_PBOBJ

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Or_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_Or_Done
    //*********************************
    //* Add the Entry Field String
    //*********************************
    SearchCount ++
    SearchCountStr = '0@SearchCount@'
    splitr:/@SearchCountStr@/;2
    if (SearchCount = 1)
+      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_String_EFOBJ@'
+   else
+      Builder_Search_List_LBOBJ = '@right@: OR @Builder_Search_String_EFOBJ@'
+   endif
    window insert end default Builder_Search_List_LBOBJ
    split:/@Builder_Search_List_LBOBJ@/;4
    Newline = right
    i:/@Newline@/

    //***************************************
    //* Clear out the String Entry Field
    //* and Set Focus
    //***************************************
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    window setfocus Builder_Search_String_EFOBJ
    return

//******************************
//* Remove a search string
//******************************
!a1200_Builder_Search_Remove_PBOBJ
    window obtain Builder_Search_List_LBOBJ
    if  (Builder_Search_List_LBOBJ = null)
+      message = 'Please select a search string rule'
+      window message error ok
+      window setfocus Builder_Search_List_LBOBJ
+      return
+   endif
    //*********************************
    //* Remove the entry from the file
    //*********************************
    split:/@Builder_Search_List_LBOBJ@/;4
    file SearchList
    b
    fs:/@right@/
    if (!eof) d

    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Remove_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)

!a1200_Builder_Search_Remove_Done
    //*********************************
    //* Refresh the list
    //*********************************
    window hide Builder_Search_List_LBOBJ
    window show Builder_Search_List_LBOBJ
    return

//******************************
//* Clear all search strings
//******************************
!a1200_Builder_Search_Clear_PBOBJ
    file SearchList
    b
    d;*
    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ
    //*********************************
    //* Refresh the list
    //*********************************
    window hide Builder_Search_List_LBOBJ
    window show Builder_Search_List_LBOBJ

    //*********************************
    //* Enable the Search Actions
    //*********************************
    window enable Builder_Search_And_PBOBJ
    window enable Builder_Search_Or_PBOBJ
    return

//******************************
//* Search the Directory
//******************************
!a1200_Builder_Search_Search_PBOBJ
    if  (Reenter) 
+       window setfocus Builder_Progress_Cancel_PBOBJ
+       window paint Builder_Progress_WIN
+       goto !a1200_Builder_Search_Search_loop
+   endif
    window obtain Builder_Search_WIN
    crush Builder_Search_Directory_EFOBJ
    crush Builder_Search_String_EFOBJ
    MacroCommand = '    if (!exists @Builder_Search_Directory_EFOBJ@) goto !a1200_Builder_Search_Search_Bad_Directory'
    $MacroCommand
    file SearchList
    b
    if (Builder_Search_String_EFOBJ = null) and (eof)
+      message = 'Please enter a search string'
+      window message error ok
+      window setfocus Builder_Search_String_EFOBJ
+      return
+   endif
    pack Builder_Search_Extension_EFOBJ
    if (Builder_Search_Extension_EFOBJ = null)
+      message = "Please enter an Extension"
+      window message error ok
+      window setfocus Builder_Search_Extension_EFOBJ
+      return
+   endif
    upper Builder_Search_Extension_EFOBJ
    Extension = Builder_Search_Extension_EFOBJ
    window modify Builder_Search_Extension_EFOBJ
    //*********************************
    //* Add the Entry field to the list
    //*********************************
    file SearchList
    b
    crush Builder_Search_String_EFOBJ
    if  (Builder_Search_String_EFOBJ = null)
+       goto !a1200_Builder_Search_Search_Add_Done
+   endif
    if (!eof)
+       f;*
+       Newline = /@SearchLast@ @Builder_Search_String_EFOBJ@/
+       i:/@Newline@/
+   else
+       Newline = Builder_Search_String_EFOBJ
+       i:/@Newline@/
+   endif

!a1200_Builder_Search_Search_Add_Done
    Builder_Search_String_EFOBJ = null
    window modify Builder_Search_String_EFOBJ
    
    //*********************************
    //* Clear the Search List
    //*********************************
    Builder_Search_List_LBOBJ = 'ALL'
    window delete Builder_Search_List_LBOBJ

    //*********************************
    //* Refresh the Search List from file
    //*********************************
    SearchCount = 0
    file SearchList
    b
    do
       if (eof)
+         goto !a1200_Builder_Search_Search_Refresh_Done
+      endif

      SearchCount ++

      Builder_Search_List_LBOBJ = line
      if (SearchCount = 1)
+        scan:/@line/:word
+        if  (left = 'AND') or (left = 'OR')
+            Builder_Search_List_LBOBJ = right
+     endif

      SearchCountStr = '0@SearchCount@'
      splitr:/@SearchCountStr@/;2
      Builder_Search_List_LBOBJ = '@right@: @Builder_Search_List_LBOBJ@'
      window insert end default Builder_Search_List_LBOBJ
      f;1
    until (eof)
!a1200_Builder_Search_Search_Refresh_Done
    goto !a1200_Builder_Search_Search_Find

!a1200_Builder_Search_Search_Bad_Directory
    message = "Directory doesn't exist (ensure no spaces in name)"
    window message error ok
    window setfocus Builder_Search_Directory_EFOBJ    
    return

!a1200_Builder_Search_Search_Find
    string SearchFile error

    window pointer wait
    window open Builder_Searchresults_WIN shade
    window clear Builder_Searchresults_WIN
    window center Builder_Searchresults_WIN
  
    //****************************************
    //* Search the Directory for the String
    //****************************************
    close SearchFileList error
    open SearchFileList null

    window obtain Builder_Search_Subdir_CBOBJ
    if (Builder_Search_Subdir_CBOBJ)
+      Dirname = Builder_Search_Directory_EFOBJ
+      call !x100_dirlist
+      file DirFileList
+      b
+      clear
+      copy;*
+      close DirFileList
+      file SearchFileList
+      paste
+      b
+   else
+      MacroCommand = "dir @Builder_Search_Directory_EFOBJ@"
+      systemcurr:"@MacroCommand@"
+      b
+      d;5
+      f;*
+      b;1
+      d;*
+      b
+   endif

    case off
    pattern on
    //**************************
    //* Open Progress
    //**************************
    f;*
    ProgressCount = pcount + 1
    call !p100_open_progress
    b

!a1200_Builder_Search_Search_loop
    file SearchFileList
    if (eof) goto !a1200_Builder_Search_Search_done
    if (Builder_Search_Subdir_CBOBJ)
+      SearchFile = line
+   else
+      scan:/@line/:word
+      scan:/@right/:word
+      scan:/@right/:word
+      scan:/@right/:word
+      SearchFile = '@Builder_Search_Directory_EFOBJ@\@right@' //message = 'Searching @SearchFile@[@line@]' window message info ok
+   endif
    scanr:/@SearchFile@/:/./
    upper right
    if (right != Builder_Search_Extension_EFOBJ)
+      goto !a1200_Builder_Search_Search_next
+   endif   
    open SearchSource @SearchFile error file SearchFileList goto !a1200_Builder_Search_Search_next
    file SearchList
    b
    f;1
    if (eof)
+      SearchAction = 'OR'
+   else
+      scan:/@line/:word
+      SearchAction = left
+   endif
    SearchNotFound = 'n'
    b
!a1200_Builder_Search_Search_String_loop
    if (eof) goto !a1200_Builder_Search_Search_String_loop_done
    scan:/@line/:word
    if (left = 'AND') or (left = 'OR')
+      SearchString = right
+   else
+      SearchString = line
+   endif

    file SearchSource
    b
    fs:/@SearchString@/
    if (!eof) and (SearchAction = 'OR')
+       Builder_Searchresults_Results_LBOBJ = SearchFile
+       window insert end default Builder_Searchresults_Results_LBOBJ
+       goto !a1200_Builder_Search_Search_String_loop_done
+   endif
    if (eof) and (SearchAction = 'AND')
+       SearchNotFound = 'y'
+   endif

    file SearchList
    f;1
    goto !a1200_Builder_Search_Search_String_loop

!a1200_Builder_Search_Search_String_loop_done
    if (SearchAction = 'AND') and (SearchNotFound != 'y')
+       Builder_Searchresults_Results_LBOBJ = SearchFile
+       window insert end default Builder_Searchresults_Results_LBOBJ
+   endif
    close SearchSource error
!a1200_Builder_Search_Search_next
    file SearchFileList
    f;1
    if (eof) goto !a1200_Builder_Search_Search_done
    //**************************
    //* Show Progress
    //**************************
    call !p200_show_progress
    Reenter = 'y'
    window push Builder_Search_Search_PBOBJ
    return
    //goto !a1200_Builder_Search_Search_loop

!a1200_Builder_Search_Search_done
    Reenter = 'n'
    call !p300_close_progress
    case on
    pattern off
    Directory = Builder_Search_Directory_EFOBJ
    Builder_Searchresults_Results_STTXT = "Search Results: @Builder_Search_String_EFOBJ@"
    window modify Builder_Searchresults_Results_STTXT
    window unshade Builder_Searchresults_WIN
    window pointer arrow
    return

//******************************
//* Show Help for Search
//******************************
!a1200_Builder_Search_Help_PBOBJ
    window pointer wait
    window open Builder_Help_WIN shade
    window center Builder_Help_WIN
    window clear Builder_Help_WIN
    Builder_Help_WIN = 'Help: Searching Files for a String'
    window title Builder_Help_WIN
    Builder_Help_Help_LBOBJ = '1.  Search files for any string entered. Note: The search is not case sensitive.' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '2.  ' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '3.  Searching files for patterns:' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '4.     ? = Match on any Character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '5.     # = Match on any Digit' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '6.     & = Match on any Alpha character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '7.     ~ = Match on any Special character' window insert end default Builder_Help_Help_LBOBJ
    Builder_Help_Help_LBOBJ = '8.     * = Match to end or next char e.g. "this*test" will find "this is a test"' window insert end default Builder_Help_Help_LBOBJ
    window unshade Builder_Help_WIN
    window pointer arrow
    return

//******************************
//* Close the Search Window
//******************************
!a1200_Builder_Search_Cancel_PBOBJ
    window close Builder_Search_WIN
    return

//******************************
//* Search Directory Lookup
//******************************
!a1200_Builder_Search_Directory_PBOBJ
    DirField = "Builder_Search_Directory_EFOBJ"
    FileField = null
    window obtain Builder_Search_Directory_EFOBJ
    Directory = Builder_Search_Directory_EFOBJ
    call !s100_directory
    return

//******************************
//* Open a Search Result file
//******************************
!a1300_Builder_Searchresults_Open_PBOBJ
    window obtain Builder_Searchresults_Results_LBOBJ
    crush Builder_Searchresults_Results_LBOBJ
    if  (Builder_Searchresults_Results_LBOBJ = null)
+       message = 'Please make a selection'
+       window message error ok
+       return
+   endif
    MacroCommand = 'system:"start @Builder_Searchresults_Results_LBOBJ@"'
    $MacroCommand
    return

//******************************
//* Close the Search Results Window
//******************************
!a1300_Builder_Searchresults_Cancel_PBOBJ
    window close Builder_Searchresults_WIN
    return

//******************************
//* Close the Help Window
//******************************
!a1400_Builder_Help_Ok_PBOBJ
    window close Builder_Help_WIN
    return

//******************************
//* Close the About Window
//******************************
!a1500_Builder_About_Ok_PBOBJ
    window close Builder_About_WIN
    return

//******************************
//* Double-click Browse Sub-dir List
//******************************
!a1600_Builder_Browse_Subdir_LBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    window obtain Builder_Browse_Subdir_LBOBJ
    leftjust Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    splitr:/@Builder_Browse_Directory_EFOBJ@/;1
    if (right = '\')
+      Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@@Builder_Browse_Subdir_LBOBJ@'
+   else  
+      Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Subdir_LBOBJ@'
+   endif
    window modify Builder_Browse_Directory_EFOBJ
    call !s200_show_dir
    return

//******************************
//* Double-click Browse Files List
//******************************
!a1600_Builder_Browse_Files_LBOBJ
    if  (FileField = null)
+       return
+   endif

    window obtain Builder_Browse_WIN
    MacroCommand = '@FileField@ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Browse_Files_LBOBJ@"' $MacroCommand 
    MacroCommand = 'window modify @FileField@' $MacroCommand 
    scanr:/@Builder_Browse_Files_LBOBJ@/:/./
    if (found)
+      Builder_Browse_Extension_EFOBJ = right
+      window modify Builder_Browse_Extension_EFOBJ
+   endif
    call !a1600_Builder_Browse_Ok_PBOBJ
    call !a600_Builder_Import_OK_PBOBJ
    return

//******************************
//* Refresh the Browse
//******************************
!a1600_Builder_Browse_Refresh_PBOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    call !s200_show_dir
    return

//******************************
//* Back up 1 browse directory
//******************************
!a1600_Builder_Browse_Back_PBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    window obtain Builder_Browse_Extension_EFOBJ
    crush Builder_Browse_Extension_EFOBJ
    upper Builder_Browse_Extension_EFOBJ
    window modify Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    scanr:/@Builder_Browse_Directory_EFOBJ@/:"\"
    if (found)
+      Builder_Browse_Directory_EFOBJ = left
+      window modify Builder_Browse_Directory_EFOBJ
+      call !s200_show_dir
+   endif
    return

//******************************
//* Accept the current browse dir
//******************************
!a1600_Builder_Browse_Ok_PBOBJ
    window obtain Builder_Browse_Directory_EFOBJ
    Directory = Builder_Browse_Directory_EFOBJ
    //**********************************************
    //* Pass directory to Chk3090.bed
    //**********************************************
    if  (DirField = 'Chk3090.dir')
+       open DirFile null
+       i:/@Builder_Browse_Directory_EFOBJ@/
+       i:/ /
+       write DirFile Chk3090.dir
+       close DirFile
+       system:"start 3090check.bat"
+       window close Builder_Browse_WIN
+       return
+   endif
    //**********************************************
    //* Pass directory to calling window dir field
    //**********************************************
    MacroCommand = '@DirField@ = Builder_Browse_Directory_EFOBJ' $MacroCommand 
    MacroCommand = 'window modify @DirField@' $MacroCommand 
    window obtain Builder_Browse_Extension_EFOBJ
    Extension = Builder_Browse_Extension_EFOBJ
    //**********************************************
    //* Pass File back to View Program Flow
    //**********************************************
    if (FileField = 'Builder_Import_Filename_EFOBJ')
+      Builder_Import_Extension_EFOBJ = Builder_Browse_Extension_EFOBJ
+      Extension = Builder_Browse_Extension_EFOBJ
+      window modify Builder_Import_Extension_EFOBJ
+   endif
    window close Builder_Browse_WIN
    //**********************************************
    //* Process the Lookup on View Program Flow
    //**********************************************
    if  (DirField = 'Builder_Import_Directory_EFOBJ') and (Extension != null)
+       call !a600_Builder_Import_Lookup_PBOBJ
+   endif
    return

//******************************
//* Close the browse window
//******************************
!a1600_Builder_Browse_Cancel_PBOBJ
    window close Builder_Browse_WIN
    return

//******************************
//* Open a file on the Browse Window
//******************************
!a1600_Builder_Browse_Open_PBOBJ
    string FileOpenName error
    window obtain Builder_Browse_WIN
    if (Builder_Browse_Files_LBOBJ = null)
+      message = "Please select a file"
+      window message error ok
+      window setfocus Builder_Browse_Files_LBOBJ
+      return
+   endif
    split:/@Builder_Browse_Directory_EFOBJ@/;3
    FileOpenName = '@left@"@right@\@Builder_Browse_Files_LBOBJ@"'
    MacroCommand = |system:"start @FileOpenName@"| 
    $MacroCommand
    return

//******************************
//* Open the new directory window
//******************************
!a1600_Builder_Browse_Newdir_PBOBJ
    window obtain Builder_Browse_WIN
    window open Builder_Newdir_WIN shade
    window clear Builder_Newdir_WIN
    window center Builder_Newdir_WIN
    window unshade Builder_Newdir_WIN
    return

//******************************
//* Create a new directory
//******************************
!a1650_Builder_Newdir_Ok_PBOBJ
    window obtain Builder_Newdir_Name_EFOBJ
    crush Builder_Newdir_Name_EFOBJ
    if (Builder_Newdir_Name_EFOBJ = null)
+      message = "Please enter a Name"
+      window message error ok
+      window setfocus Builder_Newdir_Name_EFOBJ
+      return
+   endif
    MacroCommand = |system:"md @Builder_Browse_Directory_EFOBJ@\@Builder_Newdir_Name_EFOBJ@"|
    $MacroCommand
    Builder_Browse_Directory_EFOBJ = "@Builder_Browse_Directory_EFOBJ@\@Builder_Newdir_Name_EFOBJ@"
    window modify Builder_Browse_Directory_EFOBJ
    window close Builder_Newdir_WIN
    window push Builder_Browse_Refresh_PBOBJ
    return

//******************************
//* Close the new directory window
//******************************
!a1650_Builder_Newdir_Cancel_PBOBJ
    window close Builder_Newdir_WIN
    return

//******************************
//* Codecheck Directory Lookup
//******************************
!a1700_Builder_Codecheck_Directory_PBOBJ
    DirField = "Builder_Codecheck_Directory_EFOBJ"
    FileField = null
    call !s100_directory
    return

//******************************
//* Close the browse window
//******************************
!a1700_Builder_Codecheck_Ok_PBOBJ
    window obtain Builder_Codecheck_WIN
    if (Builder_Codecheck_System_EFOBJ = null)
+      message = 'Please enter a System'
+      window message error ok
+      window setfocus Builder_Codecheck_System_EFOBJ
+      return
+   endif 
    if (Builder_Codecheck_Directory_EFOBJ = null)
+      message = 'Please enter a Directory'
+      window message error ok
+      window setfocus Builder_Codecheck_Directory_EFOBJ
+      return
+   endif
    //*************************************
    //* Create Checkcd.dir for Checkcd.bed
    //*************************************
    open CodeCheck null
    i:/@Builder_Codecheck_System_EFOBJ@/
    i:/@Builder_Codecheck_Directory_EFOBJ@/
    write CodeCheck Checkcd.dir
    close CodeCheck
    //*************************************
    //* Update AppNames.txt
    //*************************************
    Newline = '$*$ @Builder_Codecheck_System_EFOBJ@'
    open AppNames AppNames.txt error open AppNames null
    b
    fs:/@Newline@/
    if (eof)
+      i:/@Newline@/
+      write AppNames AppNames.txt
+   endif
    close AppNames
    
    window close Builder_Codecheck_WIN

    //*************************************
    //* Run Checkcd.bed
    //*************************************
    system:"start codecheck.bat"

    return

//******************************
//* Close the browse window
//******************************
!a1700_Builder_Codecheck_Cancel_PBOBJ
    window close Builder_Codecheck_WIN
    return

//******************************
//* System COOBJ Action
//******************************
!a1700_Builder_Codecheck_System_LBOBJ
    window obtain Builder_Codecheck_System_LBOBJ
    Builder_Codecheck_System_EFOBJ = Builder_Codecheck_System_LBOBJ
    window modify Builder_Codecheck_System_EFOBJ
    open CheckCodeLog checkcd.log error return
    SearchString = "System[@Builder_Codecheck_System_EFOBJ@]"
    direction up
    b f;1 b;1   //*** Prevent EOF on last record of file using f;1 b;1 with direction up (backwards)
    fs:/@SearchString@/
    if (eof) goto !a1700_Builder_Codecheck_System_done
    scan:/@line/:/Dir[/
    if (found)
+      scan:/@right/:/]/
+      if (found)
+         Builder_Codecheck_Directory_EFOBJ = left
+         window modify Builder_Codecheck_Directory_EFOBJ
+         Directory = Builder_Codecheck_Directory_EFOBJ
+   endif

!a1700_Builder_Codecheck_System_done
    direction down
    close CheckCodeLog
    return

//******************************
//* Open the Code Module Window
//******************************
!a1800_Builder_Code_Ok_PBOBJ
    window obtain Builder_Code_WIN

!a1800_Builder_Code_Ok_PBOBJ-1
    string ModuleFileName error

    if  (Builder_Code_Codemodules_LBOBJ = null)
+       window obtain Builder_Code_WIN
+   endif
    if (Builder_Code_Codemodules_LBOBJ = null)
+      message = 'Please select a module'
+      window message error ok
+      window setfocus Builder_Code_Codemodules_LBOBJ
+      return
+   endif
    if-complete  (Builder_Code_Codemodules_LBOBJ = '! Complete Program')
+       ModuleFileName = 'Bedit-code\@SystemName@.bed'
+   else-complete
+       if-global  (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+           ModuleFileName = 'Bedit-code\Global.bed'
+       else-global
+           ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
+   endif
    MacroCommand = 'system:"start @ModuleFileName@"'
    $MacroCommand
    Builder_Code_Codemodules_LBOBJ = null
    return

!a1800_Builder_Code_Codemodules_LBOBJ
    Builder_Code_Codemodules_LBOBJ = null
    call !a1800_Builder_Code_Ok_PBOBJ-1
    return

//******************************
//* Close the Code Selection window
//******************************
!a1800_Builder_Code_Cancel_PBOBJ
    window close Builder_Code_WIN
    return

//******************************
//* Open the Code Assist window
//******************************
!a1800_Builder_Code_Assist_PBOBJ
    int    CodeCount       error
    string CodeCountStr    error
    string FullFileName    error
    int    CodeLineNumber  error

    if  (!CodeAssistReenter)   
+       window obtain Builder_Code_WIN
+   endif

    if  (Builder_Code_Codemodules_LBOBJ = null)
+       message = 'Please select a module'
+       window message error ok
+       window setfocus Builder_Code_Codemodules_LBOBJ
+       return
+   endif
    if  (Builder_Code_Codemodules_LBOBJ = '! Complete Program') or (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+       if  (CodeType != 'bedit')
+           message = "Can't use Complete Program for Code Assist"
+           window message error ok
+           window setfocus Builder_Code_Codemodules_LBOBJ
+           return
+   endif
    if  (Builder_Code_Codemodules_LBOBJ = '! Complete Program')
+       message = "Can't use Complete Program for Code Assist"
+       window message error ok
+       window setfocus Builder_Code_Codemodules_LBOBJ
+       return
+   endif

    if  (!CodeAssistReenter)
+       window pointer wait
+       window open Builder_Codeassist_WIN shade
+       window center Builder_Codeassist_WIN
+   endif
    if  (CodeType = 'bedit')
+       window show Builder_Codeassist_Code_PBOBJ
+       window show Builder_Codeassist_Refresh_PBOBJ
+       window show Builder_Codeassist_Test_PBOBJ
+       window show Builder_Codeassist_Log_PBOBJ
+       window show Builder_Codeassist_View_PBOBJ
+   else
+       window hide Builder_Codeassist_Code_PBOBJ
+       window hide Builder_Codeassist_Refresh_PBOBJ
+       window hide Builder_Codeassist_Test_PBOBJ
+       window hide Builder_Codeassist_Log_PBOBJ
+       window hide Builder_Codeassist_View_PBOBJ
+   endif
    window clear Builder_Codeassist_WIN
    Builder_Codeassist_WIN = 'Code Assist - System[@SystemName@]'
    window title Builder_Codeassist_WIN 

    Builder_Codeassist_Code_STTXT = "Code: @Builder_Code_Codemodules_LBOBJ@"
    window modify Builder_Codeassist_Code_STTXT

    //************************************
    //* Clear and load the Code list
    //************************************
    Builder_Codeassist_Code_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Code_LBOBJ

    if  (Builder_Code_Codemodules_LBOBJ = '! Global Variables')
+        Builder_Code_Codemodules_LBOBJ = 'Global'
+   endif

    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'  
    close CodeFile error
    open CodeFile @ModuleFileName error return
    b
    CodeCount = 0     
    do
        if (!eof)
+          CodeCount ++
+          CodeCountStr = '0000@CodeCount@'
+          splitr:/@CodeCountStr@/;4
+          Builder_Codeassist_Code_LBOBJ = '@right@ @line@'
+          window insert end default Builder_Codeassist_Code_LBOBJ
+          f;1
+       endif
    until (eof)

    //*********************************************************
    //* Clear and load the Variables List
    //*********************************************************
    Builder_Codeassist_Variables_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Variables_LBOBJ
    close VariableFile error
    open VariableFile null
    
    //************************************
    //* Load the BED Module and Variable Names
    //************************************
    string VarFileName error

    Builder_Codeassist_Variables_LBOBJ = "! Global Variables"
    window insert end default Builder_Codeassist_Variables_LBOBJ

    FullFileName = 'Bedit-code\@SystemName@.bed'
    open FullFile @FullFileName
    b
    do
        //*********************
        //* Module Name
        //*********************
        split:/@line/;1
        if (left = '!')
+          scan:/@line/:word
+          Builder_Codeassist_Variables_LBOBJ = left
+          window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        //*********************
        //* Variables
        //*********************
        scan:/@line/:word
        lower left
        if (left = 'int') or (left = 'integer') or (left = 'string') or (left = 'float') or (left = 'dollar')
+          scan:/@right/:word
+          file VariableFile
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+             Builder_Codeassist_Variables_LBOBJ = left
+             window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        //*********************
        //* File open
        //*********************
        file FullFile
        scan:/@line/:word
        split:/@left/;2
        if (left != '//')
+          scan:/@line/:/ open /
+          if  (found)
+              scan:/@right/:word
+              VarFileName = left
+              subs ^
+              split:/^VarFileName^/;1
+              if (left != '@')
+                 subs @
+                 file VariableFile
+                 b
+                 fs:/@VarFileName/
+                 if (eof)
+                    i:/@VarFileName@/
+                    Builder_Codeassist_Variables_LBOBJ = VarFileName
+                    window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        subs @
        //*********************
        //* File pointer
        //*********************
        file FullFile
        scan:/@line/:word
        split:/@left/;2
        if (left != '//')
+          scan:/@line/:/ file /
+          if  (found)
+              scan:/@right/:word
+              VarFileName = left
+              subs ^
+              split:/^VarFileName^/;1
+              if (left != '@')
+                 subs @
+                 file VariableFile
+                 b
+                 fs:/@VarFileName/
+                 if (eof)
+                    i:/@VarFileName@/
+                    Builder_Codeassist_Variables_LBOBJ = VarFileName
+                    window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        subs @


        file FullFile
        f;1
    until (eof)
    close FullFile
    //************************************
    //* Load the WIN Variable Names
    //************************************
    FullFileName = '@SystemName@.win'
    open FullFile @FullFileName error goto !a1800_Builder_Code_Assist_system
    do
        scan:/@line/:/,/
        if (found)
+          scan:/@right/:/,/
+          file VariableFile
+          b
+          fs:/@left/
+          if (eof)
+             i:/@left@/
+             Builder_Codeassist_Variables_LBOBJ = left
+             window insert end default Builder_Codeassist_Variables_LBOBJ
+       endif
        file FullFile
        f;1       
    until (eof)
    close FullFile

!a1800_Builder_Code_Assist_system
    //************************************
    //* Insert the system variables
    //************************************
    Builder_Codeassist_Variables_LBOBJ = 'eof' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'line' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'left' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'mid' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'right' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'midright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'rword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'null' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'found' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'partial1' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'partial2' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'functionkey' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'pcount' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lineno' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lline' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lleft' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lmid' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lmidright' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'llword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'lrword' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'calllevel' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'message' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'tab' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'date' window insert end default Builder_Codeassist_Variables_LBOBJ
    Builder_Codeassist_Variables_LBOBJ = 'time' window insert end default Builder_Codeassist_Variables_LBOBJ
    

    //*********************************************************
    //* Clear and load the Commands List
    //*********************************************************
    Builder_Codeassist_Commands_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* B-Edit Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = 'b' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bell' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bookmark' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'break' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'buffer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'call' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'case' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'char' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cleankeys' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'clear' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'close' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cls' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'color' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cols' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'copy' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'country' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'crush' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'currdir' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cursor' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'cut' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'debug' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'decrypt' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'decryptfile' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dir' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'direction' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'do' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dollar' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'dump' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'eol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'erase' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'error' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'exit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'extract' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'f' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'file' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'files' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'filesize' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'filestring' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'float' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'front' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'fs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'bedit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'goto' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'i' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'ib' window insert end default Builder_Codeassist_Commands_LBOBJ

    Builder_Codeassist_Commands_LBOBJ = 'if (a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (!a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a = b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a != b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a > b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a >= b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a < b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a <= b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a beginswith b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (a endswith b)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (numeric a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (digit a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (special a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (alpha a)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (found)' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'if (eof)' window insert end default Builder_Codeassist_Commands_LBOBJ

    Builder_Codeassist_Commands_LBOBJ = 'or' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'and' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'else' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'endif' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'initialize' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'input' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'integer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'list' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'leftjust' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'len' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'local' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'logfile' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'lower' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'md' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'mix' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'noco' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'nove' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'p' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pack' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'paste' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pasteb' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'pattern' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'perm' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'print' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'printx' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'ps' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'r' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'random' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rd' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'read' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'restore' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'return' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rightjust' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rv' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'rvs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'save' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'scan' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'scanr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'size' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'sleep' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'sort' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'split' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'splitr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'status' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'string' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'subs' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'system' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'systemcurr' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'trace' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'upper' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'until' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'user' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'veri' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'wait' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'waitbell' window insert end default Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* Multi-line Add Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = '*File Processing' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Comments' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Directory List' window insert end default Builder_Codeassist_Commands_LBOBJ
    if (CodeType = 'bedit')
+      goto !a1800_Builder_Code_Assist_bypass_windows
+   endif

    Builder_Codeassist_Commands_LBOBJ = '*Directory Button' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Window Open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = '*Clear List' window insert end default Builder_Codeassist_Commands_LBOBJ

    //***************************************
    //* Window Commands
    //***************************************
    Builder_Codeassist_Commands_LBOBJ = 'window action' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window autotab' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window backcolor' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window bitmap' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window center' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window check' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window clear' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window close' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window color' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window conceal' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window createcontrol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window createwindow' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window delete' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window deletecontrol' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window deletewindow' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window default' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window disable' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window edit' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window enable' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window fileinsert' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window getfocus' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window getfocuswin' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window hide' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window hwnd' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window insert' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window mask' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window message' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window modify' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window mousepos' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window obtain' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window open' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window paint' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window push' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window select' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window selectaction' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window setfocus' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window shade' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window show' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window size' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window sound' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window start' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window stop' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window timer' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window title' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window uncheck' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unconceal' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unselect' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window unshade' window insert end default Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Commands_LBOBJ = 'window windowpos' window insert end default Builder_Codeassist_Commands_LBOBJ

!a1800_Builder_Code_Assist_bypass_windows
    call !a1900_Backup_Code

    if  (!CodeAssistReenter)
+       window unshade Builder_Codeassist_WIN
+   endif
    CodeAssistReenter = 'n'
    window pointer arrow
    return

//******************************
//* Refresh the Builder_Code_WIN window
//******************************
!a1800_Builder_Code_Refresh_PBOBJ
    call !y500_bedit_code
    Builder_System_SystemList_COOBJ = SystemName
    BatchUpdating = 'y'
    call !a200_Builder_System_Modify_bedit
    BatchUpdating = 'n'
    return

//******************************
//* Test the B-Edit batch program
//******************************
!a1800_Builder_Code_Test_PBOBJ
    MacroCommand = |system:"start bedit call @SystemName@.bed"| 
    $MacroCommand
    return

//******************************
//* View the B-Edit batch flow
//******************************
!a1800_Builder_Code_View_PBOBJ 
    string HoldSystemName error
    ViewSingleProg = 'y'
    HoldSystemName = SystemName
    Builder_Import_Filename_EFOBJ = '@SystemName@.bed'
    //message = Builder_Import_Filename_EFOBJ window message info ok
    Builder_Import_Extension_EFOBJ = 'BED'
    Extension = 'BED'
    call !a600_Builder_Import_OK_bedit_batch
    SystemName = HoldSystemName
    return

//******************************
//* Refresh the screen
//******************************
!a1900_Builder_Codeassist_Refresh_PBOBJ 
    string HoldCodeModule error
    HoldCodeModule = Builder_Code_Codemodules_LBOBJ
    CodeAssistReenter = 'y'
    call !a1900_Builder_Codeassist_Ok_PBOBJ
    Builder_Code_Codemodules_LBOBJ = HoldCodeModule
    call !a1800_Builder_Code_Assist_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Test the System
//****************************** 
!a1900_Builder_Codeassist_Test_PBOBJ 
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    CodeAssistReenter = 'y'
    call !a1800_Builder_Code_Test_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* View the Bedit.log file
//******************************
!a1900_Builder_Codeassist_Log_PBOBJ
    system:"start notepad bedit.log"
    return

//******************************
//* View the System Modules
//****************************** 
!a1900_Builder_Codeassist_View_PBOBJ 
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    CodeAssistReenter = 'y'
    call !a1800_Builder_Code_View_PBOBJ
    CodeAssistReenter = 'n'
    return

//******************************
//* Code Assist on Module selection
//******************************
!a1900_Builder_Codeassist_Code_PBOBJ 
    window obtain Builder_Codeassist_Variables_LBOBJ
    split:/@Builder_Codeassist_Variables_LBOBJ/;1
    if  (left != '!')
+       message = 'Please select a Module from the list'
+       window message error ok
+       window setfocus Builder_Codeassist_Variables_LBOBJ
+       return
+   endif
    Builder_Code_Codemodules_LBOBJ = Builder_Codeassist_Variables_LBOBJ
    call !a1900_Builder_Codeassist_Refresh_PBOBJ
    return

//******************************
//* Save the new code
//******************************
!a1900_Builder_Codeassist_Ok_PBOBJ
    file CodeFile error return
    write CodeFile @ModuleFileName
    MacroCommand = |open CheckCode @SystemName@.bed| $MacroCommand
    file CodeFile
    b
    do
        pattern on
        fs:/ call*!/
        pattern off
        if (!eof)
+          call !a1900_Builder_Codeassist_Add_New_Module
+       endif
        file CodeFile
        f;1
    until (eof)
    close CheckCode
    close CodeFile
    close CodeBackup
    if (!CodeAssistReenter)
+      window close Builder_Codeassist_WIN
+   endif
    if (CodeType = 'bedit')
+      call !y500_bedit_code
+      //window close Builder_Code_WIN
+      Builder_System_SystemList_COOBJ = SystemName
+      BatchUpdating = 'y'
+      call !a200_Builder_System_Modify_bedit
+      BatchUpdating = 'n'
+   endif
    return


//******************************
//* Add a new module if needed
//******************************
!a1900_Builder_Codeassist_Add_New_Module
    string NewModuleName   error
    string CheckModuleName error

    scan:/@line/:/call/
    scan:/@right/:word
    NewModuleName = left
    file CheckCode
    b
!a1900_Builder_Codeassist_Add_New_Module_loop
    fs:/@NewModuleName@/
    if-1 (!eof)
+      split:/@line/;1
+      if-2 (left != '!')
+         //* Not a Module Header
+         f;1
+         goto !a1900_Builder_Codeassist_Add_New_Module_loop
+      else-2
+         //* Code Exists
+         return
+   endif
    //message = 'adding module @NewModuleName@' window message info ok

    open NewModuleFile null
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |//* | i:/@Newline@/
    Newline = |//****************************************************| i:/@Newline@/
    Newline = |@NewModuleName@| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    MacroCommand = |write NewModuleFile Bedit-code\@NewModuleName@.bed| $MacroCommand 
    close NewModuleFile
    file ModuleNameFile
    i:/@NewModuleName@/
    sort ModuleNameFile,A,1   
    return

//******************************
//* Close the Code Assist window
//******************************
!a1900_Builder_Codeassist_Cancel_PBOBJ
    message = "Are you sure?"
    window message question yesno
    if (message)
+      close CodeFile error
+      close CodeBackup error
+      window close Builder_Codeassist_WIN
+   endif
    return

//******************************
//* Move a code line up
//******************************
!a1900_Builder_Codeassist_Up_PBOBJ
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif

    scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile
    if (CodeLineNumber = 1)
+      return
+   endif

    //********************
    //* Move the Line
    //********************
    b
    CodeLineNumber --
    f;@CodeLineNumber
    clear
    if-1 (CodeLineNumber = 1)
+      b
+      cut
+      paste
+   else-1
+      cut
+      if-2 (eof)
+         b;1
+         paste
+      else-2
+         b;2
+         paste
+   endif

    call !a1900_reload_code

    //************************************
    //* Select the line
    //************************************
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    return

//******************************
//* Move a code line Down
//******************************
!a1900_Builder_Codeassist_Down_PBOBJ
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Move the Line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    clear
    cut
    if (eof)
+      CodeLineNumber ++
+   else
+      CodeLineNumber = CodeLineNumber + 2
+   endif
    paste

    call !a1900_reload_code

    //************************************
    //* Select the line
    //************************************
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    return

//******************************
//* Delete a line of code
//******************************
!a1900_Builder_Codeassist_Delete_PBOBJ
    integer CodeLineNumber   error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Delete the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    d;1
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Indent a line to the left
//******************************
!a1900_Builder_Codeassist_Left_PBOBJ
    integer CodeLineNumber   error
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Remove Indent from the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    split:/@line/;4
    if (left != '    ') and (left != '+   ')
+      return
+   endif
    if (left = '+   ')
+      Newline = '+@right@'
+   else
+      Newline = right
+   endif
    r:/@Newline@/

    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber ++
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Indent a line to the right
//******************************
!a1900_Builder_Codeassist_Right_PBOBJ
    integer CodeLineNumber   error
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_LBOBJ = null)
+       message = 'Please select a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_LBOBJ
+       return
+   endif
    scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
    CodeLineNumber = left
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok
    file CodeFile

    //********************
    //* Indent the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    split:/@line/;1
    if (left = '!') return
    if (left = '+')
+      Newline = '+   @right@'
+   else
+      Newline = "    @line@"
+   endif
    r:/@Newline@/
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber ++
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    return

//******************************
//* Add a Code Line
//******************************
!a1900_Builder_Codeassist_Add_PBOBJ
    integer CodeLineNumber error

    call !a1900_Backup_Code

    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    window obtain Builder_Codeassist_Code_LBOBJ
    if  (Builder_Codeassist_Code_EFOBJ = null)
+       message = 'Please enter a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    file CodeFile

    if (Builder_Codeassist_Code_LBOBJ = null)
+      b
+      f;*
+      CodeLineNumber = pcount + 1
+   else
+      scan:/@Builder_Codeassist_Code_LBOBJ@/:/ /
+      CodeLineNumber = left
+   endif
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok

    //********************
    //* Remove Indent from the line
    //********************
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif

//    split:/@Builder_Codeassist_Code_EFOBJ@/;1
//    if (left != '!')
//+      split:/@Builder_Codeassist_Code_EFOBJ@/;2
//+      if  (left != '//') and (left != '  ') and (left != '+ ')
//+          Builder_Codeassist_Code_EFOBJ = '    @Builder_Codeassist_Code_EFOBJ@'
//+   endif

    //******************************
    //* Check for "if"
    //******************************
    split:/@Builder_Codeassist_Code_EFOBJ@/;1
    if (left = '+') goto !a1900_Builder_Codeassist_Add_passif 

    if  (ModifyCode)
+       AddIndent = null
+   else
+       call !a1900_Add_Indent
+   endif
    Builder_Codeassist_Code_EFOBJ = '@AddIndent@@Builder_Codeassist_Code_EFOBJ@'
    goto !a1900_Builder_Codeassist_Add_passif //fgb02032014

    scan:/@line/:word
    lower left
    if (left = 'if')
+      Builder_Codeassist_Code_EFOBJ = '+   @Builder_Codeassist_Code_EFOBJ@'
+   else
+      split:/@line/;1
+      if (left = '+')
+         scan:/@right/:word
+         if (left != 'endif')
+            Builder_Codeassist_Code_EFOBJ = '+   @Builder_Codeassist_Code_EFOBJ@'
+   endif

!a1900_Builder_Codeassist_Add_passif      
    i:/@Builder_Codeassist_Code_EFOBJ@/
    b
    rs:/$&$Var1/:/@Builder_Codeassist_Variables_LBOBJ@/;*
    call !a1900_reload_code
    //************************************
    //* Select the line
    //************************************
    CodeLineNumber = CodeLineNumber + 2
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    
    VariableType = null
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ string / if (found) VariableType = 'string' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ int / if (found) VariableType = 'int' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ integer / if (found) VariableType = 'integer' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ float / if (found) VariableType = 'float' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ dollar / if (found) VariableType = 'dollar' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ open / if (found) VariableType = 'file' goto !a1900_Builder_Codeassist_Add_variable
    scan:/@Builder_Codeassist_Code_EFOBJ@/:word split:/@left/;2 if (left != '//') scan:/@Builder_Codeassist_Code_EFOBJ@/:/ file / if (found) VariableType = 'file' goto !a1900_Builder_Codeassist_Add_variable

!a1900_Builder_Codeassist_Add_variable
    if-1 (found)
+      scan:/@right/:word
+      file VariableFile
+      b
+      fs:/@left/
+      if-2 (eof)
+         i:/@left@/
+         Builder_Codeassist_Variables_LBOBJ = left
+         window insert end default Builder_Codeassist_Variables_LBOBJ
+      else-2
+         if-3 (VariableType != 'file') and (!ModifyCode)
+             message = 'Variable already exists!'
+             window message warning ok
+   endif

    Builder_Codeassist_Code_EFOBJ = null
    window modify Builder_Codeassist_Code_EFOBJ
    window setfocus Builder_Codeassist_Code_EFOBJ

    return

//******************************
//* Replace a line of code
//******************************
!a1900_Builder_Codeassist_Modify_PBOBJ
    integer KeepLineNumber error

    call !a1900_Backup_Code


    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_WIN
    if  (Builder_Codeassist_Code_EFOBJ = null)
+       message = 'Please enter a Code line'
+       window message error ok
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif

    file CodeFile
    f;*
    CodeLineNumber = pcount + 1
    call !a1900_Builder_Codeassist_Delete_PBOBJ

    CodeLineNumber ++
    KeepLineNumber = CodeLineNumber

    //************************************
    //* Select the line
    //************************************
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null

    CodeLineNumber ++
    ModifyCode = 'y'
    call !a1900_Builder_Codeassist_Add_PBOBJ
    ModifyCode = 'n'

    file CodeFile
    b
    rs:/$&$Var1/:/@Builder_Codeassist_Variables_LBOBJ@/;*
    b
    CodeLineNumber --
    if (CodeLineNumber)
+      f;@CodeLineNumber
+   endif
    f;1
    if (!eof)    
+      call !a1900_Builder_Codeassist_Up_PBOBJ
+   endif

    window setfocus Builder_Codeassist_Code_LBOBJ
    window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Undo the last change
//******************************
!a1900_Builder_Codeassist_Undo_PBOBJ
    window obtain Builder_Codeassist_Code_LBOBJ
    file CodeBackup
    clear
    b
    copy;*
    file CodeFile
    b
    d;*
    paste

    call !a1900_find_position
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 1
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null

    return

//******************************
//* Backup the Code
//******************************
!a1900_Backup_Code
    file CodeFile
    b
    clear
    copy;*
    close CodeBackup error
    open CodeBackup null
    b
    d;*
    paste
    return

//******************************
//* Double-click the Code List
//******************************
!a1900_Builder_Codeassist_Code_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_Code_LBOBJ
    scan:/@Builder_Codeassist_Code_LBOBJ@/:word
    Builder_Codeassist_Code_EFOBJ = right
    //message = 'LBOBJ[@Builder_Codeassist_Code_LBOBJ@] EFOBJ[@Builder_Codeassist_Code_EFOBJ@]' window message info ok
    window modify Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Double-click the Variables List
//******************************
!a1900_Builder_Codeassist_Variables_LBOBJ

    call !a1900_Backup_Code

    window obtain Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Variables_LBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ
    scan:/@Builder_Codeassist_Variables_LBOBJ@/:/System: /
    if (found)
+      Builder_Codeassist_Variables_LBOBJ = right
+   endif
    file CodeFile
    b
    rs:/$*$Var1/:/@Builder_Codeassist_Variables_LBOBJ/;*
    if (!pcount)
+      b
+      rs:/$*$Var2/:/@Builder_Codeassist_Variables_LBOBJ/;*
+   endif

    if  (!pcount)
+       Builder_Codeassist_Code_EFOBJ = '@Builder_Codeassist_Code_EFOBJ@@Builder_Codeassist_Variables_LBOBJ@ '
+       window modify Builder_Codeassist_Code_EFOBJ
+   endif

    call !a1900_find_position
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 1
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null

    //window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Double-click the Commands List
//******************************
!a1900_Builder_Codeassist_Commands_LBOBJ
    string AddIndent error

    call !a1900_Backup_Code

    window obtain Builder_Codeassist_Variables_LBOBJ
    scan:/@Builder_Codeassist_Variables_LBOBJ@/:/System: /
    if (found)
+      Builder_Codeassist_Variables_LBOBJ = right
+   endif
    pack Builder_Codeassist_Variables_LBOBJ
    if (Builder_Codeassist_Variables_LBOBJ = null)
+      Builder_Codeassist_Variables_LBOBJ = '$*$Var1'
+   endif
    window obtain Builder_Codeassist_Commands_LBOBJ
    Builder_Codeassist_Code_LBOBJ = null
    window obtain Builder_Codeassist_Code_LBOBJ
    window obtain Builder_Codeassist_Code_EFOBJ

    call !a1900_find_position
    call !a1900_Add_Indent

    //*************************************
    //* Processing Commands
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = '*File Processing')
+       subs & Newline = /    open Filename @FileLoc/ subs @ i:/@Newline@/
+       Newline = /    b/ i:/@Newline@/
+       Newline = /    do/ i:/@Newline@/
+       Newline = /        if  (!eof)/ i:/@Newline@/
+       Newline = |+           // Add Processing Here| i:/@Newline@/
+       Newline = /+       endif/ i:/@Newline@/
+       Newline = /        f;1/ i:/@Newline@/
+       Newline = /    until (eof)/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* Comments
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = '*Comments')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 3
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window obtain Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       Builder_Codeassist_Code_EFOBJ = Builder_Codeassist_Code_LBOBJ 
+       window modify Builder_Codeassist_Code_EFOBJ
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       return
+   endif
    //*************************************
    //* Directory Button Processing
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Directory Button')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* Directory Button Processing | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@DirField = "$*$Var1"| i:/@Newline@/
+       MacroCommand = \Newline = |@AddIndent@FileField = "$*$Var2"|\ $MacroCommand i:/@Newline@/
+       Newline = |@AddIndent@call @SystemName@Browse.bed!s100_directory| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 5
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif

    //*************************************
    //* Directory List
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Directory List')
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@//* Directory List Processing | i:/@Newline@/
+       Newline = |@AddIndent@//*     Input : Directory string initialized | i:/@Newline@/
+       Newline = |@AddIndent@//*     Output: DirFileList file of files in Directory | i:/@Newline@/
+       Newline = |@AddIndent@//**********************************************| i:/@Newline@/
+       Newline = |@AddIndent@string Directory = 'c:\' error| i:/@Newline@/
+       Newline = |@AddIndent@call DirList.bed| i:/@Newline@/
+       Newline = |@AddIndent@file DirFileList| i:/@Newline@/
+       Newline = |@AddIndent@b| i:/@Newline@/
+       Newline = |@AddIndent@| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 7
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       if-type  (CodeType != 'bedit')
+           call !a1900_directory_add
+           return
+       else-type
+           return
+   endif

    //*************************************
    //* Clear List
    //*************************************
    if-directory (Builder_Codeassist_Commands_LBOBJ = '*Clear List')
+       Newline = |@AddIndent@$*$Var1 = 'ALL'| i:/@Newline@/
+       Newline = |@AddIndent@window delete $*$Var1| i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ 
+       Builder_Codeassist_Code_LBOBJ = null
+       window setfocus Builder_Codeassist_Code_EFOBJ
+       call !a1900_directory_add
+       return
+   endif

    //*************************************
    //* if processing
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a)')
+       Newline = /    if  ($*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (!a)')
+       Newline = /    if  (!$*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a = b)')
+       Newline = /    if  ($*$Var1 = $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a != b)')
+       Newline = /    if  ($*$Var1 != $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a > b)')
+       Newline = /    if  ($*$Var1 > $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a >= b)')
+       Newline = /    if  ($*$Var1 >= $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a < b)')
+       Newline = /    if  ($*$Var1 < $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a <= b)')
+       Newline = /    if  ($*$Var1 <= $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a beginswith b)')
+       Newline = /    if  ($*$Var1 beginswith $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (a endswith b)')
+       Newline = /    if  ($*$Var1 endswith $*$Var2)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (numeric a)')
+       Newline = /    if  (numeric $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (digit a)')
+       Newline = /    if  (digit $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (special a)')
+       Newline = /    if  (special $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (alpha a)')
+       Newline = /    if  (alpha $*$Var1)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (found)')
+       Newline = /    if  (found)/ i:/@Newline@/
+       call !a1900_if_lines
+       return
    if  (Builder_Codeassist_Commands_LBOBJ = 'if (eof)')
+       Newline = /    if  (eof)/ i:/@Newline@/
+       call !a1900_if_lines
+       return

    //*************************************
    //* sort
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'sort')
+       Newline = /@AddIndent@sort $*$Var1,A,1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif

    //*************************************
    //* do
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'do')
+       Newline = /@AddIndent@do/ i:/@Newline@/
+       Newline = /@AddIndent@until ($*$Var1)/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif

    //*************************************
    //* window open
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window open') or (Builder_Codeassist_Commands_LBOBJ = '*Window Open')
+       Newline = /@AddIndent@window pointer wait/ i:/@Newline@/
+       Newline = /@AddIndent@window open @Builder_Codeassist_Variables_LBOBJ@ shade/ i:/@Newline@/
+       Newline = /@AddIndent@window center @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window clear @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window unshade @Builder_Codeassist_Variables_LBOBJ@/ i:/@Newline@/
+       Newline = /@AddIndent@window pointer arrow/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ
+       Builder_Codeassist_Code_LBOBJ = null  
+       return
+   endif
    //*************************************
    //* window close
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window close')
+       call !a1900_find_position
+       Newline = /@AddIndent@window close @Builder_Codeassist_Variables_LBOBJ@ shade/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window message
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window message')
+       call !a1900_find_position
+       Newline = /@AddIndent@window message info ok/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window insert
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window insert')
+       call !a1900_find_position
+       Newline = /@AddIndent@window insert end default $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window createcontrol
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window createcontrol')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window createcontrol WinName ContName Xpos Ypos Length Width ContType(e.g. PBOBJ) Text/ i:/@Newline@/
+       Newline = /@AddIndent@window createcontrol $*$Var1 $*$Var2 x y cx cy type text/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window createwindow
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window createwindow')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window createwindow WinName Xpos Ypos Length Width Title/ i:/@Newline@/
+       Newline = /@AddIndent@window createcontrol $*$Var1 x y cx cy type text/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window delete
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window delete')
+       call !a1900_find_position
+       Newline = /@AddIndent@window delete $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window deletecontrol
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window deletecontrol')
+       call !a1900_find_position
+       Newline = /@AddIndent@window deletecontrol $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window deletewindow
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window deletewindow')
+       call !a1900_find_position
+       Newline = /@AddIndent@window deletewindow $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window disable
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window disable')
+       call !a1900_find_position
+       Newline = /@AddIndent@window disable $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window enable
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window enable')
+       call !a1900_find_position
+       Newline = /@AddIndent@window enable $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window getfocus
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window getfocus')
+       call !a1900_find_position
+       Newline = /@AddIndent@window getfocus $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window getfocuswin
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window getfocuswin')
+       call !a1900_find_position
+       Newline = /@AddIndent@window getfocuswin $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window hide
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window hide')
+       call !a1900_find_position
+       Newline = /@AddIndent@window hide $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window modify
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window modify')
+       call !a1900_find_position
+       Newline = /@AddIndent@window modify $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window mousepos
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window mousepos')
+       call !a1900_find_position
+       Newline = /@AddIndent@window mousepos $*$Var1 $*$Var2/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window obtain
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window obtain')
+       call !a1900_find_position
+       Newline = /@AddIndent@window obtain $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window open
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window open')
+       call !a1900_find_position
+       Newline = /@AddIndent@window open $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window paint
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window paint')
+       call !a1900_find_position
+       Newline = /@AddIndent@window paint $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window pointer
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window pointer')
+       call !a1900_find_position
+       Newline = /@AddIndent@window pointer PointerType/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window push
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window push')
+       call !a1900_find_position
+       Newline = /@AddIndent@window push $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window select 
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window select')
+       call !a1900_find_position
+       subs & Newline = /&AddIndent&    $*$Var1 = 'INDEX=@$*$Var2@'/ subs @ i:/@Newline@/
+       Newline = /@AddIndent@window select $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window setfocus
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window setfocus')
+       call !a1900_find_position
+       Newline = /@AddIndent@window setfocus $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window shade
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window shade')
+       call !a1900_find_position
+       Newline = /@AddIndent@window shade $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window show
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window show')
+       call !a1900_find_position
+       Newline = /@AddIndent@window show $*$Var1/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window size
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window size')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window size ObjectName Xpos Ypos Length Width/ i:/@Newline@/
+       Newline = /@AddIndent@window size $*$Var1 Xpos Ypos Length Width/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif
    //*************************************
    //* window windowpos
    //*************************************
    if  (Builder_Codeassist_Commands_LBOBJ = 'window windowpos')
+       call !a1900_find_position
+       Newline = /@AddIndent@//window windowpos ObjectName Xpos Ypos Length Width/ i:/@Newline@/
+       Newline = /@AddIndent@window size $*$Var1 Xpos Ypos Length Width/ i:/@Newline@/
+       call !a1900_reload_code
+       CodeLineNumber = CodeLineNumber + 2
+       Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
+       window select Builder_Codeassist_Code_LBOBJ  
+       Builder_Codeassist_Code_LBOBJ = null
+       return
+   endif

    Builder_Codeassist_Code_EFOBJ = '@Builder_Codeassist_Code_EFOBJ@@Builder_Codeassist_Commands_LBOBJ@ '
!a1900_Builder_Codeassist_Commands_update
    window modify Builder_Codeassist_Code_EFOBJ
    //window setfocus Builder_Codeassist_Code_EFOBJ
    return

//******************************
//* Add the rest of the IF lines
//******************************
!a1900_if_lines
    Newline = /+   else/ i:/@Newline@/
    Newline = /+   endif/ i:/@Newline@/
    call !a1900_reload_code
    CodeLineNumber = CodeLineNumber + 2
    Builder_Codeassist_Code_LBOBJ = 'INDEX=@CodeLineNumber@'
    window select Builder_Codeassist_Code_LBOBJ 
    Builder_Codeassist_Code_LBOBJ = null
    return

!a1900_directory_add
    //*********************************
    //* Create the SystemBrowse.bed file
    //*********************************
    open BrowseFile BuilderBrowse.bed
    b
    rs:/Builder/:/@SystemName@/;*
    MacroCommand = 'write BrowseFile @SystemName@Browse.bed' $MacroCommand
    close BrowseFile
    //*********************************
    //* Update the System WIN file
    //*********************************
    MacroCommand = 'open BrowseWindowFile @SystemName@.win error return' $MacroCommand
    b
    fs:/_Browse_WIN/
    if-eof (eof)
+       open BuilderBrowseWin Builder.win
+       fs:/_Browse_WIN/
+       b;3
+       clear
+       copy;26
+       close BuilderBrowseWin
+       file BrowseWindowFile
+       f;*
+       paste
+       b
+       MacroCommand = 'rs:/Builder/:/@SystemName@/;*' $MacroCommand
+       MacroCommand = 'write BrowseWindowFile @SystemName@.win' $MacroCommand
+       close BrowseWindowFile
+   endif

!a1900_directory_add_proc
    //*********************************
    //* Update !0005_Main_Processing
    //*********************************
    open MainProc0005 Bedit-code\!0005_Main_Processing.bed
    b
    fs:/!a1600_Browse_Setup/
    if (eof)
+      b
+      fs:/!0005_Main_Processing/
+      MacroCommand = |i:/    call @SystemName@Browse.bed!a1600_Browse_Setup/| $MacroCommand
+      i:/ /
+      write MainProc0005 Bedit-code\!0005_Main_Processing.bed
+   endif
    close MainProc0005
    return

//******************************
//* Find the chars that should 
//* be in front of the variable
//******************************
!a1900_Add_Indent
    AddIndent = null
    split:/@Builder_Codeassist_Code_EFOBJ@/;1
    if (left = ' ') or (left = '+')
+      return
+   endif
    split:/@line/;1
    if (left != ' ') and (left != '+')
+      AddIndent = '    '
+      return
+   endif
    scan:/@line/:word
    lower left
    if (left = 'if')
+      AddIndent = '+@lword@    '
+   else
+      split:/@line/;1
+      if (left = '+')
+         scan:/@right/:word
+         if (left != 'endif')
+            AddIndent = '+@lword@ '
+            if (left = 'else')
+               AddIndent = '+@lword@     '
+   endif
    scan:/@line/:word
    if (left = 'do')
+      AddIndent = '@lword@    '
+   endif
    if (AddIndent = null)
+      scan:/@line/:word
+      AddIndent = lword
+   endif
    if (AddIndent = null)
+      AddIndent = '    '
+   endif
    split:/@AddIndent/;1
    if (left = '+')
+      split:/@right/;1
+      AddIndent = '+@right@'
+   endif
    //message = '!a1900_Add_Indent line[@line@] AddIndent[@AddIndent@]' window message info ok
    return
    
//******************************
//* Clear and load the Code list
//******************************
!a1900_reload_code
    Builder_Codeassist_Code_LBOBJ = 'ALL'
    window delete Builder_Codeassist_Code_LBOBJ

    b
    CodeCount = 0     
    do
        if (!eof)
+          CodeCount ++
+          CodeCountStr = '0000@CodeCount@'
+          splitr:/@CodeCountStr@/;4
+          Builder_Codeassist_Code_LBOBJ = '@right@ @line@'
+          window insert end default Builder_Codeassist_Code_LBOBJ
+          f;1
+       endif
    until (eof)
    return

//******************************
//* Find the proper position
//******************************
!a1900_find_position
    file CodeFile

    if (Builder_Codeassist_Code_LBOBJ = null)
+      b 
+      f;*
+      CodeLineNumber = pcount + 1
+   else
+      split:/@Builder_Codeassist_Code_LBOBJ@/;4
+      CodeLineNumber = left
+   endif
    //message = '@Builder_Codeassist_Code_LBOBJ@[@CodeLineNumber@]' window message info ok

    b
    CodeLineNumber --
    if (CodeLineNumber > 0)
+      f;@CodeLineNumber
+   endif
    return

//******************************
//* Update Object Size
//******************************
!b300_object_size
    WinX = ObjectX - MinX
    WinY = ObjectY - MinY
    if (WinX < 1)
+      WinX = MinX + 1
+      Builder_Control_X_EFOBJ = "1"
+      window modify Builder_Control_X_EFOBJ
+      window size @ButtonFocus @MinX @ObjectY @ObjectCX @ObjectCY
+   endif
    if (WinY < 1)
+      WinY = MinY + 1
+      Builder_Control_Y_EFOBJ = "1"
+      window modify Builder_Control_Y_EFOBJ
+      window size @ButtonFocus @ObjectX @MinY @ObjectCX @ObjectCY
+   endif
    Builder_Control_X_EFOBJ = WinX
    window modify Builder_Control_X_EFOBJ    
    Builder_Control_Y_EFOBJ = WinY
    window modify Builder_Control_Y_EFOBJ 
    Builder_Control_Length_EFOBJ = ObjectCX
    window modify Builder_Control_Length_EFOBJ
    Builder_Control_Height_EFOBJ = ObjectCY
    window modify Builder_Control_Height_EFOBJ
    return

//******************************
//* Repaint to fix some controls
//******************************
!b400_repaint_control
    if  (ButtonFocus = 'Builder_Control_WindowSize_GBOBJ')
+       MacroCommand = "window hide Builder_Control_WIN" $MacroCommand
+       MacroCommand = "window show Builder_Control_WIN" $MacroCommand
+   endif
    window exists @ButtonFocus
    if (!status) return
    file Controls
    b
    fs:/@ButtonFocus@/
    if (eof) return
    scan:/@line/:/,/
    scan:/@right/:/,/
    if  (left = 'COOBJL') or (left = 'COOBJD') or (left = 'COOBJS') or (left = 'LBOBJ1') or (left = 'STTXTF') or (left = 'STTXTR')
+       goto !b400_repaint
+   else
+       return
+   endif
    
!b400_repaint
    //MacroCommand = "window paint Builder_Control_WIN" $MacroCommand

    if  (left = 'COOBJL') or (left = 'COOBJD') or (left = 'COOBJS') or (left = 'LBOBJ1')
+       MacroCommand = "window paint @ButtonFocus@" $MacroCommand     // COOBJS, COOBJL
+   else
+       MacroCommand = "window hide @ButtonFocus@" $MacroCommand       //STTXTF, STTXTR
+       MacroCommand = "window show @ButtonFocus@" $MacroCommand
+   endif
    return

//**********************************************************************************************************************
//******************************
//* Import a COBOL program for View
//******************************
!i100_import_cobol
    string HoldRight     error
    string Paragraph     error
    string Perform       error
    string ProgramName   error
    string CobolWinName  error
    string CobolNavName  error
    string ParagraphFull error
    string LastParagraph error
    string PerfParaFull  error
    string Copyfilename  error
    string Copydir       error

    HoldRight = null
    Paragraph = null
    Perform = null

!i100_main

    
    file SOURCECODE
    b
    //***********************
    //* Size the COBOL file
    //***********************
    do
        if (!eof)
+          Newline = line
+          size Newline,72
+          r:/@Newline/
+       endif
+       f;1
    until (eof)
    open COBOLWIN null
    open COBOLNAV null

    ProgramName = Builder_Import_Filename_EFOBJ
    pack Builder_Import_Copydir_EFOBJ
    Copydir = Builder_Import_Copydir_EFOBJ
    scanr:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'COBOL-@ProgramName@'

    //message = 'COBOL program [@ProgramName@]' window message info ok
    
    CobolWinName = '@ProgramName@.win'
    CobolNavName = '@ProgramName@.nav'

    //***************************
    //* Insert COPY code
    //***************************
    file SOURCECODE
    b 
!i100_copy_loop
    fs:/ COPY /
    if (eof) goto !i100_copy_done
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !i100_copy_loop
+   endif

    scan:/@line/:/ COPY /
    scan:/@right/:word
    if (left = 'IDMS') f goto !i100_copy_loop
    Copyfilename = left
    scan:/@Copyfilename/:/./
    if (found) Copyfilename = left
    scan:/@Copyfilename/:/'/
    if (found) Copyfilename = "@left@@right@"
    scan:/@Copyfilename/:/'/
    if (found) Copyfilename = "@left@@right@"
    Copyfilename = "@Copydir@\@Copyfilename@.cpy"
    open CopyFile @Copyfilename error goto !i100_copyfile2
    goto !i100_copyfile_ok

!i100_copyfile2
    scanr:/@Copyfilename@/:/./
    Copyfilename = left
    //message = Copyfilename window message info ok
    open CopyFile @Copyfilename error file SOURCECODE f goto !i100_copy_loop
    
!i100_copyfile_ok
    //message = 'pasting [@Copyfilename@]' window message info ok
    b
    copy;*
    close CopyFile
    file SOURCECODE
    paste
    goto !i100_copy_loop
!i100_copy_done
    b

    //***************************
    //* Find Starting Position
    //***************************
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    if (eof)
+      message = 'Unable to locate PROCEDURE DIVISION' window message error ok
+      return
+   endif
    LastParagraph = null

!i100_loop
    if (eof) goto !i100_done
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !i100_loop
+   endif
    HoldRight = right
    split:/@right/;1
    if (left != ' ')
+      scan:/@HoldRight/:word
+      Paragraph = left
+      call !i110_paragraph
+      file SOURCECODE
+      f;1
+      goto !i100_loop
+   endif

    if (left = ' ')
+      scan:/@line/:/ PERFORM /
+      if (found)
+         Newline = line
+         size Newline,72
+         scan:/@Newline/:/ PERFORM /
+         scan:/@right/:word
+         Perform = left
+         call !i120_perform
+   endif
    file SOURCECODE
    f;1
    goto !i100_loop

!i100_done
    //***************************************
    //* Write Files
    //***************************************
    write COBOLWIN @CobolWinName
    write COBOLNAV @CobolNavName

    //close SOURCECODE
    close COBOLWIN
    close COBOLNAV
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    return

!i110_paragraph
    //**************************************
    //* Process a Paragraph
    //**************************************
    scan:/@Paragraph@/:/./
    if (found) Paragraph = left
    upper Paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/-/
    if (found) 
+      Paragraph = left
+   endif

    crush Paragraph
    split:/@Paragraph@/;5
    if (left = 'UNTIL') return
    if (Paragraph = null) return
    if (Paragraph = "PROCEDURE") Paragraph = null return
    if (Paragraph = "COPY") Paragraph = null return
    if (Paragraph = "UNTIL") Paragraph = null return
    if (Paragraph = "WITH") Paragraph = null return
    if (Paragraph = "TEST") Paragraph = null return
    scan:/@Paragraph/:/-/
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file COBOLWIN
    b
    //Newline = 'WINDOW,COBOL_@Paragraph@_WIN,1,1,50,50,@Paragraph@' // FGB 01-09-2014
    Newline = 'WINDOW,COBOL_@ParagraphFull@_WIN,1,1,50,50,@ParagraphFull@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    //Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@' // FGB 01-09-2014
    Newline = '@ParagraphFull@,@ParagraphFull@,@ParagraphFull@'

!i110_paragraph_ViewFilterList
    //**************************************
    //* Update ViewFilterList
    //**************************************
    //message = 'ViewFilterList Newline[@Newline@]' window message info ok
    file ViewFilterList
    b
    scan:/@Newline/:/,/
    HoldLeft = left
    goto !i110_paragraph_ViewFilterList_add // FGB 01-09-2014
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/-/
    if (found)
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/ //message = 'replaced' window message info ok
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/-/
    if (!found)
+      scan:/@Newline/:/,/                 // 01-16-2014 was scanning line
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         //message = 'skipped' window message info ok
+         return
+   endif

!i110_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@HoldLeft@/
    if (eof) 
+      i:/@Newline@/ //message = 'added' window message info ok
+   else
+      //message = 'skipped 2' window message info ok
+   endif

    return

!i120_perform
    //**************************************
    //* Process a Perform
    //**************************************
    //message = 'PERFORM [@Paragraph@][@Perform@][@line@]' window message info ok
    if  (Paragraph = null) 
+       Paragraph = '0000'
+       ParagraphFull = '0000-PROCEDURE-DIVISION'
+   endif 
    scan:/@Perform@/:/./
    if (found) Perform = left
    upper Perform
    PerfParaFull = Perform
    scan:/@Perform@/:/-/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    split:/@Perform@/;5
    if (left = 'UNTIL') return
    if (left = 'VARYI') return
    if (left = 'WITH') return
    if (left = 'TEST') return
    if (Paragraph = Perform) return
    
    Newline = 'COBOL_@ParagraphFull@_@PerfParaFull@_PBOBJ,@PerfParaFull@,open' // FGB 01-09-2014
    file COBOLNAV
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/ //message = 'New COBOLNAV[@line@]' window message info ok
    file COBOLWIN
    b
    Newline = 'WINDOW,COBOL_@PerfParaFull@_WIN,1,1,50,50,@PerfParaFull@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@ParagraphFull@,@ParagraphFull@'
    call !i110_paragraph_ViewFilterList

    if (ParagraphFull = '0000-PROCEDURE-DIVISION')
+      file COBOLWIN
+      Newline = 'WINDOW,COBOL_@ParagraphFull@_WIN,1,1,50,50,@ParagraphFull@'
+      b
+      fs:/@Newline@/
+      if (eof) 
+         i:/@Newline@/
+   endif

    if (ParagraphFull = '0000-PROCEDURE-DIVISION')
+      Newline = '@ParagraphFull@,@ParagraphFull@,@ParagraphFull@'
+      call !i110_paragraph_ViewFilterList
+   endif

    return

//**********************************************************************************************************************
//******************************
//* Import a BEDIT program for View
//******************************
!i200_import_bedit
    string  HoldRight     error
    string  HoldLeft      error
    string  Paragraph     error
    string  Perform       error
    string  ProgramName   error
    string  BeditCodeWinName  error
    string  BeditCodeNavName  error
    string  ParagraphFull error
    string  LastParagraph error
    string  PerfParaFull  error

    HoldRight = null
    Paragraph = null
    Perform = null

!i200_main
    file SOURCECODE
    b
    //message = 'Builder_Import_Viewmods_RBOBJ[@Builder_Import_Viewmods_RBOBJ@]' window message info ok
    //message = 'Builder_Import_Viewfiles_RBOBJ[@Builder_Import_Viewfiles_RBOBJ@]' window message info ok
    //message = 'Builder_Import_Viewvars_RBOBJ[@Builder_Import_Viewvars_RBOBJ@]' window message info ok
    if  (Builder_Import_Viewfiles_RBOBJ)
+       call !i250_viewfiles
+   endif
    b

    open BeditCodeWin null
    open BeditCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'BEDIT-@ProgramName@'

    //message = 'SOURCECODE program [@ProgramName@]' window message info ok
    
    BeditCodeWinName = '@ProgramName@.win'
    BeditCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b

    //*************************************
    //* Fix string call lines
    //*************************************
    do
        pattern on
        fs:/ string *call /
        pattern off
        if (!eof)
+          scan:/@line/:/ string /
+          scan:/@right/:word
+          Newline = '!@left@'
+          r:/@Newline@/
+          f;1
+          scan:/@right/:/call /
+          splitr:/@right@/;1
+          Newline = '    call @left@' //message = 'replacing [@line@] with [@Newline@]' window message info ok
+          r:/@Newline/
+          f;1
+       endif
    until (eof)
    write SOURCECODE BEDITSTR.dat

    //***************************
    //* Find Starting Position
    //***************************
    b
    cols 1,1
    fs:/!/
    noco
    if (eof)
+      message = 'Unable to locate first label in the Bedit code'
+      window message error ok
+      return
+   endif

    LastParagraph = null
!i200_loop
    if (eof) goto !i200_done
    split:/@line/;1
    HoldRight = right
    if (left = '!')
+      scan:/@HoldRight/:word
+      Paragraph = left
+      call !i210_paragraph
+      file SOURCECODE
+      f;1
+      goto !i200_loop
+   endif

    if-1 (left = ' ') or (left = '+')
+      scan:/@line/:/ call /
+      if-2 (found)
+         scan:/@right/:word
+         Perform = left
+         split:/@left@/;1
+         if-3 (left = '!')
+            Perform = right
+            call !i220_perform
+         else-3
+            call !i220_perform
+   endif
    file SOURCECODE
    f;1
    goto !i200_loop

!i200_done
    //***************************************
    //* Write Files
    //***************************************
    write BeditCodeWin @BeditCodeWinName
    write BeditCodeNav @BeditCodeNavName

    //close SOURCECODE
    close BeditCodeWin
    close BeditCodeNav

    return

!i210_paragraph
    //**************************************
    //* Process a Paragraph
    //**************************************
    ParagraphFull = Paragraph  
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file BeditCodeWin
    b
    Newline = 'WINDOW,BEDIT_@Paragraph@_WIN,1,1,50,50,@Paragraph@' 
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'

!i210_paragraph_ViewFilterList
    //**************************************
    //* Update ViewFilterList
    //**************************************
    //message = 'ViewFilterList Newline[@Newline@]' window message info ok
    file ViewFilterList
    b
    scan:/@Newline/:/,/
    HoldLeft = left
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/ //message = 'replaced' window message info ok
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/                      // 01-16-2014 was scanning line
+      SearchString = '@HoldLeft@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         //message = 'skipped' window message info ok
+         return
+   endif

!i210_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@HoldLeft@/
    if (eof) 
+      i:/@Newline@/ //message = 'added' window message info ok
+   else
+      //message = 'skipped 2' window message info ok
+   endif

    return

!i220_perform
    //**************************************
    //* Process a Perform
    //**************************************
    if  (Paragraph = null) return
    PerfParaFull = Perform
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file BeditCodeNav
    Newline = 'BEDIT_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file BeditCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file BeditCodeWin
    b
    Newline = 'WINDOW,BEDIT_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i210_paragraph_ViewFilterList

    return

//******************************
//* View B-Edit File Structure
//******************************
!i250_viewfiles
    string FileCallName  error

    open FileCallsFile null

    file SOURCECODE
    //**************************
    //* Comment all current calls
    //**************************
    b rs:/ call /:/ removedcall /;*
    b rs:/ window open /:/windowopen/;*
    b
    pattern on
    do
        fs:/print* file /
        if (!eof)
+          d;1
+       endif
    until (eof)
    b
    do
        fs:/print* open /
        if (!eof)
+          d;1
+       endif
    until (eof)
 
    pattern off
    b
    //**************************
    //* Change all File access to calls
    //**************************
    do
        scan:/@line/:word
        split:/@left/;2
        if  (left != '//')
+           scan:/@line/:/ file /
+           if  (found)
+               scan:/@right/:word
+               call !i251_filecallsfile
+               file SOURCECODE
+               Newline = '    call @FileCallName@'
+               r:/@Newline/
+               file SOURCECODE
+       endif
        scan:/@line/:word
        split:/@left/;2
        if  (left != '//')
+           scan:/@line/:/ open /
+           if  (found)
+               scan:/@right/:word
+               call !i251_filecallsfile
+               file SOURCECODE
+               Newline = '    call @FileCallName@'
+               r:/@Newline/
+               file SOURCECODE
+       endif
        f;1
    until (eof)
    file FileCallsFile
    b
    if (eof)
+      goto !b250_done
+   endif
    do
        file FileCallsFile
        if (!eof)
+          Newline = line
+          file SOURCECODE
+          f;*
+          i:/@Newline@/
+          i:/    return/
+          i:/ /
+       endif
        file FileCallsFile
        f;1
    until (eof)

!b250_done
    close FileCallsFile
    write SOURCECODE fgb.dat
    file SOURCECODE
    b
    return

//******************************
//* Update the FileCallsFile
//******************************
!i251_filecallsfile
    string TestCallName error
    TestCallName = left
    file FileCallsFile
    b
    fs:/@TestCallName@/
    if (eof)
+      i:/@TestCallName@/
+   endif
    FileCallName = '!*F@lineno@_@line@/
    return

//**********************************************************************************************************************
//******************************
//* Import a C program for View
//******************************
!i300_import_c
    string  HoldRight     error
    string  HoldLeft      error
    string  Paragraph     error
    string  Perform       error
    string  ProgramName   error
    string  CCodeWinName  error
    string  CCodeNavName  error
    string  ParagraphFull error
    string  LastParagraph error
    string  PerfParaFull  error

    HoldRight = null
    Paragraph = null
    Perform = null

!i300_main
    file SOURCECODE
    b

    open CCodeWin null
    open CCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'C-@ProgramName@'

    //message = 'CCode program [@ProgramName@]' window message info ok
    
    CCodeWinName = '@ProgramName@.win'
    CCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b rs:|"//"|:|"\\"|;*
    b rs:/@tab@/:/     /;*
    b
    //*************************************
    //* Remove Comments
    //*************************************
    do  
        if (!eof)
+          fs:|//|
+          if (!eof)
+             scan:/@line/:|//|
+             r:/@left@/
+       endif
        f;1
    until (eof)
    b
    call !i301_remove_comments

    //*************************************
    //* includes
    //*************************************
    b
    do  
        if (!eof)
+          scan:/@line/:word
+          split:/@left/;1 
+          if (left = '#')
+             r:/ /
+       endif
        f;1
    until (eof)

    //*************************************
    //* Remove Blank Lines
    //*************************************
    file SOURCECODE
    b
!i300_del_lines
    if (eof)
+      goto !i300_del_done
+   endif
    Newline = line
    crush Newline
    if (Newline = null)
+      d;1
+   else
+      f;1
+   endif
    goto !i300_del_lines   

!i300_del_done
    b
    rs:/ call /:/ xxx /
    b

    //write SOURCECODE SOURCECODE.C message = 'C ready for processing' window message info ok

    //*************************************
    //* Find Functions
    //*************************************
    int  BracketCount error
    int  FunctionCount error
    BracketCount = 0
    FunctionCount = 0

    open Functions null 
    file SOURCECODE 
    b  
    do
        if (!eof)
+          scan:/@line/:/(/
+          if (found)
+             if (!BracketCount)
+                call !i302_found_function
+       endif
        file SOURCECODE
        if (!eof)
+          call !i303_count_brackets
+       endif
        //message = 'FunctionCount[@FunctionCount@] BracketCount[@BracketCount@] line[@line@]' window message info ok
        if (BracketCount < 0)
+          message = 'Non-matching brackets [@lineno@][@line@]' 
+          window message warning ok
+          file SOURCECODE
+          f;*
+       endif
        file SOURCECODE
        f;1
    until (eof)

    //write SOURCECODE SOURCECODE.C message = 'C done with brackets' window message info ok

    //*************************************
    //* Replaced called functions with call
    //*************************************
    file Functions
    b
    do
        if (!eof)
+          Paragraph = line
+          call !i305_paragraph
+       endif
        file Functions
        f;1
    until (eof)
    
    write Functions SOURCECODE-Functions.txt
    close Functions
    write SOURCECODE SOURCECODE.C
    //window stop

    LastParagraph = null
    Paragraph = null
    file SOURCECODE
    b
!i300_loop
    if (eof) goto !i300_done
    split:/@line/;1
    if (left = '!')
+      scan:/@right/:word
+      Paragraph = left
+      call !i310_paragraph
+      goto !i300_next
+   endif

    scan:/@line/:/ call /
    if  (!found) 
+       scan:/@line/:/ CALL /
+       if (!found)
+          goto !i300_next
+   endif

    HoldRight = right
    HoldLeft = left

    scan:/@HoldRight/:word
    Perform = left
    split:/@Perform/;1
    if  (left = '!') Perform = right
    call !i320_perform

!i300_next
    file SOURCECODE
    f;1
    goto !i300_loop

!i300_done
    write CCodeWin @CCodeWinName
    write CCodeNav @CCodeNavName

    //close SOURCECODE
    close CCodeWin
    close CCodeNav
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    return

//*******************************
//* Remove /* */ comments
//*******************************
!i301_remove_comments
    fs:|/*|
    if (eof) return
    scan:/@line/:|/*|
    HoldLeft = left
    HoldRight = right
    Newline = HoldLeft
    scan:/@right/:|*/|
!i301_loop1
    if  (!found)
+       r:/@Newline@/
+       f;1
+       if (!eof)
+          scan:/@line/:|*/|
+          Newline = null
+          goto !i301_loop1
+   endif
    if (eof) return
    scan:/@line/:|*/|
    if (found)
+      r:/@right/
+      f;1
+      goto !i301_remove_comments
+   else
+      d
+      goto !i301_loop1
+   endif
    return

//*******************************
//* Found a function def line
//*******************************
!i302_found_function
    scanr:/@left/:word
    file Functions
    if (right != null)
+      Newline = right
+   else
+      Newline = left
+   endif
    crush Newline
    //if (Newline = 'main') Newline = '0000_main'
    i:/@Newline@/     
    file SOURCECODE
    Newline = '!@Newline@ @line@'
    r:/@Newline@/ 
    FunctionCount ++
    file SOURCECODE
    return

//*******************************
//* Count Parens
//*******************************
!i303_count_brackets
    Newline = line
    scan:/@Newline/:/{/
!i303_scan_left
    if (found) 
+      BracketCount ++
+      scan:/@right/:/{/
+      goto !i303_scan_left
+   endif

    scan:/@Newline/:/}/
!i303_scan_right
    if (found) 
+      BracketCount --
+      scan:/@right/:/}/
+      goto !i303_scan_right
+   endif

    //Newline = '[@BracketCount@]@line@' r:/@Newline@/

    //message = 'paren count[@line@][@BracketCount@]' window message info ok
    return

//*******************************
//* Add CALL to all called functions
//*******************************
!i305_paragraph
    file SOURCECODE
    b
!i305_loop
    fs:/@Paragraph@/
    if (eof) return
    split:/@line/;1
    if (left = '!') goto !i305_next
    Newline = '@left@ call @Paragraph@ @right@'
    r:/@Newline/
    goto !i305_next
    
!i305_next
    f;1
    if (eof) return
    goto !i305_loop
    

!i310_paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file CCodeWin
    b
    Newline = 'WINDOW,CCode_@Paragraph@_WIN,1,1,50,50,@Paragraph@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'
!i310_paragraph_ViewFilterList
    file ViewFilterList
    b
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@left@,'
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/                     // 01-16-2014 was scanning line
+      SearchString = '@left@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         return
+   endif

!i310_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@Newline@/
    if (eof) i:/@Newline@/
    return

!i320_perform
    if  (Paragraph = null) return
    PerfParaFull = Paragraph
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file CCodeNav
    Newline = 'CCode_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file CCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file CCodeWin
    b
    Newline = 'WINDOW,CCode_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i310_paragraph_ViewFilterList

    return

========================================================================================================================================================
//******************************
//* Import a Java program for View
//******************************
!i400_import_java
    string  HoldRight        error
    string  HoldLeft         error
    string  Paragraph        error
    string  Perform          error
    string  ProgramName      error
    string  JavaCodeWinName  error
    string  JavaCodeNavName  error
    string  ParagraphFull    error
    string  LastParagraph    error
    string  PerfParaFull     error
    string  CurrentClass     error
    string  FunctionName     error

    HoldRight = null
    Paragraph = null
    Perform = null

!i400_main
    window pointer wait
    close SOURCECODE error
    if (Builder_Import_Filename_EFOBJ = null)
+      call !i450_read_java_files
+      Builder_Import_Filename_EFOBJ = 'JAVADIR'
+   else
+      open SOURCECODE @Builder_Import_Filename_EFOBJ
+   endif

    file SOURCECODE
    b
    subs ^
    rs:/@/:/ /;*
    subs @

    open JavaCodeWin null
    open JavaCodeNav null

    ProgramName = Builder_Import_Filename_EFOBJ
    scan:/@ProgramName@/:/./
    if (found)  
+      ProgramName = left
+   endif
    scanr:/@ProgramName@/:|\|
    if (found)
+      ProgramName = right
+   endif
    scanr:/@ProgramName@/:|/|
    if (found)
+      ProgramName = right
+   endif
    ProgramName = 'Java-@ProgramName@'

    //message = 'JavaCode program [@ProgramName@]' window message info ok
    
    JavaCodeWinName = '@ProgramName@.win'
    JavaCodeNavName = '@ProgramName@.nav'

    file SOURCECODE
    b rs:|"//"|:|"\\"|;*
    b rs:/@tab@/:/     /;*
    b
    //*************************************
    //* Remove Comments
    //*************************************
    do  
        if (!eof)
+          fs:|//|
+          if (!eof)
+             scan:/@line/:|//|
+             r:/@left@/
+       endif
        f;1
    until (eof)
    b
    call !i401_remove_comments

    //*************************************
    //* Remove Imports
    //*************************************
    b
    do  
        if (!eof) 
+          scan:/@line/:word
+          if (left = 'import')
+             r:/ /
+       endif
        f;1
    until (eof)

    //*************************************
    //* Remove Blank Lines
    //*************************************
    file SOURCECODE
    b
!i400_del_lines
    if (eof)
+      goto !i400_del_done
+   endif
    Newline = line
    crush Newline
    if (Newline = null)
+      d;1
+   else
+      f;1
+   endif
    goto !i400_del_lines   

!i400_del_done
    b
    rs:/ call /:/ xxx /
    b

    //write SOURCECODE SOURCECODE.java message = 'Java ready for processing' window message info ok

    //*************************************
    //* Create Class for Implements/Extends
    //*************************************
    string ClassName     error
    string ExtendClassName error

    pattern on
    do
        fs:/class *extends/-/class *implements/
        if-eof (!eof)
+          scan:/@line/:/class *extends/
+          if-extends (found)
+             scan:/@line/:/class /
+             scan:/@right/:word
+             ClassName = left
+             scan:/@right/:/extends/
+             scan:/@right/:word
+             ExtendClassName = left
+             Newline = "public void class @ExtendClassName@ () {"
+             ib:/@Newline/
+             Newline = "     @ClassName@ abcd = new @ClassName@ ();"
+             i:/@Newline/
+             f;1
+          else-extends
+             scan:/@line/:/class /
+             scan:/@right/:word
+             ClassName = left
+             scan:/@right/:/implements/
+             scan:/@right/:word
+             ExtendClassName = left
+             Newline = "public void class @ExtendClassName@ () {"
+             ib:/@Newline/
+             Newline = "     @ClassName@ abcd = new @ClassName@ ();"
+             i:/@Newline/
+             f;1
+        endif
         f;1
    until (eof)
    pattern off
    b

    //*************************************
    //* Find Functions/Classes
    //*************************************
    int  BracketCount error
    int  FunctionCount error
    BracketCount = 0
    FunctionCount = 0

    open Functions null 

    file SOURCECODE 
    b  
    do
        if (!eof)
+          scan:/@line/:/class /
+          if (found)
+             call !i402_found_function
+       endif
        file SOURCECODE
        scan:/@line/:/(/
        if (found)
+          scanr:/@left/:word
+          call !i402_found_function
+       endif
        file SOURCECODE
        f;1
    until (eof)

    write SOURCECODE SOURCECODE.J1 //message = 'Java done with brackets' window message info ok

    //*************************************
    //* Remove 'calls' not in class Function list
    //*************************************
    file SOURCECODE
    b
    do
        fs:/call !/
        if (!eof)
+          scan:/@line/:/call !/
+          scan:/@right/:word
+          Paragraph = '@left@'
+          file Functions
+          b
+          fs:/@Paragraph@/
+          if (eof)
+             file SOURCECODE
+             //message = "Removing Paragraph[@Paragraph@] line[@line@]" window message info ok
+             rs:/call !/:/removecallto !/
+       endif
        file SOURCECODE
        f;1
    until (eof)

    //write SOURCECODE SOURCECODE.J2 //message = 'Java done with brackets' window message info ok

    //*************************************
    //* Make all "new class" names = class name
    //*************************************
    string OldName         error
    string NewFunctionCall error

    file Functions
    b
    do-functions
       split:/@line/;1
       FunctionName = right
       scan:/@FunctionName@/:/./
       if (found) FunctionName = "not-a-class"
       NewFunctionCall = " call !@FunctionName@ "
       SearchString = 'new* @FunctionName@'
       file SOURCECODE
       b
       do-code
          pattern on
          fs:/@SearchString@/
          if (!eof)
+            scan:/@line/:/@SearchString@/
+            scanr:/@left@/:/=/
+            scanr:/@left@/:word
+            OldName = right
+            i:/FGB-Point/
+            b;1
+            call !a405_change_oldname
+            b 
+            fs:/FGB-Point/
+            d
+            b;1
+         endif
          pattern off
          f;1
       until-code (eof)
       file Functions
       f;1
    until-functions (eof)
    b
    
    write Functions SOURCECODE-Functions.txt
    close Functions
    write SOURCECODE SOURCECODE.java
    //window stop

    LastParagraph = null
    Paragraph = null
    file SOURCECODE
    b
!i400_loop
    if (eof) goto !i400_done
    split:/@line/;1
    if (left = '!')
+      scan:/@right/:word
+      Paragraph = left
+      call !i410_paragraph
+      goto !i400_next
+   endif

    scan:/@line/:/ call /
    if  (!found) 
+       scan:/@line/:/ CALL /
+       if (!found)
+          goto !i400_next
+   endif

    HoldRight = right
    HoldLeft = left

    scan:/@HoldRight/:word
    Perform = left
    split:/@Perform/;1
    if  (left = '!') Perform = right
    call !i420_perform

!i400_next
    file SOURCECODE
    f;1
    goto !i400_loop

!i400_done
    close ClassesFile error
    open ClassesFile null
    file SOURCECODE
    b
    do
        fs:/call !/
        if (!eof)
+          scan:/@line/:/call !/
+          scan:/@right/:word
+          Newline = '!@left@'
+          file ClassesFile
+          b
+          fs:/@Newline@/
+          if (eof)
+             i:/@Newline/
+             i:/ /
+       endif
        file SOURCECODE
        f;1
    until (eof)
    file ClassesFile
    b
    copy;*
    file SOURCECODE
    f;*
    paste
    write SOURCECODE SOURCECODE.j3
    close ClassesFile

    write JavaCodeWin @JavaCodeWinName
    write JavaCodeNav @JavaCodeNavName

    //close SOURCECODE
    close JavaCodeWin
    close JavaCodeNav
    //message = 'Use Builder View to see the Paragraph Perform call flow'
    //window message info ok
    window pointer arrow
    return

//*******************************
//* Remove /* */ comments
//*******************************
!i401_remove_comments
    fs:|/*|
    if (eof) return
    scan:/@line/:|/*|
    HoldLeft = left
    HoldRight = right
    Newline = HoldLeft
    scan:/@right/:|*/|
!i401_loop1
    if  (!found)
+       r:/@Newline@/
+       f;1
+       if (!eof)
+          scan:/@line/:|*/|
+          Newline = null
+          goto !i401_loop1
+   endif
    if (eof) return
    scan:/@line/:|*/|
    if (found)
+      r:/@right/
+      f;1
+      goto !i401_remove_comments
+   else
+      d
+      goto !i401_loop1
+   endif
    return

//*******************************
//* Found a function def line
//*******************************
!i402_found_function
    string JavaFoundType error  
    string Holdright     error  

    if-class (mid = 'class ')
+      scan:/@right/:word
+      Newline = "@left@"
+      CurrentClass = Newline
+      crush Newline
+      JavaFoundType = 'class'
+   else-class
+      Newline = "@CurrentClass@.@right@"
+      JavaFoundType = 'function'
+      Holdright = right
+      scan:/@line/:/;/
+      if-call (found)
+          Newline = Holdright
+          JavaFoundType = 'call'
+   endif
    scan:/@Newline/:/{/
    if (found) Newline = "@left@@right@"
    scan:/@Newline/:/}/
    if (found) Newline = "@left@@right@"
    crush Newline
    if (Newline = 'for') goto !i402_next

    if  (JavaFoundType = 'class') or (JavaFoundType = 'function')
+       if (Newline != '=')
+          Newline = '!@Newline@'
+          file Functions
+          b
+          fs:/@Newline@/
+          if (eof)
+             i:/@Newline@/
+             FunctionCount ++    
+   endif 

    file SOURCECODE
    if  (JavaFoundType = 'class')
+       Newline = '@Newline@ @line@'
+       r:/@Newline@/ 
+   endif
    if  (JavaFoundType = 'call') and (Newline != '=')
+       Newline = '    call !@Newline@ @line@'
+       r:/@Newline@/ 
+   endif
!i402_next
    file SOURCECODE
    //f;1
    return

//*******************************
//* Count Parens
//*******************************
!i403_count_brackets
    Newline = line
    scan:/@Newline/:/{/
!i403_scan_left
    if (found) 
+      BracketCount ++
+      scan:/@right/:/{/
+      goto !i403_scan_left
+   endif

    scan:/@Newline/:/}/
!i403_scan_right
    if (found) 
+      BracketCount --
+      scan:/@right/:/}/
+      goto !i403_scan_right
+   endif

    //Newline = '[@BracketCount@]@line@' r:/@Newline@/

    //message = 'paren count[@line@][@BracketCount@]' window message info ok
    return    

//*******************************
//* Change all old class names to actual
//*******************************
!a405_change_oldname
   string OldnameSearch error
   string NewReplace    error

   scan:/@line/:/call !/
   if (!found)
+     Newline = '    call !@FunctionName@ @line@'
+     r:/@Newline@/
+   endif

    OldnameSearch = '@OldName@.'
    NewReplace = '@FunctionName@.'
    if  (OldnameSearch = NewReplace) return
    if  (OldnameSearch = '.') return
    pattern off
    b
    //message = 'FunctionName[@FunctionName@] OldName[@OldName@] OldnameSearch[@OldnameSearch@] NewReplace[@NewReplace@] line[@line@]' window message info ok
    do
        fs:/@OldnameSearch/
        if (!eof)
+          scan:/@line/:/@OldnameSearch/
+          if (found)  
+             rs:/@OldnameSearch@/:/@NewReplace@/
+             Newline = '    call !@FunctionName@ - @line@'
+             r:/@Newline@/
+       endif
        //f;1
    until (eof)
    return

//*******************************
//* Found a Paragraph
//*******************************
!i410_paragraph
    ParagraphFull = Paragraph
    scan:/@Paragraph/:/_/
    if (found) Paragraph = left
    crush Paragraph
    if (Paragraph = null) return
    if (Paragraph = LastParagraph) return
    LastParagraph = Paragraph
    file JavaCodeWin
    b
    Newline = 'WINDOW,JavaCode_@Paragraph@_WIN,1,1,50,50,@Paragraph@'
    fs:/@Newline/
    if (eof) 
+      i:/@Newline@/
+   endif

    Newline = '@ParagraphFull@,@Paragraph@,@Paragraph@'
!i410_paragraph_ViewFilterList
    file ViewFilterList
    b
    //**************************
    //* Replace Short Name
    //**************************
    scan:/@Newline@/:/_/
    if (found)
+      SearchString = '@left@,'
+      fs:/@SearchString@/
+      if (!eof)
+         r:/@Newline@/
+         return
+   endif
    //**************************
    //* Don't add short if full exists
    //**************************
    scan:/@Newline@/:/_/
    if (!found)
+      scan:/@Newline/:/,/
+      SearchString = '@left@,'
+      b
+      fs:/@SearchString@/
+      if (!eof)
+         return
+   endif

!i410_paragraph_ViewFilterList_add
    //**************************
    //* Add Name
    //**************************
    b
    fs:/@Newline@/
    if (eof) i:/@Newline@/
    return

!i420_perform
    if  (Paragraph = null) return
    PerfParaFull = Paragraph
    scan:/@Perform@/:/_/
    if (found) Perform = left
    crush Perform
    if  (Perform = '') return
    
    file JavaCodeNav
    Newline = 'JavaCode_@Paragraph@_@Perform@_PBOBJ,@Perform@,open'
    file JavaCodeNav
    b
    fs:/@Newline@/
    if (eof) i:/@Newline/
    file JavaCodeWin
    b
    Newline = 'WINDOW,JavaCode_@Perform@_WIN,1,1,50,50,@Perform@'
    fs:/@Newline/
    if (eof) i:/@Newline@/

    Newline = '@PerfParaFull@,@Paragraph@,@Paragraph@'
    call !i410_paragraph_ViewFilterList

    return

//*************************************
//* Read all java files into one file
//*************************************
!i450_read_java_files
    string TestExtension error
    string JavaFilename  error
    Dirname = Builder_Import_Directory_EFOBJ
    call !x100_dirlist
    file DirFileList
    b
    do
        scanr:/@line/:/./
        TestExtension = right
        upper TestExtension
        if  (TestExtension != Extension)
+           d
+       else
+           f
+       endif
    until (eof)
    close SOURCECODE error
    open SOURCECODE null
    write DirFileList dirfilelist.dat
    b
    do
        JavaFilename = line
        open TempJavaSource @JavaFilename error goto !i450_next
        //message = 'Merging @JavaFilename@' window message info ok
        subs `
        b 
        copy;*
        file SOURCECODE
        i:/ /
        paste
        subs @
        close TempJavaSource
        file DirFileList
        f;1
    until (eof)
    write SOURCECODE SOURCECODE.java
    return

========================================================================================================================================================

//******************************
//* Show COBOL comments for module
//******************************
!j100_cobol_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco
    SearchString = '@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j100_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;6
    split:/@right/;1
    if (left != ' ')
+      goto !j100_next
+   endif
    scan:/@right/:word
    //message = 'comparing[@left@] to [@SearchString@]' window message info ok
    if  (left != SearchString)
+       goto !j100_next
+   endif
    goto !j100_found
!j100_next
    f;1
    if (eof) goto !j100_done
    goto !j100_loop

!j100_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j100_find_up
    b;1
    if  (Lastline = line) goto j100_keep_down
    Lastline = line
    split:/@line/;6
    split:/@right/;1
    if (left = '*') goto !j100_find_up
    if  (left = ' ')
    split:/@line/;7
    Newline = right
    size Newline,70
    pack Newline
    if (Newline = null) goto !j100_find_up
    f;1
!j100_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j100_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j100_keep_down

!j100_comments_down
    if (eof) goto !j100_done
    split:/@line/;6
    split:/@right/;1
    if  (left = ' ') 
+       split:/@line/;7
+       Newline = right
+       size Newline,65
+       pack Newline
+       if (Newline = null) 
+          goto !j100_next_down
+   endif
    split:/@line/;6
    split:/@right/;1
    if  (left = ' ')
+       goto !j100_done
+   endif
    if (left != '*') goto !j100_next_down
    split:/@line/;7
    Newline = right
    size Newline,65
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j100_next_down
    f;1
    if (!eof) goto !j100_comments_down    

!j100_done
    return

//******************************
//* Show BEDIT comments for module
//******************************
!j200_bedit_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    file SOURCECODE
    b
    cols 1,1
    fs:/!/
    noco
    SearchString = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j200_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;1
    if (left != '!')
+      goto !j200_next
+   endif
    scan:/@line/:/@SearchString@/
    if (right != null) goto !j200_next
    goto !j200_found
!j200_next
    f;1
    if (eof) goto !j200_done
    goto !j200_loop

!j200_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j200_find_up
    b;1
    if  (Lastline = line) goto j200_keep_down
    Lastline = line
    scan:/@line/:word
    split:/@left/;2
    if (left = '//') goto !j200_find_up
    f;1
!j200_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j200_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j200_keep_down

!j200_comments_down
    if (eof) goto !j200_done
    scan:/@line/:word
    split:/@left/;2
    if  (left != '//') goto !j200_done
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j200_next_down
    f;1
    if (!eof) goto !j200_comments_down    

!j200_done
    return

//******************************
//* Show C comments for module
//******************************
!j300_c_comments
    int    CommentCount error
    string CommentCountStr error

    CommentCount = 0
    //$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$*$
    return

    file SOURCECODE
    b
    cols 1,1
    fs:/!/
    noco
    SearchString = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@SearchString@/:word
    SearchString = left
    //message = 'searching[@SearchString@]' window message info ok
!j200_loop
    fs:/@SearchString@/
    if (eof) return
    //message = line window message info ok
    split:/@line/;1
    if (left != '!')
+      goto !j200_next
+   endif
    scan:/@line/:/@SearchString@/
    if (right != null) goto !j200_next
    goto !j200_found
!j200_next
    f;1
    if (eof) goto !j200_done
    goto !j200_loop

!j200_found
    //message = 'found' window message info ok
    ib:/FGB-Para/
    Lastline = line
!j200_find_up
    b;1
    if  (Lastline = line) goto j200_keep_down
    Lastline = line
    scan:/@line/:word
    split:/@left/;2
    if (left = '//') goto !j200_find_up
    f;1
!j200_keep_down
    scan:/@line/:/FGB-Para/
    if  (found)
+       d
+       f;1
+       goto !j200_comments_down
+   endif 
    //message = 'keeping[@line@]' window message info ok
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
    f;1
    if (!eof) goto !j200_keep_down

!j200_comments_down
    if (eof) goto !j200_done
    scan:/@line/:word
    split:/@left/;2
    if  (left != '//') goto !j200_done
    scan:/@line/:word
    Newline = '@left@@right@'
    pack Newline
    if  (Newline != null)
+       //message = 'inserting [@Newline@]' window message info ok
+       CommentCount ++
+       CommentCountStr = '000@CommentCount@'
+       splitr:/@CommentCountStr@/;3
+       Builder_Comments_Comments_LBOBJ = '@right@:@Newline@'
+       window insert end default Builder_Comments_Comments_LBOBJ
+   endif
!j200_next_down
    f;1
    if (!eof) goto !j200_comments_down    

!j200_done
    return

//******************************
//* View Cobol Module
//******************************
!k100_cobol_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    Builder_Filter_Windowlist_LBOBJ = 'FIRST'
    goto !k100_filter_obtain
!k100_filter_loop
    Builder_Filter_Windowlist_LBOBJ = 'NEXT'
!k100_filter_obtain
    window obtain Builder_Filter_Windowlist_LBOBJ
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k100_done
+   endif 

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/-/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    file SOURCECODE
    b
    cols 7,16
    fs:/PROCEDURE/
    noco

    //****************************
    //* Find the correct module
    //****************************
!k100_cobol_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k100_filter_loop
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/')
+      f;1
+      goto !k100_cobol_module_loop1
+   endif
    scan:/@right/:word
    ModuleName = left
    scan:/@ModuleName/:/./
    if (found) ModuleName = left
    crush ModuleName

    if (Builder_Filter_Windowlist_LBOBJ != ModuleName)
+      f;1
+      goto !k100_cobol_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       split:/@line/;6
       split:/@right/;1
    until (left != '*') and (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k100_cobol_module_loop2
    copy;1
    file ProgModule
    paste
    file SOURCECODE
    f;1
    if  (eof) goto !k100_filter_loop
    split:/@line/;6
    split:/@right/;1
    if (left = '*') or (left = '/') goto !k100_cobol_module_loop2
    split:/@right/;1
    if (left = ' ') goto !k100_cobol_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k100_cobol_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       split:/@line/;6
       split:/@right/;1
       if (left = '*') or (left = '/')
+         d;1
+         split:/@line/;6
+         split:/@right/;1
+      endif
    until (left != '*') and (left != '/')

    goto !k100_filter_loop
!k100_done
    return

//******************************
//* View Bedit Module
//******************************
!k200_bedit_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    Builder_Filter_Windowlist_LBOBJ = 'FIRST'
    goto !k200_filter_obtain
!k200_filter_loop
    Builder_Filter_Windowlist_LBOBJ = 'NEXT'
!k200_filter_obtain
    window obtain Builder_Filter_Windowlist_LBOBJ
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k200_done
+   endif 

    Builder_Filter_Windowlist_LBOBJ = '!@Builder_Filter_Windowlist_LBOBJ@'
    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    file SOURCECODE
    b

    //****************************
    //* Find the correct module
    //****************************
!k200_bedit_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k200_filter_loop
    scan:/@line/:word
    ModuleName = left
    crush ModuleName

    if (Builder_Filter_Windowlist_LBOBJ != ModuleName)
+      f;1
+      goto !k200_bedit_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       scan:/@line/:word
       split:/@left@/;1
    until (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k200_bedit_module_loop2
    copy;1
    file ProgModule
    paste
    file SOURCECODE
    f;1
    if  (eof) goto !k200_filter_loop
    split:/@line/;1
    if (left != '!') goto !k200_bedit_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k200_bedit_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       scan:/@line/:word
       split:/@left/;1
       if (left = '/')
+         d;1
+         scan:/@line/:word
+         split:/@left/;1
+      endif
    until (left != '/')

    goto !k200_filter_loop
!k200_done
    return

//******************************
//* View C Module
//******************************
!k300_c_module
    string ModuleName   error
    string ModulePrefix error
    string SearchPrefix error

    Builder_Filter_Windowlist_LBOBJ = 'FIRST'
    goto !k300_filter_obtain
!k300_filter_loop
    Builder_Filter_Windowlist_LBOBJ = 'NEXT'
!k300_filter_obtain
    window obtain Builder_Filter_Windowlist_LBOBJ
    if (Builder_Filter_Windowlist_LBOBJ = null)
+      goto !k300_done
+   endif 

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/ /   
    Builder_Filter_Windowlist_LBOBJ = left

    scan:/@Builder_Filter_Windowlist_LBOBJ@/:/_/
    if (found) 
+      SearchPrefix = left
+   else
+      SearchPrefix = Builder_Filter_Windowlist_LBOBJ
+   endif

    close CSource error
    open CSource @SystemName
   
    b

    //****************************
    //* Find the correct module
    //****************************
!k300_c_module_loop1
    fs:/@Builder_Filter_Windowlist_LBOBJ@/
    if (eof)  goto !k300_filter_loop
    split:/@line/;1
    if (left = '/') or (left = ' ') or (left = tab)
+     f;1 
+     goto !k300_c_module_loop1
+   endif

    //****************************
    //* Backup and keep comments
    //****************************
    do
       b;1
       scan:/@line/:word
       split:/@left@/;1
    until (left != '/')
    f;1
    
    //****************************
    //* Keep Module Code
    //****************************
!k300_c_module_loop2
    copy;1
    file ProgModule
    paste
    file CSource
    f;1
    if  (eof) goto !k300_filter_loop
    if (line = null) goto !k300_c_module_loop2
    split:/@line/;1
    if (left = '/') or (left = ' ') or (left = tab) or (left = '{') or (left = '}') goto !k300_c_module_loop2
    scan:/@line/:/@SearchPrefix@/
    if (found) goto !k300_c_module_loop2

    //****************************
    //* remove trailing comments
    //****************************
    file ProgModule
    f;*
    do
       scan:/@line/:word
       split:/@left/;1
       if (left = '/') or (line = null)
+         d;1
+         scan:/@line/:word
+         split:/@left/;1
+      endif
    until (left != '/')

    goto !k300_filter_loop
!k300_done
    return

//******************************
//* Set the Object navigation
//******************************
!n100_navigation
    window pointer wait
    window open Builder_Nav_WIN shade
    window windowpos Builder_Nav_WIN WinX WinY WinCX WinCY
    WinX = ObjectX + 10
    WinY = ObjectY + 45
    window size Builder_Nav_WIN @WinX @WinY @WinCX @WinCY
    //window center Builder_Nav_WIN
    window clear Builder_Nav_WIN
    Builder_Nav_Controlname_STTXT = ButtonFocus
    window modify Builder_Nav_Controlname_STTXT
    Builder_Nav_Open_RBOBJ = 'Y'
    window modify Builder_Nav_Open_RBOBJ

    file WindowList
    b
!n100_loop
    if (!eof) 
+      Builder_Nav_Windowlist_COOBJ = line
+      window insert end default Builder_Nav_Windowlist_COOBJ
+      f;1
+      goto !n100_loop
+   endif

    file WindowNav
    b
    fs:/@ButtonFocus@/
    if (eof) goto !n100_unshade
    scan:/@line/:/,/
    scan:/@right@/:/,/
    Builder_Nav_Windowlist_COOBJ = left
    Builder_Nav_Windowname_STTXT = left
    window modify Builder_Nav_Windowname_STTXT
    NavAction = right
    if  (NavAction = 'open')
+       Builder_Nav_Open_RBOBJ = 'Y'
+       window modify Builder_Nav_Open_RBOBJ
+       Builder_Nav_Close_RBOBJ = 'N'
+       window modify Builder_Nav_Close_RBOBJ
+   else
+       Builder_Nav_Open_RBOBJ = 'N'
+       window modify Builder_Nav_Open_RBOBJ
+       Builder_Nav_Close_RBOBJ = 'Y'
+       window modify Builder_Nav_Close_RBOBJ
+   endif

!n100_unshade
    call !a400_Builder_Control_Focus_Controls_set
    window unshade Builder_Nav_WIN
    window pointer arrow    
    return


//******************************
//* Setup the Progress Window 
//* -initialize ProgressCount before calling
//******************************
!p100_open_progress
    window open Builder_Progress_WIN shade
    window center Builder_Progress_WIN
    window windowpos Builder_Progress_Progressframe_STTXT Progframex Progframey Progframecx Progframecy
    window windowpos Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    window size Builder_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    ProgressMax = Progcx - 4

    if (ProgressCount) 
+      Progress = Progcx / ProgressCount
+   else
+      Progress = 1
+   endif
    //message = 'Files[@ProgressCount@] Progress[@Progress@] Progcx[@Progcx@]' window message info ok    
    b

    Progx += 2
    Progy += 2
    Progcx = 1
    Progcy -= 4
    window size Builder_Progress_Progress_STTXT Progx Progy Progcx Progcy
    ProgressShow = Progcx
    window unshade Builder_Progress_WIN

    return

//******************************
//* Show Progress
//******************************
!p200_show_progress
    ProgressWork = ProgressShow + Progress
    Progcx = ProgressWork
    if  (Progcx > ProgressMax) 
+       Progcx = ProgressMax
+   endif
    ProgressShow = ProgressWork
    window size Builder_Progress_Progress_STTXT @Progx @Progy @Progcx @Progcy
    window size Builder_Progress_Progressframe_STTXT @Progframex @Progframey @Progframecx @Progframecy
    //window modify Builder_Progress_Progress_STTXT
    //window paint Builder_Progress_Progress_STTXT
    //window modify Builder_Progress_Progressframe_STTXT
    //window paint Builder_Progress_Progressframe_STTXT
    //window paint Builder_Progress_WIN
    return

//******************************
//* Close the Progress Window
//******************************
!p300_close_progress
    window close Builder_Progress_WIN error
    return

//******************************
//* Show Directory Screen
//*     DirField:  should be set to the EFOBJ to update when the Browse OK button is pressed
//*     Directory: Should be set prior to calling s100 to setup the initial directory
//*     Extension: Should be set prior to calling s100 to setup if you want to limit the files selectable
//******************************
!s100_directory
    window pointer wait
    window open Builder_Browse_WIN shade
    window center Builder_Browse_WIN
    window clear Builder_Browse_WIN

    if  (Directory = null)
+       Directory = 'c:\'
+   endif

    Builder_Browse_Directory_EFOBJ = Directory
    window modify Builder_Browse_Directory_EFOBJ
    Builder_Browse_Extension_EFOBJ = Extension
    window modify Builder_Browse_Extension_EFOBJ

    if  (FileField = null)
+       window disable Builder_Browse_Files_STTXT
+       window disable Builder_Browse_Extension_STTXT
+       window disable Builder_Browse_Extension_EFOBJ
+       window disable Builder_Browse_Refresh_PBOBJ
+   else
+       window enable Builder_Browse_Files_STTXT
+       window enable Builder_Browse_Extension_STTXT
+       window enable Builder_Browse_Extension_EFOBJ
+       window enable Builder_Browse_Refresh_PBOBJ
+   endif

    call !a1600_Builder_Browse_Refresh_PBOBJ
    
    window unshade Builder_Browse_WIN
    window pointer arrow
    return

//******************************
//* Show the Browsed Dir
//******************************
!s200_show_dir
    close Directory error
    open Directory null

    window obtain Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    if  (Builder_Browse_Directory_EFOBJ != null)
+       scan:/@Builder_Browse_Directory_EFOBJ@/:/\/
+       if (!found) 
+          Builder_Browse_Directory_EFOBJ = '@Builder_Browse_Directory_EFOBJ@\'
+   endif
    window modify Builder_Browse_Directory_EFOBJ

    pack Builder_Browse_Extension_EFOBJ

    //********************************************
    //* Directory in Quotes to allow for spaces
    //********************************************
    MacroCommand = |dir "@Builder_Browse_Directory_EFOBJ@"|
    systemcurr:"@MacroCommand@"

    b
    fs:/Directory of/
    scan:/@line/:/Directory of/
    //scan:/@right/:word
    //window clear Builder_Browse_WIN
    Builder_Browse_Subdir_LBOBJ = 'ALL'
    window delete Builder_Browse_Subdir_LBOBJ
    Builder_Browse_Files_LBOBJ = 'ALL'
    window delete Builder_Browse_Files_LBOBJ
    Builder_Browse_Subdir_LBOBJ = null
    window modify Builder_Browse_Subdir_LBOBJ
    Builder_Browse_Directory_EFOBJ = right
    leftjust Builder_Browse_Directory_EFOBJ
    pack Builder_Browse_Directory_EFOBJ
    window modify Builder_Browse_Directory_EFOBJ
    b
    //*********************************************
    //* remove top and bottom of directory listing
    //*********************************************
    d;5
    f;*
    b;1 d;*
    b
    //*********************************************
    //* Find all Sub-directories and files
    //*********************************************
    do 
        if-eof (!eof)
+          scan:/@line/:/<DIR>/
+          if-dir (found)
+             //scan:/@right/:word
+             Builder_Browse_Subdir_LBOBJ = right
+             leftjust Builder_Browse_Subdir_LBOBJ
+             pack Builder_Browse_Subdir_LBOBJ
+             if-dots  (Builder_Browse_Subdir_LBOBJ != '.') and (Builder_Browse_Subdir_LBOBJ != '..')
+                 //Builder_Browse_Subdir_LBOBJ = left
+                 window insert end default Builder_Browse_Subdir_LBOBJ
+          else-dir
+             scan:/@line/:word
+             scan:/@right/:word  
+             scan:/@right/:word
+             scan:/@right/:word
+             Builder_Browse_Files_LBOBJ = right
+             leftjust Builder_Browse_Files_LBOBJ
+             if-extension (Builder_Browse_Extension_EFOBJ != null)
+                scanr:/@Builder_Browse_Files_LBOBJ@/:/./
+                upper right
+                if-found (found) and (Builder_Browse_Extension_EFOBJ = right)
+                   window insert end default Builder_Browse_Files_LBOBJ
+             else-extension
+                window insert end default Builder_Browse_Files_LBOBJ
+       endif
        f;1
    until (eof)
    window paint Builder_Browse_Subdir_LBOBJ
    window hide Builder_Browse_Subdir_LBOBJ
    window show Builder_Browse_Subdir_LBOBJ
    return

//******************************
//* Separate B-Edit Batch program code
//******************************
!t100_separate_batch_code
    //message = 't100' window message info ok
    string ModuleFileName error
    string ModuleName     error
    string ModulePrefix   error
    string SearchPrefix   error

    //***********************
    //* Open the Code Modules window
    //***********************
    if (!BatchUpdating)
+      window pointer wait
+      window open Builder_Code_WIN shade
+      window center Builder_Code_WIN
+      Builder_Code_WIN = 'Code Selection - System[@SystemName@]'
+      window title Builder_Code_WIN
+   endif
    window show Builder_Code_Refresh_PBOBJ
    window show Builder_Code_Test_PBOBJ
    window show Builder_Code_View_PBOBJ

!t100_separate_batch_code_reload
    //***********************
    //* Open the Module File
    //***********************
    close ModuleFile error
    open ModuleFile null

    close ModuleNameFile error
    open ModuleNameFile null

    GenSystemFilename = "@SystemName@.BED"

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    //***********************
    //* Open the Bedit Code File
    //***********************
    close CodeFile error
    open CodeFile @GenSystemFilename
    ModuleFileName = 'Bedit-code\@SystemName@.bed'
    write CodeFile @ModuleFileName

    //***********************
    //* Clear the listbox
    //***********************
    Builder_Code_Codemodules_LBOBJ = 'ALL'
    window delete Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Add the generic lines
    //***********************
    //Builder_Code_Codemodules_LBOBJ = "! Complete Program"
    //window insert end default Builder_Code_Codemodules_LBOBJ
    Builder_Code_Codemodules_LBOBJ = "! Global Variables"
    window insert end default Builder_Code_Codemodules_LBOBJ

    //***********************
    //* Global Variables
    //***********************
    b
    do
        split:/@line/;1
        if  (left != '!')
+           Newline = line
+           file ModuleFile
+           i:/@Newline/
+           file CodeFile
+           f;1
+       endif
    until (left = '!') or (eof)
   
    file ModuleFile
!t100_separate_batch_firstcomments
    b;1
    if (eof) goto !t100_separate_batch_firstcomments_done
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      d
+      goto !t100_separate_batch_firstcomments
+   endif

!t100_separate_batch_firstcomments_done
    ModuleFileName = 'Bedit-code\Global.bed'

!t100_separate_batch_module  
    file ModuleFile
    MacroCommand = "    if (!exists @ModuleFileName@) write ModuleFile @ModuleFileName@"  
    $MacroCommand

    if (eof)
+      goto !t100_separate_batch_Done
+   endif
    ModuleFileName = line
    file ModuleFile
    b
    d;*
    file CodeFile
    Builder_Code_Codemodules_LBOBJ = line
    window insert end default Builder_Code_Codemodules_LBOBJ
    file ModuleNameFile
    i:/@Builder_Code_Codemodules_LBOBJ@/
    file ModuleFile
    //i:/@Builder_Code_Codemodules_LBOBJ/
    ModuleFileName = 'Bedit-code\@Builder_Code_Codemodules_LBOBJ@.bed'
    scan:/@Builder_Code_Codemodules_LBOBJ@/:/_/
    if (found)
+      ModulePrefix = left
+   else
+      ModulePrefix = Builder_Code_Codemodules_LBOBJ
+   endif
    if (ModulePrefix = '!a010')
+      ModulePrefix = null
+   endif
    file CodeFile
!t100_separate_batch_comments
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !t100_separate_batch_comments
+   endif

!t100_separate_batch_loop
    split:/@line/;1
    if (left != '!') or (line = Builder_Code_Codemodules_LBOBJ)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !t100_separate_batch_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      Newline = line
+      file ModuleFile
+      i:/@Newline/
+      goto !t100_separate_batch_next
+   endif    
    file ModuleFile
    b
    ib:/FGB/
    f;*
!t100_separate_batch_commentdelloop
    pack line
    if (line = null)
+      goto !t100_separate_batch_commentremove
+   endif
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !t100_separate_batch_commentremove
+   endif
    goto !t100_separate_batch_commentdeldone
!t100_separate_batch_commentremove
    d
    split:/@line/;3
    if (left != 'FGB')
+      goto !t100_separate_batch_commentdelloop
+   endif

!t100_separate_batch_commentdeldone
    b
    d  //* Remove FGB line  
    goto !t100_separate_batch_module

!t100_separate_batch_next
    file CodeFile
    f;1
    if (!eof)
+      goto !t100_separate_batch_loop
+   endif
    write ModuleFile @ModuleFileName
    close ModuleFile

!t100_separate_batch_Done
    close CodeFile

    if (!BatchUpdating)
+      window unshade Builder_Code_WIN
+      window pointer arrow
+   endif

    return

//******************************
//* Show the System View
//******************************
!v100_view
    call !v200_build_levellist
!v100_view_redraw
    call !v300_view_size
    //message = 'ViewColWins[@ViewColWins@] ViewRowWins[@ViewRowWins@]' window message info ok
    if  (!ViewColWins) or (!ViewRowWins)
+       message = 'No screens to view'
+       window message warning ok
+       return
+   endif
    if  (ViewColWins > 100) or (ViewRowWins > 10)
+       message = 'Too many screens to view, please filter'
+       window message warning ok
+       return
+   endif
    call !v400_view_win_size
    if  (ViewColWins > 20) or (ViewRowWins > 10)
+       message = 'Too many screens to view, do you want to filter?'
+       window message warning yesno
+       if  (message)
+           return
+   endif
    call !v500_draw_view
    return

//******************************
//* Build the LevelList file
//******************************
!v200_build_levellist
    file WindowList
    b
    clear
    copy;*
    close ViewList error
    close ViewListWork error
    open ViewList null
    open ViewListWork null
    paste
    sort ViewListWork,A,1
    write ViewListWork ViewListWork.dat
    file ViewListWork
    b
!v200_viewlist_level1_loop
    //************************
    //* Find Level 1 Windows
    //************************
    if (eof) goto !v200_viewlist_level1_done
    WindowName = line

    Newline = ',@WindowName@,'
    file WindowNav
    b
!v200_viewlist_level1_nav_loop
    fs:/@Newline/
    if (!eof)
+      scanr:/@line@/:/,/
+      if  (right = 'open')
+          file ViewListWork
+          f;1
+          goto !v200_viewlist_level1_loop
+   endif
    if  (!eof)
+       f;1
+       goto !v200_viewlist_level1_nav_loop 
+   endif
    file ViewListWork
    Newline = 'Level-01,@line@'
    file ViewList
    i:/@Newline@/
    file ViewListWork
    d;1
    goto !v200_viewlist_level1_loop

!v200_viewlist_level1_done
    write ViewList viewlist.dat
    //message = 'ViewList.dat written' window message info ok
    write ViewListWork viewwork.dat
    //message = 'Level 1 complete' window message info ok

    file WindowList
    b
    file ViewListWork
    b
    ViewChange = 'n'
    //************************
    //* Set Next Levels
    //************************
!v200_viewlist_nextlevel_loop
    if (eof) goto !v200_viewlist_nextlevel_done
    WindowName = line
    Newline = ',@WindowName@,open'
    file WindowNav
    b
    fs:/@Newline@/
    if (eof)
+      message = 'Error finding open for window [@WindowName@]'
+      window message error ok
+      return
+   endif
    scan:/@line/:/_/
    scan:/@right/:/_/
    file ViewList
    b
    Newline = ',@left@'
    fs:/@Newline@/
    if (eof)
+      file ViewListWork
+      f;1
+      goto !v200_viewlist_nextlevel_loop
+   endif
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    file ViewListWork
    Level ++
    if (Level < 10)
+      Newline = 'Level-0@Level@,@line@'
+   else
+      Newline = 'Level-@Level@,@line@'
+   endif
    file ViewList
    f;*
    i:/@Newline/
    file ViewListWork
    d;1
    ViewChange = 'y'
    goto !v200_viewlist_nextlevel_loop

!v200_viewlist_nextlevel_done
    write ViewList viewlist.dat
    write ViewListWork viewwork.dat
    //message = 'Next Level Complete' window message info ok
    file ViewListWork
    b
    if (!eof)
+      if (!ViewChange)
+         message = 'No changes in View Level Pass, missing data in view'
+         //window message error ok
+         goto !v200_viewlist_nextlevel_finish
+   endif
    if (!eof)
+      file ViewListWork
+      b
+      ViewChange = 'n'
+      goto !v200_viewlist_nextlevel_loop
+   endif

!v200_viewlist_nextlevel_finish
!v200_viewlist_push_levels_down
    //goto !v200_viewlist_push_done

    //************************************
    //* Push Levels to lowest level called
    //************************************
    file ViewList
    b
    copy;*
    file ViewListWork error open ViewListWork null
    paste
    file ViewList
    b
!v200_viewlist_push_loop
    if (eof) goto !v200_viewlist_push_done
    //if (WindowName = '9123') message = '!v200_viewlist_push_loop for [@line@]' window message info ok
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    WindowName = right
    file WindowNav
    b
    NewLevel = Level
!v200_viewlist_push_next_windownav
    SearchString = ',@WindowName@,' //if  (WindowName = '9123') message = SearchString window message info ok
    fs:/@SearchString@/
    if (eof) goto !v200_viewlist_push_highest_done
    scan:/@line/:/_/ //if  (WindowName = '9123') message = 'found[@line@]' window message info ok
    if (!found)
+      scan:/@line@/:/,/
+      ViewFromWin = right
+   else
+      scan:/@right/:/_/
+      ViewFromWin = left
+   endif
    file ViewListWork
    b
!v200_viewlist_push_highest_level
    if (eof) goto !v200_viewlist_push_highest_done
    SearchString = ',@ViewFromWin@'
    fs:/@SearchString@/
    if (eof) goto !v200_viewlist_push_next
    //if  (WindowName = '9123') message = '!v200_viewlist_push_highest_level [@Level@][@line@]' window message info ok
    scan:/@line/:/-/
    scan:/@right/:/,/
    DrawWork = left + 1
    if  (NewLevel < DrawWork) NewLevel = DrawWork 

    file WindowNav
    f;1
    goto !v200_viewlist_push_next_windownav
!v200_viewlist_push_highest_done    
    //if  (WindowName = '9123') message = 'Checking level[@Level@] = [@NewLevel@] for Window[@WindowName@]' window message info ok
    if  (NewLevel = Level) goto !v200_viewlist_push_next
    //if  (WindowName = '9123') message = 'changing level[@Level@] to [@NewLevel@] for Window[@WindowName@]' window message info ok
    file ViewList
    SearchString = line
    file ViewListWork
    b
    fs:/@SearchString@/
    //if  (WindowName = '9123') message = 'Searching [@SearchString@]' window message info ok
    if (eof) goto !v200_viewlist_push_next
    if  (NewLevel < 10)
+       Newline = 'Level-0@NewLevel@,@WindowName@'
+   else
+       Newline = 'Level-@NewLevel@,@WindowName@'
+   endif
    //if  (WindowName = '9123') message = 'Replaced [@Newline@]' window message info ok
    r:/@Newline@/
    file ViewList
    r:/@Newline@/

!v200_viewlist_push_next
    file ViewList
    f;1
    goto !v200_viewlist_push_loop
!v200_viewlist_push_done
    write ViewList ViewListPush.dat
!v200_viewlist_eliminate_gaps
    //********************************
    //* Resequence Level
    //* Eliminate Level Number Gaps
    //********************************
    sort ViewList,A,1

    int LastLevel error
    int LineLevel error

    Level = 0
    LastLevel = 0

    file ViewList
    b
    if (eof) goto !v200_elim_done
    do
        if (eof) 
+          goto !v200_elim_done
+       endif
        scan:/@line/:/-/
        scan:/@right/:/,/
        LineLevel = left
        WindowName = right
        if (LineLevel != LastLevel)
+           Level ++ 
+           LastLevel = LineLevel
+       endif

        if (Level > 9) Level = 9
        Newline = 'Level-0@Level@,@WindowName@' 
        r:/@Newline@/

        f;1
    until (eof)

    //********************************
    //* Eliminate Duplicate Lines
    //********************************
    b
    Newline = line
    do
        f;1
        if (!eof)
+          //message = 'checking[@Newline@][@line@]' window message info ok
+          if (Newline = line)
+             d
+             b;1
+       endif
        Newline = line
    until (eof)

!v200_elim_done
    write ViewList viewlistsort.dat
    write ViewListWork viewwork.dat error

    //*************************************
    //* Float low levels up to just below
    //* Lowest calling level
    //*************************************
    string ViewFromWindow error
    string ViewToWindow   error
    int    NewLevel       error
    int    CheckLevel     error

    file ViewList
    b
    copy;*
    file ViewListWork
    b
    d;*
    paste
    file ViewList
    b
!v200_float_viewlist_loop
    if (eof) goto !v200_float_done
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    WindowName = right
    file WindowNav
    NewLevel = 0
    b
!v200_float_windownav_loop
    if (eof) goto !v200_float_windownav_done
    scan:/@line/:/_/
    scan:/@right/:/_/
    ViewFromWindow = left
    scan:/@right/:/_/
    ViewToWindow = left
    //message = 'checking WindowName[@WindowName@] ViewToWindow[@ViewToWindow@]' window message info ok
    if (ViewToWindow != WindowName) goto !v200_float_windownav_next
    file ViewListWork
    b
    SearchString = ',@ViewFromWindow@'
    //message = 'searching for SearchString[@SearchString@]' window message info ok
    fs:/@SearchString/
    if (eof) goto !v200_float_windownav_next
    scan:/@line/:/-/
    scan:/@right/:/,/
    CheckLevel = left
    //message = 'checking WindowName[@WindowName@] ViewFromWindow[@ViewFromWindow@] left[@CheckLevel@] > NewLevel[@NewLevel@]' window message info ok
    if  (CheckLevel >= NewLevel)
+       NewLevel = left
+       NewLevel += 1
+       //message = 'NewLevel[@NewLevel@]' window message info ok
+   endif

!v200_float_windownav_next
    file WindowNav
    f;1
    goto !v200_float_windownav_loop

!v200_float_windownav_done
    if  (NewLevel = 0) or (NewLevel > Level) or (NewLevel = Level)
+       goto !v200_float_viewlist_next
+   endif

    //message = 'New Level WindowName[@WindowName@] NewLevel[@NewLevel@] Level[@Level@]' window message info ok

    //**************************************
    //* Update the Lists with the new level
    //**************************************
    file ViewList
    SearchString = line
    if (NewLevel > 9) NewLevel = 9
    Newline = 'Level-0@NewLevel@,@WindowName@' 
    r:/@Newline@/
    file ViewListWork
    b
    fs:/@SearchString@/
    if (!eof)
+      r:/@Newline@/
+   endif

!v200_float_viewlist_next
    file ViewList
    f;1
    goto !v200_float_viewlist_loop

!v200_float_done
    write ViewList viewlistfloat.dat

    return

//******************************
//* Find View Rows and Cols Windows
//******************************
!v300_view_size
    ViewRowWins = 0
    ViewColWins = 0
    file ViewList
    b
!v300_row_loop
    //****************
    //* Count Rows
    //****************
    if  (eof) goto !v300_row_loop_done
    scan:/@line/:/-/
    scan:/@right/:/,/
    Level = left
    if (Level > ViewRowWins)
+      ViewRowWins = Level
+   endif
    f;1
    goto !v300_row_loop

!v300_row_loop_done
    //****************
    //* Count Cols
    //****************
    LevelCount = 0
    LevelRowCount = 0
    if (ViewRowWins < 1) goto !v300_cols_done
    do
        LevelCount ++
        file ViewList
        b
        if (LevelCount < 10)
+          Newline = "Level-0@LevelCount@,"
+       else
+          Newline = "Level-@LevelCount@,"
+       endif
        fs:/@Newline@/;*
        if  (pcount > ViewColWins)
+           ViewColWins = pcount
+       endif
    until (LevelCount = Level)

!v300_cols_done
    return

//******************************
//* Determine the View Window Sizes and Spacing
//******************************
!v400_view_win_size
    window windowpos Builder_View_WIN WinX WinY WinCX WinCY

    //**********************
    //* Calculate Width
    //**********************
    ViewWinCXWork = WinCX / ViewColWins
    ViewWinCXWork -= 20
    ViewWinCX = ViewWinCXWork
    ViewWinCX /= 2
    if  (ViewWinCX > 300) ViewWinCX = 300

    //**********************
    //* Calculate Height
    //**********************
    ViewWinCYWork = WinCY / ViewRowWins 
    ViewWinCYWork -= 20
    ViewWinCY = ViewWinCYWork
    ViewWinCY /= 2
    if  (ViewWinCY > 200) ViewWinCY = 200

    //**********************
    //* Calculate X Start/Spacing
    //**********************   
    if  (ViewColWins = 1)
+       ViewWinXStart = WinCX / 2
+       ViewWinCXWork = ViewWinCX / 2
+       ViewWinXStart = ViewWinXStart - ViewWinCXWork
+   else 
+       ViewWinCXWork = ViewWinCX * ViewColWins
+       ViewWinCXWork = WinCX - ViewWinCXWork
+       ViewWinCXWork -= ViewWinCX
+       ViewWinCXWork = ViewWinCXWork / ViewColWins
+       ViewWinXSpacing = ViewWinCXWork
+       ViewWinXStart = WinX + ViewWinXSpacing
+   endif

    //**********************
    //* Calculate Y Start/Spacing
    //**********************    
    ViewWinCYWork = ViewWinCY * ViewRowWins
    ViewWinCYWork = WinCY - ViewWinCYWork
    ViewWinCYWork -= ViewWinCY
    ViewWinCYWork = ViewWinCYWork / ViewRowWins
    ViewWinYSpacing = ViewWinCYWork
    ViewWinYStart = WinY + ViewWinCY - 40
    if  (ViewWinYStart < 0) ViewWinCY = WinY

    //message = 'View Window Size ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@]' window message info ok
    //message = 'View Window X Start[@ViewWinXStart@] Spacing[@ViewWinXSpacing@]' window message info ok
    //message = 'View Window Y WinCY[@WinY@] ViewWinCY[@ViewWinCY@] Start[@ViewWinYStart@] Spacing[@ViewWinYSpacing@]' window message info ok
    return

//******************************
//* Draw the View
//******************************
!v500_draw_view
    ViewCount = 0
    write ViewFilterList ViewFilterList.dat
    close ViewPositions error    
    open ViewPositions null
    b d;*
    close ViewObjects error
    open ViewObjects null
    file ViewList
    b
    //message = 'View Draw Level[@Level@] ViewRowWins[@ViewRowWins@] ViewColWins[@ViewColWins@]' window message info ok
    if (!Level) goto !v100_draw_done
    LevelCount = 0
    LevelRowCount = 0
    ViewCurrX = ViewWinXStart
    ViewCurrY = ViewWinYStart
    //*************************
    //* Draw the Windows
    //*************************
    string SizePosError error
    SizePosError = 'n'
    do-levels
        LevelCount ++
        if  (LevelCount < 10)
+           Newline = 'Level-0@LevelCount@,'
+       else
+           Newline = 'Level-@LevelCount@,'
+       endif
        file ViewList        
        b
        fs:/@Newline@/;*
        if (pcount)
+          //********************************
+          //* Shift the window to the right
+          //********************************
+          ViewWork = ViewColWins - pcount
+          ViewWork /= 2
+          if  (ViewWork > 0)
+              do-shift
+                  ViewCurrX = ViewCurrX + ViewWinCX + ViewWinXSpacing
+                  ViewWork --
+              until-shift (ViewWork = 0)
+       endif
        b
        //***********************************
        //* Create View Windows
        //***********************************
        do-windows
            file ViewList
            if (LevelCount < 10)
+              Newline = /Level-0@LevelCount@,/ 
+           else
+              Newline = /Level-@LevelCount@,/ 
+           endif
            fs:/@Newline@/
            CreateWin = 'n'
            if (!eof)
+              CreateWin = 'y'
+              scanr:/@line@/:/,/
+              WindowName = right
+              WindowTitle = right
+              file BuilderWindowFile
+              b
+              Newline = "WINDOW,@SystemName@_@WindowName@_WIN,"
+              fs:/@Newline@/
+              if (!eof)
+                 scanr:/@line/:/,/
+                 WindowTitle = right
+                 pack WindowTitle
+                 if (WindowTitle = null)
+                    WindowTitle = WindowName
+           endif
            if  (CreateWin)
+               ViewCount ++
+               ControlName = '@WindowName@-@ViewCount@'
+               call !v550_window_title
+               call !v560_check_size
+               //message = 'Creating ControlName[@ControlName@] ViewCurrX[@ViewCurrX@] ViewCurrY[@ViewCurrY@] ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@] WindowTitle[@WindowTitle@]' window message info ok
+               MacroCommand = |window createcontrol Builder_View_WIN @ControlName@ @ViewCurrX@ @ViewCurrY@ @ViewWinCX@ @ViewWinCY@ GBOBJ1 @WindowTitle@|
+               $MacroCommand
+               file ViewObjects
+               i:/@ControlName@/
+               file ViewPositions
+               Newline = '@WindowName@,@LevelCount@,@ViewCurrX@,@ViewCurrY@,@ViewWinCX@,@ViewWinCY@'
+               i:/@Newline@/
+               ViewCurrX = ViewCurrX + ViewWinCX + ViewWinXSpacing
+           endif
            file ViewList
            f;1
        until-windows (eof) 
        file ViewList
        b   
        ViewCurrY = ViewCurrY + ViewWinCY + ViewWinYSpacing
        ViewCurrX = ViewWinXStart
    until-levels (LevelCount = ViewRowWins)
    write ViewPositions viewpos.dat

    if  (SizePosError)
+       message = 'Excessive number of windows'
+       //window message warning ok
+   endif

    //*************************
    //* Draw the Connections
    //*************************
    file WindowNav
    b
    do
        scanr:/@line@/:/,/
        if  (right = 'open')
+           scanr:/@left@/:/,/
+           ViewWindowTo = right
+           scan:/@line@/:/_/
+           scan:/@right@/:/_/
+           ViewWindowFrom = left
+           call !v600_draw_line
+       endif
        file WindowNav
        f;1
    until (eof)

    //close ViewList
    close ViewListWork error
    close ViewPositions error
    return

//******************************
//* Full Window Title for COBOL
//******************************
!v550_window_title
    //message = 'v550' window message info ok
    //if (!ViewCobol) return
    //message = 'WindowTitle[@WindowTitle@] ViewColWins[@ViewColWins@]' window message info ok
    if-viewcol (ViewColWins > 6) 
+      scan:/@WindowTitle@/:/-/
+      if-dash (found)
+         WindowTitle = left
+         return
+      else-dash
+         return
+   endif
    file ViewFilterList error return
    b
!v550_loop
    fs:/@WindowTitle@/ //message = 'WindowTitle[@WindowTitle@] ViewFilterList line[@line@]' window message info ok
    if (eof) return
    scan:/@line/:/,/
    HoldLeft = left
    //**********************
    //* COBOL Separator
    //**********************
    scan:/@HoldLeft@/:/-/
    if (found)
+      if (left != WindowTitle)
+         f;1
+         goto !v550_loop
+   endif
    //**********************
    //* BEDIT Separator
    //**********************
    scan:/@HoldLeft@/:/_/
    if (found)
+      if (left != WindowTitle)
+         f;1
+         goto !v550_loop
+   endif

    WindowTitle = HoldLeft
    return

//******************************
//* Check the size/pos of the window
//******************************
!v560_check_size
    //message = 'ControlName[@ControlName@] ViewCurrX[@ViewCurrX@] ViewCurrY[@ViewCurrY@] ViewWinCX[@ViewWinCX@] ViewWinCY[@ViewWinCY@]' window message info ok
    if  (ViewCurrX < 1)
+       SizePosError = 'y'
+       ViewCurrX = 10
+   endif
    if  (ViewCurrY < 1)
+       SizePosError = 'y'
+       ViewCurrY = 10
+   endif
    if  (ViewWinCX < 1)
+       SizePosError = 'y'
+       ViewWinCX = 10
+   endif
    if  (ViewWinCY < 1)
+       SizePosError = 'y'
+       ViewWinCY = 10
+   endif
    return

//******************************
//* Draw a line from WindowFrom to WindowTo
//******************************
!v600_draw_line
    string Reverse error
    Reverse = 'n'
    //message = 'Draw from [@ViewWindowFrom@] to [@ViewWindowTo@]' window message info ok
    file ViewPositions
    //************************
    //* Find From Window Pos
    //************************
    b
    SearchString = '@ViewWindowFrom@,'
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to locate From Window[@ViewWindowFrom@] - draw to Window[@ViewWindowTo@]'
+      //window message error ok
+      return
+   endif
    scan:/@line/:/,/ ViewFromWin = left 
    scan:/@right/:/,/ ViewFromLevel = left
    scan:/@right/:/,/ ViewFromWinX = left
    scan:/@right/:/,/ ViewFromWinY = left
    scan:/@right/:/,/ ViewFromWinCX = left
    ViewFromWinCY = right

    //************************
    //* Find To Window Pos
    //************************
    b
    SearchString = '@ViewWindowTo@,'
    fs:/@SearchString@/
    if (eof)
+      //message = 'Unable to locate To Window[@ViewWindowTo@] - draw from Window[@ViewWindowFrom@]'
+      //window message error ok
+      return
+   endif
    scan:/@line/:/,/ ViewToWin = left
    scan:/@right/:/,/ ViewToLevel = left
    scan:/@right/:/,/ ViewToWinX = left
    scan:/@right/:/,/ ViewToWinY = left
    scan:/@right/:/,/ ViewToWinCX = left
    ViewToWinCY = right
    
    //message = 'From ViewFromWin[@ViewFromWin@] ViewFromLevel[@ViewFromLevel@] ViewFromWinX[@ViewFromWinX@] ViewFromWinY[@ViewFromWinY@] ViewFromWinCX[@ViewFromWinCX@] ViewFromWinCY[@ViewFromWinCY@]'
    //window message info ok
    //message = 'From ViewToWin[@ViewToWin@] ViewToLevel[@ViewToLevel@] ViewToWinX[@ViewToWinX@] ViewToWinY[@ViewToWinY@] ViewToWinCX[@ViewToWinCX@] ViewToWinCY[@ViewToWinCY@]'
    //1:03 PM 12/9/2013window message info ok
    if  (ViewFromWin = ViewToWin) return

    if  (ViewFromLevel = ViewToLevel)
+       goto !v600_draw_across
+   endif

    if  (ViewToLevel > ViewFromLevel)
+       goto !v600_draw_down
+   else
+       //****************************
+       //* Invert From/To Windows
+       //****************************
+       //message = 'Inverting From Window[@ViewFromWin@] To Window[@ViewToWin@]' window message info ok
+       ViewHoldWin = ViewFromWin
+       ViewHoldLevel = ViewFromLevel
+       ViewHoldWinX = ViewFromWinX
+       ViewHoldWinY = ViewFromWinY
+       ViewHoldWinCX = ViewFromWinCX
+       ViewHoldWinCY = ViewFromWinCY
+
+       ViewFromWin = ViewToWin
+       ViewFromLevel = ViewToLevel
+       ViewFromWinX = ViewToWinX
+       ViewFromWinY = ViewToWinY
+       ViewFromWinCX = ViewToWinCX
+       ViewFromWinCY = ViewToWinCY
+
+       ViewToWin = ViewHoldWin
+       ViewToLevel = ViewHoldLevel
+       ViewToWinX = ViewHoldWinX
+       ViewToWinY = ViewHoldWinY
+       ViewToWinCX = ViewHoldWinCX
+       ViewToWinCY = ViewHoldWinCY
+       Reverse = 'y'
+       goto !v600_draw_down
+   endif

    return

//************************************************
//* Draw From Window down to To Window
//************************************************
!v600_draw_down
    //*****************************
    //* Draw first line down
    //*****************************
    DrawWork = ViewFromWinCX / 2
    LineX = ViewFromWinX + DrawWork
    LineY = ViewFromWinY + ViewFromWinCY - 1
    LineCX = 1
    LineCY = ViewWinYSpacing / 2
    DrawToNextLevel = ViewToLevel - ViewFromLevel      
    if  (DrawToNextLevel = 1)
+       if  (ViewFromWinX = ViewToWinX)
+           //***********************************
+           //* 1 Level Down, same column
+           //***********************************
+           LineCY = ViewWinYSpacing
+           call !v700_create_line_control
+           if (!Reverse)
+              //*****************************
+              //* Draw Ending Block at bottom
+              //*****************************
+              LineX = LineX - 3
+              LineY = LineY + LineCY - 3
+              LineCX = 6
+              LineCY = 6
+              call !v700_create_line_control
+              return
+   endif
    if  (DrawToNextLevel = 1)
+       if  (ViewFromWinX = ViewToWinX)    
+           if (Reverse)
+              //*****************************
+              //* Draw Ending Block at top
+              //*****************************
+              LineY = LineY - 3
+              LineCX = 6
+              LineCY = 6
+              call !v700_create_line_control
+              return
+   endif
    call !v700_create_line_control

    if  (DrawToNextLevel > 1) goto !v600_down_plus_level

    if  (ViewFromWinX < ViewToWinX)
+        //*****************************
+        //* Draw Right 1 Level Down
+        //***************************** 
+        //message = 'Draw right from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        DrawWork = ViewToWinX + DrawWork
+        DrawWork = DrawWork - LineX
+        LineCX = DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        LineX += LineCX
+        do 
+           LineCX += ViewWinXSpacing
+        until (LineCX > ViewToWinX)
+   else
+        //*****************************
+        //* Draw Left 1 Level Down
+        //***************************** 
+        //message = 'Draw left from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        LineCX = LineX - ViewToWinX - DrawWork
+        LineX = ViewToWinX + DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        DrawWork = ViewToWinX + ViewToWinCX
+        do 
+           LineCX -= ViewWinXSpacing 
+        until (LineCX < DrawWork)
+   endif
    

    //*****************************
    //* Draw Down
    //***************************** 
    DrawWork = ViewWinYSpacing / 2
    LineCY = LineCY + DrawWork
    LineCX = 1
    call !v700_create_line_control

    //*****************************
    //* Draw Ending Block
    //*****************************
    if (!Reverse)
+      LineX = LineX - 3
+      LineY = LineY + LineCY - 3
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control 
+   else
+      DrawWork = ViewFromWinCX / 2
+      LineX = ViewFromWinX + DrawWork - 3
+      LineY = ViewFromWinY + ViewFromWinCY
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control
+   endif
    return

//************************************************
//* Draw Down more than 1 Level
//************************************************
!v600_down_plus_level
    if  (ViewFromWinX < ViewToWinX)
+        //*****************************
+        //* Draw Right 
+        //***************************** 
+        LineY += LineCY
+        LineCX = ViewToWinCX
+        LineCY = 1 
+        call !v700_create_line_control
+        LineX += ViewToWinCX
+   else
+        //*****************************
+        //* Draw Left 
+        //***************************** 
+        LineX = LineX - ViewToWinCX
+        LineY += LineCY
+        LineCX = ViewToWinCX
+        LineCY = 1
+        call !v700_create_line_control
+   endif
    //**********************************
    //* Draw Down
    //**********************************
    DrawWork = ViewToWinCY / 2
    LineCY = ViewToWinY - DrawWork - LineY
    LineCX = 1
    call !v700_create_line_control

    if  (ViewFromWinX <= ViewToWinX)
+        //*****************************
+        //* Draw Right 1 Level Down
+        //***************************** 
+        //message = 'Draw right from[@ViewFromWin@] to[@ViewToWin@] ViewWinXSpacing [@ViewWinXSpacing@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        DrawWork = ViewToWinX + DrawWork
+        DrawWork = DrawWork - LineX
+        LineCX = DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        LineX += LineCX
+        //do 
+        //   LineCX += ViewWinXSpacing
+        //   if (ViewWinXSpaceing = 0)
+        //until (LineCX > ViewToWinX)
+   else
+        //*****************************
+        //* Draw Left 1 Level Down
+        //***************************** 
+        //message = 'Draw left from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+        LineY += LineCY
+        DrawWork = ViewToWinCX / 2
+        LineCX = LineX - ViewToWinX - DrawWork
+        LineX = ViewToWinX + DrawWork
+        LineCY = 1
+        call !v700_create_line_control
+        DrawWork = ViewToWinX + ViewToWinCX
+        //do 
+        //   LineCX -= ViewWinXSpacing 
+        //until (LineCX < DrawWork)
+   endif
    

    //*****************************
    //* Draw Down
    //***************************** 
    DrawWork = ViewWinYSpacing / 2
    LineCY = LineCY + DrawWork
    LineCX = 1
    call !v700_create_line_control

    //*****************************
    //* Draw Ending Block
    //*****************************
    if (!Reverse)
+      LineX = LineX - 3
+      LineY = LineY + LineCY - 3
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control 
+   else
+      DrawWork = ViewFromWinCX / 2
+      LineX = ViewFromWinX + DrawWork - 3
+      LineY = ViewFromWinY + ViewFromWinCY
+      LineCX = 6
+      LineCY = 6
+      call !v700_create_line_control
+   endif 
    return

//************************************************
// Draw line for windows on same level
//************************************************
!v600_draw_across
    if  (ViewFromWinX > ViewToWinX)
+       goto !v600_draw_across_left
+   endif
!v600_draw_across2
    DrawWork = ViewFromWinX + ViewFromWinCX + ViewWinXSpacing + 10
    if  (DrawWork > ViewToWinX)
+       //*****************************
+       //* Draw right to adjacent Window
+       //*****************************
+       LineX = ViewFromWinX + ViewFromWinCX
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCX = ViewWinXSpacing
+       LineCY = 1
+       call !v700_create_line_control
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = LineX + ViewWinXSpacing - 3
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   else
+       //message = 'draw right + from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+       //*****************************
+       //* Draw right to > 1 column
+       //*****************************
+       //*** Right
+       LineX = ViewFromWinX + ViewFromWinCX
+       DrawWork = ViewFromWinCX / 2
+       LineCX = DrawWork
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*** Down
+       LineX = LineX + LineCX
+       LineCX = 1
+       DrawWork = ViewFromWinCY / 3
+       LineCY = ViewFromWinCY - DrawWork
+       call !v700_create_line_control
+
+       //*** Right
+       DrawWork = ViewToWinCX / 2 
+       LineCX = ViewToWinX - LineX - DrawWork
+       LineY = LineY + LineCY
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*** Up
+       LineX = LineX + LineCX
+       LineCX = 1
+       DrawWork = ViewToWinCY / 2
+       LineY = ViewToWinY + DrawWork
+       DrawWork = ViewToWinCY / 3
+       LineCY = ViewToWinCY - DrawWork
+       call !v700_create_line_control
+
+       //*** Right
+       DrawWork = ViewToWinCX / 2 
+       LineCX = DrawWork
+       LineCY = 1 
+       call !v700_create_line_control
+
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       if  (!Reverse)
+           LineX = LineX + LineCX - 3
+           LineY = LineY + LineCY - 3
+           LineCX = 6
+           LineCY = 6
+           call !v700_create_line_control
+   endif
    return

!v600_draw_across_left
    DrawWork = ViewToWinX + ViewToWinCX + ViewWinXSpacing + 10
    if  (DrawWork > ViewFromWinX)
+       //*****************************
+       //* Draw left to adjacent Window
+       //*****************************
+       LineX = ViewFromWinX - ViewWinXSpacing
+       DrawWork = ViewFromWinCY / 2
+       LineY = ViewFromWinY + DrawWork
+       LineCX = ViewWinXSpacing
+       LineCY = 1
+       call !v700_create_line_control
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = LineX
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   else
+       //message = 'draw left + from[@ViewFromWin@] to[@ViewToWin@]' window message info ok
+       //****************************
+       //* Invert From/To Windows
+       //****************************
+       //message = 'Inverting From Window[@ViewFromWin@] To Window[@ViewToWin@]' window message info ok
+       ViewHoldWin = ViewFromWin
+       ViewHoldLevel = ViewFromLevel
+       ViewHoldWinX = ViewFromWinX
+       ViewHoldWinY = ViewFromWinY
+       ViewHoldWinCX = ViewFromWinCX
+       ViewHoldWinCY = ViewFromWinCY
+
+       ViewFromWin = ViewToWin
+       ViewFromLevel = ViewToLevel
+       ViewFromWinX = ViewToWinX
+       ViewFromWinY = ViewToWinY
+       ViewFromWinCX = ViewToWinCX
+       ViewFromWinCY = ViewToWinCY
+
+       ViewToWin = ViewHoldWin
+       ViewToLevel = ViewHoldLevel
+       ViewToWinX = ViewHoldWinX
+       ViewToWinY = ViewHoldWinY
+       ViewToWinCX = ViewHoldWinCX
+       ViewToWinCY = ViewHoldWinCY
+       Reverse = 'y'
+       call !v600_draw_across2
+       Reverse = 'n'
+       //*****************************
+       //* Draw Ending Block
+       //*****************************
+       LineX = ViewFromWinX + ViewFromWinCX
+       LineY = LineY + LineCY - 3
+       LineCX = 6
+       LineCY = 6
+       call !v700_create_line_control
+   endif
    return

//******************************
//* Create Line Control
//******************************
!v700_create_line_control
    LineCount ++
    ControlName = 'line-@LineCount@'
    //message = 'Creating line ControlName[@ControlName@] LineX[@LineX@] LineY[@LineY@] LineCX[@LineCX@] LineCY[@LineCY@] WindowTitle[@WindowTitle@]' window message info ok
    window createcontrol Builder_View_WIN @ControlName @LineX @LineY @LineCX @LineCY STTXTR @WindowTitle
    file ViewObjects
    i:/@ControlName@/
    return
    
//******************************
//* Create controls for open file
//******************************
!w100_open_window_build_controls
    file BuilderWindowFile
    b
    Newline = 'WINDOW,@SystemName@_@WindowName@'
    fs:/@Newline/
    if  (eof) 
+       Builder_Control_WindowSize_GBOBJ = WindowTitle
+       window modify Builder_Control_WindowSize_GBOBJ
+       goto !w100_done
+   endif
    scan:/@line/:/,/ ControlType = left
    scan:/@right/:/,/ WindowName = left
    scan:/@right/:/,/ Xpos = left
    scan:/@right/:/,/ Ypos = left
    scan:/@right/:/,/ ObjectCX = left
    scan:/@right/:/,/ ObjectCY = left
    Text = right 
    scan:/@WindowName@/:/_/
    scan:/@right/:/_/
    WindowName = left

    window windowpos Builder_Control_Frame_STTXT MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    //message = 'Win File x[@Xpos@] y[@Ypos@] MinX[@MinX@] MinY[@MinY@]' window message info ok

    Xpos += MinX
    Ypos += MinY
    MacroCommand = 'window size Builder_Control_WindowSize_GBOBJ @Xpos@ @Ypos@ @ObjectCX@ @ObjectCY@' $MacroCommand
    Builder_Control_WindowSize_GBOBJ = Text
    window modify Builder_Control_WindowSize_GBOBJ

    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    MacroCommand = "window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY" $MacroCommand
    
!w100_loop
    if (eof) goto !w100_done
    split:/@line/;5
    if  (left = 'PBOBJ') goto !w100_process
    if  (left = 'EFOBJ') goto !w100_process
    if  (left = 'STTXT') goto !w100_process
    if  (left = 'CBOBJ') goto !w100_process
    if  (left = 'GBOBJ') goto !w100_process
    if  (left = 'LBOBJ') goto !w100_process
    if  (left = 'RBOBJ') goto !w100_process
    if  (left = 'COOBJ') goto !w100_process
    if  (left = 'MLOBJ') goto !w100_process
    goto !w100_next

!w100_process
    scan:/@line/:/,/ ControlType = left
    scan:/@right/:/,/ ControlName = left
    scan:/@right/:/,/ Xpos = left
    scan:/@right/:/,/ Ypos = left
    scan:/@right/:/,/ ObjectCX = left
    scan:/@right/:/,/ ObjectCY = left
    Text = right   

    Xpos = Xpos + MinX
    Ypos = Ypos + MinY

    //message = 'creating @ControlName@ @Xpos@ @Ypos@ @ObjectCX@ @ObjectCY@ @ControlType@ @Text@' window message info ok
    window createcontrol Builder_Control_WIN @ControlName @Xpos @Ypos @ObjectCX @ObjectCY @ControlType @Text 

    file Controls error open Controls null
    Newline = '@ControlName@,@ControlType@,@Text@'
    i:/@Newline@/ 

    Builder_Control_ControlList_COOBJ = "@ControlName@"
    window insert end default Builder_Control_ControlList_COOBJ 

!w100_next
    file BuilderWindowFile
    f;1
    split:/@line/;3
    if  (left != '***') goto !w100_loop
!w100_done
    window windowpos Builder_Control_WindowSize_GBOBJ MinX MinY MaxX MaxY MaxX += MinX MaxY += MinY
    return

/*********************************************
//* Create a Directory List of Files
//*********************************************
!x100_dirlist
    call !x200_init
    call !x300_proc
    call !x400_wrap
    return

//*********************************************************
//* Initialization
//*********************************************************
!x200_init
    string  Newline        error
    string  Dirname        error
    string  Systemcmd      error
    string  Currentdir     error
    integer Splitsize      error
    float   Filecount = 0  error Filecount = 0
    float   Dircount = 0   error Dircount = 0
    string  Displaycount   error
    string  Printcount     error
    int     Lencount       error
    string  sFilecount     error
    string  sDircount      error

    //if (Dirname = null) goto !x200_init
    close Dirfile error
    open Dirfile null
    i:/@Dirname@/
    close DirFileList error
    open DirFileList null
    return

//*********************************************************
//* Process the directory
//*********************************************************
!x300_proc
    file Dirfile
    b
    if (eof) goto !x300_done
    Currentdir = line
    d
    Systemcmd = "dir @Currentdir@ >tempdir.dat"
    system:"@Systemcmd@"
    open tempdir tempdir.dat
    b
    fs:/<DIR>/
    scan:/@line/:/<DIR>/
    if (!found) goto !x300_proc
    scanr:/@line/:word
    Splitsize = lleft + 1
    b   
    fs:/../
    f;1
    copy;*
    b d;*
    b paste
    Dircount = Dircount + 1
    f;*
    b;1
    d;*
    b
!x300_loop
    if (eof)
+      close tempdir
+      goto !x300_proc
+   endif
    scan:/@line/:/<DIR>/
    if (!found) goto !x300_file
    split:/@line/;@Splitsize
    Newline = "@Currentdir@\@right@"
    file Dirfile
    f;*
    i:/@Newline@/
    file tempdir
    goto !x300_next
    
!x300_file
    split:/@line/;@Splitsize
    Newline = "@Currentdir@\@right@"
    file DirFileList
    i:/@Newline/
    Filecount  = Filecount + 1
    goto !x300_next

!x300_next
    file tempdir
    f;1
    goto !x300_loop
!x300_done
    return

//*********************************************************
//* Wrapup
//*********************************************************
!x400_wrap
    close Dirfile
    write DirFileList dirfilelist.dat

    Displaycount = Filecount
    call !x450_comma
    sFilecount = Printcount
    if (Printcount = 0) sFilecount = '0'

    Displaycount = Dircount
    call !x450_comma
    sDircount = Printcount
    if (Printcount = 0) sDircount = '0'
    
    return

//*********************************************************
//* Convert number to display with commas
//********************************************************* 
!x450_comma
    scan:/@Displaycount/:/./
    Displaycount = left
    Printcount = null
    
!x450_comma_loop
    Lencount = len(Displaycount)
    if  (Lencount < 4) 
+       Printcount = "@Displaycount@@Printcount@"
+       goto !x450_done
+   endif
    splitr:/@Displaycount/;3
    Printcount = /,@right@/
    Displaycount = left
    goto !x450_comma_loop
!x450_done
    return

//*********************************************
//* Generate the new system BEDITWIN bed code
//*********************************************
!y100_Generate
    GenSystemFilename = "@SystemName@.BED"
    call !y300_backup_code
    file WindowList
    b
    FirstWindowName = "@SystemName@_@line@_WIN"
    close GenCode error
    open GenCode null
    Newline = |//*********************************************************************| i:/@Newline/
    Newline = |//* Program   : @GenSystemFilename@| i:/@Newline/
    Newline = |//*             Generated by Forrest Bentley's @System@ @Version@| i:/@Newline/
    Newline = |//* Date      : @date@| i:/@Newline@/
    Newline = |//* Time      : @time@| i:/@Newline@/
    Newline = |//* Desc      : @SystemDesc@| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = || i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Storage Variables| i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    int     Xpos| i:/@Newline@/
    Newline = |    int     Ypos| i:/@Newline@/
    Newline = |    string  MouseOK| i:/@Newline@/
    Newline = |    string  Drag| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    string  BannerLine2 = '@SystemTitle@'| i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Special Actions                 | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    string WindowInit                                       = "call !a010_WindowInit"| i:/@Newline@/
    Newline = |    string WindowWrap                                       = "call !a010_WindowWrap"| i:/@Newline@/
    Newline = |    string WindowMouse                                      = "call !a010_WindowMouse"| i:/@Newline@/
    Newline = |    string WindowDown1                                      = "call !a010_WindowDown1"| i:/@Newline@/
    Newline = |    string WindowDown2                                      = "call !a010_WindowDown2"| i:/@Newline@/
    Newline = |    string WindowUp1                                        = "call !a010_WindowUp1"| i:/@Newline@/
    Newline = |    string WindowUp2                                        = "call !a010_WindowUp2"| i:/@Newline@/
    Newline = |    string WindowEscape                                     = "call !a010_Escape"| i:/@Newline@/
    Newline = |    string DefaultWindowProcess                             = "call !a010_Default_Window_Processing"| i:/@Newline@/
    Newline = | 
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Window Menu Actions             | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Window Button Actions           | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    //* Field Edits                     | i:/@Newline@/
    Newline = |    //***********************************| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* User Defined Global Variables| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!0001_User_Defined_Globals| i:/@Newline@/
    Newline = |    | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Main Processing| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!0005_Main_Processing| i:/@Newline@/
    Newline = |    open WindowFile @SystemName@.win| i:/@Newline@/
    Newline = |    open MenuFile @SystemName@.mnu| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    //*************************| i:/@Newline@/
    Newline = |    //* Main Window Loop      | i:/@Newline@/
    Newline = |    //*************************| i:/@Newline@/
    Newline = |    window start noclose| i:/@Newline@/
    Newline = |    exit| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Special Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |!a010_Escape| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Default Window Processing| i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_Default_Window_Processing| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Main Window Initialization Routine     | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowInit| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Main Window Wrapup Routine     | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowWrap| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 1 Down    | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowDown1| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'y'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 1 Up      | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowUp1| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'n'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 2 Down    | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowDown2| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'y'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Button 2 Up      | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowUp2| i:/@Newline@/
    Newline = |    if  (!MouseOK) return| i:/@Newline@/
    Newline = |    Drag = 'n'| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |//* Mouse Movement | i:/@Newline@/
    Newline = |//******************************************| i:/@Newline@/
    Newline = |!a010_WindowMouse| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |    window mousepos Xpos Ypos| i:/@Newline@/
    Newline = |    if  (!Drag) return| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Build Menu Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    b fs:/Window Menu Actions/
    f;1
    close ButtonProc error
    open ButtonProc null
    file WindowList
    b
    if  (eof)
+       message = "No windows to navigate to" window message error ok
+       //goto !y100_menu_nav_done
+       return
+   endif

    //**********************************
    //* Create Menu Navigation
    //**********************************
    call !y160_create_menunav

    file GenCode
    MenuCount = 0
    Newline = |    string @SystemName@_Main_Exit_MSOBJ|
    size Newline,60
    Newline = |@Newline@= "call !a090_@SystemName@_Main_Exit_MSOBJ"|
    i:/@Newline@/
    Newline = |    string @SystemName@_Main_About_MSOBJ|
    size Newline,60
    Newline = |@Newline@= "call !a095_@SystemName@_Main_About_MSOBJ"|
    i:/@Newline@/

    file ButtonProc
    i:|//****************************************|
    Newline = |//* Exit Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a090_@SystemName@_Main_Exit_MSOBJ| i:/@Newline@/
    Newline = |    message = 'Are you sure?'| i:/@Newline@/
    Newline = |    window message question yesno| i:/@Newline@/
    Newline = |    if  (message)| i:/@Newline@/
    Newline = |+       window stop| i:/@Newline@/
    Newline = |+   endif| i:/@Newline@/
    i:|    return|
    i:| |
    i:|//****************************************|
    Newline = |//* About Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a095_@SystemName@_Main_About_MSOBJ| i:/@Newline@/
    Newline = |    message = ^@SystemDesc@^| i:/@Newline@/
    Newline = |    window message info OK| i:/@Newline@/
    Newline = |    if  (message)| i:/@Newline@/
    Newline = |+       window close @FirstWindowName@| i:/@Newline@/
    Newline = |+   endif| i:/@Newline@/
    i:|    return|

    file MenuNav
    b
!y100_menu_nav_loop
    if (eof) goto !y100_menu_nav_done
    scan:/@line/:/,/
    MenuName = left
    WindowName = right
    MenuCount += 100
    MenuFunction = '!a@MenuCount@_@MenuName@'
    Newline = |    string @MenuName@|
    LenNewline = len(Newline)
    if (LenNewline < 59) size Newline,60
    file GenCode
    Newline = |@Newline@= "call !a@MenuCount@_@MenuName@"|
    i:/@Newline@/
    file ButtonProc
    if (MenuCount) i:| |
    i:|//****************************************|
    Newline = |//* @MenuName@ Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!a@MenuCount@_@MenuName@| i:/@Newline@/
    Newline = |    window pointer wait| i:/@Newline@/
    //Newline = |    window close @WindowName@_WIN error| i:/@Newline@/
    Newline = |    window open @WindowName@_WIN shade| i:/@Newline@/
    Newline = |    window center @WindowName@_WIN| i:/@Newline@/
    Newline = |    window clear @WindowName@_WIN| i:/@Newline@/
    Newline = |    window unshade @WindowName@_WIN| i:/@Newline@/
    Newline = |    window pointer arrow| i:/@Newline@/
    i:|    return|
    file MenuNav
    f;1
    goto !y100_menu_nav_loop
    
!y100_menu_nav_done
    file GenCode
 
    file ButtonProc
    b
    cut;*
    file GenCode
    f;*
    paste
    Newline = | | i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//* Build Window Button Actions| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/
    b fs:/Window Button Actions/
    f;1
    file WindowNav
    b
    ButtonCount = 0
!y100_button_nav_loop
    if (eof) goto !y100_nav_proc
    scan:/@line/:/,/
    ButtonName = left
    scan:/@right/:/,/
    WindowName = left
    NavAction = right
    ButtonCount += 100
    ButtonFunction = '!b@ButtonCount@_@ButtonName@'
    file GenCode
    Newline = |    string @ButtonName@|
    LenNewline = len(Newline)
    if (LenNewline < 59) size Newline,60
    Newline = |@Newline@= "call !b@ButtonCount@_@ButtonName@"|
    i:/@Newline@/
    file ButtonProc
    if (ButtonCount) i:| |
    i:|//****************************************|
    Newline = |//* @ButtonName@ Processing| i:/@Newline@/
    i:|//****************************************|
    Newline = |!b@ButtonCount@_@ButtonName@| i:/@Newline@/
    if  (NavAction = 'close')
+       Newline = |    window close @SystemName@_@WindowName@_WIN| i:/@Newline@/
+   endif
    if  (NavAction = 'open')
+       Newline = |    window pointer wait| i:/@Newline@/
+       //Newline = |    window close @SystemName@_@WindowName@_WIN error| i:/@Newline@/
+       Newline = |    window open @SystemName@_@WindowName@_WIN shade| i:/@Newline@/
+       Newline = |    window center @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window clear @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window unshade @SystemName@_@WindowName@_WIN| i:/@Newline@/
+       Newline = |    window pointer arrow| i:/@Newline@/
+   endif
    i:|    return|
    file WindowNav
    f;1
    goto !y100_button_nav_loop

!y100_nav_proc
    file ButtonProc
    b
    cut;*
    close ButtonProc
    file GenCode
    f;*
    paste
   
    //*************************************
    //* Add Entry Field Actions
    //*************************************
    b
    fs:/* Field Edits/
    f;1
    file Entryaction
    b
    do
        if (!eof)
+          scan:/@line/:/,/ //message = '[@line@]' window message info ok
+          ControlName = left
+          Newline = '    string @ControlName@'
+          size Newline,60
+          scan:/@right/:/,/
+          EntryFieldAction = left
+          EntryFieldSize = right
+          scan:/@EntryFieldAction/:/-/     //*** Remove Password if present
+          EntryFieldAction = left
+          Newline = '@Newline@= "call !z999_entryaction_return"'
+          file GenCode
+          i:/@Newline/
+          Newline = '    window action @ControlName@'
+          i:/@Newline/
+          Newline = '    window edit @ControlName@ @EntryFieldAction@ @EntryFieldSize@'
+          i:/@Newline/
+          i:/ /
+          file Entryaction
+       endif
        f;1
    until (eof)

    //*************************************
    //* Add Password Field CONCILE statements
    //*************************************
    file Entryaction
    b
    do-action
        if (!eof)
+          scan:/@line/:/,/
+          ControlName = left
+          scan:/@right/:/,/
+          scan:/@left/:/-/
+          if (found)
+             scan:/@ControlName@/:/_/
+             SearchString = ' @left@_'
+             scan:/@right/:/_/
+             SearchString = '@SearchString@@left@_WIN'
+             Newline = '    window conceal @ControlName@'
+             call !y150_conceal
+       endif
        file Entryaction
        f;1
    until-action (eof)

    file GenCode
    f;*
    i:| |
    i:|//****************************************|
    i:|//* Special return for Entry Field Actions|
    i:|//****************************************|
    Newline = |!z999_entryaction_return| i:/@Newline@/
    Newline = |    return| i:/@Newline@/
    Newline = | | i:/@Newline@/

    Newline = |//*********************************************************************| i:/@Newline@/
    Newline = |//*    End of Program @GenSystemFilename@| i:/@Newline@/
    Newline = |//*********************************************************************| i:/@Newline@/

    call !y500_bedit_code
    write GenCode @GenSystemFilename
    b
    f;*
    int CodeLines error
    CodeLines = pcount

    close GenCode

    call !y200_menu_file

    //window close Builder_Window_WIN
    //Newline = 'beditwin call @GenSystemFilename@' system:"@Newline@"
    return

//***********************************************
//* Add 'window conceal' logic
//***********************************************
!y150_conceal
    file GenCode
    b
    do
        if (!eof)
+          fs:/@SearchString@/
+          if (!eof)
+             b;1
+             i:/@Newline@/
+             f;1
+       endif
        f;1
    until (eof)
    return

//***********************************************
//* Create the MenuNav file
//***********************************************
!y160_create_menunav
    close MenuNav error
    open MenuNav null

    file BuilderWindowFile
    b
!y160_window_loop
    fs:/WINDOW,/
    if (eof) goto !y160_window_done
    scan:/@line/:/_/
    scan:/@right/:/_/
    WindowName = left
    file WindowNav
    b
    SearchString = '@WindowName@,open'
    fs:/@SearchString@/
    if (!eof)
+      goto !y160_window_next
+   endif
    MenuName = "@SystemName@_@WindowName@_MSOBJ"
    Newline = "@MenuName@,@SystemName@_@WindowName@"
    file MenuNav
    i:/@Newline@/

!y160_window_next
    file BuilderWindowFile
    f;1
    goto !y160_window_loop
       
!y160_window_done
    file MenuNav
    b
    return    

//***********************************************
//* Create the .MNU file
//***********************************************
!y200_menu_file
    close Menu error
    open Menu null
    i:/***********************************/
    i:/* M E N U/
    i:/***********************************/
    Newline = |TITLE,@SystemTitle@| i:/@Newline/
    Newline = |MENU,~Test| i:/@Newline/
    
    file MenuNav
    b
!y200_menu_loop
    if  (eof) goto !y200_menu_done
    Newline = "ITEM,@line@_WIN"
    file Menu
    i:/@Newline@/
    file MenuNav
    f;1
    goto !y200_menu_loop

!y200_menu_done
    file Menu
    Newline = |--------------------| i:/@Newline@/
    Newline = |ITEM,@SystemName@_Main_Exit_MSOBJ,E~xit| i:/@Newline@/
    i:/***********************************/
    i:/* M E N U/
    i:/***********************************/
    Newline = |MENU,~Help| i:/@Newline/
    Newline = |ITEM,@SystemName@_Main_About_MSOBJ,~About @SystemName@ System| i:/@Newline@/
    
    MenuFilename = "@SystemName@.MNU"
    write Menu @MenuFilename
    return

//*********************************************
//* Backup the original .bed file if it exists
//* to preserve manually entered code
//*********************************************
!y300_backup_code
    MacroCommand = "    if (!exists @SystemName@.bed) return" $MacroCommand
    MacroCommand = "open BackupBed @SystemName@.bed" $MacroCommand

    //***********************
    //* Remove old module code
    //***********************
    if (exists Bedit-code)
+      //system:"del Bedit-code\*.bed"
+   else
+      system:"md Bedit-code"
+   endif

    MacroCommand = "write BackupBed Bedit-code\@SystemName@.bed" $MacroCommand
    close BackupBed
    return

//*********************************************
//* Merge the modified code
//*********************************************
!y500_bedit_code
    string CodeFileName error
    string ModuleName   error

    if (CodeType = 'bedit')
+      close GenCode error
+      MacroCommand = 'open GenCode @SystemName@.bed' $MacroCommand
+   endif

    close CodeFile error
    //write ModuleNameFile modname.txt
    file ModuleNameFile error return
    clear
    b
    copy;*
    close ModuleNameFile2 error
    open ModuleNameFile2 null
    i:/TopOfFile/
    paste
    file ModuleNameFile
    b
    fs:/Global/
    if (eof)
+      b
+      ib:/Global/
+   endif
    b
    do-module
        //message = 'ModuleName[@line@]' window message info ok
        if (line = 'Global') and (CodeType != 'bedit') f;1
        ModuleName = line
        CodeFileName = "Bedit-code\@ModuleName@.bed"
        //message = 'opening[@CodeFileName@]' window message info ok
        open CodeFile @CodeFileName error message = 'bad' window message info ok goto !y500_bad_file
        call !y510_remove_old_code
        //write GenCode gencode.bed
        file GenCode
        if (CodeType = 'bedit') and (ModuleName = 'Global') 
+          //* Add Top blank Line
+          b
+          ib:/ /
+       endif
        //message = 'Adding Code[@ModuleName@][@line@]' window message info ok
        file CodeFile
        b
        //*************************
        //* Insert the new code into
        //* the generated code file
        //*************************
        do-code
            //message = 'inserting[@line@]' window message info ok
            Newline = line
            file GenCode
            i:/@Newline/
            file CodeFile
            f;1
        until-code (eof)
        i:/ /
        close CodeFile
        if (CodeType = 'bedit') and (ModuleName = 'Global')
+          //* Remove Top blank Line
+          file GenCode
+          b
+          d
+       endif
        //write GenCode gencode2.bed
        //message = 'Code Added[@ModuleName@]' window message info ok        
!y500_bad_file
        file ModuleNameFile
        f;1
    until-module (eof)

    close CodeFile error
    //*******************************
    //* Remove Second Blank Line
    //*******************************
    //write GenCode GenCode5.bed message = 'gencode5' window message info ok
    file GenCode
    b
    string CurrentLine error
    CurrentLine = line
    do
        f;1
        if (!eof)
+          if  (line = CurrentLine)
+              d;1
+              b;1
+       endif
        CurrentLine = line  
    until (eof)

    if (CodeType = 'bedit')
+      MacroCommand = 'write GenCode @SystemName@.bed' $MacroCommand
+      MacroCommand = 'write GenCode Bedit-code\@SystemName@.bed' $MacroCommand
+      close GenCode
+   endif

    return

//*********************************************
//* Remove the old B-Edit code from the generated file
//*********************************************
!y510_remove_old_code
    //message = 'y510 remove[@ModuleName@]' window message info ok
    string CopyCmts error
    string TopCmts  error

    file GenCode
    b
    clear

!y510_next_global
    //**************************
    //* Remove Global Variables
    //**************************
    if (eof)
+      return
+   endif
    if-1 (ModuleName = 'Global')
+      split:/@line/;1
+      if-2 (left = '!')
+         return
+      else-2
+         d
+         goto !y510_next_global
+   endif
    if-1 (ModuleName = 'Global')
+       f;1
+       goto !y510_next_global
+   endif

!y510_find_module_loop
    cols 1,1
    fs:/!/
    noco
    if  (eof)
+       call !y520_new_module_position
+       return
+   endif
    scan:/@line/:/@ModuleName/
    if (!found)
+      f;1
+      goto !y510_find_module_loop   
+   endif

    scan:/@ModuleName@/:/_/
    if (found)
+      ModulePrefix = left
+   endif
    if (ModulePrefix = '!a010') and (CodeType != 'bedit')
+      ModulePrefix = null
+   endif
    file GenCode

!y510_Builder_Control_Code_comments
    //********************************
    //* Find all header comments
    //********************************
    b;1
    scan:/@line/:word
    split:/@left/;2
    if (left = '//')
+      goto !y510_Builder_Control_Code_comments
+   endif

    f;1
    TopCmts = 'y'
!y510_Builder_Control_Code_loop
    pack line
    scan:/@line/:word
    split:/@left/;2
    CopyCmts = 'n'
    if (left = '//') and (!TopCmts)
+      CopyCmts = 'y'
+   endif
    if (line = null) and (!TopCmts)
+      CopyCmts = 'y'
+   endif
    //********************************
    //* Copy comments to be pasted back
    //* if they belong to the next module
    //********************************
    if (CopyCmts)
+      //message = 'Copy[@line@]' window message info ok
+      copy;1
+   else
+      split:/@line/;1
+      if (left != '!')
+         //message = 'Clear CopyCmts[@CopyCmts@]TopCmts[@TopCmts@][@line@]' window message info ok
+         clear
+   endif

    //********************************
    //* Clear the comments from the buffer 
    //* if new module has the same prefix
    //********************************
    split:/@line/;1
    if (left = '!')
+      scan:/@line/:/_/
+      if (left = ModulePrefix)
+         clear
+   endif
    split:/@line/;1
    if (left != '!')
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif  
    TopCmts = 'n'
    if (line = ModuleName)
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif  
    scan:/@line/:/_/
    if (left = ModulePrefix)
+      d;1
+      goto !y510_Builder_Control_Code_next
+   endif

    //message = 'Pasting[@line@]' window message info ok
    //********************************
    //* Replace the module comments
    //********************************
    file GenCode
    ib:/$*$FGB/
    paste
    //write GenCode GenCode4.bed
    //message = 'gencode4' window message info ok
    b
    cols 1,6
    fs:/$*$FGB/
    noco
    d;1
    b;1
    return

!y510_Builder_Control_Code_next
    if (!eof)
+      goto !y510_Builder_Control_Code_loop
+   endif
    //write GenCode GenCode3.bed
    //message = 'eof GenCode' 
    //window message info ok
    return

//*********************************************
//* Find the position for a new module
//*********************************************
!y520_new_module_position
    string CheckModuleName error
    file ModuleNameFile2
    b
    fs:/@ModuleName@/
    if (eof)
+      file GenCode
+      f;*
+      return
+   endif

!y520_new_module_position_down
    file ModuleNameFile2
    f;1
    if (eof) goto !y520_new_module_position_up
    CheckModuleName = line
    file GenCode
    b
!y520_new_module_position_down_module
    cols 1,1
    fs:/!/
    noco
    if (eof) goto !y520_new_module_position_down
    scan:/@line/:/@CheckModuleName@/
    if (!found)
+      f;1
+      goto !y520_new_module_position_down_module
+   endif
    goto !y520_new_module_found

!y520_new_module_position_up
    file ModuleNameFile2
    b;1
    scan:/@line/:/TopOfFile/
    if (found)
+      file GenCode
+      f;*
+      return
+   endif
    CheckModuleName = line
    file GenCode
    b
!y520_new_module_position_up_module
    cols 1,1
    fs:/!/
    noco
    if (eof)
+      goto !y520_new_module_position_up
+   endif
    scan:/@line/:/@CheckModuleName@/
    if (!found)
+      f;1
+      goto !y520_new_module_position_up_module
+   endif
    goto !y520_new_module_found

!y520_new_module_found
    do
        b;1
        split:/@line/;2
    until (left != '//')
    return

//*********************************************
//* Special return for entry fields with edits
//*********************************************
!z999_entry_action_return
    return

//*********************************************************************
//*    End of Program Builder.BED                                     *
//*********************************************************************
