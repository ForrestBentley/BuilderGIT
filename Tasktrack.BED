//*********************************************************************
//* Program   : Tasktrack.BED
//*             Generated by Forrest Bentley's GECA B-Edit Analysis System v1.2
//* Date      : 03/11/14
//* Time      : 09:49:09
//* Desc      : This system will manage personal and business tasks.
//*             When you complete a task you can enter comments, then later
//*             report on all completed tasks, which is very useful at the
//*             end of the year when you want to remember everything you've
//*             done during the year.
//*********************************************************************
//*                        Maintenance Log
//*
//* Date       Author            Desc
//* ---------- ----------------- --------------------------------------
//* 03/11/2014 Forrest Bentley   Created
//* 03/12/2014 Forrest Bentley   Added Task-Backup
//*                              Added TaskCompleteFile
//*                              Added Auto-open from Builder
//*                              Added Refresh using filters
//*                              Added Report CSV
//*                              Added Date/Time Entered
//*                              Added Task Status to Completed
//*                              Added Clear History
//* 03/13/2014 Forrest Bentley   Added Preferences
//*                              Added startup overdue message
//* 03/14/2014 Forrest Bentley   Added Plus/Minus Year, Month, Week, Day, Hour
//*                              Today radio shows today and prior
//* 03/17/2014 Forrest Bentley   Added Comments to Finished Tasks
//*                              Added BackupCount on Clear Button
//*                              Fixed Sleep timer to 10 min after msg, 30 mins after sleep button
//*                              Hilight first line in list if overdue
//*                              Added Calendar Selection
//* 03/18/2014 Forrest Bentley   Added Prev/Next buttons to Calendar
//*                              Added Leap Year Processing
//*                              Fixed opening Calendar when already open error
//*                              Changed Date/Time to non-entry
//* 03/22/2014 Forrest Bentley   When adding, check Personal if only Personal is checked on main window
//*                              Moved Calendar window to Taskdtls window
//*                              Box around Task Date on Calendar
//*                              Accelerator on Current Date on Calendar
//*                              Added Today/Tomorrow Buttons to Detail window
//*                              Added Contact
//* 03/24/2014 Forrest Bentley   Corrected Finish Task bug (not finishing task properly)
//* 03/26/2014 Forrest Bentley   Added Daily Task Add
//*                              Added Daily Double-Click, Change, Delete
//*                              Added AM/PM to Task Details
//*                              Fixed Daily radio button task date include CC in list
//* 03/29/2014 Forrest Bentley   Added Recurring (weekly, monthly, yearly) Entry
//*                              Added Recurring Weekly Warning
//* 03/30/2014 Forrest Bentley   Corrected Recurring Weekly Warnings
//* 04/17/2014 Forrest Bentley   Changed Sleep Count from 180 (30 mins) to 360 (60 mins)
//*                              Added good logic for recurring monthly and yearly tasks
//* 04/19/2014 Forrest Bentley   Added recurring monthly/yearly delete
//* 04/20/2014 Forrest Bentley   Added Change for Monthly and Yearly Recurring Tasks
//*                              Hide Main Task window when reminder message is shown
//* 04/24/2014 Forrest Bentley   Added Search
//* 06/18/2014 Forrest Bentley   Added code to hide the main window in the timer
//* 06/23/2014 Forrest Bentley   Turned off main window sizing in timer
//*                              Added View window - Yearly buttons working
//* 06/24/2014 Forrest Bentley   Added +,- to Yearly View
//* 06/25/2014 Forrest Bentley   Added Help button
//*                              Update Day View current line shows to the minute
//* 06/26/2014 Forrest Bentley   Added View Drag/Drop to change task due data
//* 06/27/2014 Forrest Bentley   Bubble Help on View
//* 06/30/2014 Forrest Bentley   Move Bubble Help as mouse moves
//* 07/01/2014 Forrest Bentley   Fixed size Bubble error if it doesn't exist
//* 07/02/2014 Forrest Bentley   Sort tasks by date/time before writing (s100_sort)
//* 12/18/2014 Forrest Bentley   Fixed Bubble abort by checking to see if Tasktrack_View_WIN is open before any bubble display
//* 01/09/2015 Forrest Bentley   Changed Priority entry to 2 characters rather than just 1 during entry
//*                              Increased SleepCount from 6 to 30 to delay reminders (5 mins)
//*
//*********************************************************************

    //***********************************
    //* Storage Variables
    //***********************************
 
    int     Xpos
    int     Ypos
    int     XposLast
    int     YposLast
    string  MouseOK
    string  Drag
    
    string  Ban1
    string  Ban2 = 'Task Tracker'
    string  Ban3
    string  BannerLine1 = Ban1
    string  BannerLine2 = Ban2
    string  BannerLine3 = Ban3
    //***********************************
    //* Special Actions                 
    //***********************************
    string WindowInit                                       = "call !a010_WindowInit"
    string WindowWrap                                       = "call !a010_WindowWrap"
    string WindowMouse                                      = "call !a010_WindowMouse"
    string WindowDown1                                      = "call !a010_WindowDown1"
    string WindowDown2                                      = "call !a010_WindowDown2"
    string WindowUp1                                        = "call !a010_WindowUp1"
    string WindowUp2                                        = "call !a010_WindowUp2"
    string WindowEscape                                     = "call !a010_Escape"
    string DefaultWindowProcess                             = "call !a010_Default_Window_Processing"
    string WindowTimer                                      = "call !a010_WindowTimer"
    //***********************************
    //* Window Menu Actions             
    //***********************************
    string Tasktrack_Main_Exit_MSOBJ                        = "call !a090_Tasktrack_Main_Exit_MSOBJ"
    string Tasktrack_Main_Banneron_MSOBJ                    = "call !a090_Tasktrack_Main_Banneron_MSOBJ"
    string Tasktrack_Main_Banneroff_MSOBJ                   = "call !a090_Tasktrack_Main_Banneroff_MSOBJ"
    string Tasktrack_Main_About_MSOBJ                       = "call !a095_Tasktrack_Main_About_MSOBJ"
    string Tasktrack_Tasks_MSOBJ                            = "call !a100_Tasktrack_Tasks_MSOBJ"
    
    //***********************************
    //* Window Button Actions           
    //***********************************
    string Tasktrack_Tasks_Exit_PBOBJ                       = "call !a090_Tasktrack_Main_Exit_MSOBJ"
    string Tasktrack_Tasks_Add_PBOBJ                        = "call !b300_Tasktrack_Tasks_Add_PBOBJ"
    string Tasktrack_Tasks_Change_PBOBJ                     = "call !b400_Tasktrack_Tasks_Change_PBOBJ"
    string Tasktrack_Tasks_Complete_PBOBJ                   = "call !b500_Tasktrack_Tasks_Complete_PBOBJ"
    string Tasktrack_Tasks_Refresh_PBOBJ                    = "call !b600_Tasktrack_Tasks_Refresh_PBOBJ"
    string Tasktrack_Tasks_Delete_PBOBJ                     = "call !b700_Tasktrack_Tasks_Delete_PBOBJ"
    string Tasktrack_Tasks_Report_PBOBJ                     = "call !b800_Tasktrack_Tasks_Report_PBOBJ"
    string Tasktrack_Tasks_Clear_PBOBJ                      = "call !b900_Tasktrack_Tasks_Clear_PBOBJ"
    string Tasktrack_Tasks_Sleep_PBOBJ                      = "call !b950_Tasktrack_Tasks_Sleep_PBOBJ"
    string Tasktrack_Tasks_Daily_PBOBJ                      = "call !b960_Tasktrack_Tasks_Daily_PBOBJ"
    string Tasktrack_Tasks_Search_PBOBJ                     = "call !b970_Tasktrack_Tasks_Search_PBOBJ"
    string Tasktrack_Tasks_Help_PBOBJ                       = "call !b975_Tasktrack_Tasks_Help_PBOBJ"
    string Tasktrack_Tasks_View_PBOBJ                       = "call !b980_Tasktrack_Tasks_View_PBOBJ"

    string Tasktrack_Tasks_Tasklist_LBOBJ                   = "call !b400_Tasktrack_Tasks_Change_PBOBJ"
    window action Tasktrack_Tasks_Tasklist_LBOBJ

    string Tasktrack_Taskdtls_Ok_PBOBJ                      = "call !b100_Tasktrack_Taskdtls_Ok_PBOBJ"
    string Tasktrack_Taskdtls_Cancel_PBOBJ                  = "call !b200_Tasktrack_Taskdtls_Cancel_PBOBJ"
    string Tasktrack_Taskdtls_Plus_PBOBJ                    = "call !b210_Tasktrack_Taskdtls_Plus_PBOBJ"
    string Tasktrack_Taskdtls_Minus_PBOBJ                   = "call !b220_Tasktrack_Taskdtls_Minus_PBOBJ"
    string Tasktrack_Taskdtls_Today_PBOBJ                   = "call !b230_Tasktrack_Taskdtls_Today_PBOBJ"
    string Tasktrack_Taskdtls_Tomorrow_PBOBJ                = "call !b240_Tasktrack_Taskdtls_Tomorrow_PBOBJ"
    string Tasktrack_Taskdtls_Am_PBOBJ                      = "call !b250_Tasktrack_Taskdtls_Am_PBOBJ"
    string Tasktrack_Taskdtls_Pm_PBOBJ                      = "call !b260_Tasktrack_Taskdtls_Pm_PBOBJ"

    string Tasktrack_Taskdtls_Priority_EFOBJ                = "call !z999_entryaction_return"
    window action Tasktrack_Taskdtls_Priority_EFOBJ
    window edit Tasktrack_Taskdtls_Priority_EFOBJ numeric 2

    string Tasktrack_Finish_Finish_PBOBJ                    = "call !d100_Tasktrack_Finish_Finish_PBOBJ"
    string Tasktrack_Finish_Cancel_PBOBJ                    = "call !d100_Tasktrack_Finish_Cancel_PBOBJ"

    string Tasktrack_Taskdtls_Prev_PBOBJ                    = "call !b290_Tasktrack_Taskdtls_Prev_PBOBJ"
    string Tasktrack_Taskdtls_Next_PBOBJ                    = "call !b295_Tasktrack_Taskdtls_Next_PBOBJ"

    string Tasktrack_Recurring_Close_PBOBJ                  = "call !b970_Tasktrack_Recurring_Close_PBOBJ"
    string Tasktrack_Recurring_Add_PBOBJ                    = "call !b970_Tasktrack_Recurring_Add_PBOBJ"
    string Tasktrack_Recurring_Change_PBOBJ                 = "call !b970_Tasktrack_Recurring_Change_PBOBJ"
    string Tasktrack_Recurring_Delete_PBOBJ                 = "call !b970_Tasktrack_Recurring_Delete_PBOBJ"
    string Tasktrack_Recurring_Tasklist_LBOBJ               = "call !b970_Tasktrack_Recurring_Tasklist_LBOBJ"
    window action Tasktrack_Recurring_Tasklist_LBOBJ


    string Tasktrack_View_Close_PBOBJ                       = "call !b980_Tasktrack_View_Close_PBOBJ"
    string Tasktrack_View_Plus_PBOBJ                        = "call !b980_Tasktrack_View_Plus_PBOBJ"
    string Tasktrack_View_Minus_PBOBJ                       = "call !b980_Tasktrack_View_Minus_PBOBJ"
    string Tasktrack_View_Year_PBOBJ                        = "call !b981_view_year"
    string Tasktrack_View_Month_PBOBJ                       = "call !b982_view_month"
    string Tasktrack_View_Day_PBOBJ                         = "call !b983_view_day"
    
    //***********************************
    //* Field Edits                     
    //***********************************
    
//*********************************************************************
//* User Defined Global Variables
//*********************************************************************
!0001_User_Defined_Globals
    string  Newline
    string  Oldline
    string  TaskPriority
    string  TaskEnteredDate
    string  TaskEnteredTime
    string  TaskDate
    string  TaskTime
    string  TaskDesc
    string  TaskContact
    string  TaskComments
    string  TaskAction
    string  TaskType
    string  FinishLine
    string  MM
    string  DD
    string  CCYY
    string  Today
    string  Hour
    string  Min
    string  Sec

    string  sWork
    float   fTaskDay
    float   fCurrDay

    int     iCCYY
    int     iMM
    int     iDD
    int     iHour
    int     iMin
    int     iSec

    string  BackupFilename 

    string  TaskStatus

    float   fCurrentDateTime
    string  sCurrentDateTime
    float   fTaskDateTime
    string  sTaskDateTime

    int     OverdueBusiness
    int     OverduePersonal
    string  Firsttime = 'y'

    int     SleepCount
    int     BackupCount
    string  HoldClearButton

    string  ButtonFocus
    string  ButtonFocusHold

    int     iLeapYear

    int     CurrentDay
    string  CurrentDayOfWeek
    string  CurrentMonth
    int     LastDay
    string  LastDayOfWeek
    string  LastMonth   
    int     TaskDay
    string  TaskDayOfWeek
    string  TaskMonth 

    string  SearchString   

    int     ViewButton
    string  ViewYear
    int     iViewYear
    string  ViewMonth
    int     iViewMonth
    string  ViewDay
    int     iViewDay
    string  ViewType

    int     iPriority

    string  TaskHoldLeft
    string  TaskHoldRight
    string  TaskChange

    int     ObjectX
    int     ObjectY
    int     ObjectCX
    int     ObjectCY

    string LastBubble
    string NewBubble
    string BubbleDesc

//*********************************************************************
//* Main Processing
//*********************************************************************
!0005_Main_Processing
    open WindowFile Tasktrack.win
    open MenuFile Tasktrack.mnu
 
    //*************************
    //* Main Window Loop      
    //*************************
    window start noclose
    exit
 
//*********************************************************************
//* Special Actions
//*********************************************************************
!a010_Escape
    return
 
//******************************************
//* Default Window Processing
//******************************************
!a010_Default_Window_Processing
    window hwnd Tasktrack_View_WIN status error goto !a010_Default_Window_Processing_2
    window getfocus ButtonFocus
    scan:/@ButtonFocus@/:/_/
    ViewButton = right
    if  (ViewButton < 1) goto !a010_Default_Window_Processing_2
    //message = ButtonFocus window message info ok
    file TaskTrackFile
    b
    ViewButton --
    if (ViewButton) f;@ViewButton
    split:/@line/;20
    scan:/@right/:/|/
    TaskDate = left
    scan:/@right/:/|/
    TaskTime = left
    scan:/@right/:/|/
    TaskType = left
    scan:/@right/:/|/
    TaskPriority = left
    scan:/@right/:/|/
    TaskDesc = left
    TaskContact = right

    if  (TaskType = 'D') or (TaskType = 'W') or (TaskType = 'M') or (TaskType = 'Y')
+       message = "@TaskDate@  @TaskTime@ @TaskDesc@"
+       //window message info ok
+       return
+   endif


    message = "@TaskDate@  @TaskTime@ @TaskDesc@"
    //window message info ok
    return

    Tasktrack_Tasks_Tasklist_LBOBJ = "@TaskDate@ @TaskTime@ @TaskType@ @TaskPriority@ *** @TaskDesc@ [@TaskContact@]"
    call !b400_Tasktrack_Tasks_Change_PBOBJ_2
    return

!a010_Default_Window_Processing_2
    window hwnd Tasktrack_Taskdtls_WIN status error return

    window getfocus ButtonFocus
    scan:/@ButtonFocus@/:/_/
    ButtonFocus = '0@right@'
    splitr:/@ButtonFocus@/;2
    CalDD = right
    //message = 'button @ButtonFocus@ pressed' window message info ok
    Tasktrack_Taskdtls_Date_EFOBJ = '@CalCCYY@/@CalMM@/@CalDD@'
    window modify Tasktrack_Taskdtls_Date_EFOBJ
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return
 
//******************************************
//* Main Window Initialization Routine     
//******************************************
!a010_WindowInit
    call !a100_Tasktrack_Tasks_MSOBJ
    return
 
//******************************************
//* Main Window Wrapup Routine     
//******************************************
!a010_WindowWrap
    return
 
//******************************************
//* Mouse Button 1 Down    
//******************************************
!a010_WindowDown1
    window deletecontrol Bubble error
    Drag = 'y'
    return
 
//******************************************
//* Mouse Button 1 Up      
//******************************************
!a010_WindowUp1
    int  LockPosX      error
    int  LockPoint     error
    int  LockMaxSize   error
    int  LockMaxCount  error
    int  LockSize      error
    int  LockCount     error

    //**************************************
    // Find the Button being dropped
    //**************************************
    Drag = 'n'
    //window getfocus @ButtonFocus
    scan:/@ButtonFocus/:/_/
    if  (left != "View") return
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY

    //**************************************
    // Find the right position to drop it
    //**************************************
    if  (ViewType = 'Year')
+       LockMaxCount = 12
+       LockSize = 80
+       LockMaxSize = 12 * 80
+       LockMaxSize += 73
+       LockMaxSize += 10
+       LockPosX = 73 + 80
+   endif
    if  (ViewType = 'Month')
+       LockSize = 29
+       LockMaxSize = LockMaxCount * 29
+       LockMaxSize += 120
+       LockMaxSize += 10
+       LockPosX = 120 + 29
+   endif
    if  (ViewType = 'Day')
+       LockMaxCount = 23
+       LockSize = 29
+       LockMaxSize = 23 * 29
+       LockMaxSize += 118
+       LockMaxSize += 10
+       LockPosX = 118 + 29
+   endif
    LockCount = 0
    do
        if-1  (LockPosX < ObjectX)
+           if-2  (LockPosX >= LockMaxSize) or (LockCount >= LockMaxCount)
+               LockPosX = LockMaxSize
+               LockCount = LockMaxCount
+           else-2
+               LockCount ++
+               LockPosX += LockSize
+       endif
    until (LockPosX >= LockMaxSize) or (LockCount >= LockMaxCount) or (LockPosX >= ObjectX)

    if  (LockCount > 0) and (LockCount < LockMaxCount)
+       LockPosX -= LockSize
+   endif
    if  (LockCount = 0) LockCount = 1

    if  (LockCount = LockMaxCount)
+       LockPosX = LockMaxSize - 10
+   endif

    //message = "LockCount[@LockCount@]" window message info ok

    window size @ButtonFocus @LockPosX @ObjectY @ObjectCX @ObjectCY
    //**************************************
    //* Update the Task data with the new
    //* position data
    //**************************************
    scan:/@ButtonFocus@/:/_/
    ViewButton = right
    if  (ViewButton < 1) return
    file TaskTrackFile
    b
    ViewButton --
    if (ViewButton) f;@ViewButton
    //********************
    //* Update Task Month
    //********************
    if (ViewType = 'Year')
+      split:/@line/;25
+      TaskHoldLeft = left
+      split:/@right/;2
+      TaskHoldRight = right
+      TaskChange = '0@LockCount@' 
+      splitr:/@TaskChange@/;2 
+      TaskChange = right      
+      Newline = '@TaskHoldLeft@@TaskChange@@TaskHoldRight@'
+      call !a010_verify_day
+      d
+      f;*
+      i:/@Newline@/
+      ButtonFocusHold = 'View_@lineno@'
+      call !s100_sort
+      write TaskTrackFile TaskTrack.dat
+      call !b981_view_year
+      ButtonFocus = ButtonFocusHold
+      return
+   endif
    //********************
    //* Update Task Day
    //********************
    if (ViewType = 'Month')
+      split:/@line/;28
+      TaskHoldLeft = left
+      split:/@right/;2
+      TaskHoldRight = right
+      TaskChange = '0@LockCount@' 
+      splitr:/@TaskChange@/;2 
+      TaskChange = right      
+      Newline = '@TaskHoldLeft@@TaskChange@@TaskHoldRight@'
+      d
+      f;*
+      i:/@Newline@/
+      ButtonFocusHold = 'View_@lineno@'
+      call !s100_sort
+      write TaskTrackFile TaskTrack.dat
+      call !b982_view_month
+      ButtonFocus = ButtonFocusHold
+      return
+   endif
    //********************
    //* Update Task Hour
    //********************
    if (ViewType = 'Day')
+      split:/@line/;31
+      TaskHoldLeft = left
+      split:/@right/;2
+      TaskHoldRight = right
+      TaskChange = '0@LockCount@' 
+      splitr:/@TaskChange@/;2 
+      TaskChange = right      
+      Newline = '@TaskHoldLeft@@TaskChange@@TaskHoldRight@'
+      d
+      f;*
+      i:/@Newline@/
+      ButtonFocusHold = 'View_@lineno@'
+      call !s100_sort
+      write TaskTrackFile TaskTrack.dat
+      call !b983_view_day
+      ButtonFocus = ButtonFocusHold
+      return
+   endif
    return

//******************************************
//* Verify the day of the month if draging for year    
//******************************************
!a010_verify_day
    int    iCheckMM error
    int    iCheckDD error
    string NewDD    error

    split:/@Newline/;25
    split:/@right/;2
    iCheckMM = left
    split:/@right/;1
    split:/@right/;2
    iCheckDD = left
    if  (iCheckMM = 4) or (iCheckMM = 6) or (iCheckMM = 9) or (iCheckMM = 11)
+       if  (iCheckDD > 30)
+           iCheckDD = 30
+   endif
    if  (iCheckMM = 2)
+       if  (iCheckDD > 28)
+           iCheckDD = 28
+   endif
    
    split:/@Newline/;28
    TaskHoldLeft = left
    split:/@right/;2
    TaskHoldRight = right

    NewDD = '0@iCheckDD@'
    splitr:/@NewDD@/;2
    NewDD = right
    
    Newline = '@TaskHoldLeft@@NewDD@@TaskHoldRight@'
    return
 
//******************************************
//* Mouse Button 2 Down    
//******************************************
!a010_WindowDown2
    Drag = 'y'
    return
 
//******************************************
//* Mouse Button 2 Up      
//******************************************
!a010_WindowUp2
    Drag = 'n'
    return
 
//******************************************
//* Mouse Movement 
//******************************************
!a010_WindowMouse
    if  (!Drag) 
+       call !a010_bubble
+       return
+   endif
    window mousepos Xpos Ypos

    //**************************************
    //* Shift the new position away from the 
    //* mouse pointer so dropping is possible
    //**************************************
    Xpos ++
    Ypos ++

    window getfocus @ButtonFocus
    scan:/@ButtonFocus/:/_/
    if  (left != "View") return
    window windowpos @ButtonFocus ObjectX ObjectY ObjectCX ObjectCY
    window size @ButtonFocus @Xpos @Ypos @ObjectCX @ObjectCY
    return

//******************************************
//* Show Bubble Tasks
//******************************************
!a010_bubble
    window hwnd Tasktrack_View_WIN status error return
    window mousepos Xpos Ypos
    if (Xpos = XposLast) and (Ypos = YposLast)
+      return
+   endif
    XposLast = Xpos
    YposLast = Ypos

    file BubbleTasks error return
    b
    do
        if-1 (!eof)
+           scan:/@line/:/|/
+           ObjectX = left
+           scan:/@right/:/|/
+           ObjectCX = left
+           scan:/@right/:/|/
+           ObjectY = left
+           scan:/@right/:/|/
+           ObjectCY = left
+           if-2  (Xpos >= ObjectX) and (Xpos <= ObjectCX) and (Ypos >= ObjectY) and (Ypos <= ObjectCY)
+               scan:/@right/:/|/
+               TaskDate = left       
+               scan:/@right/:/|/
+               TaskTime = left
+               scan:/@right/:/|/
+               TaskType = left
+               TaskDesc = right
+               //Xpos += 20
+               //Ypos += 10
+               NewBubble = "@ObjectX@@ObjectY@"
+               if-3  (NewBubble != LastBubble)
+                   window deletecontrol Bubble error
+                   BubbleDesc = "@TaskDate@ @TaskTime@ @TaskDesc@"
+                   size BubbleDesc,99
+                   window createcontrol Tasktrack_View_WIN Bubble @Xpos @Ypos 300 50 STTXT1 @BubbleDesc
+                   LastBubble = NewBubble
+                   return
+               else-3
+                   window size Bubble @Xpos @Ypos 300 50 error
+                   window paint Bubble error
+                   return
+       endif
        f;1
    until (eof)
    window deletecontrol Bubble error
    LastBubble = null
    return

//******************************************
//* Window Timer
//******************************************
!a010_WindowTimer
    //window hide MAIN
    goto !a010_WindowTimer_Sleep

    window size MainWindow 5000 5000 0 0

    window hwnd Tasktrack_Taskdtls_WIN status error goto !a010_Window_Timer1
    window setfocus Tasktrack_Taskdtls_WIN
    goto !a010_WindowTimer_Sleep 

!a010_Window_Timer1
    window hwnd Tasktrack_Finish_WIN status error goto !a010_Window_Timer2
    window setfocus Tasktrack_Finish_WIN
    goto !a010_WindowTimer_Sleep
 
!a010_Window_Timer2
    window hwnd Tasktrack_Recurring_WIN status error goto !a010_Window_Timer2
    window setfocus Tasktrack_Recurring_WIN
    goto !a010_WindowTimer_Sleep

    window setfocus TaskTrack_Tasks_WIN
 
!a010_WindowTimer_Sleep
    if  (SleepCount > 0)
+       SleepCount --
+       return
+   endif
    Firsttime = 'y'
    call !c100_refresh_list
    return
 
//*********************************************************************
//* Build Menu Actions
//*********************************************************************
//****************************************
//* Exit Processing
//****************************************
!a090_Tasktrack_Main_Exit_MSOBJ

    //****************************************
    //* Save the Prefs and Exit
    //****************************************
    window obtain Tasktrack_Tasks_WIN
    open TaskPrefFile null
    i:/@Tasktrack_Tasks_Business_CBOBJ@/
    i:/@Tasktrack_Tasks_Personal_CBOBJ@/
    i:/@Tasktrack_Tasks_Today_RBOBJ@/
    i:/@Tasktrack_Tasks_Overdue_RBOBJ@/
    i:/@Tasktrack_Tasks_Future_RBOBJ@/
    i:/@Tasktrack_Tasks_All_RBOBJ@/
    write TaskPrefFile TaskPref.dat
    close TaskPrefFile
    window stop
    return
 
//****************************************
//* Banner On
//****************************************
!a090_Tasktrack_Main_Banneron_MSOBJ
    BannerLine1 = Ban1
    BannerLine2 = Ban2
    BannerLine3 = Ban3
    window paint MainWindow
    return
 
//****************************************
//* Banner Off
//****************************************
!a090_Tasktrack_Main_Banneroff_MSOBJ
    BannerLine1 = null
    BannerLine2 = null
    BannerLine3 = null
    window paint MainWindow
    return
 
//****************************************
//* About Processing
//****************************************
!a095_Tasktrack_Main_About_MSOBJ
    message = ^The Task Tracker system will keep track of daily tasks, and report on completed tasks.^
    window message info OK
    return
 
//****************************************
//* Tasktrack_Tasks_MSOBJ Processing
//****************************************
!a100_Tasktrack_Tasks_MSOBJ
    window pointer wait
    window hwnd Tasktrack_Tasks_WIN status error window open Tasktrack_Tasks_WIN shade
    window centerdesktop Tasktrack_Tasks_WIN

    window clear Tasktrack_Tasks_WIN
    open TaskTrackFile TaskTrack.dat error open TaskTrackFile null
    open TaskCompleteFile TaskComplete.dat error open TaskCompleteFile null

    //****************************************
    //* Backup the Data Files
    //****************************************
    system:"md Task-Backup"
    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'

    scan:/@time@/:/:/
    Hour = left
    scan:/@right/:/:/
    Min = left
    Sec = right
    
    BackupFilename = 'Task-Backup\TaskTrack-@CCYY@@MM@@DD@-@Hour@@Min@@Sec@.dat'
    write TaskTrackFile @BackupFilename
    BackupFilename = 'Task-Backup\TaskComplete-@CCYY@@MM@@DD@-@Hour@@Min@@Sec@.dat'
    write TaskCompleteFile @BackupFilename

    //****************************************
    //* Setup the Window with Preferences
    //****************************************
    open TaskPrefFile TaskPref.dat error open TaskPrefFile null i:/Y/ i:/Y/ i:/N/ i:/N/ i:/N/ i:/Y/
    b Tasktrack_Tasks_Business_CBOBJ = line
    f;1 Tasktrack_Tasks_Personal_CBOBJ = line
    f;1 Tasktrack_Tasks_Today_RBOBJ = line
    f;1 Tasktrack_Tasks_Overdue_RBOBJ = line
    f;1 Tasktrack_Tasks_Future_RBOBJ = line
    f;1 Tasktrack_Tasks_All_RBOBJ = line
    close TaskPrefFile

    window modify Tasktrack_Tasks_Business_CBOBJ
    window modify Tasktrack_Tasks_Personal_CBOBJ
    window modify Tasktrack_Tasks_Today_RBOBJ
    window modify Tasktrack_Tasks_Overdue_RBOBJ
    window modify Tasktrack_Tasks_Future_RBOBJ
    window modify Tasktrack_Tasks_All_RBOBJ

    window disable Tasktrack_Tasks_Sleep_PBOBJ

    //window hide MAIN
    window size MainWindow 5000 5000 0 0

    call !c100_refresh_list

    window unshade Tasktrack_Tasks_WIN
    window pointer arrow
    window timer on 10

    open Taskbackup null
    systemcurr:"dir task-backup"
    b
    fs:/.dat/;*
    BackupCount = pcount / 2
    HoldClearButton = Tasktrack_Tasks_Clear_PBOBJ
    if  (BackupCount = 1)
+       Tasktrack_Tasks_Clear_PBOBJ = '&Clear @BackupCount@ Backup'
+   else
+       Tasktrack_Tasks_Clear_PBOBJ = '&Clear @BackupCount@ Backups'
+   endif
    window modify Tasktrack_Tasks_Clear_PBOBJ
    close Taskbackup
    Tasktrack_Tasks_Clear_PBOBJ = HoldClearButton

    //window disable Tasktrack_Taskdtls_Date_EFOBJ

    return
 
//*********************************************************************
//* Build Window Button Actions
//*********************************************************************
 
//****************************************
//* Tasktrack_Taskdtls_Ok_PBOBJ Processing
//****************************************
!b100_Tasktrack_Taskdtls_Ok_PBOBJ
    window obtain Tasktrack_Taskdtls_WIN
    crush Tasktrack_Taskdtls_Priority_EFOBJ
    if  (Tasktrack_Taskdtls_Priority_EFOBJ = null)
+       message = 'Please enter a Priority' window message error ok
+       window setfocus Tasktrack_Taskdtls_Priority_EFOBJ
+       return
+   endif
    iPriority = Tasktrack_Taskdtls_Priority_EFOBJ
    if  (iPriority < 1) or (iPriority > 9)
+       message = 'Priority must be 1-9' window message error ok
+       window setfocus Tasktrack_Taskdtls_Priority_EFOBJ
+       return
+   endif
+   endif
    crush Tasktrack_Taskdtls_Date_EFOBJ
    if  (Tasktrack_Taskdtls_Date_EFOBJ = null)
+       message = 'Please enter a Date' window message error ok
+       window setfocus Tasktrack_Taskdtls_Date_EFOBJ
+       return
+   endif
    crush Tasktrack_Taskdtls_Time_EFOBJ
    if  (Tasktrack_Taskdtls_Time_EFOBJ = null)
+       message = 'Please enter a Time' window message error ok
+       window setfocus Tasktrack_Taskdtls_Time_EFOBJ
+       return
+   endif

    if  (Tasktrack_Taskdtls_Business_RBOBJ)
+       TaskType = 'B'
+   else
+       TaskType = 'P'
+   endif
    if  (Tasktrack_Taskdtls_Desc_EFOBJ = null)
+       message = 'Please enter a Description' window message error ok
+       window setfocus Tasktrack_Taskdtls_Desc_EFOBJ
+       return
+   endif
    //***********************************
    //* Replace , with ; 
    //*         | with /
    //*         [ with (
    //*         ] with )
    //***********************************
    do
        scan:/@Tasktrack_Taskdtls_Desc_EFOBJ@/:/,/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@;@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Desc_EFOBJ@/:/|/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@/@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Desc_EFOBJ@/:/[/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@(@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Desc_EFOBJ@/:/]/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@)@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Contact_EFOBJ@/:/,/
        if (found) Tasktrack_Taskdtls_Contact_EFOBJ = '@left@;@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Contact_EFOBJ@/:/|/
        if (found) Tasktrack_Taskdtls_Contact_EFOBJ = '@left@/@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Contact_EFOBJ@/:/[/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@(@right@'
    until (!found)
    do
        scan:/@Tasktrack_Taskdtls_Contact_EFOBJ@/:/]/
        if (found) Tasktrack_Taskdtls_Desc_EFOBJ = '@left@)@right@'
    until (!found)

    Newline = '@TaskEnteredDate@|@TaskEnteredTime@|@Tasktrack_Taskdtls_Date_EFOBJ@|@Tasktrack_Taskdtls_Time_EFOBJ@|@TaskType@|@Tasktrack_Taskdtls_Priority_EFOBJ@|@Tasktrack_Taskdtls_Desc_EFOBJ@|@Tasktrack_Taskdtls_Contact_EFOBJ@'
    file TaskTrackFile
    if  (TaskAction = 'Add')
+       f;*
+       i:/@Newline@/
+       call !s100_sort
+       write TaskTrackFile TaskTrack.dat
+       call !c100_refresh_list
+   endif
    if  (TaskAction = 'Change')
+       b
+       fs:/@Oldline@/
+       if (!eof)
+          r:/@Newline@/
+          call !s100_sort
+          write TaskTrackFile TaskTrack.dat
+          call !c100_refresh_list
+   endif
    call !b275_delete_day_buttons
    window close Tasktrack_Taskdtls_WIN
    return
 
//****************************************
//* Tasktrack_Taskdtls_Cancel_PBOBJ Processing
//****************************************
!b200_Tasktrack_Taskdtls_Cancel_PBOBJ
    call !b275_delete_day_buttons
    window close Tasktrack_Taskdtls_WIN
    return

//****************************************
//* Add to Date/Time
//****************************************
!b210_Tasktrack_Taskdtls_Plus_PBOBJ
    window obtain Tasktrack_Taskdtls_WIN
    call !b250_get_datetime  
    if  (Tasktrack_Taskdtls_Year_RBOBJ) iCCYY ++
    if  (Tasktrack_Taskdtls_Month_RBOBJ)
+       iMM ++
+       if  (iMM > 12)
+           iMM = 1
+           iCCYY ++
+   endif
    if  (iCCYY > 2040) iCCYY = 2040 iMM = 12
    if  (Tasktrack_Taskdtls_Day_RBOBJ)
+       iDD ++
+       call !b230_day_change
+   endif
    if  (Tasktrack_Taskdtls_Week_RBOBJ)
+       int iWeekCount error
+       iWeekCount = 7
+       do
+           iDD ++
+           call !b230_day_change
+           iWeekCount --
+       until (iWeekCount = 0)
+   endif

    if  (Tasktrack_Taskdtls_Hour_RBOBJ)
+       iHour ++
+       if  (iHour > 23)
+           iHour = 1
+           iDD ++
+           call !b230_day_change
+   endif

    call !b260_set_datetime
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return

//****************************************
//* Subtract from Date/Time
//****************************************
!b220_Tasktrack_Taskdtls_Minus_PBOBJ
    window obtain Tasktrack_Taskdtls_WIN
    call !b250_get_datetime  
    if  (Tasktrack_Taskdtls_Year_RBOBJ) iCCYY --
    if  (Tasktrack_Taskdtls_Month_RBOBJ)
+       iMM --
+       if  (iMM < 1)
+           iMM = 12
+           iCCYY --
+   endif
    if  (iCCYY < 2014) iCCYY = 2014 iMM = 1
    if  (Tasktrack_Taskdtls_Day_RBOBJ)
+       iDD --
+       call !b230_day_change
+   endif
    if  (Tasktrack_Taskdtls_Week_RBOBJ)
+       int iWeekCount error
+       iWeekCount = 7
+       do
+           iDD --
+           call !b230_day_change
+           iWeekCount --
+       until (iWeekCount = 0)
+   endif

    if  (Tasktrack_Taskdtls_Hour_RBOBJ)
+       iHour --
+       if  (iHour < 1)
+           iHour = 23
+           iDD --
+           call !b230_day_change
+   endif

    call !b260_set_datetime
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return

//****************************************
//* Change the Date to Today
//****************************************
!b230_Tasktrack_Taskdtls_Today_PBOBJ
    string sCurrCCYY error
    string sCurrMM   error
    string sCurrDD   error
    scan:/@date/:'/'
    sCurrMM = left
    scan:/@right/:'/'
    sCurrDD = left
    sCurrCCYY = '20@right@'
    Tasktrack_Taskdtls_Date_EFOBJ = '@sCurrCCYY@/@sCurrMM@/@sCurrDD@'
    window modify Tasktrack_Taskdtls_Date_EFOBJ
    call !b210_Tasktrack_Taskdtls_Plus_PBOBJ
    call !b220_Tasktrack_Taskdtls_Minus_PBOBJ
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return

//****************************************
//* Change the Date to Tomorrow
//****************************************
!b240_Tasktrack_Taskdtls_Tomorrow_PBOBJ
    string sCurrCCYY error
    string sCurrMM   error
    string sCurrDD   error
    scan:/@date/:'/'
    sCurrMM = left
    scan:/@right/:'/'
    sCurrDD = left
    sCurrCCYY = '20@right@'
    Tasktrack_Taskdtls_Date_EFOBJ = '@sCurrCCYY@/@sCurrMM@/@sCurrDD@'
    window modify Tasktrack_Taskdtls_Date_EFOBJ

    Tasktrack_Taskdtls_Year_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Year_RBOBJ
    Tasktrack_Taskdtls_Month_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Month_RBOBJ
    Tasktrack_Taskdtls_Day_RBOBJ = 'Y'
    window modify Tasktrack_Taskdtls_Day_RBOBJ
    Tasktrack_Taskdtls_Week_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Week_RBOBJ
    Tasktrack_Taskdtls_Hour_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Hour_RBOBJ
    call !b210_Tasktrack_Taskdtls_Plus_PBOBJ
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return

//****************************************
//* Change time to 7AM
//****************************************
!b250_Tasktrack_Taskdtls_Am_PBOBJ
    Tasktrack_Taskdtls_Time_EFOBJ = "07:00:00"
    window modify Tasktrack_Taskdtls_Time_EFOBJ
    return

//****************************************
//* Change time to 4PM
//****************************************
!b260_Tasktrack_Taskdtls_Pm_PBOBJ
    Tasktrack_Taskdtls_Time_EFOBJ = "16:00:00"
    window modify Tasktrack_Taskdtls_Time_EFOBJ
    return

//****************************************
//* Change the Day
//****************************************
!b230_day_change
    if  (iDD < 1) goto !b230_minus_month

    if (iDD > 31)
+      goto !b230_plus_month
+   endif
    if (iDD > 30)
+      if  (iMM = 2) or (iMM = 4) or (iMM = 6) or (iMM = 9) or (iMM = 11)
+          goto !b230_plus_month
+   endif   
    if (iCCYY = 2016) or (iCCYY = 2020) or (iCCYY = 2024) or (iCCYY = 2028) or (iCCYY = 2032) or (iCCYY = 2036) or (iCCYY = 2040)
+      iLeapYear = 1
+   else
+      iLeapYear = 0
+   endif
    if  (iDD > 28) and (iMM = 2) and (!iLeapYear)
+       goto !b230_plus_month
+   endif 
    if  (iDD > 29) and (iMM = 2) and (iLeapYear)
+       goto !b230_plus_month
+   endif 
    return

!b230_plus_month
    iDD = 1
    iMM ++
    if  (iMM > 12)
+       iMM = 1
+       iCCYY ++
+   endif
    return

!b230_minus_month
    iMM --
    if  (iMM < 1)
+       iMM = 12
+       iCCYY --
+   endif
    iDD = 28
    if  (iMM = 1) or (iMM = 3) or (iMM = 5) or (iMM = 7) or (iMM = 8) or (iMM = 10) or (iMM = 12) iDD = 31
    if  (iMM = 4) or (iMM = 6) or (iMM = 9) or (iMM = 11) iDD = 30
    if  (iDD = 28) and (iLeapYear) iDD = 29
    return

//****************************************
//* Get Date/Time from window
//****************************************
!b250_get_datetime
    //************************
    //* Get Date
    //************************
    split:/@Tasktrack_Taskdtls_Date_EFOBJ/;4
    iCCYY = left
    split:/@right/;1
    split:/@right/;2
    iMM = left
    split:/@right/;1
    iDD = right
    //************************
    //* Get Time
    //************************
    split:/@Tasktrack_Taskdtls_Time_EFOBJ/;2
    iHour = left
    split:/@right/;1
    split:/@right/;2
    iMin = left
    split:/@right/;1
    iSec = right 

    if (iCCYY = 2016) or (iCCYY = 2020) or (iCCYY = 2024) or (iCCYY = 2028) or (iCCYY = 2032) or (iCCYY = 2036) or (iCCYY = 2040)
+      iLeapYear = 1
+   else
+      iLeapYear = 0
+   endif

    return

//****************************************
//* Set Date/Time on the window
//****************************************
!b260_set_datetime
    //************************
    //* Set Date
    //************************
    CCYY = iCCYY
    MM = iMM MM = '0@MM@' splitr:/@MM@/;2 MM = right
    DD = iDD DD = '0@DD@' splitr:/@DD@/;2 DD = right
    Tasktrack_Taskdtls_Date_EFOBJ = '@CCYY@/@MM@/@DD@'
    window modify Tasktrack_Taskdtls_Date_EFOBJ

    //************************
    //* Prepare Time
    //************************
    Hour = iHour Hour = '0@Hour@' splitr:/@Hour@/;2 Hour = right
    Min = iMin Min = '0@Min@' splitr:/@Min@/;2 Min = right
    Sec = '00'
    Tasktrack_Taskdtls_Time_EFOBJ = '@Hour@:@Min@:@Sec@'
    window modify Tasktrack_Taskdtls_Time_EFOBJ
    return

//****************************************
//* Display the Calendar
//****************************************
!b270_Tasktrack_Taskdtls_Calendar_PBOBJ
    string  DayField      error
    int     DayCount      error
    string  MacroCommand  error
    int     DayPosX       error
    int     DayPosY       error
    int     DayPosCount   error
    int     DaysInMonth   error
    string  CalendarTitle error
    float   TotalDays     error
    int     DayOffset     error
    string  CalCCYY       error
    string  CalMM         error
    string  CalDD         error
    int     iYearWork     error
   
    call !b275_delete_day_buttons

    window obtain Tasktrack_Taskdtls_Date_EFOBJ
    split:/@Tasktrack_Taskdtls_Date_EFOBJ@/;4
    CCYY = left
    split:/@right/;1
    split:/@right/;2
    iMM = left

    iCCYY = CCYY

!b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    call !b275_delete_day_buttons
    if  (iCCYY > 2014)
+       iYearWork = iCCYY - 2014
+       TotalDays = iYearWork * 365
+   endif

    if (iCCYY < 2014) iCCYY = 2014 iMM = 1
    if (iCCYY > 2040) iCCYY = 2040 iMM = 12
    if (iCCYY = 2016) or (iCCYY = 2020) or (iCCYY = 2024) or (iCCYY = 2028) or (iCCYY = 2032) or (iCCYY = 2036) or (iCCYY = 2040)
+      iLeapYear = 1
+   else
+      iLeapYear = 0
+   endif
    if  (iCCYY > 2016) TotalDays ++
    if  (iCCYY > 2020) TotalDays ++
    if  (iCCYY > 2024) TotalDays ++
    if  (iCCYY > 2028) TotalDays ++
    if  (iCCYY > 2032) TotalDays ++
    if  (iCCYY > 2036) TotalDays ++
    if  (iCCYY > 2040) TotalDays ++

    CCYY = iCCYY
    CalCCYY = CCYY

    CalMM = '0@iMM@'
    splitr:/@CalMM@/;2
    CalMM = right
    
    if  (iMM > 1) TotalDays = TotalDays + 31
    if  (iMM > 2) 
+       TotalDays = TotalDays + 28
+       if  (iLeapYear)
+           TotalDays ++
+   endif
    if  (iMM > 3) TotalDays = TotalDays + 31
    if  (iMM > 4) TotalDays = TotalDays + 30
    if  (iMM > 5) TotalDays = TotalDays + 31
    if  (iMM > 6) TotalDays = TotalDays + 30
    if  (iMM > 7) TotalDays = TotalDays + 31
    if  (iMM > 8) TotalDays = TotalDays + 31
    if  (iMM > 9) TotalDays = TotalDays + 30
    if  (iMM > 10) TotalDays = TotalDays + 31
    if  (iMM > 11) TotalDays = TotalDays + 30

    do
        if  (TotalDays > 7) TotalDays = TotalDays - 7
    until (TotalDays <= 7)
    DayOffset = 4
    if-1  (TotalDays > 0)
+       call !b273_calc_shift
+   endif

    DaysInMonth = 31
    if  (iMM = 1) CalendarTitle = "January - @CCYY@"
    if  (iMM = 2) CalendarTitle = "February - @CCYY@"
    if  (iMM = 3) CalendarTitle = "March - @CCYY@"
    if  (iMM = 4) CalendarTitle = "April - @CCYY@"
    if  (iMM = 5) CalendarTitle = "May - @CCYY@"
    if  (iMM = 6) CalendarTitle = "June - @CCYY@"
    if  (iMM = 7) CalendarTitle = "July - @CCYY@"
    if  (iMM = 8) CalendarTitle = "August - @CCYY@"
    if  (iMM = 9) CalendarTitle = "September - @CCYY@"
    if  (iMM = 10) CalendarTitle = "October - @CCYY@"
    if  (iMM = 11) CalendarTitle = "November - @CCYY@"
    if  (iMM = 12) CalendarTitle = "December - @CCYY@"
    Tasktrack_Taskdtls_Month_GBOBJ = CalendarTitle
    window modify Tasktrack_Taskdtls_Month_GBOBJ 

    if  (iMM = 2) or (iMM = 4) or (iMM = 6) or (iMM = 9) or (iMM = 11)
+          DaysInMonth = 30
+   endif   
    if  (iMM = 2)
+       DaysInMonth = 28
+       if (iLeapYear) 
+          DaysInMonth ++
+   endif 
    
    int MonthX   error
    int MonthY   error
    int MonthCX  error
    int MonthCY  error
    window windowpos Tasktrack_Taskdtls_Month_GBOBJ MonthX MonthY MonthCY MonthCY

    DayCount = 0
    DayPosX = MonthX + 48
    DayPosY = MonthY + 50
    DayPosCount = 0

    //******************************
    //* Fix for Minimum Year
    //******************************
    if (iCCYY = 2014) and (iMM = 1) 
+      DayOffset = 4
+   endif
    //******************************
    //* Fix for Maximum Year
    //******************************
    if (iCCYY = 2040) and (iMM = 12) 
+      DayOffset = 7
+   endif

    if  (DayOffset > 1) 
+       call !b274_shift
+   endif
    DayPosCount ++

    int iCurrCCYY  error
    string sCurrCCYY error
    int iCurrMM    error
    int iCurrDD    error
    scan:/@date/:'/'
    iCurrMM = left
    scan:/@right/:'/'
    iCurrDD = left
    sCurrCCYY = '20@right@'
    iCurrCCYY = sCurrCCYY

    int iTaskCCYY  error
    int iTaskMM    error
    int iTaskDD    error
    window obtain Tasktrack_Taskdtls_Date_EFOBJ
    split:/@Tasktrack_Taskdtls_Date_EFOBJ@/;4
    iTaskCCYY = left
    split:/@right/;1
    split:/@right/;2
    iTaskMM = left
    split:/@right/;1
    iTaskDD = right

    do
        DayCount ++
        if  (iCCYY = iTaskCCYY) and (iMM = iTaskMM) and (DayCount = iTaskDD)
+           int BoxX  error
+           int BoxY  error
+           BoxX = DayPosX - 2
+           BoxY = DayPosY - 2
+           MacroCommand = "window createcontrol Tasktrack_Taskdtls_WIN Daybutton_BOX @BoxX@ @BoxY@ 29 24 STTXTR" $MacroCommand
+       endif
        if  (iCCYY = iCurrCCYY) and (iMM = iCurrMM) and (DayCount = iCurrDD)
+           MacroCommand = "window createcontrol Tasktrack_Taskdtls_WIN Daybutton_@DayCount@ @DayPosX@ @DayPosY@ 25 20 PBOBJ1 &@DayCount@" $MacroCommand
+           call !b271_set_current_date_fields
+       else
+           MacroCommand = "window createcontrol Tasktrack_Taskdtls_WIN Daybutton_@DayCount@ @DayPosX@ @DayPosY@ 25 20 PBOBJ1 @DayCount@" $MacroCommand
+       endif
        DayPosX = DayPosX + 27
        DayPosCount ++
        if  (DayPosCount > 7)
+           DayPosCount = 1
+           DayPosX = MonthX + 48
+           DayPosY = DayPosY + 22
+       endif
    until (DayCount = DaysInMonth)
    return

//****************************************
//* Set the Current Date Fields
//****************************************
!b271_set_current_date_fields
    CurrentDay = iCurrDD

    if  (DayPosCount = 1) CurrentDayOfWeek = 'Sunday'
    if  (DayPosCount = 2) CurrentDayOfWeek = 'Monday'
    if  (DayPosCount = 3) CurrentDayOfWeek = 'Tuesday'
    if  (DayPosCount = 4) CurrentDayOfWeek = 'Wednesday'
    if  (DayPosCount = 5) CurrentDayOfWeek = 'Thursday'
    if  (DayPosCount = 6) CurrentDayOfWeek = 'Friday'
    if  (DayPosCount = 7) CurrentDayOfWeek = 'Saturday'

    if  (iCurrMM = 1) CurrentMonth = "January"
    if  (iCurrMM = 2) CurrentMonth = "February"
    if  (iCurrMM = 3) CurrentMonth = "March"
    if  (iCurrMM = 4) CurrentMonth = "April"
    if  (iCurrMM = 5) CurrentMonth = "May"
    if  (iCurrMM = 6) CurrentMonth = "June"
    if  (iCurrMM = 7) CurrentMonth = "July"
    if  (iCurrMM = 8) CurrentMonth = "August"
    if  (iCurrMM = 9) CurrentMonth = "September"
    if  (iCurrMM = 10) CurrentMonth = "October"
    if  (iCurrMM = 11) CurrentMonth = "November"
    if  (iCurrMM = 12) CurrentMonth = "December"

    return

//****************************************
//* Calculate the Shift Starting Day
//****************************************
!b273_calc_shift
    do
        TotalDays --
        DayOffset ++
        if (DayOffset > 7)
+           DayOffset = 1
+       endif
    until (TotalDays < 1)
    return

//****************************************
//* Shift the Day Starting Position
//****************************************
!b274_shift
    do
        DayOffset --
        DayPosX += 27
        DayPosCount ++
        if (DayPosCount > 7)
+           DayPosCount = 1
+       endif
    until (DayOffset < 2)
    return

//****************************************
//* Remove the Day Buttons
//****************************************
!b275_delete_day_buttons
    DayCount = 0
    do
        DayCount ++
        MacroCommand = "window deletecontrol Daybutton_@DayCount@ error" $MacroCommand 
    until (DayCount = 31)
    MacroCommand = "window deletecontrol Daybutton_BOX error" $MacroCommand 
    return

//****************************************
//* Previous Month
//****************************************
!b290_Tasktrack_Taskdtls_Prev_PBOBJ
    iMM --
    if (iMM < 1)
+      iMM = 12
+      iCCYY --
+   endif
    CCYY = iCCYY
    call !b275_delete_day_buttons
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return

//****************************************
//* Next Month
//****************************************
!b295_Tasktrack_Taskdtls_Next_PBOBJ
    iMM ++
    if (iMM > 12)
+      iMM = 1
+      iCCYY ++
+   endif
    CCYY = iCCYY
    call !b275_delete_day_buttons
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ_refresh
    return
 
//****************************************
//* Tasktrack_Tasks_Add_PBOBJ Processing
//****************************************
!b300_Tasktrack_Tasks_Add_PBOBJ
    TaskAction = 'Add'
    window pointer wait
    window hwnd Tasktrack_Taskdtls_WIN status error window open Tasktrack_Taskdtls_WIN shade

    window centerdesktop Tasktrack_Taskdtls_WIN
    window clear Tasktrack_Taskdtls_WIN
    Tasktrack_Taskdtls_Priority_EFOBJ = '3'
    window modify Tasktrack_Taskdtls_Priority_EFOBJ

    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'
    Today = '@CCYY@/@MM@/@DD@'
    Tasktrack_Taskdtls_Date_EFOBJ = Today
    window modify Tasktrack_Taskdtls_Date_EFOBJ
    Tasktrack_Taskdtls_Time_EFOBJ = time
    split:/@Tasktrack_Taskdtls_Time_EFOBJ@/;2
    Tasktrack_Taskdtls_Time_EFOBJ = "@left@:00:00"
    window modify Tasktrack_Taskdtls_Time_EFOBJ

    window obtain Tasktrack_Tasks_Business_CBOBJ
    window obtain Tasktrack_Tasks_Personal_CBOBJ
    if  (Tasktrack_Tasks_Personal_CBOBJ) and (!Tasktrack_Tasks_Business_CBOBJ)
+       Tasktrack_Taskdtls_Business_RBOBJ = 'N'
+       Tasktrack_Taskdtls_Personal_RBOBJ = 'Y'
+   else
+       Tasktrack_Taskdtls_Business_RBOBJ = 'Y'
+       Tasktrack_Taskdtls_Personal_RBOBJ = 'N'
+   endif
    window modify Tasktrack_Taskdtls_Business_RBOBJ
    window modify Tasktrack_Taskdtls_Personal_RBOBJ

    Tasktrack_Taskdtls_Business_RBOBJ = 'Personal'
    window modify Tasktrack_Taskdtls_Personal_RBOBJ
    window setfocus Tasktrack_Taskdtls_Desc_EFOBJ

    TaskEnteredDate = Today
    TaskEnteredTime = time

    Tasktrack_Taskdtls_Date_STTXT = 'Date - @TaskEnteredDate@'
    window modify Tasktrack_Taskdtls_Date_STTXT
    Tasktrack_Taskdtls_Time_STTXT = 'Time - @TaskEnteredTime@'
    window modify Tasktrack_Taskdtls_Time_STTXT

    Tasktrack_Taskdtls_Year_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Year_RBOBJ
    Tasktrack_Taskdtls_Month_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Month_RBOBJ
    Tasktrack_Taskdtls_Day_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Day_RBOBJ
    Tasktrack_Taskdtls_Week_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Week_RBOBJ
    Tasktrack_Taskdtls_Hour_RBOBJ = 'Y'
    window modify Tasktrack_Taskdtls_Hour_RBOBJ
    //********************************
    //* Task Due +1 Day
    //********************************
    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ
    call !b210_Tasktrack_Taskdtls_Plus_PBOBJ
    call !b210_Tasktrack_Taskdtls_Plus_PBOBJ

    Tasktrack_Taskdtls_Hour_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Hour_RBOBJ
    Tasktrack_Taskdtls_Day_RBOBJ = 'Y'
    window modify Tasktrack_Taskdtls_Day_RBOBJ

    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ

    window pointer arrow
    return
 
//****************************************
//* Tasktrack_Tasks_Change_PBOBJ Processing
//****************************************
!b400_Tasktrack_Tasks_Change_PBOBJ
    TaskAction = 'Change'
    Tasktrack_Tasks_Tasklist_LBOBJ = null
    window obtain Tasktrack_Tasks_Tasklist_LBOBJ
    pack Tasktrack_Tasks_Tasklist_LBOBJ
    if  (Tasktrack_Tasks_Tasklist_LBOBJ = null)
+       message = 'Please select a Task in the list'
+       window message warning ok
+       window setfocus Tasktrack_Tasks_Tasklist_LBOBJ
+       return
+   endif
!b400_Tasktrack_Tasks_Change_PBOBJ_2
    scan:/@Tasktrack_Tasks_Tasklist_LBOBJ@/:word
    TaskDate = left
    scan:/@right/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left

    if  (TaskType = 'D') or (TaskType = 'W') or (TaskType = 'M') or (TaskType = 'Y')
+       call !b960_Tasktrack_Tasks_Daily_PBOBJ
+       return
+   endif
    scan:/@right/:word
    TaskPriority = left
    scan:/@right/:/[/
    TaskDesc = left
    scan:/@right/:/]/
    TaskContact = left
    leftjust TaskDesc
    pack TaskDesc
    if (TaskDesc beginswith '*** ')
+      scan:/@TaskDesc/:word
+      TaskDesc = right
+      leftjust TaskDesc
+   endif
    Oldline = '@TaskDate@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@|@TaskContact@'
    file TaskTrackFile
    b
    fs:/@Oldline@/
    if (!eof)
+      scan:/@line/:/|/
+      TaskEnteredDate = left
+      scan:/@right/:/|/
+      TaskEnteredTime = left
+   else
+      TaskEnteredDate = null
+      TaskEnteredTime = null
+   endif
    window pointer wait
    window hwnd Tasktrack_Taskdtls_WIN status error window open Tasktrack_Taskdtls_WIN shade
    window centerdesktop Tasktrack_Taskdtls_WIN
    window clear Tasktrack_Taskdtls_WIN
    Tasktrack_Taskdtls_Priority_EFOBJ = TaskPriority
    window modify Tasktrack_Taskdtls_Priority_EFOBJ
    Tasktrack_Taskdtls_Date_EFOBJ = TaskDate
    window modify Tasktrack_Taskdtls_Date_EFOBJ
    Tasktrack_Taskdtls_Time_EFOBJ = TaskTime
    window modify Tasktrack_Taskdtls_Time_EFOBJ
    Tasktrack_Taskdtls_Desc_EFOBJ = TaskDesc
    window modify Tasktrack_Taskdtls_Desc_EFOBJ
    Tasktrack_Taskdtls_Contact_EFOBJ = TaskContact
    window modify Tasktrack_Taskdtls_Contact_EFOBJ

    if  (TaskType = 'B')
+       Tasktrack_Taskdtls_Business_RBOBJ = 'Y'
+       Tasktrack_Taskdtls_Personal_RBOBJ = 'N'
+   else
+       Tasktrack_Taskdtls_Business_RBOBJ = 'N'
+       Tasktrack_Taskdtls_Personal_RBOBJ = 'Y'
+   endif
    window modify Tasktrack_Taskdtls_Business_RBOBJ
    window modify Tasktrack_Taskdtls_Personal_RBOBJ

    Tasktrack_Taskdtls_Date_STTXT = 'Date - @TaskEnteredDate@'
    window modify Tasktrack_Taskdtls_Date_STTXT
    Tasktrack_Taskdtls_Time_STTXT = 'Time - @TaskEnteredTime@'
    window modify Tasktrack_Taskdtls_Time_STTXT

    window unshade Tasktrack_Taskdtls_WIN
    window pointer arrow
    window setfocus Tasktrack_Taskdtls_Date_EFOBJ

    Tasktrack_Taskdtls_Year_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Year_RBOBJ
    Tasktrack_Taskdtls_Month_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Month_RBOBJ
    Tasktrack_Taskdtls_Day_RBOBJ = 'Y'
    window modify Tasktrack_Taskdtls_Day_RBOBJ
    Tasktrack_Taskdtls_Week_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Week_RBOBJ
    Tasktrack_Taskdtls_Hour_RBOBJ = 'N'
    window modify Tasktrack_Taskdtls_Hour_RBOBJ

    call !b270_Tasktrack_Taskdtls_Calendar_PBOBJ

    return
 
//****************************************
//* Tasktrack_Tasks_Complete_PBOBJ Processing
//****************************************
!b500_Tasktrack_Tasks_Complete_PBOBJ
    Tasktrack_Tasks_Tasklist_LBOBJ = null
    window obtain Tasktrack_Tasks_Tasklist_LBOBJ
    pack Tasktrack_Tasks_Tasklist_LBOBJ
    if  (Tasktrack_Tasks_Tasklist_LBOBJ = null)
+       message = 'Please select a Task in the list'
+       window message warning ok
+       window setfocus Tasktrack_Tasks_Tasklist_LBOBJ
+       return
+   endif
    scan:/@Tasktrack_Tasks_Tasklist_LBOBJ@/:word
    TaskDate = left
    scan:/@right/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left
    if  (TaskType = 'D') or (TaskType = 'W') or (TaskType = 'M') or (TaskType = 'Y')
+       call !b700_Tasktrack_Tasks_Delete_PBOBJ
+       return
+   endif
    scan:/@right/:word
    TaskPriority = left
    scan:/@right/:/[/
    TaskDesc = left
    scan:/@right/:/]/
    TaskContact = left
    leftjust TaskDesc
    pack TaskDesc
    if (TaskDesc beginswith '*** ')
+      scan:/@TaskDesc/:word
+      TaskDesc = right
+      leftjust TaskDesc
+   endif
    FinishLine = '@TaskDate@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@|@TaskContact@'
    Oldline = '@TaskDate@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@|@TaskContact@'
    file TaskTrackFile
    b
    fs:/@Oldline@/
    if (!eof)
+      scan:/@line/:/|/
+      TaskEnteredDate = left
+      scan:/@right/:/|/
+      TaskEnteredTime = left
+   else
+      TaskEnteredDate = null
+      TaskEnteredTime = null
+   endif
    window pointer wait
    window hwnd Tasktrack_Finish_WIN status error window open Tasktrack_Finish_WIN shade
    window centerdesktop Tasktrack_Finish_WIN
    window clear Tasktrack_Finish_WIN
    Tasktrack_Finish_Priority_EFOBJ = TaskPriority
    window modify Tasktrack_Finish_Priority_EFOBJ
    Tasktrack_Finish_Date_EFOBJ = TaskDate
    window modify Tasktrack_Finish_Date_EFOBJ
    Tasktrack_Finish_Time_EFOBJ = TaskTime
    window modify Tasktrack_Finish_Time_EFOBJ
    Tasktrack_Finish_Desc_EFOBJ = TaskDesc
    window modify Tasktrack_Finish_Desc_EFOBJ

    if  (TaskType = 'B')
+       Tasktrack_Finish_Business_RBOBJ = 'Y'
+       Tasktrack_Finish_Personal_RBOBJ = 'N'
+   else
+       Tasktrack_Finish_Business_RBOBJ = 'N'
+       Tasktrack_Finish_Personal_RBOBJ = 'Y'
+   endif
    window modify Tasktrack_Finish_Business_RBOBJ
    window modify Tasktrack_Finish_Personal_RBOBJ

    Tasktrack_Finish_Date_STTXT = 'Date - @TaskEnteredDate@'
    window modify Tasktrack_Finish_Date_STTXT
    Tasktrack_Finish_Time_STTXT = 'Time - @TaskEnteredTime@'
    window modify Tasktrack_Finish_Time_STTXT

    window unshade Tasktrack_Finish_WIN
    window pointer arrow
    window setfocus Tasktrack_Finish_Date_EFOBJ

    window disable Tasktrack_Finish_Date_EFOBJ
    window disable Tasktrack_Finish_Time_EFOBJ
    window disable Tasktrack_Finish_Business_RBOBJ
    window disable Tasktrack_Finish_Personal_RBOBJ
    window disable Tasktrack_Finish_Priority_EFOBJ
    window disable Tasktrack_Finish_Desc_EFOBJ
    window setfocus Tasktrack_Finish_Comments_EFOBJ

    return
 
//****************************************
//* Tasktrack_Tasks_Refresh_PBOBJ Processing
//****************************************
!b600_Tasktrack_Tasks_Refresh_PBOBJ
    call !c100_refresh_list
    return
 
//****************************************
//* Tasktrack_Tasks_Close_PBOBJ Processing
//****************************************
!b600_Tasktrack_Tasks_Close_PBOBJ
    window close Tasktrack_Tasks_WIN
    return
 
//****************************************
//* Tasktrack_Tasks_Exit_PBOBJ Processing
//****************************************
!b600_Tasktrack_Tasks_Exit_PBOBJ
    call !a090_Tasktrack_Main_Exit_MSOBJ
    return
 
//****************************************
//* Tasktrack_Tasks_Delete_PBOBJ Processing
//****************************************
!b700_Tasktrack_Tasks_Delete_PBOBJ
    Tasktrack_Tasks_Tasklist_LBOBJ = null
    window obtain Tasktrack_Tasks_Tasklist_LBOBJ
    pack Tasktrack_Tasks_Tasklist_LBOBJ
    if  (Tasktrack_Tasks_Tasklist_LBOBJ = null)
+       return
+   endif
    message = 'Are you sure?'
    window message question yesno
    if  (!message) return
    scan:/@Tasktrack_Tasks_Tasklist_LBOBJ@/:word
    TaskDate = left
    scan:/@right/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left
    scan:/@right/:word
    TaskPriority = left
    scan:/@right/:/[/
    TaskDesc = left
    scan:/@right/:/]/
    TaskContact = left
    leftjust TaskDesc
    pack TaskDesc
    if (TaskDesc beginswith '*** ')
+      scan:/@TaskDesc/:word
+      TaskDesc = right
+      leftjust TaskDesc
+   endif
    Newline = '@TaskDate@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@'
    file TaskTrackFile
    b
    fs:/@Newline/
    if (!eof) d

    //**********************************
    //* Setup for New Recurring line if needed
    //**********************************
    int iTaskCCYY   error
    int iTaskMM     error
    string TaskCCYY error
    string TaskMM   error
    string TaskDD   error

    split:/@TaskDate@/;4
    iTaskCCYY = left
    split:/@right/;1
    split:/@right/;2
    iTaskMM = left
    split:/@right/;1
    TaskDD = right
 
    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'
    Today = '@CCYY@/@MM@/@DD@'

    //**********************************
    //* Recurring Monthly
    //**********************************
    if  (TaskType = 'M')
+       iTaskMM ++
+       if (iTaskMM > 12)
+          iTaskMM = 1
+          iTaskCCYY ++
+   endif

    //**********************************
    //* Recurring Yearly
    //**********************************
    if-1  (TaskType = 'Y')
+       iTaskCCYY ++
+   endif

    TaskMM = '0@iTaskMM@' splitr:/@TaskMM/;2 TaskMM = right
    TaskCCYY = iTaskCCYY

    Newline = '@Today@|@time@|@TaskCCYY@/@TaskMM@/@TaskDD@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@|'

    if  (TaskType = 'M') or (TaskType = 'Y')
+       f;*
+       i:/@Newline@/
+   endif
    call !s100_sort
    write TaskTrackFile TaskTrack.dat
    Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX'
    window obtain Tasktrack_Tasks_Tasklist_LBOBJ
    Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX=@Tasktrack_Tasks_Tasklist_LBOBJ@'
    window delete Tasktrack_Tasks_Tasklist_LBOBJ
    call !c100_refresh_list
    return

//****************************************
//* Create Completed Report as CSV
//****************************************
!b800_Tasktrack_Tasks_Report_PBOBJ
    open TaskCompleteCSVFile null
    i:/Date Entered,Time Entered,Date Due,Time Due,Type,Priority,Description,Contact,Comments,Date Complete,Time Complete,Status/
    file TaskCompleteFile
    b
    clear
    copy;*
    file TaskCompleteCSVFile
    paste
    b
    rs:/|B|/:/|Business|/;*
    b
    rs:/|P|/:/|Personal|/;*
    b
    rs:/|/:/,/;*
    write  TaskCompleteCSVFile TaskTrack.csv error message = 'Unable to write TaskTrack.csv' window message info ok close TaskCompleteCSVFile return
    close TaskCompleteCSVFile
    system:"start TaskTrack.csv"
    return 

//****************************************
//* Clear History Files
//****************************************
!b900_Tasktrack_Tasks_Clear_PBOBJ
    if  (BackupCount = 1)
+       message = 'This will remove @BackupCount@ backup, are you sure?'
+   else
+       message = 'This will remove all @BackupCount@ backups, are you sure?'
+   endif
    window message question yesno
    if (message) 
+      system:"del Task-Backup\*.dat"
+      window hide Tasktrack_Tasks_Clear_PBOBJ
+   endif
    return

//****************************************
//* Sleep the Reminders for 30 minutes
//*     (timer every 10 seconds * 180 = 30 Min)
//****************************************
!b950_Tasktrack_Tasks_Sleep_PBOBJ
    //* Changed SleepCount from 180 (30 mins) to 360 (60 mins) 4/17/2014
    //SleepCount = 180
    SleepCount = 360
    window disable Tasktrack_Tasks_Sleep_PBOBJ
    return

//****************************************
//* Open the Daily Task Maintenance Window
//****************************************
!b960_Tasktrack_Tasks_Daily_PBOBJ
    window pointer wait
    window hwnd Tasktrack_Recurring_WIN status error window open Tasktrack_Recurring_WIN shade
    window centerdesktop Tasktrack_Recurring_WIN
    window clear Tasktrack_Recurring_WIN
    Tasktrack_Recurring_Daily_RBOBJ = 'Y'
    window modify Tasktrack_Recurring_Daily_RBOBJ
    Tasktrack_Recurring_Weekly_RBOBJ = 'N'
    window modify Tasktrack_Recurring_Weekly_RBOBJ
    Tasktrack_Recurring_Monthly_RBOBJ = 'N'
    window modify Tasktrack_Recurring_Monthly_RBOBJ
    Tasktrack_Recurring_Yearly_RBOBJ = 'N'
    window modify Tasktrack_Recurring_Yearly_RBOBJ

    Tasktrack_Recurring_Time_EFOBJ = '07:00:00'
    window modify Tasktrack_Recurring_Time_EFOBJ

    Tasktrack_Recurring_Dayofweek_COOBJ = 'ALL'
    window delete Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = null

    Tasktrack_Recurring_Dayofweek_COOBJ = 'Sunday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ    
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Monday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Tuesday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Wednesday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Thursday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Friday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ
    Tasktrack_Recurring_Dayofweek_COOBJ = 'Saturday' window insert end default Tasktrack_Recurring_Dayofweek_COOBJ

    Tasktrack_Recurring_Dayofmonth_COOBJ = 'ALL'
    window delete Tasktrack_Recurring_Dayofmonth_COOBJ
    Tasktrack_Recurring_Dayofmonth_COOBJ = null

    int Counter error
    Counter = 0
    do
        Counter ++
        Tasktrack_Recurring_Dayofmonth_COOBJ = Counter
        window insert end default Tasktrack_Recurring_Dayofmonth_COOBJ
    until (Counter = 31)

    Tasktrack_Recurring_Month_COOBJ = 'ALL'
    window delete Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = null

    Tasktrack_Recurring_Month_COOBJ = 'January' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'February' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'March' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'April' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'May' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'June' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'July' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'August' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'September' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'October' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'November' window insert end default Tasktrack_Recurring_Month_COOBJ
    Tasktrack_Recurring_Month_COOBJ = 'December' window insert end default Tasktrack_Recurring_Month_COOBJ

    call !b960_Tasktrack_Tasks_Daily_Refresh

    window unshade Tasktrack_Recurring_WIN
    window setfocus Tasktrack_Recurring_Task_EFOBJ
    window pointer arrow
    return

//****************************************
//* Refresh the Task List using Search
//****************************************
!b970_Tasktrack_Tasks_Search_PBOBJ
    window obtain Tasktrack_Tasks_Search_EFOBJ
    Tasktrack_Tasks_Tasklist_LBOBJ = 'ALL'
    window delete Tasktrack_Tasks_Tasklist_LBOBJ
    file TaskTrackFile
    b
    do
        pack Tasktrack_Tasks_Search_EFOBJ
        if  (Tasktrack_Tasks_Search_EFOBJ != null)
+           pattern on
+           case off
+           fs:/@Tasktrack_Tasks_Search_EFOBJ@/
+           case on
+           pattern off
+       endif

        if (!eof)
+           scan:/@line/:/|/
+           scan:/@right/:/|/
+           scan:/@right/:/|/
+           TaskDate = left
+           scan:/@right/:/|/
+           TaskTime = left
+           scan:/@right/:/|/
+           TaskType = left
+           scan:/@right/:/|/
+           TaskPriority = left
+           scan:/@right/:/|/
+           TaskDesc = left
+           TaskContact = right
+           TaskStatus = '     '
+           Newline = '@TaskDate@  @TaskTime@    @TaskType@          @TaskPriority@    @TaskStatus@@TaskDesc@[@TaskContact@]'
+           Tasktrack_Tasks_Tasklist_LBOBJ = Newline
+           window insert end default Tasktrack_Tasks_Tasklist_LBOBJ
+       endif
        f;1
    until (eof)
    Tasktrack_Tasks_Search_EFOBJ = null
    window modify Tasktrack_Tasks_Search_EFOBJ
    return

//****************************************
//* Refresh the Daily Task List
//****************************************
!b960_Tasktrack_Tasks_Daily_Refresh
    Tasktrack_Recurring_Tasklist_LBOBJ = 'ALL'
    window delete Tasktrack_Recurring_Tasklist_LBOBJ 
    Tasktrack_Recurring_Tasklist_LBOBJ = null
    open DailyTasks TaskTrackDaily.dat error open DailyTasks null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           TaskTime = left
+           scan:/@right/:/|/
+           TaskType = left
+           TaskDesc = right
+           Tasktrack_Recurring_Tasklist_LBOBJ = '@TaskTime@     @TaskType@     @TaskDesc@'
+           window insert end default Tasktrack_Recurring_Tasklist_LBOBJ
+           f;1
+       endif
    until (eof) 
    close DailyTasks
    return

//****************************************
//* Close the Daily Task Maintenance Window
//****************************************
!b970_Tasktrack_Recurring_Close_PBOBJ
    window close Tasktrack_Recurring_WIN
    call !c100_refresh_list
    return

//****************************************
//* Close the Daily Task Maintenance Window
//****************************************
!b970_Tasktrack_Recurring_Add_PBOBJ
    string Parameters error
    Parameters = null

    Tasktrack_Recurring_Tasklist_LBOBJ = null
    window obtain Tasktrack_Recurring_WIN
    if  (Tasktrack_Recurring_Task_EFOBJ = null)
+       message = "Please enter a Task Description")
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Task_EFOBJ
+       return
+   endif
    if  (Tasktrack_Recurring_Time_EFOBJ = null)
+       message = "Please enter a Task Time")
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Time_EFOBJ
+       return
+   endif
    if  (Tasktrack_Recurring_Daily_RBOBJ) TaskType = 'D'
    if  (Tasktrack_Recurring_Weekly_RBOBJ) 
+       TaskType = 'W'
+       Parameters = '[@Tasktrack_Recurring_Dayofweek_COOBJ@]'
+       if  (Tasktrack_Recurring_Dayofweek_COOBJ = null)
+           message = 'Please select a Day of the Week'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofweek_COOBJ
+           return
+   endif
    if  (Tasktrack_Recurring_Monthly_RBOBJ) 
+       TaskType = 'M'
+       Parameters = '[@Tasktrack_Recurring_Dayofmonth_COOBJ@]'
+       if  (Tasktrack_Recurring_Dayofmonth_COOBJ = null)
+           message = 'Please select a Day of the Month'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofmonth_COOBJ
+           return
+   endif
    if-1  (Tasktrack_Recurring_Yearly_RBOBJ) 
+       TaskType = 'Y'
+       Parameters = '[@Tasktrack_Recurring_Dayofmonth_COOBJ@-@Tasktrack_Recurring_Month_COOBJ@]'
+       if-2  (Tasktrack_Recurring_Dayofmonth_COOBJ = null)
+           message = 'Please select a Day of the Month'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofmonth_COOBJ
+           return
+       else-2
+           if  (Tasktrack_Recurring_Month_COOBJ = null)
+               message = 'Please select a Month'
+               window message warning ok
+               window setfocus Tasktrack_Recurring_Month_COOBJ
+               return
+   endif

    Newline = '@Tasktrack_Recurring_Time_EFOBJ@|@TaskType@|@Tasktrack_Recurring_Task_EFOBJ@@Parameters@'
    open DailyTasks TaskTrackDaily.dat error open DailyTasks null
    f;*
    i:/@Newline@/
    write DailyTasks TaskTrackDaily.dat
    close DailyTasks
    Tasktrack_Recurring_Tasklist_LBOBJ = '@Tasktrack_Recurring_Time_EFOBJ@     @TaskType@     @Tasktrack_Recurring_Task_EFOBJ@@Parameters@'
    window insert end default Tasktrack_Recurring_Tasklist_LBOBJ
    Tasktrack_Recurring_Tasklist_LBOBJ = null

    if  (!Tasktrack_Recurring_Monthly_RBOBJ) and (!Tasktrack_Recurring_Yearly_RBOBJ)
+       return
+   endif 
    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'
    Today = '@CCYY@/@MM@/@DD@'

    string RecurringTaskDate error

    iMM = MM
    iDD = DD
    iCCYY = CCYY
    int iTestDD error
    int iTestMM error
    iTestDD = Tasktrack_Recurring_Dayofmonth_COOBJ
    if  (Tasktrack_Recurring_Month_COOBJ = "January") iTestMM = 1
    if  (Tasktrack_Recurring_Month_COOBJ = "February") iTestMM = 2
    if  (Tasktrack_Recurring_Month_COOBJ = "March") iTestMM = 3
    if  (Tasktrack_Recurring_Month_COOBJ = "April") iTestMM = 4
    if  (Tasktrack_Recurring_Month_COOBJ = "May") iTestMM = 5
    if  (Tasktrack_Recurring_Month_COOBJ = "June") iTestMM = 6
    if  (Tasktrack_Recurring_Month_COOBJ = "July") iTestMM = 7
    if  (Tasktrack_Recurring_Month_COOBJ = "August") iTestMM = 8
    if  (Tasktrack_Recurring_Month_COOBJ = "September") iTestMM = 9
    if  (Tasktrack_Recurring_Month_COOBJ = "October") iTestMM = 10
    if  (Tasktrack_Recurring_Month_COOBJ = "November") iTestMM = 11
    if  (Tasktrack_Recurring_Month_COOBJ = "December") iTestMM = 12

    //**********************************
    //* Recurring Monthly
    //**********************************
    if  (Tasktrack_Recurring_Monthly_RBOBJ)
+       TaskType = 'M'
+       if  (iTestDD < iDD)
+          iMM ++
+          if (iMM > 12)
+             iMM = 1
+             iCCYY ++
+   endif

    //**********************************
    //* Recurring Yearly
    //**********************************
    if-1  (Tasktrack_Recurring_Yearly_RBOBJ)
+       TaskType = 'Y'
+       if-2  (iTestMM < iMM)
+           iCCYY ++
+       else-2
+           if-3  (iTestMM = iMM)
+              if-4  (iTestDD < iDD)
+                  iCCYY ++
+   endif

    if  (Tasktrack_Recurring_Monthly_RBOBJ)
+       DD = '0@Tasktrack_Recurring_Dayofmonth_COOBJ@' splitr:/@DD@/;2 DD = right
+       MM = '0@iMM@' splitr:/@MM@/;2 MM = right
+       CCYY = iCCYY
+   endif

    if  (Tasktrack_Recurring_Yearly_RBOBJ)
+       DD = '0@Tasktrack_Recurring_Dayofmonth_COOBJ@' splitr:/@DD@/;2 DD = right
+       MM = '0@iTestMM@' splitr:/@MM@/;2 MM = right
+       CCYY = iCCYY
+   endif

    Newline = '@Today@|@time@|@CCYY@/@MM@/@DD@|@Tasktrack_Recurring_Time_EFOBJ@|@TaskType@|3|@Tasktrack_Recurring_Task_EFOBJ@|'
    file TaskTrackFile
    f;*
    i:/@Newline@/
    call !s100_sort
    write TaskTrackFile TaskTrack.dat
    return


//****************************************
//* Double-click a Daily Task
//****************************************
!b970_Tasktrack_Recurring_Tasklist_LBOBJ
    Tasktrack_Recurring_Tasklist_LBOBJ = null
    window obtain Tasktrack_Recurring_Tasklist_LBOBJ
    pack Tasktrack_Recurring_Tasklist_LBOBJ
    if  (Tasktrack_Recurring_Tasklist_LBOBJ = null) return
    scan:/@Tasktrack_Recurring_Tasklist_LBOBJ@/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left
    TaskDesc = right
    leftjust TaskDesc
    pack TaskDesc

    scan:/@TaskDesc@/:/[/
    if (found) TaskDesc = left

    Tasktrack_Recurring_Task_EFOBJ = TaskDesc
    window modify Tasktrack_Recurring_Task_EFOBJ
    Tasktrack_Recurring_Time_EFOBJ = TaskTime
    window modify Tasktrack_Recurring_Time_EFOBJ 
    
    if  (TaskType = 'D') Tasktrack_Recurring_Daily_RBOBJ = 'Y' else Tasktrack_Recurring_Daily_RBOBJ = 'N'
    if  (TaskType = 'W') Tasktrack_Recurring_Weekly_RBOBJ = 'Y' else Tasktrack_Recurring_Weekly_RBOBJ = 'N'
    if  (TaskType = 'M') Tasktrack_Recurring_Monthly_RBOBJ = 'Y' else Tasktrack_Recurring_Monthly_RBOBJ = 'N'
    if  (TaskType = 'Y') Tasktrack_Recurring_Yearly_RBOBJ = 'Y' else Tasktrack_Recurring_Yearly_RBOBJ = 'N'

    window modify Tasktrack_Recurring_Daily_RBOBJ
    window modify Tasktrack_Recurring_Weekly_RBOBJ
    window modify Tasktrack_Recurring_Monthly_RBOBJ 
    window modify Tasktrack_Recurring_Yearly_RBOBJ 

    return

//****************************************
//* Delete a Daily Task
//****************************************
!b970_Tasktrack_Recurring_Delete_PBOBJ
    Tasktrack_Recurring_Tasklist_LBOBJ = null
    window obtain Tasktrack_Recurring_Tasklist_LBOBJ
    pack Tasktrack_Recurring_Tasklist_LBOBJ
    if  (Tasktrack_Recurring_Tasklist_LBOBJ = null)
+       message = 'Please select a Task'
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Tasklist_LBOBJ
+       return
+   endif
    scan:/@Tasktrack_Recurring_Tasklist_LBOBJ@/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left
    TaskDesc = right
    leftjust TaskDesc
    pack TaskDesc
    Newline = '@TaskTime@|@TaskType@|@TaskDesc@'
    open DailyTasks TaskTrackDaily.dat error open DailyTasks null
    b
    fs:/@Newline@/
    if (!eof)
+      d;1
+   endif
    write DailyTasks TaskTrackDaily.dat
    close DailyTasks

    scan:/@TaskDesc@/:/[/
    TaskDesc = left
    if  (TaskType = 'M') or (TaskType = 'Y')
+       SearchString = '|@TaskDesc@|'
+       file TaskTrackFile
+       b
+       fs:/@SearchString@/
+       if (!eof)
+          d
+          call !s100_sort
+          write TaskTrackFile TaskTrack.dat
+   endif

    call !b960_Tasktrack_Tasks_Daily_Refresh
    window setfocus Tasktrack_Recurring_WIN
    return

//****************************************
//* Change a Daily Task
//****************************************
!b970_Tasktrack_Recurring_Change_PBOBJ
    string Parameters error
    Parameters = null

    window obtain Tasktrack_Recurring_WIN
    Tasktrack_Recurring_Tasklist_LBOBJ = null
    window obtain Tasktrack_Recurring_Tasklist_LBOBJ
    pack Tasktrack_Recurring_Tasklist_LBOBJ
    if  (Tasktrack_Recurring_Tasklist_LBOBJ = null) 
+       message = 'Please select a Task'
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Tasklist_LBOBJ
+       return
+   endif

    if  (Tasktrack_Recurring_Task_EFOBJ = null)
+       message = 'Please enter a Description'
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Task_EFOBJ
+       return
+   endif 
    if  (Tasktrack_Recurring_Time_EFOBJ = null)
+       message = 'Please enter a Time'
+       window message warning ok
+       window setfocus Tasktrack_Recurring_Time_EFOBJ
+       return
+   endif 

    scan:/@Tasktrack_Recurring_Tasklist_LBOBJ@/:word
    TaskTime = left
    scan:/@right/:word
    TaskType = left
    TaskDesc = right
    leftjust TaskDesc
    pack TaskDesc
    Oldline = '@TaskTime@|@TaskType@|@TaskDesc@'

    if  (Tasktrack_Recurring_Daily_RBOBJ) TaskType = 'D'
    if  (Tasktrack_Recurring_Weekly_RBOBJ) 
+       TaskType = 'W'
+       Parameters = '[@Tasktrack_Recurring_Dayofweek_COOBJ@]'
+       if  (Tasktrack_Recurring_Dayofweek_COOBJ = null)
+           message = 'Please select a Day of the Week'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofweek_COOBJ
+           return
+   endif
    if  (Tasktrack_Recurring_Monthly_RBOBJ) 
+       TaskType = 'M'
+       Parameters = '[@Tasktrack_Recurring_Dayofmonth_COOBJ@]'
+       if  (Tasktrack_Recurring_Dayofmonth_COOBJ = null)
+           message = 'Please select a Day of the Month'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofmonth_COOBJ
+           return
+   endif
    if-1  (Tasktrack_Recurring_Yearly_RBOBJ) 
+       TaskType = 'Y'
+       Parameters = '[@Tasktrack_Recurring_Dayofmonth_COOBJ@|@Tasktrack_Recurring_Month_COOBJ@]'
+       if-2  (Tasktrack_Recurring_Dayofmonth_COOBJ = null)
+           message = 'Please select a Day of the Month'
+           window message warning ok
+           window setfocus Tasktrack_Recurring_Dayofmonth_COOBJ
+           return
+       else-2
+           if  (Tasktrack_Recurring_Month_COOBJ = null)
+               message = 'Please select a Month'
+               window message warning ok
+               window setfocus Tasktrack_Recurring_Month_COOBJ
+               return
+   endif

    Newline = '@Tasktrack_Recurring_Time_EFOBJ@|@TaskType@|@Tasktrack_Recurring_Task_EFOBJ@@Parameters@'

    open DailyTasks TaskTrackDaily.dat error open DailyTasks null
    b
    fs:/@Oldline@/
    if (!eof)
+      r:/@Newline@/
+   endif
    write DailyTasks TaskTrackDaily.dat
    close DailyTasks

    if  (TaskType = 'M') or (TaskType = 'Y')
+       file TaskTrackFile
+       b
+       scan:/@TaskDesc/:/[/
+       TaskDesc = left
+       SearchString = '@TaskType@|3|@TaskDesc@|'
+       fs:/@SearchString@/
+       if (!eof)
+          rs:/@TaskDesc@/:/@Tasktrack_Recurring_Task_EFOBJ@/
+          call !s100_sort
+          write TaskTrackFile TaskTrack.dat
+   endif

    call !b960_Tasktrack_Tasks_Daily_Refresh
    return

//****************************************
//* Open Help
//****************************************
!b975_Tasktrack_Tasks_Help_PBOBJ
    system:"start TaskTrackerGuide.docx"
    return

//****************************************
//* Open the View window
//****************************************
!b980_Tasktrack_Tasks_View_PBOBJ    
    window pointer wait
    window hwnd Tasktrack_View_WIN status error window open Tasktrack_View_WIN shade
    window centerdesktop Tasktrack_View_WIN

    window clear Tasktrack_View_WIN

    scan:/@date/:'/'
    ViewMonth = left
    iViewMonth = ViewMonth
    scan:/@right/:'/'
    ViewDay = left
    iViewDay = ViewDay
    ViewYear = '20@right@'
    iViewYear = ViewYear
    ViewType = 'Year'
    call !b982_view_month
    
    window unshade Tasktrack_View_WIN
    window pointer arrow
    return

//****************************************
//* Close the View window
//****************************************
!b980_Tasktrack_View_Close_PBOBJ    
    window close Tasktrack_View_WIN
    call !b600_Tasktrack_Tasks_Refresh_PBOBJ
    return

//****************************************
//* Add one to the View based on ViewType
//****************************************
!b980_Tasktrack_View_Plus_PBOBJ    
    if  (ViewType = 'Year')
+       iViewYear ++
+       ViewYear = iViewYear
+       call !b981_view_year
+       return
+   endif
    if-1  (ViewType = 'Month')
+       iViewMonth ++
+       ViewMonth = iViewMonth
+       if-2  (iViewMonth > 12)
+           iViewMonth = 1
+           ViewMonth = iViewMonth
+           iViewYear ++
+           ViewYear = iViewYear
+           call !b982_view_month
+           return
+       else-2
+           call !b982_view_month
+           return
+   endif
    if-1  (ViewType = 'Day')
+       iViewDay ++
+       ViewDay = iViewDay
+       if-2  (iViewDay > 31)
+           iViewDay = 31
+           ViewDay = iViewDay
+           call !b983_view_day
+           return
+        else-2
+           call !b983_view_day
+           return
+   endif
    return

//****************************************
//* Subtract one from the View based on ViewType
//****************************************
!b980_Tasktrack_View_Minus_PBOBJ    
    if  (ViewType = 'Year')
+       iViewYear --
+       ViewYear = iViewYear
+       call !b981_view_year
+       return
+   endif
    if-1  (ViewType = 'Month')
+       iViewMonth --
+       ViewMonth = iViewMonth
+       if-2  (iViewMonth < 1)
+           iViewMonth = 12
+           ViewMonth = iViewMonth
+           iViewYear --
+           ViewYear = iViewYear
+           call !b982_view_month
+           return
+       else-2
+           call !b982_view_month
+           return
+   endif
    if-1  (ViewType = 'Day')
+       iViewDay --
+       ViewDay = iViewDay
+       if-2  (iViewDay < 1)
+           iViewDay = 1
+           ViewDay = iViewDay
+           call !b983_view_day
+           return
+        else-2
+           call !b983_view_day
+           return
+   endif
    return

//****************************************
//* View Year Tasks
//****************************************
!b981_view_year
    ViewType = 'Year'
    ButtonFocus = null

    string MacroCommand error
    int    MaxControl   error
    string sCurrCCYY    error
    string sCurrMM      error
    int    iCurrMM      error
    int    iTaskMM      error
    string sCurrDD      error
    int    Ypos         error

    int    Ypos1        error
    int    Ypos2        error
    int    Ypos3        error
    int    Ypos4        error
    int    Ypos5        error
    int    Ypos6        error
    int    Ypos7        error
    int    Ypos8        error
    int    Ypos9        error
    int    Ypos10       error
    int    Ypos11       error
    int    Ypos12       error

    scan:/@date/:'/'
    sCurrMM = left
    iCurrMM = sCurrMM
    scan:/@right/:'/'
    sCurrDD = left
    sCurrCCYY = '20@right@'
    
    Ypos1 = 65
    Ypos2 = Ypos1
    Ypos3 = Ypos1
    Ypos4 = Ypos1
    Ypos5 = Ypos1
    Ypos6 = Ypos1
    Ypos7 = Ypos1
    Ypos8 = Ypos1
    Ypos9 = Ypos1
    Ypos10 = Ypos1
    Ypos11 = Ypos1
    Ypos12 = Ypos1

    Tasktrack_View_Heading1_STTXT = "@ViewYear@"
    window modify Tasktrack_View_Heading1_STTXT
    Tasktrack_View_Heading2_STTXT = "January        February      March          April           May             June             July             August        September    October        November    December"
    window modify Tasktrack_View_Heading2_STTXT

    call !b999_remove_view_controls

    //********************************
    //* Create the current view line
    //********************************
    window deletecontrol ViewLine error
    if  (ViewYear = sCurrCCYY)
+       Xpos = iCurrMM * 80
+       Xpos += 65
+       MacroCommand = "window createcontrol Tasktrack_View_WIN ViewLine @Xpos@ 58 83 600 STTXT1 " $MacroCommand
+   endif

    file TaskTrackFile
    b
    do
        if  (!eof)
+           MaxControl = lineno           
+           split:/@line/;20
+           split:/@right/;4
+           if  (left = ViewYear)
+               split:/@right/;1
+               split:/@right/;2
+               iTaskMM = left
+               Xpos = iTaskMM * 80
+               Xpos += 73
+               scan:/@line/:/|/
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDate = left
+               scan:/@right/:/|/
+               TaskTime = left
+               scan:/@right/:/|/
+               TaskType = left
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDesc = left
+               MacroCommand = "Ypos = Ypos@iTaskMM@" $MacroCommand                   
+               MacroCommand = "window createcontrol Tasktrack_View_WIN View_@MaxControl@ @Xpos@ @Ypos@ 30 20 PBOBJ1 @TaskType@" $MacroCommand
+               MacroCommand = "Ypos@iTaskMM@ += 27" $MacroCommand
+               file BubbleTasks
+               ObjectX = Xpos - 5
+               ObjectCX = Xpos + 32
+               ObjectY = Ypos - 5
+               ObjectCY = Ypos + 25
+               Newline = '@ObjectX@|@ObjectCX@|@ObjectY@|@ObjectCY@|@TaskDate@|@TaskTime@|@TaskType@|@TaskDesc@'
+               file BubbleTasks
+               i:/@Newline/
+               file TaskTrackFile
+       endif
        f;1
    until (eof)

    return

//****************************************
//* View Month Tasks
//****************************************
!b982_view_month
    ViewType = 'Month'
    ButtonFocus = null

    string MacroCommand error
    int    MaxControl   error
    string sCurrCCYY    error
    string sCurrMM      error
    int    iTaskMM      error
    string sCurrDD      error
    int    iCurrDD      error
    int    iTaskDD      error
    int    Ypos         error

    int    Ypos1        error
    int    Ypos2        error
    int    Ypos3        error
    int    Ypos4        error
    int    Ypos5        error
    int    Ypos6        error
    int    Ypos7        error
    int    Ypos8        error
    int    Ypos9        error
    int    Ypos10       error
    int    Ypos11       error
    int    Ypos12       error
    int    Ypos13       error
    int    Ypos14       error
    int    Ypos15       error
    int    Ypos16       error
    int    Ypos17       error
    int    Ypos18       error
    int    Ypos19       error
    int    Ypos20       error
    int    Ypos21       error
    int    Ypos22       error
    int    Ypos23       error
    int    Ypos24       error
    int    Ypos25       error
    int    Ypos26       error
    int    Ypos27       error
    int    Ypos28       error
    int    Ypos29       error
    int    Ypos30       error
    int    Ypos31       error

    string CheckYear    error
    string CheckMonth   error

    scan:/@date/:'/'
    sCurrMM = left
    scan:/@right/:'/'
    sCurrDD = left
    iCurrDD = sCurrDD
    sCurrCCYY = '20@right@'
    
    Ypos1 = 65
    Ypos2 = Ypos1
    Ypos3 = Ypos1
    Ypos4 = Ypos1
    Ypos5 = Ypos1
    Ypos6 = Ypos1
    Ypos7 = Ypos1
    Ypos8 = Ypos1
    Ypos9 = Ypos1
    Ypos10 = Ypos1
    Ypos11 = Ypos1
    Ypos12 = Ypos1
    Ypos13 = Ypos1
    Ypos14 = Ypos1
    Ypos15 = Ypos1
    Ypos16 = Ypos1
    Ypos17 = Ypos1
    Ypos18 = Ypos1
    Ypos19 = Ypos1
    Ypos20 = Ypos1
    Ypos21 = Ypos1
    Ypos22 = Ypos1
    Ypos23 = Ypos1
    Ypos24 = Ypos1
    Ypos25 = Ypos1
    Ypos26 = Ypos1
    Ypos27 = Ypos1
    Ypos28 = Ypos1
    Ypos29 = Ypos1
    Ypos30 = Ypos1
    Ypos31 = Ypos1

    int LockMaxCount error

    string MonthName error
    if  (ViewMonth = '1') MonthName = "January"
    if  (ViewMonth = '2') MonthName = "February"
    if  (ViewMonth = '3') MonthName = "March"
    if  (ViewMonth = '4') MonthName = "April"
    if  (ViewMonth = '5') MonthName = "May"
    if  (ViewMonth = '6') MonthName = "June"
    if  (ViewMonth = '7') MonthName = "July"
    if  (ViewMonth = '8') MonthName = "August"
    if  (ViewMonth = '9') MonthName = "September"
    if  (ViewMonth = '10') MonthName = "October"
    if  (ViewMonth = '11') MonthName = "November"
    if  (ViewMonth = '12') MonthName = "December"

    Tasktrack_View_Heading1_STTXT = "@MonthName@ @ViewYear@"
    window modify Tasktrack_View_Heading1_STTXT
    if  (iViewMonth = 1) or (iViewMonth = 3)  or (iViewMonth = 5) or (iViewMonth = 7) or (iViewMonth = 8) or (iViewMonth = 10) or (iViewMonth = 12)
+       Tasktrack_View_Heading2_STTXT = "1     2     3     4      5     6      7     8      9    10    11   12   13    14   15   16   17   18   19    20    21   22   23   24   25    26   27   28   29   30   31"
+       LockMaxCount = 31
+   endif
    if  (iViewMonth = 4) or (iViewMonth = 6) or (iViewMonth = 9) or (iViewMonth = 11)
+       Tasktrack_View_Heading2_STTXT = "1     2     3     4      5     6      7     8      9    10    11   12   13    14   15   16   17   18   19    20    21   22   23   24   25    26   27   28   29   30"
+       LockMaxCount = 30
+   endif
    if  (iViewMonth = 2)
+       Tasktrack_View_Heading2_STTXT = "1     2     3     4      5     6      7     8      9    10    11   12   13    14   15   16   17   18   19    20    21   22   23   24   25    26   27   28"
+       LockMaxCount = 28
+   endif

    window modify Tasktrack_View_Heading2_STTXT

    call !b999_remove_view_controls

    //********************************
    //* Create the current view line
    //********************************
    window deletecontrol ViewLine error
    if  (ViewYear = sCurrCCYY) and (ViewMonth = sCurrMM)
+       Xpos = iCurrDD * 29
+       Xpos += 118
+       MacroCommand = "window createcontrol Tasktrack_View_WIN ViewLine @Xpos@ 58 30 600 STTXT1 " $MacroCommand
+   endif

    file TaskTrackFile
    b
    do
        if  (!eof)
+           MaxControl = lineno           
+           split:/@line/;20
+           split:/@right/;4
+           CheckYear = left
+           split:/@right/;1
+           split:/@right/;2
+           CheckMonth = left
+           split:/@right/;1
+           split:/@right/;2
+           iTaskDD = left
+           if  (CheckYear = ViewYear) and (CheckMonth = ViewMonth)
+               Xpos = iTaskDD * 29
+               Xpos += 120
+               scan:/@line/:/|/
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDate = left
+               scan:/@right/:/|/
+               TaskTime = left
+               scan:/@right/:/|/
+               TaskType = left
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDesc = left
+               MacroCommand = "Ypos = Ypos@iTaskDD@" $MacroCommand                   
+               MacroCommand = "window createcontrol Tasktrack_View_WIN View_@MaxControl@ @Xpos@ @Ypos@ 25 20 PBOBJ1 @TaskType@" $MacroCommand
+               MacroCommand = "Ypos@iTaskDD@ += 27" $MacroCommand
+               file BubbleTasks
+               ObjectX = Xpos - 5
+               ObjectCX = Xpos + 32
+               ObjectY = Ypos - 5
+               ObjectCY = Ypos + 25
+               Newline = '@ObjectX@|@ObjectCX@|@ObjectY@|@ObjectCY@|@TaskDate@|@TaskTime@|@TaskType@|@TaskDesc@'
+               file BubbleTasks
+               i:/@Newline/
+               file TaskTrackFile
+       endif
        f;1
    until (eof)

    return

//****************************************
//* View Day Tasks
//****************************************
!b983_view_day
    ViewType = 'Day'
    ButtonFocus = null

    string MacroCommand error
    int    MaxControl   error
    string sCurrCCYY    error
    string sCurrMM      error
    int    iTaskMM      error
    string sCurrDD      error
    int    iCurrDD      error
    int    iTaskDD      error
    string CurrHH       error
    int    iCurrHH      error
    int    iCurrMin     error
    float  fWorkMin     error
    string TaskHH       error
    int    iTaskHH      error
    int    Ypos         error

    int    Ypos1        error
    int    Ypos2        error
    int    Ypos3        error
    int    Ypos4        error
    int    Ypos5        error
    int    Ypos6        error
    int    Ypos7        error
    int    Ypos8        error
    int    Ypos9        error
    int    Ypos10       error
    int    Ypos11       error
    int    Ypos12       error
    int    Ypos13       error
    int    Ypos14       error
    int    Ypos15       error
    int    Ypos16       error
    int    Ypos17       error
    int    Ypos18       error
    int    Ypos19       error
    int    Ypos20       error
    int    Ypos21       error
    int    Ypos22       error
    int    Ypos23       error
    int    Ypos24       error

    string CheckYear    error
    string CheckMonth   error
    string CheckDay     error

    scan:/@date/:'/'
    sCurrMM = left
    scan:/@right/:'/'
    sCurrDD = left
    iCurrDD = sCurrDD
    sCurrCCYY = '20@right@'
    
    Ypos1 = 80
    Ypos2 = Ypos1
    Ypos3 = Ypos1
    Ypos4 = Ypos1
    Ypos5 = Ypos1
    Ypos6 = Ypos1
    Ypos7 = Ypos1
    Ypos8 = Ypos1
    Ypos9 = Ypos1
    Ypos10 = Ypos1
    Ypos11 = Ypos1
    Ypos12 = Ypos1
    Ypos13 = Ypos1
    Ypos14 = Ypos1
    Ypos15 = Ypos1
    Ypos16 = Ypos1
    Ypos17 = Ypos1
    Ypos18 = Ypos1
    Ypos19 = Ypos1
    Ypos20 = Ypos1
    Ypos21 = Ypos1
    Ypos22 = Ypos1
    Ypos23 = Ypos1
    Ypos24 = Ypos1

    string MonthName error
    if  (ViewMonth = '1') MonthName = "January"
    if  (ViewMonth = '2') MonthName = "February"
    if  (ViewMonth = '3') MonthName = "March"
    if  (ViewMonth = '4') MonthName = "April"
    if  (ViewMonth = '5') MonthName = "May"
    if  (ViewMonth = '6') MonthName = "June"
    if  (ViewMonth = '7') MonthName = "July"
    if  (ViewMonth = '8') MonthName = "August"
    if  (ViewMonth = '9') MonthName = "September"
    if  (ViewMonth = '10') MonthName = "October"
    if  (ViewMonth = '11') MonthName = "November"
    if  (ViewMonth = '12') MonthName = "December"

    Tasktrack_View_Heading1_STTXT = "@MonthName@ @ViewDay@, @ViewYear@"
    window modify Tasktrack_View_Heading1_STTXT
    Tasktrack_View_Heading2_STTXT = "1     2     3     4      5     6      7     8      9    10    11   12   1      2     3     4     5     6     7      8      9    10    11"
    window modify Tasktrack_View_Heading2_STTXT

    call !b999_remove_view_controls

    window createcontrol Tasktrack_View_WIN ViewAM 150 54 1000 20 STTXT1 AM
    Xpos = 13 * 29
    Xpos = Xpos + 120
    MacroCommand = "window createcontrol Tasktrack_View_WIN ViewPM @Xpos@ 54 30 20 STTXT1 PM" $MacroCommand

    //********************************
    //* Create the current view line
    //********************************
    window deletecontrol ViewLine error
    if  (ViewYear = sCurrCCYY) and (ViewMonth = sCurrMM) and (ViewDay = sCurrDD)
+       split:/@time@/;2
+       iCurrHH = left
+       split:/@right/;1
+       split:/@right/;2
+       iCurrMin = left
+       Xpos = iCurrHH * 29
+       Xpos += 118
+       fWorkMin = iCurrMin / 60
+       fWorkMin = fWorkMin * 29
+       Xpos = Xpos + fWorkMin
+       MacroCommand = "window createcontrol Tasktrack_View_WIN ViewLine @Xpos@ 34 1 610 STTXTR line" $MacroCommand
+   endif

    file TaskTrackFile
    b
    do
        if  (!eof)
+           MaxControl = lineno           
+           split:/@line/;20
+           split:/@right/;4
+           CheckYear = left
+           split:/@right/;1
+           split:/@right/;2
+           CheckMonth = left
+           split:/@right/;1
+           split:/@right/;2
+           iTaskDD = left
+           CheckDay = left
+           split:/@right/;1
+           split:/@right/;2
+           TaskHH = left
+           iTaskHH = TaskHH           
+           if  (CheckYear = ViewYear) and (CheckMonth = ViewMonth) and (CheckDay = ViewDay)
+               Xpos = iTaskHH * 29
+               Xpos += 120
+               scan:/@line/:/|/
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDate = left
+               scan:/@right/:/|/
+               TaskTime = left
+               scan:/@right/:/|/
+               TaskType = left
+               scan:/@right/:/|/
+               scan:/@right/:/|/
+               TaskDesc = left
+               MacroCommand = "Ypos = Ypos@iTaskHH@" $MacroCommand                   
+               MacroCommand = "window createcontrol Tasktrack_View_WIN View_@MaxControl@ @Xpos@ @Ypos@ 25 20 PBOBJ1 @TaskType@" $MacroCommand
+               MacroCommand = "Ypos@iTaskHH@ += 27" $MacroCommand
+               file BubbleTasks
+               ObjectX = Xpos - 5
+               ObjectCX = Xpos + 32
+               ObjectY = Ypos - 5
+               ObjectCY = Ypos + 25
+               Newline = '@ObjectX@|@ObjectCX@|@ObjectY@|@ObjectCY@|@TaskDate@|@TaskTime@|@TaskType@|@TaskDesc@'
+               file BubbleTasks
+               i:/@Newline/
+               file TaskTrackFile
+       endif
        f;1
    until (eof)

    return

//****************************************
//* Remove View Controls
//****************************************
!b999_remove_view_controls
    close BubbleTasks error
    open BubbleTasks null

    window deletecontrol ViewLine error
    window deletecontrol ViewAM error
    window deletecontrol ViewPM error
    window deletecontrol Bubble error

    if  (MaxControl < 1) return
    do
        MacroCommand = "window deletecontrol View_@MaxControl@ error" $MacroCommand
        MaxControl --
    until (MaxControl = 0)

    return

//****************************************
//* Refresh the Task Tracker List
//****************************************
!c100_refresh_list
    string Parameters error

    window obtain Tasktrack_Tasks_WIN
    Tasktrack_Tasks_Tasklist_LBOBJ = 'ALL'
    window delete Tasktrack_Tasks_Tasklist_LBOBJ

    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'

    scan:/@time@/:/:/
    Hour = left
    scan:/@right/:/:/
    Min = left
    Sec = right

    sCurrentDateTime = '@CCYY@@MM@@DD@@Hour@@Min@@Sec@'
    fCurrentDateTime = sCurrentDateTime

    sWork = "@CCYY@@MM@@DD@'
    fCurrDay = sWork

    OverdueBusiness = 0
    OverduePersonal = 0

    //*********************************************
    //* Recurring Tasks
    //*********************************************
    open TaskTrackCurrDay TaskTrackCurrDay.dat error open TaskTrackCurrDay null i:/ /
    b
    string FileCurrDate error
    FileCurrDate = line
    if  (FileCurrDate = date) 
+       goto !c100_refresh_list_file
+   endif

    //***************************************
    //* Open/Close the Tasks screen to get
    //* the Current Date Fields
    //***************************************
    call !b300_Tasktrack_Tasks_Add_PBOBJ
    call !b200_Tasktrack_Taskdtls_Cancel_PBOBJ
    //message = 'Current [@CurrentDayOfWeek@][@CurrentDay@][@CurrentMonth@]' window message info ok

    //***************************************
    //* Get Last Run Data
    //***************************************
    open LastRun TaskTrackLastRun.dat error goto !c100_no_last_run
    b LastDay = line
    f;1 LastDayOfWeek = line
    f;1 LastMonth = line
    close LastRun

!c100_no_last_run 
    open LastRun null
    //***************************************
    //* Store Last Run Data
    //***************************************
    i:/@CurrentDay@/
    i:/@CurrentDayOfWeek@/
    i:/@CurrentMonth@/
    write LastRun TaskTrackLastRun.dat
    close LastRun

    Newline = date
    file TaskTrackCurrDay
    r:/@Newline@/
    write TaskTrackCurrDay TaskTrackCurrDay.dat
    close TaskTrackCurrDay

    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'
    Today = '@CCYY@/@MM@/@DD@'

    file TaskTrackFile
    f;1
    open DailyTasks TaskTrackDaily.dat error open DailyTasks null
    b
    do
        if (!eof)
+          scan:/@line/:/|/
+          TaskTime = left
+          scan:/@right/:/|/
+          TaskType = left
+          TaskDesc = right
+          call !c100_task_type
+          file DailyTasks
+          f;1
    until (eof)
    close DailyTasks
    call !s100_sort
    write TaskTrackFile TaskTrack.dat

!c100_refresh_list_file
    file TaskTrackFile
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           scan:/@right/:/|/
+           scan:/@right/:/|/
+           TaskDate = left
+           scan:/@right/:/|/
+           TaskTime = left
+           scan:/@right/:/|/
+           TaskType = left
+           scan:/@right/:/|/
+           TaskPriority = left
+           scan:/@right/:/|/
+           TaskDesc = left
+           TaskContact = right
+           call !c110_check_insert
+           f;1
+       endif
    until (eof)

    message = null

    if  (OverdueBusiness > 0) or (OverduePersonal > 0)
+       window show Tasktrack_Tasks_WIN
+       window setfocus Tasktrack_Tasks_WIN
+       window setfocus Tasktrack_Tasks_Tasklist_LBOBJ
+       window enable Tasktrack_Tasks_Sleep_PBOBJ
+   endif

    if (OverdueBusiness > 0) and (OverduePersonal = 0) message = 'Task Tracker: @OverdueBusiness@ Business task(s) are overdue.'
    if (OverdueBusiness = 0) and (OverduePersonal > 0) message = 'Task Tracker: @OverduePersonal@ Personal task(s) are overdue.'
    if (OverdueBusiness > 0) and (OverduePersonal > 0) message = 'Task Tracker: @OverdueBusiness@ Business task(s) are overdue, and @OverduePersonal@ Personal task(s) are overdue.'
    if (Firsttime) and (message != null)
+      window hide Tasktrack_Tasks_WIN
+      window message warning ok
+      window show Tasktrack_Tasks_WIN
+      //******* Sleep 5 Minutes
+      SleepCount = 30
+   endif
    Firsttime = 'n' 

    Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX=1'
    window obtain Tasktrack_Tasks_Tasklist_LBOBJ
    scan:/@Tasktrack_Tasks_Tasklist_LBOBJ@/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    scan:/@right/:word
    if (left = '***')
+      Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX=1'
+      window select Tasktrack_Tasks_Tasklist_LBOBJ
+   endif
    Tasktrack_Tasks_Tasklist_LBOBJ = null
    return

//****************************************
//* Check the Recurring Task Type
//****************************************
!c100_task_type
    if (TaskType = 'D') 
+      Parameters = 'Daily'
+   endif
    if (TaskType = 'W') 
+      Parameters = 'Weekly'
+      scan:/@TaskDesc@/:/[/
+      scan:/@right/:/]/
+      TaskDayOfWeek = left
+   endif
    if (TaskType = 'M') 
+      Parameters = 'Monthly'
+      scan:/@TaskDesc@/:/[/
+      scan:/@right/:/]/
+      TaskDay = left
+   endif
    if (TaskType = 'Y') 
+      Parameters = 'Yearly'
+      scan:/@TaskDesc@/:/[/
+      scan:/@right/:/-/
+      TaskDay = left
+      scan:/@right/:/]/
+      TaskMonth = left
+   endif

    if (TaskType = 'D')
+      Newline = "@Today@|@time@|@Today@|@TaskTime@|@TaskType@|1|@TaskDesc@|@Parameters@"
+      file TaskTrackFile
+      i:/@Newline/
+   endif
    if-1 (TaskType = 'W')
+      if-2  (TaskDayOfWeek = CurrentDayOfWeek)
+          Newline = "@Today@|@time@|@Today@|@TaskTime@|@TaskType@|1|@TaskDesc@|@Parameters@"
+          file TaskTrackFile
+          i:/@Newline/
+      else-2
+          call !c100_check_weekly
+   endif

//    if-1 (TaskType = 'M')
//+      if-2 (TaskDay = CurrentDay)
//+         Newline = "@Today@|@time@|@Today@|@TaskTime@|@TaskType@|1|@TaskDesc@|@Parameters@"
//+         file TaskTrackFile
//+         i:/@Newline/
//+      else-2
//+         call !c100_check_monthly
//+   endif
//    if (TaskType = 'Y') and (TaskDay = CurrentDay) and (TaskMonth = CurrentMonth)
//+      Newline = "@Today@|@time@|@Today@|@TaskTime@|@TaskType@|1|@TaskDesc@|@Parameters@"
//+      file TaskTrackFile
//+      i:/@Newline/
//+   endif
    return

//****************************************
//* Check if a weekly task is due
//****************************************
!c100_check_weekly
    //message = 'LastDayOfWeek[@LastDayOfWeek@] TaskDayOfWeek[@TaskDayOfWeek@]' window message info ok
    if  (TaskDayOfWeek = 'Monday') 
+       if  (LastDayOfWeek = 'Friday') or (LastDayOfWeek = 'Saturday') or (LastDayOfWeek = 'Sunday')
+           if  (CurrentDayOfWeek = 'Tuesday') or (CurrentDayOfWeek = 'Wednesday') or (CurrentDayOfWeek = 'Thursday')
+               goto !c100_check_keep
+   endif
    if  (TaskDayOfWeek = 'Tuesday')
+       if  (LastDayOfWeek = 'Saturday') or (LastDayOfWeek = 'Sunday') or (LastDayOfWeek = 'Monday')
+           if  (CurrentDayOfWeek = 'Wednesday') or (CurrentDayOfWeek = 'Thursday') or (CurrentDayOfWeek = 'Friday')
+       goto !c100_check_keep
+   endif
    if   (TaskDayOfWeek = 'Wednesday')
+        if  (LastDayOfWeek = 'Sunday') or (LastDayOfWeek = 'Monday') or (LastDayOfWeek = 'Tuesday')
+           if  (CurrentDayOfWeek = 'Thursday') or (CurrentDayOfWeek = 'Friday') or (CurrentDayOfWeek = 'Saturday')
+               goto !c100_check_keep
+   endif
    if  (TaskDayOfWeek = 'Thursday')
+       if  (LastDayOfWeek = 'Monday') or (LastDayOfWeek = 'Tuesday') or (LastDayOfWeek = 'Wednesday')
+           if  (CurrentDayOfWeek = 'Friday') or (CurrentDayOfWeek = 'Saturday') or (CurrentDayOfWeek = 'Sunday')
+               goto !c100_check_keep
+   endif
    if  (TaskDayOfWeek = 'Friday')
+       if  (LastDayOfWeek = 'Tuesday') or (LastDayOfWeek = 'Wednesday') or (LastDayOfWeek = 'Thursday') 
+           if  (CurrentDayOfWeek = 'Saturday') or (CurrentDayOfWeek = 'Sunday') or (CurrentDayOfWeek = 'Monday')
+           goto !c100_check_keep
+   endif
    if  (TaskDayOfWeek = 'Saturday')
+       if  (LastDayOfWeek = 'Wednesday') or (LastDayOfWeek = 'Thursday') or (LastDayOfWeek = 'Friday')
+           if  (CurrentDayOfWeek = 'Sunday') or (CurrentDayOfWeek = 'Monday') or (CurrentDayOfWeek = 'Tuesday')
+               goto !c100_check_keep
+   endif
    if  (TaskDayOfWeek = 'Sunday')
+       if  (LastDayOfWeek = 'Thursday') or (LastDayOfWeek = 'Friday') or s(LastDayOfWeek = 'Saturday')
+           if  (CurrentDayOfWeek = 'Monday') or (CurrentDayOfWeek = 'Tuesday') or (CurrentDayOfWeek = 'Wednesday')
+               goto !c100_check_keep
+   endif
    return

!c100_check_keep
    Newline = "@Today@|@time@|@Today@|@TaskTime@|@TaskType@|1|@TaskDesc@|@Parameters@"
    file TaskTrackFile
    i:/@Newline/
    return

//****************************************
//* Check if a weekly task is due
//****************************************
!c100_check_monthly
    if  (TaskDay < CurrentDay) and (TaskMonth != CurrentMonth)
+       goto !c100_check_keep
+   endif
    return

//****************************************
//* Check if a Yearly task is due
//****************************************
!c100_check_yearly
    if  (TaskDay < CurrentDay) and (TaskMonth = CurrentMonth)
+       goto !c100_check_keep
+   endif
    if  (TaskMonth = 'January') and (CurrentMonth = 'February') goto !c100_check_keep
    if  (TaskMonth = 'February') and (CurrentMonth = 'March') goto !c100_check_keep  
    if  (TaskMonth = 'March') and (CurrentMonth = 'April') goto !c100_check_keep 
    if  (TaskMonth = 'April') and (CurrentMonth = 'May') goto !c100_check_keep
    if  (TaskMonth = 'May') and (CurrentMonth = 'June') goto !c100_check_keep
    if  (TaskMonth = 'June') and (CurrentMonth = 'July') goto !c100_check_keep
    if  (TaskMonth = 'July') and (CurrentMonth = 'August') goto !c100_check_keep
    if  (TaskMonth = 'August') and (CurrentMonth = 'September') goto !c100_check_keep
    if  (TaskMonth = 'September') and (CurrentMonth = 'October') goto !c100_check_keep
    if  (TaskMonth = 'October') and (CurrentMonth = 'November') goto !c100_check_keep
    if  (TaskMonth = 'November') and (CurrentMonth = 'December') goto !c100_check_keep
    if  (TaskMonth = 'December') and (CurrentMonth = 'January') goto !c100_check_keep
    return


//****************************************
//* See if the data should be in the filtered list
//****************************************
!c110_check_insert
    scan:/@TaskDate/:'/'
    CCYY = left
    scan:/@right/:'/'
    MM = left
    DD = right
    scan:/@TaskTime@/:/:/
    Hour = left
    scan:/@right/:/:/
    Min = left
    Sec = right
    sTaskDateTime = '@CCYY@@MM@@DD@@Hour@@Min@@Sec@'
    fTaskDateTime = sTaskDateTime

    sWork = '@CCYY@@MM@@DD@'
    fTaskDay = sWork

    //message = 'checking Task[@fTaskDateTime@] Curr[@fCurrentDateTime@]' window message info ok
  
    if-1  (fTaskDateTime < fCurrentDateTime)
+         if-2  (TaskType = 'B')
+             OverdueBusiness ++
+         else-2
+             if-3  (TaskType = 'P')
+                 OverduePersonal ++
+   endif  

    if  (!Tasktrack_Tasks_Business_CBOBJ) and (TaskType = 'B') return
    if  (!Tasktrack_Tasks_Personal_CBOBJ) and (TaskType = 'P') return

    if  (Tasktrack_Tasks_Overdue_RBOBJ)
+       if  (fTaskDateTime > fCurrentDateTime)
+           return
+   endif
    if  (Tasktrack_Tasks_Future_RBOBJ)
+       if  (fTaskDateTime < fCurrentDateTime)
+           return
+   endif
    if  (Tasktrack_Tasks_Today_RBOBJ)
+       //split:/@CCYY@/;2
+       //TaskDate = '@MM@/@DD@/@right@'
+       if  (fTaskDay > fCurrDay)
+           return
+   endif

    if  (fCurrentDateTime > fTaskDateTime)
+       TaskStatus = '*** '
+   else
+       TaskStatus = '     '
+   endif
    Newline = '@TaskDate@  @TaskTime@    @TaskType@          @TaskPriority@    @TaskStatus@@TaskDesc@[@TaskContact@]'
    Tasktrack_Tasks_Tasklist_LBOBJ = Newline
    window insert end default Tasktrack_Tasks_Tasklist_LBOBJ
    return

//****************************************
//* Finish the Task
//****************************************
!d100_Tasktrack_Finish_Finish_PBOBJ
    window obtain Tasktrack_Finish_Comments_EFOBJ
    //***********************************
    //* Replace , with ; and | with /
    //***********************************
    do
        scan:/@Tasktrack_Finish_Comments_EFOBJ@/:/,/
        if (found) Tasktrack_Finish_Comments_EFOBJ = '@left@;@right@'
    until (!found)
    do
        scan:/@Tasktrack_Finish_Comments_EFOBJ@/:/|/
        if (found) Tasktrack_Finish_Comments_EFOBJ = '@left@/@right@'
    until (!found)

    scan:/@FinishLine@/:/|/ TaskDate = left
    scan:/@right/:/|/ TaskTime = left
    scan:/@right/:/|/ TaskType = left
    scan:/@right/:/|/ TaskPriority = left
    scan:/@right/:/|/ TaskDesc = left
    TaskContact = right

    Newline = '@TaskDate@|@TaskTime@|@TaskType@|@TaskPriority@|@TaskDesc@|@TaskContact@'

    //********************
    //* Current Date/Time
    //********************
    scan:/@date/:'/'
    MM = left
    scan:/@right/:'/'
    DD = left
    CCYY = '20@right@'
    scan:/@time@/:/:/
    Hour = left
    scan:/@right/:/:/
    Min = left
    Sec = right
    sCurrentDateTime = '@CCYY@@MM@@DD@@Hour@@Min@@Sec@'
    fCurrentDateTime = sCurrentDateTime

    //********************
    //* Task Date/Time
    //********************
    scan:/@TaskDate/:'/'
    CCYY = left
    scan:/@right/:'/'
    MM = left
    DD = right
    scan:/@TaskTime@/:/:/
    Hour = left
    scan:/@right/:/:/
    Min = left
    Sec = right
    sTaskDateTime = '@CCYY@@MM@@DD@@Hour@@Min@@Sec@'
    fTaskDateTime = sTaskDateTime

    //********************
    //* Was it completed Late?
    //********************
    if  (fCurrentDateTime > fTaskDateTime)
+       TaskStatus = 'Late'
+   else
+       TaskStatus = null
+   endif

    file TaskTrackFile
    b
    fs:/@Newline/
    //message = "[@Newline@]" window message info ok
    //if (eof) message = 'not found in file' window message info ok
    if (!eof)
+      Newline = line
+      d;1
+      call !s100_sort
+      write TaskTrackFile TaskTrack.dat
+      file TaskCompleteFile
+      f;*
+      Newline = "@Newline@|@Tasktrack_Finish_Comments_EFOBJ@|@date@|@time@|@TaskStatus@"
+      i:/@Newline@/
+      write TaskCompleteFile TaskComplete.dat
+      Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX'
+      window obtain Tasktrack_Tasks_Tasklist_LBOBJ
+      Tasktrack_Tasks_Tasklist_LBOBJ = 'INDEX=@Tasktrack_Tasks_Tasklist_LBOBJ@'
+      window delete Tasktrack_Tasks_Tasklist_LBOBJ
+   endif
    window close Tasktrack_Finish_WIN
    call !c100_refresh_list
    return

//****************************************
//* Close the Finish window
//****************************************
!d100_Tasktrack_Finish_Cancel_PBOBJ
    window close Tasktrack_Finish_WIN
    return

//****************************************
//* Make Date ccyy/mm/dd
//****************************************
!f100_fix_date
    return

//****************************************
//* Sort the tasks before writing
//****************************************
!s100_sort
    sort TaskTrackFile,A,21
    return
 
//****************************************
//* Special return for Entry Field Actions
//****************************************
!z999_entryaction_return
    return
 
//*********************************************************************
//*    End of Program Tasktrack.BED
//*********************************************************************
