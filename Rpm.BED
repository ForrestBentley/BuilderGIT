//*********************************************************************
//* Program   : RPM.BED
//*             Generated by Forrest Bentley's GECA B-Edit Analysis System v2.1
//* Date      : 03/31/14
//* Time      : 16:47:22
//* Desc      : This system will maintain multiple remote property files, 
//*             and report differences in deployed property files
//*
//*********************************************************************
//*                        Maintenance Log
//*
//* Date       Author           Description
//* ---------- ---------------- ------------------------------------------
//* 03/31/2014 Forrest Bentley  Created
//* 04/01/2014 Forrest Bentley  Added File Maintenance logic
//* 04/02/2014 Forrest Bentley  Added Property Maintenance Logic
//*                             Changed Navigation File Maint->Property Maint
//* 04/03/2014 Forrest Bentley  Added Putty PSFTP call to test server connection
//*	                        No duplicates for file/loc, and server/userid  
//*                             Added logic to initialize the Compare window, and start downloading  
//* 04/07/2014 Forrest Bentley  Added Properties Retrieval to Property File Maintenance
//*                             Added Update window and initial code   
//* 04/08/2014 Forrest Bentley  Re-arranged the Compare window
//*                             Added Filter buttons to Compare
//*                             Added Compare Template Save/Get/Delete button/window  
//*                             Added Up/Down buttons to Compare Server List 
//*                             Added 5 backup directories (rolling at startup)  
//* 04/09/2014 Forrest Bentley  Made the Update screen look like the new compare screen
//*                             Test button starts .bat file to allow save of server key  
//*                             Fixed the Up/Down button processing   
//*                             Added Template Filter button 
//* 04/10/2014 Forrest Bentley  Added XML parsing 
//*                             Increased Properties List on Compare & Update screens
//* 04/11/2014 Forrest Bentley  Handle XML "attribute name=" lines
//*                             Added Filter on File and Server maint screens
//*                             Added Retrieve Properties button to Compare screen
//*                             Changed Retrieved Properties to not fully Xpath if XML
//*                             Autoselect Select Properties button if Retrieve Properties pressed
//*                             Clear Properties List/Select All Properties when Get, or Remove All
//*                             Added Double-Click Compare List to retrieve Properties
//* 04/14/2014 Forrest Bentley  Added Update File Filter
//*                             Added Update Servers Filter
//*                             Added Update Remove
//*                             Added Update Double-Click Server list
//*                             Added Update Template Filter
//*                             Added Update Up/Down
//*                             Added Update Save/Get/Delete
//* 04/15/2014 Forrest Bentley  Added Update list double-click retrieve
//*                             Fixed Update load list with XML non-full xpath
//*                             Added Update Properties double-click
//*                             Added Update Change button functionality
//* 04/16/2014 Forrest Bentley  Initial Update screen Update button Functionality
//*                             Added Compare button to Update screen
//* 04/17/2014 Forrest Bentley  Added Download button to Compare & Update screens
//* 04/24/2014 Forrest Bentley  Corrected XML compare difference when values are equal
//*                             Changed Test logic to rerun in batch window if you want to see errors
//*                             Added Standard Check Box to Compare and Update screens
//* 05/07/2014 Forrest Bentley  Added Update logic to maintain local downloaded files
//* 05/09/2014 Forrest Bentley  Added User's Guide
//* 05/12/2014 Forrest Bentley  Added Exact File Match on Compare window
//* 05/13/2014 Forrest Bentley  Added Exact File Match error checking when the report is empty
//* 05/27/2014 Forrest Bentley  Fixed !b1800_Rpm_Compare_Compare_PBOBJ_Exact exact match with more than one compare (changed to bat file compare)
//*
//*********************************************************************

    //***********************************
    //* Storage Variables
    //***********************************
 
    int     Xpos
    int     Ypos
    string  MouseOK
    string  Drag
    
    string  Ban1 = 'Remote Property'
    string  Ban2 = 'Maintenance'
    string  Ban3 = '(RPM)'
    string  BannerLine1 = Ban1
    string  BannerLine2 = Ban2
    string  BannerLine3 = Ban3
    //***********************************
    //* Special Actions                 
    //***********************************
    string WindowInit                                       = "call !a010_WindowInit"
    string WindowWrap                                       = "call !a010_WindowWrap"
    string WindowMouse                                      = "call !a010_WindowMouse"
    string WindowDown1                                      = "call !a010_WindowDown1"
    string WindowDown2                                      = "call !a010_WindowDown2"
    string WindowUp1                                        = "call !a010_WindowUp1"
    string WindowUp2                                        = "call !a010_WindowUp2"
    string WindowEscape                                     = "call !a010_Escape"
    string DefaultWindowProcess                             = "call !a010_Default_Window_Processing"
    string WindowTimer                                      = "call !a010_WindowTimer"
    //***********************************
    //* Window Menu Actions             
    //***********************************
    string Rpm_Main_Exit_MSOBJ                              = "call !a090_Rpm_Main_Exit_MSOBJ"
    string Rpm_Main_Banneron_MSOBJ                          = "call !a090_Rpm_Main_Banneron_MSOBJ"
    string Rpm_Main_Banneroff_MSOBJ                         = "call !a090_Rpm_Main_Banneroff_MSOBJ"
    string Rpm_Main_About_MSOBJ                             = "call !a095_Rpm_Main_About_MSOBJ"
    string Rpm_Login_MSOBJ                                  = "call !a100_Rpm_Login_MSOBJ"
    string Rpm_Idmaintenance_MSOBJ                          = "call !a200_Rpm_Idmaintenance_MSOBJ"
    string Rpm_Filemaint_MSOBJ                              = "call !a300_Rpm_Filemaint_MSOBJ"
    string Rpm_Propnamemaint_MSOBJ                          = "call !a400_Rpm_Propnamemaint_MSOBJ"
    string Rpm_Dnsmaint_MSOBJ                               = "call !a500_Rpm_Dnsmaint_MSOBJ"
    string Rpm_Compare_MSOBJ                                = "call !a600_Rpm_Compare_MSOBJ"
    string Rpm_Update_MSOBJ                                 = "call !a700_Rpm_Update_MSOBJ"
    string Rpm_Main_Guide_MSOBJ                             = "call !a800_Rpm_Main_Guide_MSOBJ"
    
    //***********************************
    //* Window Button Actions           
    //***********************************
    string Rpm_Login_Ok_PBOBJ                               = "call !b100_Rpm_Login_Ok_PBOBJ"
    string Rpm_Login_Cancel_PBOBJ                           = "call !b200_Rpm_Login_Cancel_PBOBJ"
    string Rpm_Idmaintenance_Delete_PBOBJ                   = "call !b300_Rpm_Idmaintenance_Delete_PBOBJ"
    string Rpm_Idmaintenance_Add_PBOBJ                      = "call !b400_Rpm_Idmaintenance_Add_PBOBJ"
    string Rpm_Idmaintenance_Close_PBOBJ                    = "call !b500_Rpm_Idmaintenance_Close_PBOBJ"
    string Rpm_Filemaint_Modify_PBOBJ                       = "call !b600_Rpm_Filemaint_Modify_PBOBJ"
    string Rpm_Filemaint_Delete_PBOBJ                       = "call !b700_Rpm_Filemaint_Delete_PBOBJ"
    string Rpm_Filemaint_Add_PBOBJ                          = "call !b800_Rpm_Filemaint_Add_PBOBJ"
    string Rpm_Filemaint_Filter_PBOBJ                       = "call !b850_Rpm_Filemaint_Filter_PBOBJ"
    string Rpm_Filemaint_Close_PBOBJ                        = "call !b900_Rpm_Filemaint_Close_PBOBJ"
    string Rpm_Filemaint_Properties_PBOBJ                   = "call !b910_Rpm_Filemaint_Properties_PBOBJ"
    string Rpm_Filemaint_Proplist_LBOBJ                     = "call !b950_Rpm_Filemaint_Proplist_LBOBJ"
    window action Rpm_Filemaint_Proplist_LBOBJ

    string Rpm_Propnamemaint_Propertylist_PBOBJ             = "call !b1000_Rpm_Propnamemaint_Propertylist_PBOBJ"
    string Rpm_Propnamemaint_Modify_PBOBJ                   = "call !b1050_Rpm_Propnamemaint_Modify_PBOBJ"
    string Rpm_Propnamemaint_Delete_PBOBJ                   = "call !b1100_Rpm_Propnamemaint_Delete_PBOBJ"
    string Rpm_Propnamemaint_Add_PBOBJ                      = "call !b1200_Rpm_Propnamemaint_Add_PBOBJ"
    string Rpm_Propnamemaint_Close_PBOBJ                    = "call !b1300_Rpm_Propnamemaint_Close_PBOBJ"
    string Rpm_Propnamemaint_Retrieve_PBOBJ                 = "call !b1310_Rpm_Propnamemaint_Retrieve_PBOBJ"
    string Rpm_Propnamemaint_Fileprops_LBOBJ                = "call !b1320_Rpm_Propnamemaint_Fileprops_LBOBJ"
    window action Rpm_Propnamemaint_Fileprops_LBOBJ
    string Rpm_Propnamemaint_Proplist_LBOBJ                 = "call !b1350_Rpm_Propnamemaint_Proplist_LBOBJ"
    window action Rpm_Propnamemaint_Proplist_LBOBJ

    string Rpm_Dnsmaint_Change_PBOBJ                        = "call !b1400_Rpm_Dnsmaint_Change_PBOBJ"
    string Rpm_Dnsmaint_Delete_PBOBJ                        = "call !b1500_Rpm_Dnsmaint_Delete_PBOBJ"
    string Rpm_Dnsmaint_Add_PBOBJ                           = "call !b1600_Rpm_Dnsmaint_Add_PBOBJ"
    string Rpm_Dnsmaint_Close_PBOBJ                         = "call !b1700_Rpm_Dnsmaint_Close_PBOBJ"
    string Rpm_Dnsmaint_Test_PBOBJ                          = "call !b1710_Rpm_Dnsmaint_Test_PBOBJ"
    string Rpm_Dnsmaint_Filter_PBOBJ                        = "call !b1720_Rpm_Dnsmaint_Filter_PBOBJ"
    string Rpm_Dnsmaint_Dns_LBOBJ                           = "call !b1750_Rpm_Dnsmaint_Dns_LBOBJ"
    window action Rpm_Dnsmaint_Dns_LBOBJ

    string Rpm_Compare_Compare_PBOBJ                        = "call !b1800_Rpm_Compare_Compare_PBOBJ"
    string Rpm_Compare_Filefilter_PBOBJ                     = "call !b1810_Rpm_Compare_Filefilter_PBOBJ"
    string Rpm_Compare_Serversfilter_PBOBJ                  = "call !b1820_Rpm_Compare_Serversfilter_PBOBJ"
    string Rpm_Compare_Save_PBOBJ                           = "call !b1830_Rpm_Compare_Save_PBOBJ"
    string Rpm_Compare_Get_PBOBJ                            = "call !b1840_Rpm_Compare_Get_PBOBJ"
    string Rpm_Compare_Delete_PBOBJ                         = "call !b1850_Rpm_Compare_Delete_PBOBJ"
    string Rpm_Compare_Up_PBOBJ                             = "call !b1860_Rpm_Compare_Up_PBOBJ"
    string Rpm_Compare_Down_PBOBJ                           = "call !b1870_Rpm_Compare_Down_PBOBJ"
    string Rpm_Compare_Templatefilter_PBOBJ                 = "call !b1880_Rpm_Compare_Templatefilter_PBOBJ"
    string Rpm_Compare_Retrieve_PBOBJ                       = "call !b1885_Rpm_Compare_Retrieve_PBOBJ"
    string Rpm_Compare_Close_PBOBJ                          = "call !b1900_Rpm_Compare_Close_PBOBJ"
    string Rpm_Compare_File_LBOBJ                           = "call !b1910_Rpm_Compare_File_LBOBJ"
    window action Rpm_Compare_File_LBOBJ
    string Rpm_Compare_Servers_LBOBJ                        = "call !b1920_Rpm_Compare_Servers_LBOBJ"
    window action Rpm_Compare_Servers_LBOBJ
    string Rpm_Compare_Compare_LBOBJ                        = "call !b1925_Rpm_Compare_Compare_LBOBJ"
    window action Rpm_Compare_Compare_LBOBJ
    string Rpm_Compare_Remove_PBOBJ                         = "call !b1930_Rpm_Compare_Remove_PBOBJ"
    string Rpm_Compare_Download_PBOBJ                       = "call !b1940_Rpm_Compare_Download_PBOBJ"

    string Rpm_Update_Close_PBOBJ                           = "call !b2000_Rpm_Update_Close_PBOBJ"
    string Rpm_Update_Retrieve_PBOBJ                        = "call !b2010_Rpm_Update_Retrieve_PBOBJ"
    string Rpm_Update_Filefilter_PBOBJ                      = "call !b2020_Rpm_Update_Filefilter_PBOBJ"
    string Rpm_Update_Serversfilter_PBOBJ                   = "call !b2030_Rpm_Update_Serversfilter_PBOBJ"
    string Rpm_Update_Remove_PBOBJ                          = "call !b2040_Rpm_Update_Remove_PBOBJ"
    string Rpm_Update_Download_PBOBJ                        = "call !b2045_Rpm_Update_Download_PBOBJ"
    string Rpm_Update_Up_PBOBJ                              = "call !b2050_Rpm_Update_Up_PBOBJ"
    string Rpm_Update_Down_PBOBJ                            = "call !b2060_Rpm_Update_Down_PBOBJ"
    string Rpm_Update_Templatefilter_PBOBJ                  = "call !b2070_Rpm_Update_Templatefilter_PBOBJ"
    string Rpm_Update_Save_PBOBJ                            = "call !b2080_Rpm_Update_Save_PBOBJ"
    string Rpm_Update_Get_PBOBJ                             = "call !b2090_Rpm_Update_Get_PBOBJ"
    string Rpm_Update_Delete_PBOBJ                          = "call !b2095_Rpm_Update_Delete_PBOBJ"
    string Rpm_Update_Update_LBOBJ                          = "call !b2097_Rpm_Update_Update_LBOBJ"
    window action Rpm_Update_Update_LBOBJ
    string Rpm_Update_Properties_LBOBJ                      = "call !b2098_Rpm_Update_Properties_LBOBJ"
    window action Rpm_Update_Properties_LBOBJ
    string Rpm_Update_Change_PBOBJ                          = "call !b2099_Rpm_Update_Change_PBOBJ"
    string Rpm_Update_Servers_LBOBJ                         = "call !b2100_Rpm_Update_Servers_LBOBJ"
    window action Rpm_Update_Servers_LBOBJ

    string Rpm_Update_Update_PBOBJ                          = "call !b2200_Rpm_Update_Update_PBOBJ"
    string Rpm_Update_Compare_PBOBJ                         = "call !b2300_Rpm_Update_Compare_PBOBJ"

    string Rpm_Progress_Close_PBOBJ                         = "window close "Rpm_Progress_WIN"
    
    //***********************************
    //* Field Edits                     
    //***********************************
    
//*********************************************************************
//* User Defined Global Variables
//*********************************************************************
!0001_User_Defined_Globals
    string  MacroCommand
    string  SystemCommand
    string  Newline
    string  Oldline
    string  SearchString
    string  Server
    string  Userid
    string  Password
    string  Filename
    string  Filename1
    string  Filename2
    string  FilenameFull
    string  BackupFilename
    string  Directory

    string  LastProcessed
    string  ReenterFunction

    string  ReportLine
    string  KeepReportLine
    int     ReportLineCount
    string  Value
    string  HoldLeft
    string  HoldRight
    string  BadCompare

    int     Index
    string  LastTemplate

    int     LineNumber
    string  LineNumberStr

    int     FieldSize

    string  TagName
    string  TagValue

    string  PropertyName
    string  PropertyValue

    //***********************************
    //* Progress Variables
    //***********************************
    int    Progx            error
    int    Progy            error
    int    Progcx           error
    int    Progcy           error
    float  Progress         error
    float  ProgressShow     error
    int    ProgressCount    error
    int    ProgressMax      error
    float  ProgressWork     error
    int    Progframex       error
    int    Progframey       error
    int    Progframecx      error
    int    Progframecy      error
    
//*********************************************************************
//* Main Processing
//*********************************************************************
!0005_Main_Processing
    open WindowFile Rpm.win
    open MenuFile Rpm.mnu
 
    //*************************
    //* Main Window Loop      
    //*************************
    window start noclose
    exit
 
//*********************************************************************
//* Special Actions
//*********************************************************************
//******************************************
//* Window Timer Processing
//******************************************
!a010_WindowTimer
    window timer off
    if  (ReenterFunction != null)
+       //*********************************
+       //* Reenter Code to show Progress
+       //*********************************
+       MacroCommand = "    call @ReenterFunction@"
+       $MacroCommand
+       MacroCommand = null
+   endif
    return
//******************************************
//* Escape Key Processing
//******************************************
!a010_Escape
    return
 
//******************************************
//* Default Window Processing
//******************************************
!a010_Default_Window_Processing
    return
 
//******************************************
//* Main Window Initialization Routine     
//******************************************
!a010_WindowInit
    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif

    //*******************************
    //* Remove Old Backups
    //*******************************
    close DirFile error
    open DirFile null
    systemcurr:"dir RPM-data\20*"

    //file DirFile
    //* Delete Top 5 Heading Lines
    b d;5
    //* Delete Bottom 2 Trailer Lines
    f;* b;1 d;*
    //* Remove last 4 lines (keep last 4 backups + new backup from this run)
    b;3 d;*
    write DirFile RPM-temp.dat
    //* Remove all other backup directories
    b
    do
        if (!eof)
+           scanr:/@line@/:word
+           MacroCommand = 'system:"del RPM-data\@right@\*.dat' $MacroCommand
+           MacroCommand = 'system:"rd RPM-data\@right@' $MacroCommand
+           f;1
+       endif
    until (eof)
    close DirFile 

    //*******************************
    //* Backup the Data Files
    //*******************************
    BackupFilename = '20@date[7-8]@@date[1-2]@@date[4-5]@-@time[1-2]@@time[4-5]@@time[7-8]@'
    MacroCommand = 'system:"md RPM-data\@BackupFilename@"' $MacroCommand
    MacroCommand = 'system:"copy RPM-data\*.dat RPM-data\@BackupFilename@"' $MacroCommand
    system:"del RPM-temp.dat"
    return
 
//******************************************
//* Main Window Wrapup Routine     
//******************************************
!a010_WindowWrap
    return
 
//******************************************
//* Mouse Button 1 Down    
//******************************************
!a010_WindowDown1
    if  (!MouseOK) return
    Drag = 'y'
    return
 
//******************************************
//* Mouse Button 1 Up      
//******************************************
!a010_WindowUp1
    if  (!MouseOK) return
    Drag = 'n'
    return
 
//******************************************
//* Mouse Button 2 Down    
//******************************************
!a010_WindowDown2
    if  (!MouseOK) return
    Drag = 'y'
    return
 
//******************************************
//* Mouse Button 2 Up      
//******************************************
!a010_WindowUp2
    if  (!MouseOK) return
    Drag = 'n'
    return
 
//******************************************
//* Mouse Movement 
//******************************************
!a010_WindowMouse
 
    window mousepos Xpos Ypos
    if  (!Drag) return
    return
 
//*********************************************************************
//* Build Menu Actions
//*********************************************************************
//****************************************
//* Exit Processing
//****************************************
!a090_Rpm_Main_Exit_MSOBJ
    message = 'Are you sure?'
    window message question yesno
    if  (message)
+       window stop
+   endif
    return
 
//****************************************
//* Banner On
//****************************************
!a090_Rpm_Main_Banneron_MSOBJ
    BannerLine1 = Ban1
    BannerLine2 = Ban2
    BannerLine3 = Ban3
    window paint MainWindow
    return
 
//****************************************
//* Banner Off
//****************************************
!a090_Rpm_Main_Banneroff_MSOBJ
    BannerLine1 = null
    BannerLine2 = null
    BannerLine3 = null
    window paint MainWindow
    return
 
//****************************************
//* About Processing
//****************************************
!a095_Rpm_Main_About_MSOBJ
    message = ^This system will maintain multiple remote property files, and report differences in deployed property files.^
    window message info OK
    return
 
//****************************************
//* Rpm_Login_MSOBJ Processing
//****************************************
!a100_Rpm_Login_MSOBJ
    window pointer wait
    window hwnd Rpm_Login_WIN status error window open Rpm_Login_WIN shade
    window center Rpm_Login_WIN
    window clear Rpm_Login_WIN
    window unshade Rpm_Login_WIN
    window pointer arrow
    return
 
//****************************************
//* Rpm_Idmaintenance_MSOBJ Processing
//****************************************
!a200_Rpm_Idmaintenance_MSOBJ
    window pointer wait
    window hwnd Rpm_Idmaintenance_WIN status error window open Rpm_Idmaintenance_WIN shade
    window center Rpm_Idmaintenance_WIN
    window clear Rpm_Idmaintenance_WIN
    window unshade Rpm_Idmaintenance_WIN
    window pointer arrow
    return
 
//****************************************
//* Rpm_Filemaint_MSOBJ Processing
//****************************************
!a300_Rpm_Filemaint_MSOBJ
    window pointer wait
    window hwnd Rpm_Filemaint_WIN status error window open Rpm_Filemaint_WIN shade
    window center Rpm_Filemaint_WIN
    window clear Rpm_Filemaint_WIN

    call !b750_refresh_filelist

    window setfocus Rpm_Filemaint_Propfile_EFOBJ

    window unshade Rpm_Filemaint_WIN
    window pointer arrow
    return
 
//****************************************
//* Rpm_Propnamemaint_MSOBJ Processing
//****************************************
!a400_Rpm_Propnamemaint_MSOBJ
    window pointer wait
    window hwnd Rpm_Propnamemaint_WIN status error window open Rpm_Propnamemaint_WIN shade
    window center Rpm_Propnamemaint_WIN
    window clear Rpm_Propnamemaint_WIN

    Rpm_Propnamemaint_WIN = 'Property Fields Maintenance - @FilenameFull@'
    window title Rpm_Propnamemaint_WIN

    //***************************
    //* Load the Server Dropdown
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Propnamemaint_Server_COOBJ = left
+           scan:/@right/:/|/
+           Rpm_Propnamemaint_Server_COOBJ = '@Rpm_Propnamemaint_Server_COOBJ@[@left@]'
+           window insert end default Rpm_Propnamemaint_Server_COOBJ
+           f;1
+       endif
    until (eof)
    close DNS

    Rpm_Propnamemaint_Type_COOBJ = 'Standard'
    window insert end default Rpm_Propnamemaint_Type_COOBJ
    Rpm_Propnamemaint_Type_COOBJ = 'Non-Standard'
    window insert end default Rpm_Propnamemaint_Type_COOBJ

    window unshade Rpm_Propnamemaint_WIN
    window pointer arrow
    return
 
//****************************************
//* Rpm_Dnsmaint_MSOBJ Processing
//****************************************
!a500_Rpm_Dnsmaint_MSOBJ
    window pointer wait
    window conceal Rpm_Dnsmaint_Password_EFOBJ
    window hwnd Rpm_Dnsmaint_WIN status error window open Rpm_Dnsmaint_WIN shade
    window center Rpm_Dnsmaint_WIN
    window clear Rpm_Dnsmaint_WIN

    call !a1790_refresh_dns_list

    window unshade Rpm_Dnsmaint_WIN
    window pointer arrow
    return
 
//****************************************
//* Rpm_Compare_MSOBJ Processing
//****************************************
!a600_Rpm_Compare_MSOBJ
    window pointer wait
    window hwnd Rpm_Compare_WIN status error window open Rpm_Compare_WIN shade
    window center Rpm_Compare_WIN
    window clear Rpm_Compare_WIN
    //***************************
    //* Load the File list
    //***************************
    call !b1810_Rpm_Compare_Filefilter_PBOBJ

    //***************************
    //* Load the Properties List
    //***************************
    Rpm_Compare_All_RBOBJ = 'Y'
    window modify Rpm_Compare_All_RBOBJ
    Rpm_Compare_Select_RBOBJ = 'N'
    window modify Rpm_Compare_Select_RBOBJ

    Rpm_Compare_File_LBOBJ = 'INDEX=1'
    window select Rpm_Compare_File_LBOBJ
    call !b1910_Rpm_Compare_File_LBOBJ

    //***************************
    //* Load the Server List
    //***************************
    call !b1820_Rpm_Compare_Serversfilter_PBOBJ

    //************************************
    //* Fill the Template Dropdown
    //************************************
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Compare_Template_COOBJ = left
+               window insert end default Rpm_Compare_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template

    close CompareFile error
    open CompareFile null

    window unshade Rpm_Compare_WIN
    window pointer arrow
    return

//****************************************
//* Rpm_Update_MSOBJ Processing
//****************************************
!a700_Rpm_Update_MSOBJ
    window pointer wait
    window hwnd Rpm_Update_WIN status error window open Rpm_Update_WIN shade
    window center Rpm_Update_WIN
    window clear Rpm_Update_WIN
    //***************************
    //* Load the File list
    //***************************
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    do  
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Update_File_LBOBJ = '@left@[@right@]'
+           window insert end default Rpm_Update_File_LBOBJ
+           f;1
+       endif
    until (eof)
    close Filedata

    //***************************
    //* Load the Properties List
    //***************************
    Rpm_Update_All_RBOBJ = 'N'
    window modify Rpm_Update_All_RBOBJ
    Rpm_Update_Select_RBOBJ = 'Y'
    window modify Rpm_Update_Select_RBOBJ

    //***************************
    //* Load the Server List
    //***************************
    Rpm_Update_Servers_LBOBJ = 'ALL'
    window delete Rpm_Update_Servers_LBOBJ
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Update_Servers_LBOBJ = left
+           scan:/@right/:/|/
+           Rpm_Update_Servers_LBOBJ = '@Rpm_Update_Servers_LBOBJ@[@left@]'
+           window insert end default Rpm_Update_Servers_LBOBJ
+           f;1
+       endif
    until (eof)
    close DNS

    //************************************
    //* Fill the Template Dropdown
    //************************************
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Update_Template_COOBJ = left
+               window insert end default Rpm_Update_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template

    window disable Rpm_Update_Compare_PBOBJ

    close UpdateFile error
    open UpdateFile null

    window unshade Rpm_Update_WIN
    window pointer arrow
    return

//****************************************
//* Rpm_Main_Guide_MSOBJ Processing
//****************************************
!a800_Rpm_Main_Guide_MSOBJ
    system:"start RPM-UsersGuide.docx"
    return
 
//*********************************************************************
//* Build Window Button Actions
//*********************************************************************
 
//****************************************
//* Rpm_Login_Ok_PBOBJ Processing
//****************************************
!b100_Rpm_Login_Ok_PBOBJ
    window close Rpm_Login_WIN
    return
 
//****************************************
//* Rpm_Login_Cancel_PBOBJ Processing
//****************************************
!b200_Rpm_Login_Cancel_PBOBJ
    window close Rpm_Login_WIN
    return
 
//****************************************
//* Rpm_Idmaintenance_Delete_PBOBJ Processing
//****************************************
!b300_Rpm_Idmaintenance_Delete_PBOBJ
    window close Rpm_Idmaintenance_WIN
    return
 
//****************************************
//* Rpm_Idmaintenance_Add_PBOBJ Processing
//****************************************
!b400_Rpm_Idmaintenance_Add_PBOBJ

    return
 
//****************************************
//* Rpm_Idmaintenance_Close_PBOBJ Processing
//****************************************
!b500_Rpm_Idmaintenance_Close_PBOBJ
    window close Rpm_Idmaintenance_WIN
    return
 
//****************************************
//* Rpm_Filemaint_Modify_PBOBJ Processing
//****************************************
!b600_Rpm_Filemaint_Modify_PBOBJ
    Rpm_Filemaint_Proplist_LBOBJ = null
    window obtain Rpm_Filemaint_WIN
    if  (Rpm_Filemaint_Proplist_LBOBJ = null)
+       message = 'Please select a Property File from the list'
+       window message info ok
+       window setfocus Rpm_Filemaint_Proplist_LBOBJ
+       return
+   endif 
    crush Rpm_Filemaint_Propfile_EFOBJ
    if  (Rpm_Filemaint_Propfile_EFOBJ = null)
+       message = 'Please enter a Property File'
+       window message info ok
+       window setfocus Rpm_Filemaint_Propfile_EFOBJ
+       return
+   endif  
    crush Rpm_Filemaint_Location_EFOBJ
    if  (Rpm_Filemaint_Location_EFOBJ = null)
+       message = 'Please enter a Location'
+       window message info ok
+       window setfocus Rpm_Filemaint_Location_EFOBJ
+       return
+   endif  
    //************************************
    //* Find the file in the list
    //************************************  
    scan:/@Rpm_Filemaint_Proplist_LBOBJ@/:/[/
    SearchString = left
    scan:/@right/:/]/
    SearchString = '@SearchString@|@left@'
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to locate file in the list'
+      window message error ok
+      window setfocus Rpm_Filemaint_Propfile_EFOBJ
+      close Filedata
+      return
+   endif
    //************************************
    //* Insert the new file
    //************************************
    Newline = '@Rpm_Filemaint_Propfile_EFOBJ@|@Rpm_Filemaint_Location_EFOBJ@'
    r:/@Newline@/
    write Filedata RPM-data\RPM-File.dat
    close Filedata
    call !b750_refresh_filelist
    return
 
//****************************************
//* Rpm_Filemaint_Delete_PBOBJ Processing
//****************************************
!b700_Rpm_Filemaint_Delete_PBOBJ
    Rpm_Filemaint_Proplist_LBOBJ = null
    window obtain Rpm_Filemaint_WIN
    if  (Rpm_Filemaint_Proplist_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Filemaint_Proplist_LBOBJ
+       return
+   endif
    scan:/@Rpm_Filemaint_Proplist_LBOBJ@/:/[/
    SearchString = left
    Rpm_Filemaint_Proplist_LBOBJ = left
    scan:/@right/:/]/
    SearchString = '@SearchString@|@left@'
    message = 'Are you sure?'
    window message question yesno
    if  (!message) return
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    fs:/@SearchString@/
    if (!eof) d;1
    write Filedata RPM-data\RPM-File.dat
    close Filedata

    //************************************
    //* Remove all Properties for File
    //************************************
    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Filemaint_Proplist_LBOBJ)
+               d;1
+           else
+               f;1
+       endif
    until (eof)
    write Properties RPM-data\RPM-Prop.dat
    close Properties

    call !b750_refresh_filelist
    return

//****************************************
//* Refresh the File Maintenance List
//****************************************
!b750_refresh_filelist
    Rpm_Filemaint_Proplist_LBOBJ = 'ALL'
    window delete Rpm_Filemaint_Proplist_LBOBJ
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    do  
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Filemaint_Proplist_LBOBJ = '@left@[@right@]'
+           window insert end default Rpm_Filemaint_Proplist_LBOBJ
+           f;1
+       endif
    until (eof)
    close Filedata
    return
 
//****************************************
//* Rpm_Filemaint_Add_PBOBJ Processing
//****************************************
!b800_Rpm_Filemaint_Add_PBOBJ
    window obtain Rpm_Filemaint_WIN
    crush Rpm_Filemaint_Propfile_EFOBJ
    if  (Rpm_Filemaint_Propfile_EFOBJ = null)
+       message = 'Please enter a Property'
+       window message info ok
+       window setfocus Rpm_Filemaint_Propfile_EFOBJ
+       return
+   endif  
    crush Rpm_Filemaint_Location_EFOBJ
    if  (Rpm_Filemaint_Location_EFOBJ = null)
+       message = 'Please enter a Location'
+       window message info ok
+       window setfocus Rpm_Filemaint_Location_EFOBJ
+       return
+   endif  
    //************************************
    //* Make sure the file isn't already
    //* in the list
    //************************************  
    SearchString = '@Rpm_Filemaint_Propfile_EFOBJ@|@Rpm_Filemaint_Location_EFOBJ@'
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    fs:/@SearchString@/
    if (!eof)
+      message = 'The File/Location is already in the list'
+      window message warning ok
+      window setfocus Rpm_Filemaint_Propfile_EFOBJ
+      close Filedata
+      return
+   endif
    //************************************
    //* Insert the new file
    //************************************
    Newline = '@Rpm_Filemaint_Propfile_EFOBJ@|@Rpm_Filemaint_Location_EFOBJ@'
    i:/@Newline@/
    write Filedata RPM-data\RPM-File.dat
    close Filedata
    call !b750_refresh_filelist
    return

//****************************************
//* Filter the File list
//****************************************
!b850_Rpm_Filemaint_Filter_PBOBJ
    window obtain Rpm_Filemaint_Propfile_EFOBJ
    Rpm_Filemaint_Proplist_LBOBJ = 'ALL'
    window delete Rpm_Filemaint_Proplist_LBOBJ
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b

    do  
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Filemaint_Proplist_LBOBJ = '@left@[@right@]'
+           if-2  (Rpm_Filemaint_Propfile_EFOBJ = null)
+               window insert end default Rpm_Filemaint_Proplist_LBOBJ
+           else-2
+               pattern on
+               case off
+               scan:/@Rpm_Filemaint_Proplist_LBOBJ/:/@Rpm_Filemaint_Propfile_EFOBJ/
+               case on
+               pattern off
+               if-3  (found)
+                   window insert end default Rpm_Filemaint_Proplist_LBOBJ
+       endif
        f;1
    until (eof)
    close Filedata
    return
 
//****************************************
//* Rpm_Filemaint_Close_PBOBJ Processing
//****************************************
!b900_Rpm_Filemaint_Close_PBOBJ
    window close Rpm_Filemaint_WIN
    return

//****************************************
//* Open the Properties window
//****************************************
!b910_Rpm_Filemaint_Properties_PBOBJ
    Rpm_Filemaint_Proplist_LBOBJ = null
    window obtain Rpm_Filemaint_WIN
    if  (Rpm_Filemaint_Proplist_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Filemaint_Proplist_LBOBJ
+       return
+   endif
    FilenameFull = Rpm_Filemaint_Proplist_LBOBJ
    scan:/@Rpm_Filemaint_Proplist_LBOBJ@/:/[/
    Rpm_Filemaint_Proplist_LBOBJ = left

    call !a400_Rpm_Propnamemaint_MSOBJ
    Rpm_Propnamemaint_File_COOBJ = Rpm_Filemaint_Proplist_LBOBJ
    window modify Rpm_Propnamemaint_File_COOBJ
    call !b1000_Rpm_Propnamemaint_Propertylist_PBOBJ
    return

//****************************************
//* Double-click the file maintenance list
//****************************************
!b950_Rpm_Filemaint_Proplist_LBOBJ
    Rpm_Filemaint_Proplist_LBOBJ = null
    window obtain Rpm_Filemaint_WIN
    scan:/@Rpm_Filemaint_Proplist_LBOBJ@/:/[/
    SearchString = left
    Rpm_Filemaint_Proplist_LBOBJ = left
    scan:/@right/:/]/
    SearchString = '@SearchString@|@left@'
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Error locating line in file'
+      window message error ok
+      return
+   endif
    scan:/@line/:/|/
    Rpm_Filemaint_Propfile_EFOBJ = left
    Rpm_Filemaint_Location_EFOBJ = right
    window modify Rpm_Filemaint_Propfile_EFOBJ
    window modify Rpm_Filemaint_Location_EFOBJ
    close Filedata
    return
 
//****************************************
//* Refresh the Property Listbox
//****************************************
!b1000_Rpm_Propnamemaint_Propertylist_PBOBJ
    window obtain Rpm_Propnamemaint_File_COOBJ
    if  (Rpm_Propnamemaint_File_COOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_File_COOBJ
+       return
+   endif
    call !b1000_refresh_propertylist
    return

//****************************************
//* Refresh the Property List
//****************************************
!b1000_refresh_propertylist
    Rpm_Propnamemaint_Proplist_LBOBJ = 'ALL'
    window delete Rpm_Propnamemaint_Proplist_LBOBJ
    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Propnamemaint_File_COOBJ)
+               scan:/@right/:/|/
+               Rpm_Propnamemaint_Proplist_LBOBJ = '@right@[@left@]'
+               window insert end default Rpm_Propnamemaint_Proplist_LBOBJ
+       endif
        f;1
    until (eof)
    close Properties
    return

//****************************************
//* Rpm_Propnamemaint_Modify_PBOBJ Processing
//****************************************
!b1050_Rpm_Propnamemaint_Modify_PBOBJ
    Rpm_Propnamemaint_Proplist_LBOBJ = null
    //window obtain Rpm_Propnamemaint_Proplist_LBOBJ
    window obtain Rpm_Propnamemaint_WIN
    pack Rpm_Propnamemaint_Property_EFOBJ
    if  (Rpm_Propnamemaint_Property_EFOBJ = null)
+       message = 'Please enter a Property'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Property_EFOBJ
+       return
+   endif
    scan:/@Rpm_Propnamemaint_Proplist_LBOBJ@/:/[/
    Rpm_Propnamemaint_Proplist_LBOBJ = left
    if  (Rpm_Propnamemaint_Property_EFOBJ != Rpm_Propnamemaint_Proplist_LBOBJ)
+       message = 'Please double-click a Property'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Proplist_LBOBJ
+       return
+   endif
    if  (Rpm_Propnamemaint_Type_COOBJ = null)
+       message = 'Please select a Type'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Type_COOBJ
+       return
+   endif

    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Propnamemaint_File_COOBJ)
+               scan:/@right/:/|/
+               if  (Rpm_Propnamemaint_Proplist_LBOBJ = right)
+                   Newline = '@Rpm_Propnamemaint_File_COOBJ@|@Rpm_Propnamemaint_Type_COOBJ@|@Rpm_Propnamemaint_Property_EFOBJ@'
+                   r:/@Newline@/
+                   write Properties RPM-data\RPM-Prop.dat
+                   close Properties
+                   call !b1000_refresh_propertylist
+                   return
+       endif
        f;1
    until (eof)   
    close Properties
    return
 
//****************************************
//* Rpm_Propnamemaint_Delete_PBOBJ Processing
//****************************************
!b1100_Rpm_Propnamemaint_Delete_PBOBJ
    message = 'Are you sure?'
    window message question yesno
    if (!message) return
    Rpm_Propnamemaint_Proplist_LBOBJ = null
    window obtain Rpm_Propnamemaint_Proplist_LBOBJ
    scan:/@Rpm_Propnamemaint_Proplist_LBOBJ@/:/[/
    Rpm_Propnamemaint_Proplist_LBOBJ = left
    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Propnamemaint_File_COOBJ)
+               scan:/@right/:/|/
+               if  (Rpm_Propnamemaint_Proplist_LBOBJ = right)
+                   d;1
+                   write Properties RPM-data\RPM-Prop.dat
+                   close Properties
+                   call !b1000_refresh_propertylist
+                   return
+       endif
        f;1
    until (eof)   
    close Properties
    return
 
//****************************************
//* Rpm_Propnamemaint_Add_PBOBJ Processing
//****************************************
!b1200_Rpm_Propnamemaint_Add_PBOBJ
    window obtain Rpm_Propnamemaint_WIN
    pack Rpm_Propnamemaint_Property_EFOBJ
    if  (Rpm_Propnamemaint_Property_EFOBJ = null)
+       message = 'Please enter a Property'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Property_EFOBJ
+       return
+   endif
    if  (Rpm_Propnamemaint_Type_COOBJ = null)
+       message = 'Please select a Type'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Type_COOBJ
+       return
+   endif

    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Propnamemaint_File_COOBJ)
+               scan:/@right/:/|/
+               if  (Rpm_Propnamemaint_Property_EFOBJ = right)
+                   message = 'Property already exists'
+                   window message warning ok
+                   window setfocus Rpm_Propnamemaint_Property_EFOBJ
+                   close Properties
+                   return
+       endif
        f;1
    until (eof)

    Newline = '@Rpm_Propnamemaint_File_COOBJ@|@Rpm_Propnamemaint_Type_COOBJ@|@Rpm_Propnamemaint_Property_EFOBJ@'
    i:/@Newline@/
    write Properties RPM-data\RPM-Prop.dat
    close Properties

    Rpm_Propnamemaint_Proplist_LBOBJ = '@Rpm_Propnamemaint_Property_EFOBJ@[@Rpm_Propnamemaint_Type_COOBJ@]'
    window insert end default Rpm_Propnamemaint_Proplist_LBOBJ
    return
 
//****************************************
//* Rpm_Propnamemaint_Close_PBOBJ Processing
//****************************************
!b1300_Rpm_Propnamemaint_Close_PBOBJ
    window close Rpm_Propnamemaint_WIN
    return

//****************************************
//* Retrieve a Property File
//****************************************
!b1310_Rpm_Propnamemaint_Retrieve_PBOBJ
    window obtain Rpm_Propnamemaint_Server_COOBJ
    if  (Rpm_Propnamemaint_Server_COOBJ = null)
+       message = 'Please select a Server'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Server_COOBJ
+       return
+   endif

    window pointer wait

    scan:/@Rpm_Propnamemaint_Server_COOBJ@/:/[/
    Server = left
    scan:/@right/:/]/
    Userid = left

    SearchString = '@Server@|@Userid@'
    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      window pointer arrow
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    Rpm_Propnamemaint_Fileprops_LBOBJ = 'ALL'
    window delete Rpm_Propnamemaint_Fileprops_LBOBJ

    //***************************
    //* Download the File
    //***************************
    open RPM1 null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM1 rpm.bat
    close RPM1
    open RPM2 null
    scan:/@FilenameFull@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    Newline = 'cd @Directory@'
    i:/@Newline/
    MacroCommand = 'system:"del RPM-data\@Server@\@Userid@\@Filename@"' $MacroCommand
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline@/
    write RPM2 rpm2.bat
    close RPM2
    close RPM-results error
    open RPM-results null
    systemcurr:/rpm.bat/
    //message = 'DNS[@Rpm_Dnsmaint_Dns_EFOBJ@] Userid[@Rpm_Dnsmaint_Userid_EFOBJ@] PW[@Rpm_Dnsmaint_Password_EFOBJ@]' window message info ok
    //write RPM-results RPM-results.dat
    close RPM-results

    system:/del rpm-results.dat/
    system:/del rpm*.bat/

    //***************************
    //* Fill the Properties List
    //***************************
    Rpm_Propnamemaint_Fileprops_LBOBJ = 'ALL'
    window delete Rpm_Propnamemaint_Fileprops_LBOBJ
    close FileProperties error
    MacroCommand = 'open FileProperties RPM-data\@Server@\@Userid@\@Filename@ error return' $MacroCommand
    b
    do  
        if (!eof)
+           scan:/@line/:/=/
+           if (found)
+              Rpm_Propnamemaint_Fileprops_LBOBJ = left
+              window insert end default Rpm_Propnamemaint_Fileprops_LBOBJ
+       endif
        f;1
    until (eof) 
    close FileProperties error 
    window pointer arrow

    return

//****************************************
//* Double click the Property File List
//****************************************
!b1320_Rpm_Propnamemaint_Fileprops_LBOBJ
    Rpm_Propnamemaint_Fileprops_LBOBJ = null
    window obtain Rpm_Propnamemaint_Fileprops_LBOBJ
    if  (Rpm_Propnamemaint_Fileprops_LBOBJ = null)
+       message = 'Please select a Propertry from the retrieved list'
+       window message warning ok
+       window setfocus Rpm_Propnamemaint_Fileprops_LBOBJ
+       return
+   endif
    Rpm_Propnamemaint_Property_EFOBJ = Rpm_Propnamemaint_Fileprops_LBOBJ
    window modify Rpm_Propnamemaint_Property_EFOBJ
    window setfocus Rpm_Propnamemaint_Type_COOBJ
    return

//****************************************
//* Double click the Property list
//****************************************
!b1350_Rpm_Propnamemaint_Proplist_LBOBJ
    Rpm_Propnamemaint_Proplist_LBOBJ = null
    window obtain Rpm_Propnamemaint_Proplist_LBOBJ
    scan:/@Rpm_Propnamemaint_Proplist_LBOBJ@/:/[/
    Rpm_Propnamemaint_Proplist_LBOBJ = left
    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Propnamemaint_File_COOBJ)
+               scan:/@right/:/|/
+               if  (Rpm_Propnamemaint_Proplist_LBOBJ = right)
+                   Rpm_Propnamemaint_Property_EFOBJ = '@right@'
+                   Rpm_Propnamemaint_Type_COOBJ = left
+                   window modify Rpm_Propnamemaint_Property_EFOBJ
+                   window modify Rpm_Propnamemaint_Type_COOBJ
+                   window setfocus Rpm_Propnamemaint_Property_EFOBJ
+                   close Properties
+                   return
+       endif
        f;1
    until (eof)   
    close Properties 
    return
 
//****************************************
//* Rpm_Dnsmaint_Change_PBOBJ Processing
//****************************************
!b1400_Rpm_Dnsmaint_Change_PBOBJ
    Rpm_Propnamemaint_Proplist_LBOBJ = null
    window obtain Rpm_Dnsmaint_WIN
    if  (Rpm_Dnsmaint_Dns_LBOBJ = null)
+       message = 'Please enter select a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_LBOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Dns_EFOBJ = null)
+       message = 'Please enter a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_EFOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Dns_EFOBJ != Rpm_Dnsmaint_Dns_LBOBJ)
+       message = 'Please double-click a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_LBOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Userid_EFOBJ = null)
+       message = 'Please enter a Userid'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Userid_EFOBJ
+       return
+   endif     
    if  (Rpm_Dnsmaint_Password_EFOBJ = null)
+       message = 'Please enter a Password'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Password_EFOBJ
+       return
+   endif   
    SearchString = "@Rpm_Dnsmaint_Dns_EFOBJ@|@Rpm_Dnsmaint_Userid_EFOBJ@"
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line@/:/@SearchString@/
+           if  (found)
+               encrypt Rpm_Dnsmaint_Password_EFOBJ 
+               Newline = '@Rpm_Dnsmaint_Dns_EFOBJ@|@Rpm_Dnsmaint_Userid_EFOBJ@|@Rpm_Dnsmaint_Password_EFOBJ@'
+               r:/@Newline/
+       endif
        f;1
    until (eof)
    write DNS RPM-data\RPM-dns.dat
    close DNS
    call !a1790_refresh_dns_list
    return
 
//****************************************
//* Rpm_Dnsmaint_Delete_PBOBJ Processing
//****************************************
!b1500_Rpm_Dnsmaint_Delete_PBOBJ
    window obtain Rpm_Dnsmaint_WIN
    if  (Rpm_Dnsmaint_Dns_EFOBJ = null)
+       message = 'Please enter a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_EFOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Userid_EFOBJ = null)
+       message = 'Please enter a Userid'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Userid_EFOBJ
+       return
+   endif
    SearchString = "@Rpm_Dnsmaint_Dns_EFOBJ@|@Rpm_Dnsmaint_Userid_EFOBJ@"
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line@/:/@SearchString@/
+           if  (found)
+               d;1
+       endif
        f;1
    until (eof)
    write DNS RPM-data\RPM-dns.dat
    close DNS
    call !a1790_refresh_dns_list
    return
 
//****************************************
//* Rpm_Dnsmaint_Add_PBOBJ Processing
//****************************************
!b1600_Rpm_Dnsmaint_Add_PBOBJ
    window obtain Rpm_Dnsmaint_WIN
    if  (Rpm_Dnsmaint_Dns_EFOBJ = null)
+       message = 'Please enter a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_EFOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Userid_EFOBJ = null)
+       message = 'Please enter a Userid'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Userid_EFOBJ
+       return
+   endif     
    if  (Rpm_Dnsmaint_Password_EFOBJ = null)
+       message = 'Please enter a Password'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Password_EFOBJ
+       return
+   endif   
    SearchString = "@Rpm_Dnsmaint_Dns_EFOBJ@|@Rpm_Dnsmaint_Userid_EFOBJ@"
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/@SearchString@/
+           if  (found)
+               message = 'DNS server already exists'
+               window message warning ok
+               window setfocus Rpm_Dnsmaint_Dns_EFOBJ
+               close DNS
+               return
+       endif
        f;1
    until (eof)
    encrypt Rpm_Dnsmaint_Password_EFOBJ 
    Newline = '@Rpm_Dnsmaint_Dns_EFOBJ@|@Rpm_Dnsmaint_Userid_EFOBJ@|@Rpm_Dnsmaint_Password_EFOBJ@'
    i:/@Newline/
    write DNS RPM-data\RPM-dns.dat
    close DNS
    Rpm_Dnsmaint_Dns_LBOBJ = '@Rpm_Dnsmaint_Dns_EFOBJ@[@Rpm_Dnsmaint_Userid_EFOBJ@]'
    window insert end default Rpm_Dnsmaint_Dns_LBOBJ
    
    return
 
//****************************************
//* Rpm_Dnsmaint_Close_PBOBJ Processing
//****************************************
!b1700_Rpm_Dnsmaint_Close_PBOBJ
    window close Rpm_Dnsmaint_WIN
    return

//****************************************
//* Test the DNS Server Name Entry
//****************************************
!b1710_Rpm_Dnsmaint_Test_PBOBJ
    window obtain Rpm_Dnsmaint_WIN
    if  (Rpm_Dnsmaint_Dns_EFOBJ = null)
+       message = 'Please enter a DNS name'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_EFOBJ
+       return
+   endif
    if  (Rpm_Dnsmaint_Userid_EFOBJ = null)
+       message = 'Please enter a Userid'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Userid_EFOBJ
+       return
+   endif     
    if  (Rpm_Dnsmaint_Password_EFOBJ = null)
+       message = 'Please enter a Password'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Password_EFOBJ
+       return
+   endif  
    open RPM1 null
    subs & Newline = 'psftp &Rpm_Dnsmaint_Userid_EFOBJ&@&Rpm_Dnsmaint_Dns_EFOBJ& -bc -batch -pw &Rpm_Dnsmaint_Password_EFOBJ& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM1 rpm.bat
    close RPM1
    open RPM2 null
    i:/pwd/
    write RPM2 rpm2.bat
    close RPM2
    close RPM-results error
    open RPM-results null
    systemcurr:/rpm.bat/
    //message = 'DNS[@Rpm_Dnsmaint_Dns_EFOBJ@] Userid[@Rpm_Dnsmaint_Userid_EFOBJ@] PW[@Rpm_Dnsmaint_Password_EFOBJ@]' window message info ok
    write RPM-results RPM-results.dat
    b
    fs:/Remote directory/
    if  (!eof)
+       message = 'Successful'
+       window message info ok
+   else
+       message = 'Error, view details?'
+       window message error yesno
+       if  (message)
+           goto !b1715_Rpm_Dnsmaint_Test_show
+   endif
    close RPM-results
    system:/del rpm-results.dat/
    system:/del rpm*.bat/
    return

!b1715_Rpm_Dnsmaint_Test_show

    open RPM1 null
    subs & Newline = 'psftp &Rpm_Dnsmaint_Userid_EFOBJ&@&Rpm_Dnsmaint_Dns_EFOBJ& -bc -pw &Rpm_Dnsmaint_Password_EFOBJ& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/start rpm2.bat/
    write RPM1 rpm.bat
    close RPM1
    open RPM2 null
    i:/del rpm.bat/
    i:/exit/
    write RPM2 rpm2.bat
    close RPM2
    close RPM-results error
    open RPM-results null

    system:"start rpm.bat"
    return

//****************************************
//* Filter the Server Name list
//****************************************
!b1720_Rpm_Dnsmaint_Filter_PBOBJ
    window obtain Rpm_Dnsmaint_Dns_EFOBJ
    Rpm_Dnsmaint_Dns_LBOBJ = 'ALL'
    window delete Rpm_Dnsmaint_Dns_LBOBJ
    Rpm_Dnsmaint_Dns_LBOBJ = null
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Dnsmaint_Dns_LBOBJ = left
+           scan:/@right/:/|/
+           Rpm_Dnsmaint_Dns_LBOBJ = '@Rpm_Dnsmaint_Dns_LBOBJ@[@left@]'
+           if   (Rpm_Dnsmaint_Dns_EFOBJ = null)
+               window insert end default Rpm_Dnsmaint_Dns_LBOBJ
+           else
+               pattern on
+               case off
+               scan:/@Rpm_Dnsmaint_Dns_LBOBJ/:/@Rpm_Dnsmaint_Dns_EFOBJ/
+               case on
+               pattern off
+               if  (found)
+                   window insert end default Rpm_Dnsmaint_Dns_LBOBJ
+       endif
        f;1
    until (eof)
    close DNS
    return

//****************************************
//* Double-click the DNS list
//****************************************
!b1750_Rpm_Dnsmaint_Dns_LBOBJ
    Rpm_Dnsmaint_Dns_LBOBJ = null
    window obtain Rpm_Dnsmaint_Dns_LBOBJ
    if  (Rpm_Dnsmaint_Dns_LBOBJ = null)
+       message = 'Please select a DNS entry'
+       window message warning ok
+       window setfocus Rpm_Dnsmaint_Dns_LBOBJ
+       return
+   endif

    scan:/@Rpm_Dnsmaint_Dns_LBOBJ@/:/[/
    SearchString = left
    scan:/@right/:/]/
    SearchString = '@SearchString@|@left@'
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/@SearchString@/
+           if  (found)
+               scan:/@line/:/|/
+               Rpm_Dnsmaint_Dns_EFOBJ = left
+               scan:/@right/:/|/
+               Rpm_Dnsmaint_Userid_EFOBJ = left
+               Rpm_Dnsmaint_Password_EFOBJ = right
+               window modify Rpm_Dnsmaint_Userid_EFOBJ
+               decrypt Rpm_Dnsmaint_Password_EFOBJ
+               window modify Rpm_Dnsmaint_Password_EFOBJ
+               //Rpm_Dnsmaint_Dns_EFOBJ = Rpm_Dnsmaint_Dns_LBOBJ
+               window modify Rpm_Dnsmaint_Dns_EFOBJ
+               close DNS
+               return
+       endif
        f;1
    until (eof)
    close DNS
    return

//****************************************
//* Refresh the DNS list
//****************************************
!a1790_refresh_dns_list
    Rpm_Dnsmaint_Dns_LBOBJ = 'ALL'
    window delete Rpm_Dnsmaint_Dns_LBOBJ
    Rpm_Dnsmaint_Dns_LBOBJ = null
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           Rpm_Dnsmaint_Dns_LBOBJ = left
+           scan:/@right/:/|/
+           Rpm_Dnsmaint_Dns_LBOBJ = '@Rpm_Dnsmaint_Dns_LBOBJ@[@left@]'
+           window insert end default Rpm_Dnsmaint_Dns_LBOBJ
+           f;1
+       endif
    until (eof)
    close DNS
    return
 
//****************************************
//* Rpm_Compare_Compare_PBOBJ Processing
//****************************************
!b1800_Rpm_Compare_Compare_PBOBJ
    Rpm_Compare_File_LBOBJ = null
    Rpm_Compare_Properties_LBOBJ = null
    Rpm_Compare_Servers_LBOBJ = null
    window obtain Rpm_Compare_WIN
    Rpm_Compare_Compare_LBOBJ = 'INDEX=1'
    window obtain Rpm_Compare_Compare_LBOBJ
    if  (Rpm_Compare_Compare_LBOBJ = null)
+       message = 'Please create at least one Compare File/Server'
+       window message warning ok
+       window setfocus Rpm_Compare_Compare_LBOBJ
+       return
+   endif
    if  (Rpm_Compare_Select_RBOBJ)
+       if  (Rpm_Compare_Properties_LBOBJ = null)
+           message = 'Please select at least 1 Property when comparing Standard Properties'
+           window message warning ok
+           window setfocus Rpm_Compare_Properties_LBOBJ
+           return
+   endif

    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif
    ReportLine = null

    //************************************
    //* Setup Progress
    //************************************
    file CompareFile
    b
    f;*
    ProgressCount = pcount + 1 
    call !p100_open_progress
    b
    LastProcessed = null

!b1800_Rpm_Compare_Compare_PBOBJ_reenter
    //************************************
    //* Retrieve Files
    //************************************
    file CompareFile
    if (LastProcessed = line)
+      f;1
+      if  (eof)
+          //call !p300_close_progress
+          ReenterFunction = '!b1800_Rpm_Compare_Compare_PBOBJ_done'
+          window timer on 0
+          return
+   endif
    LastProcessed = line
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    SearchString = '@Server@|@Userid@'
    Rpm_Progress_WIN = '@Filename@ <= @Server@[@Userid@]'
    window title Rpm_Progress_WIN
    window obtain Rpm_Compare_Exact_CBOBJ
    if-1  (Rpm_Compare_Exact_CBOBJ)
+       if-2  (ReportLine = null)
+           ReportLine = "@Filename@[@Directory@],Compare"
+   else-1
+       if-3  (ReportLine = null)
+           ReportLine = "@Filename@[@Directory@] Properties,Compare"
+   endif
    ReportLine = '@ReportLine@,@Server@[@Userid@]'

    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Create the RPM BAT files
    //***************************
    close RPM error
    open RPM null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM rpm.bat
    close RPM

    close RPM2 error
    open RPM2 null
    Newline = 'cd @Directory@'
    i:/@Newline@/
    SystemCommand = 'del RPM-data\@Server@\@Userid@\@Filename@'
    system:/@SystemCommand@/
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline/
    write RPM2 rpm2.bat
    close RPM2

    //*****************************
    //* Run BAT files to download
    //*****************************
    close RPM-results error
    open RPM-results null
    systemcurr:"RPM.bat"
    system:/del RPM*.bat/

    b
    //*****************************
    //* Any Files Downloaded?
    //*****************************
    fs:/get -r/
    if-1  (eof)
+       message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+       window message error yesno
+       if-2  (message)
+           write RPM-results rpm-results.dat
+           system:/start rpm-results.dat/
+           close RPM-results
+           call !p300_close_progress
+           return
+       else-2
+           close RPM-results
+           call !p300_close_progress
+           return
+   endif
    system:/del rpm-results.dat/

    //*****************************
    //* Check Errors on Downloaded Files
    //*****************************
    b
    do       
        fs:/get -r/
        if-1 (!eof)
+          f;1
+          scan:/@line/:/remote:/
+          if-2  (!found)
+              message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+              window message error yesno
+              if-3  (message)
+                  write RPM-results rpmresults.dat
+                  system:/start rpmresults.dat/
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+              else-3
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+       endif
    until (eof)
    //message = 'File @Filename@:@Directory from @Server@:@Userid@ successfully downloaded'
    //window message info ok

    close RPM-results
    system:/del rpmresults.dat/
    call !p200_show_progress
    ReenterFunction = '!b1800_Rpm_Compare_Compare_PBOBJ_reenter'
    window timer on 0
    return

!b1800_Rpm_Compare_Compare_PBOBJ_done
    //message = 'Debug - files downloaded' window message info ok
    close CompareReport error
    open CompareReport null
    i:/@ReportLine@/
    KeepReportLine = ReportLine
    window obtain Rpm_Compare_Exact_CBOBJ
    if  (Rpm_Compare_Exact_CBOBJ)
+       goto !b1800_Rpm_Compare_Compare_PBOBJ_Exact
+   endif
    //message = 'Debug - files downloaded2' window message info ok    
    //***************************************************
    //* PropertiesFile contains Properties selected in list
    //***************************************************
    open PropertiesFile null

    if  (Rpm_Compare_All_RBOBJ)
+       goto !b1800_Rpm_Compare_Compare_PBOBJ_uncontrolled
+   endif

    Rpm_Compare_Properties_LBOBJ = 'FIRST'
    do
        window obtain Rpm_Compare_Properties_LBOBJ

        //****************************************
        //* Replace LB selection with Full XPath entry for XML files
        //****************************************
        if  (Rpm_Compare_Properties_LBOBJ != null)
+           scan:/@Filename@/:/.xml/
+           if (found)
+             scan:/@Rpm_Compare_Properties_LBOBJ/:/:/
+             SearchString = '<@left@>:@right@'
+             //message = '[@SearchString@]' window message info ok
+             file PropertyFileFull
+             b
+             fs:/@SearchString/
+             if  (!eof)
+                 scan:/@line/:/=/
+                 Rpm_Compare_Properties_LBOBJ = left
+                 //message = 'Property[@line@]' window message info ok
+       endif

        //****************************************
        //* Only keep the LB selections
        //****************************************
        if  (Rpm_Compare_Properties_LBOBJ != null)
+           file PropertiesFile
+           i:/@Rpm_Compare_Properties_LBOBJ@/
+           file CompareReport
+           i:/@Rpm_Compare_Properties_LBOBJ@/
+           Rpm_Compare_Properties_LBOBJ = 'NEXT'
+       endif
    until (Rpm_Compare_Properties_LBOBJ = null)

    file CompareFile
    b
    goto !b1800_Rpm_Compare_Compare_PBOBJ_fileloop

!b1800_Rpm_Compare_Compare_PBOBJ_uncontrolled
    //****************************************
    //* Fill the PropertiesFile with
    //* every entry in the first PropertyFile
    //****************************************
    file CompareFile
    b
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    Filename = 'RPM-data\@Server@\@Userid@\@Filename@'
    open PropertyFile @Filename error message = 'Unable to open @Filename@' window message warning ok return
    scan:/@Filename/:/.xml/
    if (found)
+      call !x100_convert_xml
+   endif
    b
    do
        scan:/@line/:/=/
        if  (found)
+           file PropertiesFile
+           i:/@left@/
+           file CompareReport
+           i:/@left@/
+       endif
        file PropertyFile
        f;1
    until (eof)
    close PropertyFile
    file CompareFile
    b

!b1800_Rpm_Compare_Compare_PBOBJ_fileloop
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    Filename = 'RPM-data\@Server@\@Userid@\@Filename@'
    //***************************************************
    //* PropertiesFile is the downloaded property file
    //***************************************************
    open PropertyFile @Filename error message = 'Unable to open @Filename@' window message warning ok return
    scan:/@Filename/:/.xml/
    if (found)
+      call !x100_convert_xml
+   endif
    file CompareReport
    b
    f;1

    file PropertiesFile
    b
    do
        SearchString = '@line@='
        file PropertyFile 
        b
        fs:/@SearchString/
        if (!eof)
+          scan:/@line/:/@SearchString/
+          Value = right
+          call !a1800_double_quotes
+          d;1
+          file CompareReport
+          Newline = '@line@,"@Value@"'
+          r:/@Newline@/
+       else
+          file CompareReport
+          Newline = '@line@,'
+          r:/@Newline@/
+       endif
        file CompareReport
        f;1
        file PropertiesFile
        f;1
    until (eof)    
    close PropertyFile
    file CompareFile
    f;1
    if (!eof)
+      goto !b1800_Rpm_Compare_Compare_PBOBJ_fileloop
+   endif
    close PropertiesFile
    //************************************
    //* Add Bad Compare Column
    //************************************
    file CompareReport
    b
    f;1    // Skip Heading Row
    do-1
        Newline = /@line@,""/
        r:/@Newline@/
        scan:/@line/:/,"/
        HoldLeft = left
        HoldRight = right
        scan:/@right/:/,"/
        Value = left
        BadCompare = null
        do-2
            scan:/@right/:/,"/
            if  (found)
+               if  (left != Value)
+                   BadCompare = 'Difference'
+           endif
        until-2 (!found)
        Newline = '@HoldLeft@,@BadCompare@,"@HoldRight@'
        r:/@Newline@/
        f;1
    until-1 (eof)
!b1800_Rpm_Compare_Compare_PBOBJ_write
    //message = 'Debug - write' window message info ok
    file CompareReport
    window obtain Rpm_Compare_Exact_CBOBJ
    if  (!Rpm_Compare_Exact_CBOBJ)
+       scan:/@Filename@/:/.xml/
+       if  (found) 
+           call !x600_fix_xml_names
+   endif
    file CompareReport
    b
    f;*
    ReportLineCount = pcount
    write CompareReport rpm_compare.csv error message = "Bad write to rpm_compare.csv, file already open?" window message warning yesno if (message) goto !b1800_Rpm_Compare_Compare_PBOBJ_write
    close CompareReport

    Rpm_Progress_WIN = 'Opening Compare.CSV'
    window title Rpm_Progress_WIN
    ReenterFunction = '!b1800_Rpm_Compare_Compare_PBOBJ_opencsv'
    window timer on 0
    return

!b1800_Rpm_Compare_Compare_PBOBJ_opencsv
    //message = 'Debug - open' window message info ok
    if-1  (!ReportLineCount)
+       message = 'There aren't any output lines in the report, did you mean to match the entire file?'
+       window message question yesno
+       if-2  (message)
+           Rpm_Compare_Exact_CBOBJ = 'Y'
+           window modify Rpm_Compare_Exact_CBOBJ
+           ReportLine = KeepReportLine
+           goto !b1800_Rpm_Compare_Compare_PBOBJ_done
+       else-2
+           call !p300_close_progress
+           return
+   endif
    call !p300_close_progress
    system:"start rpm_compare.csv"
    return

//****************************************
//* Remove Double Quotes from Value
//****************************************
!a1800_double_quotes
    do
        scan:/@Value/:/"/
        if (found) Value = '@left@@right@'
    until (!found)
    return

//****************************************
//* Compare files exactly
//****************************************
!b1800_Rpm_Compare_Compare_PBOBJ_Exact
    ReportLine = null
    BadCompare = 'No Differences'
    file CompareFile
    b
    do
        if  (ReportLine = null)
+          scan:/@line/:/[/
+          ReportLine = '@left@,'
+       endif
        if-1 (!eof)
+          scan:/@line/:/[/
+          Filename = left
+          scan:/@right/:/<= /
+          scan:/@right/:/[/
+          Server = left
+          scan:/@right/:/]/
+          Userid = left
+          Filename1 = 'RPM-data\@Server@\@Userid@\@Filename@'
+          f;1
+          if-2  (!eof)
+              scan:/@line/:/[/
+              Filename = left
+              scan:/@right/:/<= /
+              scan:/@right/:/[/
+              Server = left
+              scan:/@right/:/]/
+              Userid = left
+              Filename2 = 'RPM-data\@Server@\@Userid@\@Filename@'
+              close FC-Results error
+              system:"del RPM-Comp.dat"
+              open FC-Results null
+              Newline = 'fc @Filename1@ @Filename2@ > RPM-Comp.dat'
+              i:/@Newline/
+              i:/echo RPM-Comp.bat finished >beditexec.sem/
+              i:/exit/
+              write FC-Results RPM-Comp.bat
+              close FC-Results
+              MacroCommand = "systemcurr:'RPM-Comp.bat'"
+              $MacroCommand
+              open FC-Results RPM-Comp.dat
+              b
+              fs:/no differences/
+              if-3  (!eof)
+                  ReportLine = "@ReportLine@,"
+                  file CompareFile
+              else-3
+                  ReportLine = "@ReportLine@,Different from @Server@"
+                  BadCompare = 'Differences'
+                  file CompareFile
+       endif
    until (eof)
    file CompareReport
    f;*
    i:/@ReportLine@/
    MacroCommand = "rs:/,,/:/,@BadCompare@,/"
    $MacroCommand
    goto !b1800_Rpm_Compare_Compare_PBOBJ_write
    
//****************************************
//* Filter the File List
//****************************************
!b1810_Rpm_Compare_Filefilter_PBOBJ
    window obtain Rpm_Compare_Filefilter_EFOBJ
    //***************************
    //* Load the File list
    //***************************
    Rpm_Compare_File_LBOBJ = 'ALL'
    window delete Rpm_Compare_File_LBOBJ
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    do  
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Compare_File_LBOBJ = '@left@[@right@]'
+           if-2  (Rpm_Compare_Filefilter_EFOBJ = null)
+               window insert end default Rpm_Compare_File_LBOBJ
+           else-2
+               pattern on
+               case off
+               scan:/@Rpm_Compare_File_LBOBJ@/:/@Rpm_Compare_Filefilter_EFOBJ@/
+               case on
+               pattern off
+               if-3  (found)
+                   window insert end default Rpm_Compare_File_LBOBJ
+       endif
        f;1
    until (eof)
    close Filedata
    return

//****************************************
//* Filter the Server List
//****************************************
!b1820_Rpm_Compare_Serversfilter_PBOBJ
    window obtain Rpm_Compare_Serversfilter_EFOBJ
    //***************************
    //* Load the Servers list
    //***************************
    Rpm_Compare_Servers_LBOBJ = 'ALL'
    window delete Rpm_Compare_Servers_LBOBJ
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Compare_Servers_LBOBJ = left
+           scan:/@right/:/|/
+           Rpm_Compare_Servers_LBOBJ = '@Rpm_Compare_Servers_LBOBJ@[@left@]'
+           if-2  (Rpm_Compare_Serversfilter_EFOBJ = null) 
+               window insert end default Rpm_Compare_Servers_LBOBJ
+           else-2
+               pattern on
+               case off
+               scan:/@Rpm_Compare_Servers_LBOBJ@/:/@Rpm_Compare_Serversfilter_EFOBJ@/
+               case on
+               pattern off
+               if-3  (found)
+                   window insert end default Rpm_Compare_Servers_LBOBJ
+       endif
        f;1
    until (eof)
    close DNS
    return

//****************************************
//* Save a Compare Template
//****************************************
!b1830_Rpm_Compare_Save_PBOBJ
    window obtain Rpm_Compare_Template_EFOBJ

    //************************************
    //* Ensure the Template doesn't exist
    //************************************
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    SearchString = /@Rpm_Compare_Template_EFOBJ@|/
    b
    fs:/@SearchString/
    if-1 (!eof)
+      message = 'Do you want to modify the existing template @Rpm_Compare_Template_EFOBJ@'
+      window message question yesno
+      if-2  (message)
+          call !b1850_Rpm_Compare_Delete_PBOBJ_ok
+          open Template RPM-data\RPM-template.dat error open Template null
+      else-2
+          window setfocus Rpm_Compare_Template_EFOBJ
+          return
+   endif

    //************************************
    //* Insert the data into the Template file
    //************************************    
    file Template
    f;*
    file CompareFile
    b
    do
        if (!eof)
+          Newline = '@Rpm_Compare_Template_EFOBJ@|@line@'
+          file Template
+          i:/@Newline/
+          file CompareFile
+          f;1
+       endif    
    until (eof)
    write Template RPM-data\RPM-template.dat
    close Template

    //************************************
    //* Insert the Template in the Dropdown
    //************************************
    Rpm_Compare_Template_COOBJ = Rpm_Compare_Template_EFOBJ
    window insert end default Rpm_Compare_Template_COOBJ

    return

//****************************************
//* Get a Compare Template
//****************************************
!b1840_Rpm_Compare_Get_PBOBJ
    window obtain Rpm_Compare_Template_COOBJ
    if  (Rpm_Compare_Template_COOBJ = null)
+       message = 'Please select a Template'
+       window message warning ok
+       window setfocus Rpm_Compare_Template_COOBJ
+       return
+   endif

    Rpm_Compare_Template_EFOBJ = Rpm_Compare_Template_COOBJ
    window modify Rpm_Compare_Template_EFOBJ

    Rpm_Compare_Compare_LBOBJ = 'ALL'
    window delete Rpm_Compare_Compare_LBOBJ
    file CompareFile
    b
    d;*
 
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    b
    LineNumber = 0

    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Compare_Template_COOBJ)
+               Rpm_Compare_Compare_LBOBJ = right
+               LineNumber ++
+               LineNumberStr = '00@LineNumber@'
+               splitr:/@LineNumberStr@/;3
+               Rpm_Compare_Compare_LBOBJ = '@LineNumberStr@ @Rpm_Compare_Compare_LBOBJ@'
+               window insert end default Rpm_Compare_Compare_LBOBJ
+               file CompareFile
+               scan:/@Rpm_Compare_Compare_LBOBJ@/:word
+               Rpm_Compare_Compare_LBOBJ = right
+               i:/@Rpm_Compare_Compare_LBOBJ@/
+               file Template
+       endif
        f;1
    until (eof)    
    close Template
    //************************************
    //* Clear the Properties list
    //************************************
    Rpm_Compare_Properties_LBOBJ = 'ALL'
    window delete Rpm_Compare_Properties_LBOBJ
    Rpm_Compare_All_RBOBJ = 'Y' window modify Rpm_Compare_All_RBOBJ
    Rpm_Compare_Select_RBOBJ = 'N' window modify Rpm_Compare_Select_RBOBJ
    return

//****************************************
//* Delete a Compare Template
//****************************************
!b1850_Rpm_Compare_Delete_PBOBJ
    window obtain Rpm_Compare_Template_COOBJ
    if  (Rpm_Compare_Template_COOBJ = null)
+       message = 'Please select a Template'
+       window message warning ok
+       window setfocus Rpm_Compare_Template_COOBJ
+       return
+   endif

    message = 'Are you sure?'
    window message question yesno
    if (!message) return

!b1850_Rpm_Compare_Delete_PBOBJ_ok
 
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    b
    do
        if-1  (!eof)
+           scan:/@line/:/|/
+           if-2  (left = Rpm_Compare_Template_COOBJ)
+               d;1
+           else-2
+               f;1
+       endif
    until (eof)   
    write Template RPM-data\RPM-template.dat 

    //************************************
    //* Fill the Template Dropdown
    //************************************
    Rpm_Compare_Template_COOBJ = 'ALL'
    window delete Rpm_Compare_Template_COOBJ
    b
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Compare_Template_COOBJ = left
+               window insert end default Rpm_Compare_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template
    return

//****************************************
//* Move a Server line Up
//****************************************
!b1860_Rpm_Compare_Up_PBOBJ
    Rpm_Compare_Compare_LBOBJ = null
    window obtain Rpm_Compare_Compare_LBOBJ
    if  (Rpm_Compare_Compare_LBOBJ = null)
+       message = 'Please select a Compare line'
+       window message warning ok
+       window setfocus Rpm_Compare_Compare_LBOBJ
+       return
+   endif
    scan:/@Rpm_Compare_Compare_LBOBJ@/:word
    LineNumber = left
    LineNumber --
    Index = LineNumber
    file CompareFile
    b
    if  (LineNumber > 0) f;@LineNumber
    clear
    cut;1
    if  (!eof)
+       b;1
+   endif
    pasteb
    Rpm_Compare_Compare_LBOBJ = 'ALL'
    window delete Rpm_Compare_Compare_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Compare_Compare_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Compare_Compare_LBOBJ
+       endif
        f;1
    until (eof)

    //******************************
    //* Reselect the Line
    //******************************
    if  (Index < 1) Index = 1
    Rpm_Compare_Compare_LBOBJ = 'INDEX=@Index@'
    window select Rpm_Compare_Compare_LBOBJ
    Rpm_Compare_Compare_LBOBJ = null    

    return

//****************************************
//* Move a Server line Down
//****************************************
!b1870_Rpm_Compare_Down_PBOBJ
    Rpm_Compare_Compare_LBOBJ = null
    window obtain Rpm_Compare_Compare_LBOBJ
    if  (Rpm_Compare_Compare_LBOBJ = null)
+       message = 'Please select a Compare line'
+       window message warning ok
+       window setfocus Rpm_Compare_Compare_LBOBJ
+       return
+   endif
    scan:/@Rpm_Compare_Compare_LBOBJ@/:word
    LineNumber = left
    LineNumber --
    Index = LineNumber + 1
    file CompareFile
    b
    if  (LineNumber > 0) f;@LineNumber
    clear
    cut;1
    if (eof) Index --
    paste
    Rpm_Compare_Compare_LBOBJ = 'ALL'
    window delete Rpm_Compare_Compare_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Compare_Compare_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Compare_Compare_LBOBJ    
+       endif
        f;1
    until (eof)

    //******************************
    //* Reselect the Line
    //******************************
    Index ++
    Rpm_Compare_Compare_LBOBJ = 'INDEX=@Index@'
    window select Rpm_Compare_Compare_LBOBJ
    Rpm_Compare_Compare_LBOBJ = null  
    return

//****************************************
//* Filter the Template COOBJ
//****************************************
!b1880_Rpm_Compare_Templatefilter_PBOBJ
    window obtain Rpm_Compare_Template_EFOBJ

    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Compare_Template_COOBJ = left
+               window insert end default Rpm_Compare_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template

    //***************************
    //* Load the File list
    //***************************
    Rpm_Compare_Template_COOBJ = 'ALL'
    window delete Rpm_Compare_Template_COOBJ
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do  
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Compare_Template_COOBJ = left
+           if-2  (Rpm_Compare_Template_COOBJ != LastTemplate)
+               LastTemplate = Rpm_Compare_Template_COOBJ
+               if-3  (Rpm_Compare_Template_EFOBJ = null)
+                   window insert end default Rpm_Compare_Template_COOBJ
+               else-3
+                   pattern on
+                   case off
+                   scan:/@Rpm_Compare_Template_COOBJ@/:/@Rpm_Compare_Template_EFOBJ@/
+                   case on
+                   pattern off
+                   if-4  (found)
+                       window insert end default Rpm_Compare_Template_COOBJ
+       endif
        f;1
    until (eof)
    close Template
    return

//****************************************
//* Retrieve Properties
//****************************************
!b1885_Rpm_Compare_Retrieve_PBOBJ
    Rpm_Compare_File_LBOBJ = null
    window obtain Rpm_Compare_File_LBOBJ
    Rpm_Compare_Servers_LBOBJ = null
    window obtain Rpm_Compare_Servers_LBOBJ

    if  (Rpm_Compare_File_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Compare_File_LBOBJ
+       return
+   endif

    window obtain Rpm_Compare_Standard_CBOBJ
    if  (Rpm_Compare_Standard_CBOBJ)
+       call !b1886_standard
+       return
+   endif

    if  (Rpm_Compare_Servers_LBOBJ = null)
+       message = 'Please select a Server'
+       window message warning ok
+       window setfocus Rpm_Compare_Servers_LBOBJ
+       return
+   endif

    window pointer wait

    scan:/@Rpm_Compare_Servers_LBOBJ@/:/[/
    Server = left
    scan:/@right/:/]/
    Userid = left

!b1885_Rpm_Compare_Retrieve_PBOBJ_entry2
    Rpm_Compare_Select_RBOBJ = 'Y' window modify Rpm_Compare_Select_RBOBJ
    Rpm_Compare_All_RBOBJ = 'N' window modify Rpm_Compare_All_RBOBJ
    SearchString = '@Server@|@Userid@'
    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      window pointer arrow
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Download the File
    //***************************
    open RPM1 null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM1 rpm.bat
    close RPM1
    open RPM2 null
    FilenameFull = Rpm_Compare_File_LBOBJ
    scan:/@FilenameFull@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    Newline = 'cd @Directory@'
    i:/@Newline/
    MacroCommand = 'system:"del RPM-data\@Server@\@Userid@\@Filename@"' $MacroCommand
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline@/
    write RPM2 rpm2.bat
    close RPM2
    close RPM-results error
    open RPM-results null
    //message = 'ready to retrieve' window message info ok
    systemcurr:/rpm.bat/
    close RPM-results

    system:/del rpm-results.dat/
    system:/del rpm*.bat/

    //***************************
    //* Fill the Properties List
    //***************************
    Rpm_Compare_Properties_LBOBJ = 'ALL'
    window delete Rpm_Compare_Properties_LBOBJ
    close PropertyFile error
    MacroCommand = 'open PropertyFile RPM-data\@Server@\@Userid@\@Filename@ error return' $MacroCommand
    b
    scan:/@Filename@/:/.xml/
    if (found) 
+      call !x100_convert_xml
+      clear
+      b
+      copy;*
+      close PropertyFileFull error
+      open PropertyFileFull null
+      paste
+      b
+      file PropertyFile
+      b
+      call !x700_fix_xml_names_short
+   endif
    window obtain Rpm_Compare_Standard_CBOBJ
    file PropertyFile
    b
    do  
        if-1 (!eof)
+           scan:/@line/:/=/
+           if-2  (found)
+               Rpm_Compare_Properties_LBOBJ = left
+               window insert end default Rpm_Compare_Properties_LBOBJ
+       endif
        f;1
    until (eof) 
    close PropertyFile error 
    window pointer arrow
    return

//****************************************
//* Load the Properties List with just Standard elements
//****************************************
!b1886_standard
    Rpm_Compare_Properties_LBOBJ = 'ALL'
    window delete Rpm_Compare_Properties_LBOBJ
    Rpm_Compare_Properties_LBOBJ = null
    Rpm_Compare_Select_RBOBJ = 'Y' window modify Rpm_Compare_Select_RBOBJ
    Rpm_Compare_All_RBOBJ = 'N' window modify Rpm_Compare_All_RBOBJ 
    scan:/@Rpm_Compare_File_LBOBJ/:/[/
    Rpm_Compare_File_LBOBJ = left
    close StdProps error
    open StdProps RPM-data\RPM-prop.dat error open StdProps null
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Compare_File_LBOBJ)
+               scan:/@right/:/|/
+               if  (left = 'Standard')
+                   Rpm_Compare_Properties_LBOBJ = right
+                   window insert end default Rpm_Compare_Properties_LBOBJ
+       endif
        f;1
    until (eof)
    close StdProps
    return
 
//****************************************
//* Rpm_Compare_Close_PBOBJ Processing
//****************************************
!b1900_Rpm_Compare_Close_PBOBJ
    window close Rpm_Compare_WIN
    return

//****************************************
//* Double-click the compare file list
//****************************************
!b1910_Rpm_Compare_File_LBOBJ
    Rpm_Compare_File_LBOBJ = null
    window obtain Rpm_Compare_File_LBOBJ
    window obtain Rpm_Compare_Select_RBOBJ
    if  (Rpm_Compare_File_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Compare_File_LBOBJ
+       return
+   endif
    scan:/@Rpm_Compare_File_LBOBJ@/:/[/
    Rpm_Compare_File_LBOBJ = left

    //***********************************
    //* Load the Properties List
    //***********************************
    Rpm_Compare_Properties_LBOBJ = 'ALL'
    window delete Rpm_Compare_Properties_LBOBJ
    Rpm_Compare_Properties_LBOBJ = null

    window obtain Rpm_Compare_Standard_CBOBJ

    close Properties error
    open Properties RPM-data\RPM-Prop.dat error open Properties null
    b
    do
        if-1  (!eof)
+           scan:/@line/:/|/
+           if-2  (left = Rpm_Compare_File_LBOBJ)
+               scan:/@right/:/|/
+               Rpm_Compare_Properties_LBOBJ = right
+               if-3  (Rpm_Compare_Standard_CBOBJ)
+                   if-4  (left = 'Standard')
+                       window insert end default Rpm_Compare_Properties_LBOBJ
+           else-2
+               window insert end default Rpm_Compare_Properties_LBOBJ
+       endif
        file Properties
        f;1
    until (eof)
    close Properties

    return

//****************************************
//* Double-click the DNS List
//****************************************
!b1920_Rpm_Compare_Servers_LBOBJ
    Rpm_Compare_File_LBOBJ = null
    window obtain Rpm_Compare_File_LBOBJ
    if  (Rpm_Compare_File_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Compare_File_LBOBJ
+       return
+   endif

    Rpm_Compare_Servers_LBOBJ = null
    window obtain Rpm_Compare_Servers_LBOBJ
    if  (Rpm_Compare_Servers_LBOBJ = null)
+       message = 'Please select a Server'
+       window message warning ok
+       window setfocus Rpm_Compare_Servers_LBOBJ
+       return
+   endif

    Rpm_Compare_Compare_LBOBJ = Rpm_Compare_File_LBOBJ
    FieldSize = len(Rpm_Compare_File_LBOBJ)
    if   (FieldSize < 49)
+        size Rpm_Compare_Compare_LBOBJ,50
+   endif
    Rpm_Compare_Compare_LBOBJ = '@Rpm_Compare_Compare_LBOBJ@ <= @Rpm_Compare_Servers_LBOBJ@'

    file CompareFile
    b
    if  (!eof)
+       scan:/@Rpm_Compare_File_LBOBJ@/:/[/
+       Filename = left
+       scan:/@line/:/[/
+       if (Filename != left)
+          message = "Can't comare 2 different files"
+          window message warning ok
+          window setfocus Rpm_Compare_Servers_LBOBJ
+          return
+   endif
    fs:/@Rpm_Compare_Compare_LBOBJ@/
    if (!eof)
+      message = 'Compare already exists'
+      window message warning ok
+      window setfocus Rpm_Compare_Servers_LBOBJ
+      return
+   endif
    i:/@Rpm_Compare_Compare_LBOBJ@/

    Rpm_Compare_Compare_LBOBJ = 'ALL'
    window delete Rpm_Compare_Compare_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Compare_Compare_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Compare_Compare_LBOBJ    
+       endif
        f;1
    until (eof)
    return

//****************************************
//* Double-click Rpm_Compare_Compare_LBOBJ
//****************************************
!b1925_Rpm_Compare_Compare_LBOBJ
    Rpm_Compare_Compare_LBOBJ = null
    window obtain Rpm_Compare_Compare_LBOBJ
    if  (Rpm_Compare_Compare_LBOBJ = null)
+       message = 'Please select a Compare line'
+       window message warning ok
+       window setfocus Rpm_Compare_Compare_LBOBJ
+       return
+   endif

    scan:/@Rpm_Compare_Compare_LBOBJ/:word
    scan:/@right/:word
    FilenameFull = left
    scan:/@right/:word
    scan:/@right/:/[/
    Server = left
    scan:/@right/:/]/
    Userid = left
    scan:/@FilenameFull@/:/[/
    Filename = left
    Rpm_Compare_File_LBOBJ = FilenameFull
    //message = 'FilenameFull[@FilenameFull@] Server[@Server@] Userid[@Userid@]' window message info ok
    window pointer wait
    call !b1885_Rpm_Compare_Retrieve_PBOBJ_entry2
    return

//****************************************
//* Remove a line from the Compare list
//****************************************
!b1930_Rpm_Compare_Remove_PBOBJ
    window obtain Rpm_Compare_All_CBOBJ
    if  (Rpm_Compare_All_CBOBJ)
+       Rpm_Compare_All_CBOBJ = 'N'
+       window modify Rpm_Compare_All_CBOBJ
+       file CompareFile
+       b
+       d;*
+       //************************************
+       //* Clear the Properties list
+       //************************************
+       Rpm_Compare_Properties_LBOBJ = 'ALL'
+       window delete Rpm_Compare_Properties_LBOBJ
+       Rpm_Compare_All_RBOBJ = 'Y' window modify Rpm_Compare_All_RBOBJ
+       Rpm_Compare_Select_RBOBJ = 'N' window modify Rpm_Compare_Select_RBOBJ
+       goto !b1930_Rpm_Compare_Remove_PBOBJ_all
+       return
+   endif
    Rpm_Compare_Compare_LBOBJ = null
    window obtain Rpm_Compare_Compare_LBOBJ
    if  (Rpm_Compare_Compare_LBOBJ = null)
+       message = 'Please select a Compare line'
+       window message warning ok
+       window setfocus Rpm_Compare_Compare_LBOBJ
+       return
+   endif
    file CompareFile
    b
    scan:/@Rpm_Compare_Compare_LBOBJ@/:word
    fs:/@right@/
    if (eof)
+      message = 'Unable to locate Compare list line'
+      window message error ok
+      return
+   endif
    d

!b1930_Rpm_Compare_Remove_PBOBJ_all
    Rpm_Compare_Compare_LBOBJ = 'ALL'
    window delete Rpm_Compare_Compare_LBOBJ
    b
    do
        if (!eof)
+          Rpm_Compare_Compare_LBOBJ = line
+          window insert end default Rpm_Compare_Compare_LBOBJ
+          f;1
+       endif
    until (eof)
    Rpm_Compare_Compare_LBOBJ = 'INDEX=1'
    window select Rpm_Compare_Compare_LBOBJ
    Rpm_Compare_Compare_LBOBJ = null
    return

//****************************************
//* Download Files
//****************************************
!b1940_Rpm_Compare_Download_PBOBJ
    Rpm_Compare_File_LBOBJ = null
    Rpm_Compare_Properties_LBOBJ = null

    window obtain Rpm_Compare_WIN
    Rpm_Compare_Servers_LBOBJ = null 
    window obtain Rpm_Compare_Servers_LBOBJ
    if-1  (!Rpm_Compare_All_CBOBJ)
+       Rpm_Compare_Compare_LBOBJ = null
+       window obtain Rpm_Compare_Compare_LBOBJ
+       if-2  (Rpm_Compare_Compare_LBOBJ = null)
+           message = 'Please select a Compare line to Download'
+           window message info ok
+           window setfocus Rpm_Compare_Compare_LBOBJ
+           return
+       else-2
+           file CompareFile
+           b
+           scan:/@Rpm_Compare_Compare_LBOBJ/:word
+           fs:/@right/
+           if-3  (eof)
+               message = 'Unable to locate [@right@] in CompareFile'
+               window message error ok
+               return
+   else-1
+       Rpm_Compare_Compare_LBOBJ = 'INDEX=1'
+       window obtain Rpm_Compare_Compare_LBOBJ
+       if-4  (Rpm_Compare_Compare_LBOBJ = null)
+           message = 'Please create at least one Compare File/Server'
+           window message warning ok
+           window setfocus Rpm_Compare_Compare_LBOBJ
+           return
+   endif

    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif

    //************************************
    //* Setup Progress
    //************************************
    file CompareFile
    if  (Rpm_Compare_All_CBOBJ)
+       b
+       f;*
+       ProgressCount = pcount + 1 
+       b
+   else
+       ProgressCount = 1
+   endif

    call !p100_open_progress
    LastProcessed = null

!b1940_Rpm_Compare_Compare_PBOBJ_reenter
    //************************************
    //* Retrieve Files
    //************************************
    file CompareFile
    if (LastProcessed = line)
+      if  (!Rpm_Compare_All_CBOBJ)
+          f;*
+   endif
    if (LastProcessed = line)
+      f;1
+      if  (eof)
+          //call !p300_close_progress
+          ReenterFunction = '!b1940_Rpm_Compare_Compare_PBOBJ_done'
+          window timer on 0
+          return
+   endif
    LastProcessed = line
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    SearchString = '@Server@|@Userid@'
    Rpm_Progress_WIN = '@Filename@ <= @Server@[@Userid@]'
    window title Rpm_Progress_WIN

    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Create the RPM BAT files
    //***************************
    close RPM error
    open RPM null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM rpm.bat
    close RPM

    close RPM2 error
    open RPM2 null
    Newline = 'cd @Directory@'
    i:/@Newline@/
    SystemCommand = 'del RPM-data\@Server@\@Userid@\@Filename@'
    system:/@SystemCommand@/
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline/
    write RPM2 rpm2.bat
    close RPM2

    //*****************************
    //* Run BAT files to download
    //*****************************
    close RPM-results error
    open RPM-results null
    systemcurr:"RPM.bat"
    system:/del RPM*.bat/

    b
    //*****************************
    //* Any Files Downloaded?
    //*****************************
    fs:/get -r/
    if-1  (eof)
+       message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+       window message error yesno
+       if-2  (message)
+           write RPM-results rpm-results.dat
+           system:/start rpm-results.dat/
+           close RPM-results
+           call !p300_close_progress
+           return
+       else-2
+           close RPM-results
+           call !p300_close_progress
+           return
+   endif
    system:/del rpm-results.dat/

    //*****************************
    //* Check Errors on Downloaded Files
    //*****************************
    b
    do       
        fs:/get -r/
        if-1 (!eof)
+          f;1
+          scan:/@line/:/remote:/
+          if-2  (!found)
+              message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+              window message error yesno
+              if-3  (message)
+                  write RPM-results rpmresults.dat
+                  system:/start rpmresults.dat/
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+              else-3
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+       endif
    until (eof)
    //message = 'File @Filename@:@Directory from @Server@:@Userid@ successfully downloaded'
    //window message info ok

    close RPM-results
    system:/del rpmresults.dat/
    call !p200_show_progress

    if  (Rpm_Compare_All_CBOBJ)
+       ReenterFunction = '!b1940_Rpm_Compare_Compare_PBOBJ_reenter'
+   else
+       ReenterFunction = '!b1940_Rpm_Compare_Compare_PBOBJ_done'
+   endif
    window timer on 0
    return

!b1940_Rpm_Compare_Compare_PBOBJ_done
    call !p300_close_progress
    if-1  (!Rpm_Compare_All_CBOBJ)  
+       message = 'Open RPM-data\@Server@\@Userid@\@Filename@?' window message info yesnocancel
+       if-2  (message) 
+           MacroCommand = |system:"start RPM-data\@Server@\@Userid@\@Filename@"| $MacroCommand 
+           return 
+       else-2
+           return
+   endif

    file  CompareFile
    b
    do
        scan:/@line@/:/[/
        Filename = left
        scan:/@right/:/]/
        Directory = left
        scan:/@right/:/<=/
        scan:/@right/:/[/
        Server = left
        leftjust Server
        pack Server
        scan:/@right/:/]/
        Userid = left
        message = 'Open RPM-data\@Server@\@Userid@\@Filename@?' window message info yesnocancel
        if-1  (message = 'CANCEL') 
+           return
+       else-1
+           if-2 (message) 
+              MacroCommand = |system:"start RPM-data\@Server@\@Userid@\@Filename@"| $MacroCommand  
+       endif
        f;1
    until (eof)
    return

//****************************************
//* Close the Update window
//****************************************
!b2000_Rpm_Update_Close_PBOBJ
    window close Rpm_Update_WIN
    return

//****************************************
//* Retrieve Properties
//****************************************
!b2010_Rpm_Update_Retrieve_PBOBJ
    Rpm_Update_File_LBOBJ = null
    window obtain Rpm_Update_File_LBOBJ
    if (Rpm_Update_File_LBOBJ = null)
+      message = 'Please select a File'
+      window message warning ok
+      window setfocus Rpm_Update_File_LBOBJ
+      return
+   endif
    Rpm_Update_Servers_LBOBJ = null
    window obtain Rpm_Update_Servers_LBOBJ
    if (Rpm_Update_Servers_LBOBJ = null)
+      message = 'Please select a Server'
+      window message warning ok
+      window setfocus Rpm_Update_Servers_LBOBJ
+      return
+   endif

    FilenameFull = Rpm_Update_File_LBOBJ
    scan:/@Rpm_Update_File_LBOBJ@/:/[/
    Filename = left
   
    scan:/@Rpm_Update_Servers_LBOBJ@/:/[/
    Server = left
    scan:/@right/:/]/
    Userid = left

!b2010_Rpm_Update_Retrieve_PBOBJ_entry2
    SearchString = '@Server@|@Userid@'
    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      window pointer arrow
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    Rpm_Update_Properties_LBOBJ = 'ALL'
    window delete Rpm_Update_Properties_LBOBJ

    //***************************
    //* Download the File
    //***************************
    window pointer wait
    open RPM1 null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM1 rpm.bat
    close RPM1
    open RPM2 null
    scan:/@FilenameFull@/:/[/
    Filename = left
    scan:/@right@/:/]/
    Directory = left
    Newline = 'cd @Directory@'
    i:/@Newline/
    MacroCommand = 'system:"del RPM-data\@Server@\@Userid@\@Filename@"' $MacroCommand
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline@/
    write RPM2 rpm2.bat
    close RPM2
    close RPM-results error
    open RPM-results null
    systemcurr:/rpm.bat/
    close RPM-results

    system:/del rpm-results.dat/
    system:/del rpm*.bat/

    //***************************
    //* Fill the Properties List
    //***************************
    Rpm_Update_Properties_LBOBJ = 'ALL'
    window delete Rpm_Update_Properties_LBOBJ
    close PropertyFileValues error
    MacroCommand = 'open PropertyFileValues RPM-data\@Server@\@Userid@\@Filename@ error return' $MacroCommand
    scan:/@Filename@/:/.xml/
    if (found) 
+      call !x100_convert_xml
+      clear
+      b
+      copy;*
+      close PropertyFileFull error
+      open PropertyFileFull null
+      paste
+      b
+      file PropertyFileValues
+      b
+      call !x700_fix_xml_names_short
+   endif
    b
    do  
        if (!eof)
+           scan:/@line/:/=/
+           if (found)
+              Rpm_Update_Properties_LBOBJ = line
+              window insert end default Rpm_Update_Properties_LBOBJ
+       endif
        f;1
    until (eof) 
    Rpm_Update_Propertyvalue_EFOBJ = null
    window modify Rpm_Update_Propertyvalue_EFOBJ
    window pointer arrow
    return

//******************************
//* Filter the Update File list
//******************************
!b2020_Rpm_Update_Filefilter_PBOBJ
    window obtain Rpm_Update_Filefilter_EFOBJ
    //***************************
    //* Load the File list
    //***************************
    Rpm_Update_File_LBOBJ = 'ALL'
    window delete Rpm_Update_File_LBOBJ
    close Filedata error
    open Filedata RPM-data\RPM-File.dat error open Filedata null
    b
    do  
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Update_File_LBOBJ = '@left@[@right@]'
+           if-2  (Rpm_Update_Filefilter_EFOBJ = null)
+               window insert end default Rpm_Update_File_LBOBJ
+           else-2
+               pattern on
+               case off
+               scan:/@Rpm_Update_File_LBOBJ@/:/@Rpm_Update_Filefilter_EFOBJ@/
+               case on
+               pattern off
+               if-3  (found)
+                   window insert end default Rpm_Update_File_LBOBJ
+       endif
        f;1
    until (eof)
    close Filedata
    return

//****************************************
//* Filter the Server List
//****************************************
!b2030_Rpm_Update_Serversfilter_PBOBJ
    window obtain Rpm_Update_Serversfilter_EFOBJ
    //***************************
    //* Load the Servers list
    //***************************
    Rpm_Update_Servers_LBOBJ = 'ALL'
    window delete Rpm_Update_Servers_LBOBJ
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    do
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Update_Servers_LBOBJ = left
+           scan:/@right/:/|/
+           Rpm_Update_Servers_LBOBJ = '@Rpm_Update_Servers_LBOBJ@[@left@]'
+           if-2  (Rpm_Update_Serversfilter_EFOBJ = null) 
+               window insert end default Rpm_Update_Servers_LBOBJ
+           else-2
+               pattern on
+               case off
+               scan:/@Rpm_Update_Servers_LBOBJ@/:/@Rpm_Update_Serversfilter_EFOBJ@/
+               case on
+               pattern off
+               if-3  (found)
+                   window insert end default Rpm_Update_Servers_LBOBJ
+       endif
        f;1
    until (eof)
    close DNS
    return

//****************************************
//* Remove a line from the Update list
//****************************************
!b2040_Rpm_Update_Remove_PBOBJ
    window obtain Rpm_Update_All_CBOBJ
    if  (Rpm_Update_All_CBOBJ)
+       Rpm_Update_All_CBOBJ = 'N'
+       window modify Rpm_Update_All_CBOBJ
+       file UpdateFile
+       b
+       d;*
+       //************************************
+       //* Clear the Properties list
+       //************************************
+       Rpm_Update_Properties_LBOBJ = 'ALL'
+       window delete Rpm_Update_Properties_LBOBJ
+       Rpm_Update_All_RBOBJ = 'N' window modify Rpm_Update_All_RBOBJ
+       Rpm_Update_Select_RBOBJ = 'Y' window modify Rpm_Update_Select_RBOBJ
+       goto !b2040_Rpm_Update_Remove_PBOBJ_all
+       return
+   endif
    Rpm_Update_Update_LBOBJ = null
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please select a Update line'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif
    file UpdateFile
    b
    scan:/@Rpm_Update_Update_LBOBJ@/:word
    fs:/@right@/
    if (eof)
+      message = 'Unable to locate Update list line'
+      window message error ok
+      return
+   endif
    d

!b2040_Rpm_Update_Remove_PBOBJ_all
    Rpm_Update_Update_LBOBJ = 'ALL'
    window delete Rpm_Update_Update_LBOBJ
    b
    do
        if (!eof)
+          Rpm_Update_Update_LBOBJ = line
+          window insert end default Rpm_Update_Update_LBOBJ
+          f;1
+       endif
    until (eof)
    Rpm_Update_Update_LBOBJ = 'INDEX=1'
    window select Rpm_Update_Update_LBOBJ
    Rpm_Update_Update_LBOBJ = null
    return

//****************************************
//* Download Files
//****************************************
!b2045_Rpm_Update_Download_PBOBJ
    Rpm_Update_File_LBOBJ = null
    Rpm_Update_Properties_LBOBJ = null

    window obtain Rpm_Update_WIN
    Rpm_Update_Servers_LBOBJ = null 
    window obtain Rpm_Update_Servers_LBOBJ
    if-1  (!Rpm_Update_All_CBOBJ)
+       Rpm_Update_Update_LBOBJ = null
+       window obtain Rpm_Update_Update_LBOBJ
+       if-2  (Rpm_Update_Update_LBOBJ = null)
+           message = 'Please select an Update line to Download'
+           window message info ok
+           window setfocus Rpm_Update_Update_LBOBJ
+           return
+       else-2
+           file UpdateFile
+           b
+           scan:/@Rpm_Update_Update_LBOBJ/:word
+           fs:/@right/
+           if-3  (eof)
+               message = 'Unable to locate [@right@] in UpdateFile'
+               window message error ok
+               return
+   else-1
+       Rpm_Update_Update_LBOBJ = 'INDEX=1'
+       window obtain Rpm_Update_Update_LBOBJ
+       if-4  (Rpm_Update_Update_LBOBJ = null)
+           message = 'Please create at least one Update File/Server'
+           window message warning ok
+           window setfocus Rpm_Update_Update_LBOBJ
+           return
+   endif

    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif

    //************************************
    //* Setup Progress
    //************************************
    file UpdateFile
    if  (Rpm_Update_All_CBOBJ)
+       b
+       f;*
+       ProgressCount = pcount + 1 
+       b
+   else
+       ProgressCount = 1
+   endif

    call !p100_open_progress
    LastProcessed = null

!b2045_Rpm_Update_Update_PBOBJ_reenter
    //************************************
    //* Retrieve Files
    //************************************
    file UpdateFile
    if (LastProcessed = line)
+      if  (!Rpm_Update_All_CBOBJ)
+          f;*
+   endif
    if (LastProcessed = line)
+      f;1
+      if  (eof)
+          //call !p300_close_progress
+          ReenterFunction = '!b2045_Rpm_Update_Update_PBOBJ_done'
+          window timer on 0
+          return
+   endif
    LastProcessed = line
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    SearchString = '@Server@|@Userid@'
    Rpm_Progress_WIN = '@Filename@ <= @Server@[@Userid@]'
    window title Rpm_Progress_WIN

    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Create the RPM BAT files
    //***************************
    close RPM error
    open RPM null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM rpm.bat
    close RPM

    close RPM2 error
    open RPM2 null
    Newline = 'cd @Directory@'
    i:/@Newline@/
    SystemCommand = 'del RPM-data\@Server@\@Userid@\@Filename@'
    system:/@SystemCommand@/
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline/
    write RPM2 rpm2.bat
    close RPM2

    //*****************************
    //* Run BAT files to download
    //*****************************
    close RPM-results error
    open RPM-results null
    systemcurr:"RPM.bat"
    system:/del RPM*.bat/

    b
    //*****************************
    //* Any Files Downloaded?
    //*****************************
    fs:/get -r/
    if-1  (eof)
+       message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+       window message error yesno
+       if-2  (message)
+           write RPM-results rpm-results.dat
+           system:/start rpm-results.dat/
+           close RPM-results
+           call !p300_close_progress
+           return
+       else-2
+           close RPM-results
+           call !p300_close_progress
+           return
+   endif
    system:/del rpm-results.dat/

    //*****************************
    //* Check Errors on Downloaded Files
    //*****************************
    b
    do       
        fs:/get -r/
        if-1 (!eof)
+          f;1
+          scan:/@line/:/remote:/
+          if-2  (!found)
+              message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+              window message error yesno
+              if-3  (message)
+                  write RPM-results rpmresults.dat
+                  system:/start rpmresults.dat/
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+              else-3
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+       endif
    until (eof)
    //message = 'File @Filename@:@Directory from @Server@:@Userid@ successfully downloaded'
    //window message info ok

    close RPM-results
    system:/del rpmresults.dat/
    call !p200_show_progress

    if  (Rpm_Update_All_CBOBJ)
+       ReenterFunction = '!b2045_Rpm_Update_Update_PBOBJ_reenter'
+   else
+       ReenterFunction = '!b2045_Rpm_Update_Update_PBOBJ_done'
+   endif
    window timer on 0
    return

!b2045_Rpm_Update_Update_PBOBJ_done
    call !p300_close_progress
    if-1  (!Rpm_Update_All_CBOBJ)  
+       message = 'Open RPM-data\@Server@\@Userid@\@Filename@?' window message info yesnocancel
+       if-2  (message) 
+           MacroCommand = |system:"start RPM-data\@Server@\@Userid@\@Filename@"| $MacroCommand 
+           return 
+       else-2
+           return
+   endif

    file  UpdateFile
    b
    do
        scan:/@line@/:/[/
        Filename = left
        scan:/@right/:/]/
        Directory = left
        scan:/@right/:/<=/
        scan:/@right/:/[/
        Server = left
        leftjust Server
        pack Server
        scan:/@right/:/]/
        Userid = left
        message = 'Open RPM-data\@Server@\@Userid@\@Filename@?' window message info yesnocancel
        if-1  (message = 'CANCEL') 
+           return
+       else-1
+           if-2 (message) 
+              MacroCommand = |system:"start RPM-data\@Server@\@Userid@\@Filename@"| $MacroCommand  
+       endif
        f;1
    until (eof)
    return

//****************************************
//* Move a Server line Up
//****************************************
!b2050_Rpm_Update_Up_PBOBJ
    Rpm_Update_Update_LBOBJ = null
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please select a Update line'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif
    scan:/@Rpm_Update_Update_LBOBJ@/:word
    LineNumber = left
    LineNumber --
    Index = LineNumber
    file UpdateFile
    b
    if  (LineNumber > 0) f;@LineNumber
    clear
    cut;1
    if  (!eof)
+       b;1
+   endif
    pasteb
    Rpm_Update_Update_LBOBJ = 'ALL'
    window delete Rpm_Update_Update_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Update_Update_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Update_Update_LBOBJ
+       endif
        f;1
    until (eof)

    //******************************
    //* Reselect the Line
    //******************************
    if  (Index < 1) Index = 1
    Rpm_Update_Update_LBOBJ = 'INDEX=@Index@'
    window select Rpm_Update_Update_LBOBJ
    Rpm_Update_Update_LBOBJ = null    

    return

//****************************************
//* Move a Server line Down
//****************************************
!b2060_Rpm_Update_Down_PBOBJ
    Rpm_Update_Update_LBOBJ = null
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please select a Update line'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif
    scan:/@Rpm_Update_Update_LBOBJ@/:word
    LineNumber = left
    LineNumber --
    Index = LineNumber + 1
    file UpdateFile
    b
    if  (LineNumber > 0) f;@LineNumber
    clear
    cut;1
    if (eof) Index --
    paste
    Rpm_Update_Update_LBOBJ = 'ALL'
    window delete Rpm_Update_Update_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Update_Update_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Update_Update_LBOBJ    
+       endif
        f;1
    until (eof)

    //******************************
    //* Reselect the Line
    //******************************
    Index ++
    Rpm_Update_Update_LBOBJ = 'INDEX=@Index@'
    window select Rpm_Update_Update_LBOBJ
    Rpm_Update_Update_LBOBJ = null  
    return

//****************************************
//* Filter the Template COOBJ
//****************************************
!b2070_Rpm_Update_Templatefilter_PBOBJ
    window obtain Rpm_Update_Template_EFOBJ

    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Update_Template_COOBJ = left
+               window insert end default Rpm_Update_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template

    //***************************
    //* Load the File list
    //***************************
    Rpm_Update_Template_COOBJ = 'ALL'
    window delete Rpm_Update_Template_COOBJ
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    LastTemplate = null
    b
    do  
        if-1  (!eof)
+           scan:/@line/:/|/
+           Rpm_Update_Template_COOBJ = left
+           if-2  (Rpm_Update_Template_COOBJ != LastTemplate)
+               LastTemplate = Rpm_Update_Template_COOBJ
+               if-3  (Rpm_Update_Template_EFOBJ = null)
+                   window insert end default Rpm_Update_Template_COOBJ
+               else-3
+                   pattern on
+                   case off
+                   scan:/@Rpm_Update_Template_COOBJ@/:/@Rpm_Update_Template_EFOBJ@/
+                   case on
+                   pattern off
+                   if-4  (found)
+                       window insert end default Rpm_Update_Template_COOBJ
+       endif
        f;1
    until (eof)
    close Template
    return

//****************************************
//* Save a Update Template
//****************************************
!b2080_Rpm_Update_Save_PBOBJ
    window obtain Rpm_Update_Template_EFOBJ

    //************************************
    //* Ensure the Template doesn't exist
    //************************************
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    SearchString = /@Rpm_Update_Template_EFOBJ@|/
    b
    fs:/@SearchString/
    if-1 (!eof)
+      message = 'Do you want to modify the existing template @Rpm_Update_Template_EFOBJ@'
+      window message question yesno
+      if-2  (message)
+          call !b2095_Rpm_Update_Delete_PBOBJ_ok
+          open Template RPM-data\RPM-template.dat error open Template null
+      else-2
+          window setfocus Rpm_Update_Template_EFOBJ
+          return
+   endif

    //************************************
    //* Insert the data into the Template file
    //************************************    
    file Template
    f;*
    file UpdateFile
    b
    do
        if (!eof)
+          Newline = '@Rpm_Update_Template_EFOBJ@|@line@'
+          file Template
+          i:/@Newline/
+          file UpdateFile
+          f;1
+       endif    
    until (eof)
    write Template RPM-data\RPM-template.dat
    close Template

    //************************************
    //* Insert the Template in the Dropdown
    //************************************
    Rpm_Update_Template_COOBJ = Rpm_Update_Template_EFOBJ
    window insert end default Rpm_Update_Template_COOBJ

    return

//****************************************
//* Get a Update Template
//****************************************
!b2090_Rpm_Update_Get_PBOBJ
    window obtain Rpm_Update_Template_COOBJ
    if  (Rpm_Update_Template_COOBJ = null)
+       message = 'Please select a Template'
+       window message warning ok
+       window setfocus Rpm_Update_Template_COOBJ
+       return
+   endif

    Rpm_Update_Template_EFOBJ = Rpm_Update_Template_COOBJ
    window modify Rpm_Update_Template_EFOBJ

    Rpm_Update_Update_LBOBJ = 'ALL'
    window delete Rpm_Update_Update_LBOBJ
    file UpdateFile
    b
    d;*
 
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    b
    LineNumber = 0

    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left = Rpm_Update_Template_COOBJ)
+               Rpm_Update_Update_LBOBJ = right
+               LineNumber ++
+               LineNumberStr = '00@LineNumber@'
+               splitr:/@LineNumberStr@/;3
+               Rpm_Update_Update_LBOBJ = '@LineNumberStr@ @Rpm_Update_Update_LBOBJ@'
+               window insert end default Rpm_Update_Update_LBOBJ
+               file UpdateFile
+               scan:/@Rpm_Update_Update_LBOBJ@/:word
+               Rpm_Update_Update_LBOBJ = right
+               i:/@Rpm_Update_Update_LBOBJ@/
+               file Template
+       endif
        f;1
    until (eof)    
    close Template
    //************************************
    //* Clear the Properties list
    //************************************
    Rpm_Update_Properties_LBOBJ = 'ALL'
    window delete Rpm_Update_Properties_LBOBJ
    Rpm_Update_All_RBOBJ = 'N' window modify Rpm_Update_All_RBOBJ
    Rpm_Update_Select_RBOBJ = 'Y' window modify Rpm_Update_Select_RBOBJ
    window disable Rpm_Update_Compare_PBOBJ
    return

//****************************************
//* Delete a Update Template
//****************************************
!b2095_Rpm_Update_Delete_PBOBJ
    window obtain Rpm_Update_Template_COOBJ
    if  (Rpm_Update_Template_COOBJ = null)
+       message = 'Please select a Template'
+       window message warning ok
+       window setfocus Rpm_Update_Template_COOBJ
+       return
+   endif

    message = 'Are you sure?'
    window message question yesno
    if (!message) return

!b2095_Rpm_Update_Delete_PBOBJ_ok
 
    close Template error
    open Template RPM-data\RPM-template.dat error open Template null
    b
    do
        if-1  (!eof)
+           scan:/@line/:/|/
+           if-2  (left = Rpm_Update_Template_COOBJ)
+               d;1
+           else-2
+               f;1
+       endif
    until (eof)   
    write Template RPM-data\RPM-template.dat 

    //************************************
    //* Fill the Template Dropdown
    //************************************
    Rpm_Update_Template_COOBJ = 'ALL'
    window delete Rpm_Update_Template_COOBJ
    b
    LastTemplate = null
    b
    do
        if  (!eof)
+           scan:/@line/:/|/
+           if  (left != LastTemplate)
+               LastTemplate = left
+               Rpm_Update_Template_COOBJ = left
+               window insert end default Rpm_Update_Template_COOBJ
+       endif
        f;1
    until (eof)    
    close Template
    return

//****************************************
//* Double-click the Update list
//****************************************
!b2097_Rpm_Update_Update_LBOBJ
    Rpm_Update_Update_LBOBJ = null
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please select a Update line'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif

    scan:/@Rpm_Update_Update_LBOBJ/:word
    scan:/@right/:word
    FilenameFull = left
    scan:/@right/:word
    scan:/@right/:/[/
    Server = left
    scan:/@right/:/]/
    Userid = left
    scan:/@FilenameFull@/:/[/
    Filename = left
    Rpm_Update_File_LBOBJ = FilenameFull
    //message = 'FilenameFull[@FilenameFull@] Server[@Server@] Userid[@Userid@]' window message info ok
    window pointer wait
    call !b2010_Rpm_Update_Retrieve_PBOBJ_entry2
    Rpm_Update_Propertyvalue_EFOBJ = null
    window modify Rpm_Update_Propertyvalue_EFOBJ
    return

//****************************************
//* Double-click the Properties List
//****************************************
!b2098_Rpm_Update_Properties_LBOBJ
    Rpm_Update_Properties_LBOBJ = null
    window obtain Rpm_Update_Properties_LBOBJ
    if (Rpm_Update_Properties_LBOBJ = null)
+      message = 'Please select a Property'
+      window message info ok
+      window setfocus Rpm_Update_Properties_LBOBJ
+      return
+   endif
    scan:/@Rpm_Update_Properties_LBOBJ/:/=/
    Rpm_Update_Propertyvalue_EFOBJ = right
    window modify Rpm_Update_Propertyvalue_EFOBJ
    return

//****************************************
//* Update Change Push Button
//****************************************
!b2099_Rpm_Update_Change_PBOBJ
    Rpm_Update_Properties_LBOBJ = 'INDEX'
    window obtain Rpm_Update_Properties_LBOBJ
    Index = Rpm_Update_Properties_LBOBJ
    Rpm_Update_Properties_LBOBJ = null
    window obtain Rpm_Update_Properties_LBOBJ
    if (Rpm_Update_Properties_LBOBJ = null)
+      message = 'Please select a Property'
+      window message info ok
+      window setfocus Rpm_Update_Properties_LBOBJ
+      return
+   endif
    window obtain Rpm_Update_Propertyvalue_EFOBJ
    scan:/@Rpm_Update_Properties_LBOBJ/:/=/
    SearchString = '@left@='
    file PropertyFileValues error return
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to locate Property [@left@] in PropertyFile'
+      window message error ok
+      return
+   endif
    Newline = '@left@=@Rpm_Update_Propertyvalue_EFOBJ@'
    r:/@Newline@/
    Rpm_Update_Properties_LBOBJ = 'ALL'
    window delete Rpm_Update_Properties_LBOBJ
    b
    do
        if  (!eof)
+           scan:/@line/:/=/
+           if  (found)
+               Rpm_Update_Properties_LBOBJ = line
+               window insert end default Rpm_Update_Properties_LBOBJ
+       endif
        f;1
    until (eof)
    Rpm_Update_Propertyvalue_EFOBJ = null
    window modify Rpm_Update_Propertyvalue_EFOBJ
    return

//****************************************
//* Double-click the Servers List
//****************************************
!b2100_Rpm_Update_Servers_LBOBJ
    Rpm_Update_File_LBOBJ = null
    window obtain Rpm_Update_File_LBOBJ
    if  (Rpm_Update_File_LBOBJ = null)
+       message = 'Please select a File'
+       window message warning ok
+       window setfocus Rpm_Update_File_LBOBJ
+       return
+   endif

    Rpm_Update_Servers_LBOBJ = null
    window obtain Rpm_Update_Servers_LBOBJ
    if  (Rpm_Update_Servers_LBOBJ = null)
+       message = 'Please select a Server'
+       window message warning ok
+       window setfocus Rpm_Update_Servers_LBOBJ
+       return
+   endif

    Rpm_Update_Update_LBOBJ = Rpm_Update_File_LBOBJ
    FieldSize = len(Rpm_Update_File_LBOBJ)
    if   (FieldSize < 49)
+        size Rpm_Update_Update_LBOBJ,50
+   endif
    Rpm_Update_Update_LBOBJ = '@Rpm_Update_Update_LBOBJ@ <= @Rpm_Update_Servers_LBOBJ@'

    file UpdateFile
    b
    if  (!eof)
+       scan:/@Rpm_Update_File_LBOBJ@/:/[/
+       Filename = left
+       scan:/@line/:/[/
+       if (Filename != left)
+          message = "Can't comare 2 different files"
+          window message warning ok
+          window setfocus Rpm_Update_Servers_LBOBJ
+          return
+   endif
    fs:/@Rpm_Update_Update_LBOBJ@/
    if (!eof)
+      message = 'Update already exists'
+      window message warning ok
+      window setfocus Rpm_Update_Servers_LBOBJ
+      return
+   endif
    i:/@Rpm_Update_Update_LBOBJ@/

    Rpm_Update_Update_LBOBJ = 'ALL'
    window delete Rpm_Update_Update_LBOBJ
    b
    LineNumber = 0
    do
        if (!eof)
+          LineNumber ++
+          LineNumberStr = '00@LineNumber@'
+          splitr:/@LineNumberStr@/;3
+          Rpm_Update_Update_LBOBJ = '@LineNumberStr@ @line@'
+          window insert end default Rpm_Update_Update_LBOBJ    
+       endif
        f;1
    until (eof)
    return

//****************************************
//* Update Button Processing
//****************************************
!b2200_Rpm_Update_Update_PBOBJ
    Rpm_Update_File_LBOBJ = null
    Rpm_Update_Properties_LBOBJ = null
    Rpm_Update_Servers_LBOBJ = null
    window obtain Rpm_Update_WIN
    Rpm_Update_Update_LBOBJ = 'INDEX=1'
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please create at least one Update File/Server'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif
    Rpm_Update_Properties_LBOBJ = 'FIRST'
    window obtain Rpm_Update_Properties_LBOBJ
    if  (Rpm_Update_Properties_LBOBJ = null)
+       message = 'Please select at least 1 Property to Update'
+       window message warning ok
+       window setfocus Rpm_Update_Properties_LBOBJ
+       return
+   endif

    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif
    ReportLine = null

    //************************************
    //* Setup Progress
    //************************************
    file UpdateFile
    b
    f;*
    ProgressCount = pcount + 1 
    call !p100_open_progress
    b
    LastProcessed = null

!b2200_Rpm_Update_Update_PBOBJ_reenter
    //************************************
    //* Retrieve Files
    //************************************
    file UpdateFile
    if (LastProcessed = line)
+      f;1
+      if  (eof)
+          //call !p300_close_progress
+          ReenterFunction = '!b2200_Rpm_Update_Update_PBOBJ_done'
+          window timer on 0
+          return
+   endif
    LastProcessed = line
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    SearchString = '@Server@|@Userid@'
    Rpm_Progress_WIN = '@Filename@ <= @Server@[@Userid@]'
    window title Rpm_Progress_WIN
    if  (ReportLine = null)
+       ReportLine = "@Filename@[@Directory@] Properties,Update"
+   endif
    ReportLine = '@ReportLine@,@Server@[@Userid@]'

    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Create the RPM BAT files
    //***************************
    close RPM error
    open RPM null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM rpm.bat
    close RPM

    close RPM2 error
    open RPM2 null
    Newline = 'cd @Directory@'
    i:/@Newline@/
    SystemCommand = 'del RPM-data\@Server@\@Userid@\@Filename@'
    system:/@SystemCommand@/
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline/
    write RPM2 rpm2.bat
    close RPM2

    //*****************************
    //* Run BAT files to download
    //*****************************
    close RPM-results error
    open RPM-results null
    systemcurr:"RPM.bat"
    system:/del RPM*.bat/

    b
    //*****************************
    //* Any Files Downloaded?
    //*****************************
    fs:/get -r/
    if-1  (eof)
+       message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+       window message error yesno
+       if-2  (message)
+           write RPM-results rpm-results.dat
+           system:/start rpm-results.dat/
+           close RPM-results
+           call !p300_close_progress
+           return
+       else-2
+           close RPM-results
+           call !p300_close_progress
+           return
+   endif
    system:/del rpm-results.dat/

    //*****************************
    //* Check Errors on Downloaded Files
    //*****************************
    b
    do       
        fs:/get -r/
        if-1 (!eof)
+          f;1
+          scan:/@line/:/remote:/
+          if-2  (!found)
+              message = 'Errors reading file @Filename@:@Directory@ from @Server@:@Userid@, show details?'
+              window message error yesno
+              if-3  (message)
+                  write RPM-results rpmresults.dat
+                  system:/start rpmresults.dat/
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+              else-3
+                  close RPM-results
+                  call !p300_close_progress
+                  return
+       endif
    until (eof)
    //message = 'File @Filename@:@Directory from @Server@:@Userid@ successfully downloaded'
    //window message info ok

    close RPM-results
    system:/del rpmresults.dat/

    //************************************
    //* Update the Downloaded File
    //************************************
    close DownloadFile error
    MacroCommand = "open DownloadFile RPM-data\@Server@\@Userid@\@Filename@" $MacroCommand
    Rpm_Update_Properties_LBOBJ = 'FIRST'
    window obtain Rpm_Update_Properties_LBOBJ
    do
        scan:/@Rpm_Update_Properties_LBOBJ/:/=/
        PropertyName = left
        PropertyValue = right
        b
        SearchString = '@PropertyName@='
        fs:/@SearchString@/
        if  (eof)
+           message = 'Unable to locate property [@PropertyValue@] in RPM-data\@Server@\@Userid@\@Filename@'
+           window message warning ok
+       else
+           scan:/@line/:/@SearchString@/
+           Newline = '@left@@SearchString@@PropertyValue@'
+           r:/@Newline@/
+       endif
        Rpm_Update_Properties_LBOBJ = 'NEXT'
        window obtain Rpm_Update_Properties_LBOBJ
    until (Rpm_Update_Properties_LBOBJ = null)
    MacroCommand = "write DownloadFile RPM-data\@Server@\@Userid@\@Filename@" $MacroCommand
    close DownloadFile

    call !p200_show_progress
    ReenterFunction = '!b2200_Rpm_Update_Update_PBOBJ_reenter'
    window timer on 0
    return

!b2200_Rpm_Update_Update_PBOBJ_done
    //message = 'files downloaded' window message info ok
    call !p300_close_progress
    message = 'The local files under RPM-data have been updated' window message info ok
    window enable Rpm_Update_Compare_PBOBJ
    return

//****************************************
//* Rpm_Update_Compare_PBOBJ Processing
//****************************************
!b2300_Rpm_Update_Compare_PBOBJ
    Rpm_Update_File_LBOBJ = null
    Rpm_Update_Properties_LBOBJ = null
    Rpm_Update_Servers_LBOBJ = null
    window obtain Rpm_Update_WIN
    Rpm_Update_Update_LBOBJ = 'INDEX=1'
    window obtain Rpm_Update_Update_LBOBJ
    if  (Rpm_Update_Update_LBOBJ = null)
+       message = 'Please create at least one Compare File/Server'
+       window message warning ok
+       window setfocus Rpm_Update_Update_LBOBJ
+       return
+   endif
    if  (Rpm_Update_Select_RBOBJ)
+       if  (Rpm_Update_Properties_LBOBJ = null)
+           message = 'Please select at least 1 Property when comparing Standard Properties'
+           window message warning ok
+           window setfocus Rpm_Update_Properties_LBOBJ
+           return
+   endif

    if  (!exists RPM-data)
+       system:"md RPM-data"
+   endif
    ReportLine = null

    //************************************
    //* Setup Progress
    //************************************
    file UpdateFile
    b
    f;*
    ProgressCount = pcount + 1 
    call !p100_open_progress
    b
    LastProcessed = null

!b2300_Rpm_Update_Compare_PBOBJ_reenter
    //************************************
    //* Retrieve Files
    //************************************
    file UpdateFile
    if (LastProcessed = line)
+      f;1
+      if  (eof)
+          //call !p300_close_progress
+          ReenterFunction = '!b2300_Rpm_Update_Compare_PBOBJ_done'
+          window timer on 0
+          return
+   endif
    LastProcessed = line
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    SearchString = '@Server@|@Userid@'
    Rpm_Progress_WIN = '@Filename@ <= @Server@[@Userid@]'
    window title Rpm_Progress_WIN
    if  (ReportLine = null)
+       ReportLine = "@Filename@[@Directory@] Properties,Compare"
+   endif
    ReportLine = '@ReportLine@,@Server@[@Userid@]'

    //***************************
    //* Get the Server Password
    //***************************
    close DNS error
    open DNS RPM-data\RPM-dns.dat error open DNS null
    b
    fs:/@SearchString@/
    if (eof)
+      message = 'Unable to find Server data line [@SearchString@]'
+      window message error ok
+      return
+   endif
    scanr:/@line/:/|/
    Password = right
    decrypt Password
    close DNS

    MacroCommand = 'if (!exists RPM-data\@Server@) system:"md RPM-data\@Server@' $MacroCommand
    MacroCommand = 'if (!exists RPM-data\@Server@\@Userid@) system:"md RPM-data\@Server@\@Userid@' $MacroCommand

    //***************************
    //* Create the RPM BAT files
    //***************************
    close RPM error
    open RPM null
    subs & Newline = 'psftp &Userid&@&Server& -bc -batch -pw &Password& -b rpm2.bat' subs @
    i:/@Newline@/
    i:/echo RPM.bat finished >beditexec.sem/
    i:/exit/
    write RPM rpm.bat
    close RPM

    close RPM2 error
    open RPM2 null
    Newline = 'cd @Directory@'
    i:/@Newline@/
    //SystemCommand = 'del RPM-data\@Server@\@Userid@\@Filename@'
    //system:/@SystemCommand@/
    Newline = 'get -r @Filename@ RPM-data\@Server@\@Userid@\@Filename@'
    i:/@Newline/
    write RPM2 rpm2.bat
    close RPM2

    //*****************************
    //* Run BAT files to download
    //*****************************
    close RPM-results error
    open RPM-results null
    //systemcurr:"RPM.bat"
    //system:/del RPM*.bat/

    call !p200_show_progress
    ReenterFunction = '!b2300_Rpm_Update_Compare_PBOBJ_reenter'
    window timer on 0
    return

!b2300_Rpm_Update_Compare_PBOBJ_done
    //message = 'files downloaded' window message info ok
    close CompareReport error
    open CompareReport null
    i:/@ReportLine@/
    //***************************************************
    //* PropertiesFile contains Properties selected in list
    //***************************************************
    open PropertiesFile null

    if  (Rpm_Update_All_RBOBJ)
+       goto !b2300_Rpm_Update_Compare_PBOBJ_uncontrolled
+   endif

    Rpm_Update_Properties_LBOBJ = 'FIRST'
    do
        window obtain Rpm_Update_Properties_LBOBJ
        //message = Rpm_Update_Properties_LBOBJ window message info ok
        //****************************************
        //* Replace LB selection with Full XPath entry for XML files
        //****************************************
        if  (Rpm_Update_Properties_LBOBJ != null)
+           scan:/@Rpm_Update_Properties_LBOBJ@/:/=/
+           Rpm_Update_Properties_LBOBJ = left
+           scan:/@Filename@/:/.xml/
+           if (found)
+             scan:/@Rpm_Update_Properties_LBOBJ/:/:/
+             SearchString = '<@left@>:@right@'
+             //message = '[@SearchString@]' window message info ok
+             file PropertyFileFull
+             b
+             fs:/@SearchString/
+             if  (!eof)
+                 scan:/@line/:/=/
+                 Rpm_Update_Properties_LBOBJ = left
+                 //message = 'Property[@line@]' window message info ok
+       endif

        //****************************************
        //* Only keep the LB selections
        //****************************************
        if  (Rpm_Update_Properties_LBOBJ != null)
+           file PropertiesFile
+           i:/@Rpm_Update_Properties_LBOBJ@/
+           file CompareReport
+           i:/@Rpm_Update_Properties_LBOBJ@/
+           Rpm_Update_Properties_LBOBJ = 'NEXT'
+       endif
    until (Rpm_Update_Properties_LBOBJ = null)

    file UpdateFile
    b
    goto !b2300_Rpm_Update_Compare_PBOBJ_fileloop

!b2300_Rpm_Update_Compare_PBOBJ_uncontrolled
    //****************************************
    //* Fill the PropertiesFile with
    //* every entry in the first PropertyFile
    //****************************************
    file UpdateFile
    b
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    Filename = 'RPM-data\@Server@\@Userid@\@Filename@'
    open PropertyFile @Filename error message = 'Unable to open @Filename@' window message warning ok call !p300_close_progress return
    scan:/@Filename/:/.xml/
    if (found)
+      call !x100_convert_xml
+   endif
    b
    do
        scan:/@line/:/=/
        if  (found)
+           file PropertiesFile
+           i:/@left@/
+           file CompareReport
+           i:/@left@/
+       endif
        file PropertyFile
        f;1
    until (eof)
    close PropertyFile
    file UpdateFile
    b

!b2300_Rpm_Update_Compare_PBOBJ_fileloop
    scan:/@line@/:/[/
    Filename = left
    scan:/@right/:/]/
    Directory = left
    scan:/@right/:/<=/
    scan:/@right/:/[/
    Server = left
    leftjust Server
    pack Server
    scan:/@right/:/]/
    Userid = left
    Filename = 'RPM-data\@Server@\@Userid@\@Filename@'
    //***************************************************
    //* PropertiesFile is the downloaded property file
    //***************************************************
    open PropertyFile @Filename error message = 'Unable to open @Filename@' window message warning ok  call !p300_close_progress return
    scan:/@Filename/:/.xml/
    if (found)
+      call !x100_convert_xml
+   endif
    file CompareReport
    b
    f;1

    file PropertiesFile
    b
    do
        SearchString = '@line@='
        file PropertyFile 
        b
        fs:/@SearchString/
        if (!eof)
+          scan:/@line/:/@SearchString/
+          Value = right
+          call !b2300_double_quotes
+          d;1
+          file CompareReport
+          Newline = '@line@,"@Value@"'
+          r:/@Newline@/
+       else
+          file CompareReport
+          Newline = '@line@,'
+          r:/@Newline@/
+       endif
        file CompareReport
        f;1
        file PropertiesFile
        f;1
    until (eof)    
    close PropertyFile
    file UpdateFile
    f;1
    if (!eof)
+      goto !b2300_Rpm_Update_Compare_PBOBJ_fileloop
+   endif
    close PropertiesFile
    //************************************
    //* Add Bad Compare Column
    //************************************
    file CompareReport
    b
    f;1    // Skip Heading Row
    do-1
        Newline = /@line@,""/
        r:/@Newline@/
        scan:/@line/:/,"/
        HoldLeft = left
        HoldRight = right
        scan:/@right/:/,"/
        Value = left
        BadCompare = null
        do-2
            scan:/@right/:/,"/
            if  (found)
+               if  (left != Value)
+                   BadCompare = 'Difference'
+           endif
        until-2 (!found)
        Newline = '@HoldLeft@,@BadCompare@,"@HoldRight@'
        r:/@Newline@/
        f;1
    until-1 (eof)
!b2300_Rpm_Update_Compare_PBOBJ_write
    file CompareReport
    scan:/@Filename@/:/.xml/
    if (found) call !x600_fix_xml_names
    write CompareReport Rpm_Compare.csv error message = "Bad write to rpm_compare.csv, file already open?" window message warning yesno if (message) goto !b2300_Rpm_Update_Compare_PBOBJ_write
    close CompareReport

    Rpm_Progress_WIN = 'Opening Compare.CSV'
    window title Rpm_Progress_WIN
    ReenterFunction = '!b2300_Rpm_Update_Compare_PBOBJ_opencsv'
    window timer on 0
    return

!b2300_Rpm_Update_Compare_PBOBJ_opencsv
    call !p300_close_progress
    system:"start rpm_compare.csv"
    return

//****************************************
//* Remove Double Quotes from Value
//****************************************
!b2300_double_quotes
    do
        scan:/@Value/:/"/
        if (found) Value = '@left@@right@'
    until (!found)
    return

//******************************
//* Setup the Progress Window 
//* -initialize ProgressCount before calling
//******************************
!p100_open_progress
    window hwnd Rpm_Progress_WIN status error window open Rpm_Progress_WIN shade
    window center Rpm_Progress_WIN
    window windowpos Rpm_Progress_Progressframe_STTXT Progframex Progframey Progframecx Progframecy
    window windowpos Rpm_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    window size Rpm_Progress_Progressframe_STTXT Progx Progy Progcx Progcy
    ProgressMax = Progcx - 4

    if (ProgressCount) 
+      Progress = Progcx / ProgressCount
+   else
+      Progress = 1
+   endif    

    Progx += 2
    Progy += 2
    Progcx = 1
    Progcy -= 4
    window size Rpm_Progress_Progress_STTXT Progx Progy Progcx Progcy
    ProgressShow = Progcx
    window unshade Rpm_Progress_WIN

    return

//******************************
//* Show Progress
//******************************
!p200_show_progress
    ProgressWork = ProgressShow + Progress
    Progcx = ProgressWork
    if  (Progcx > ProgressMax) 
+       Progcx = ProgressMax
+   endif
    ProgressShow = ProgressWork
    window size Rpm_Progress_Progress_STTXT @Progx @Progy @Progcx @Progcy
    window size Rpm_Progress_Progressframe_STTXT @Progframex @Progframey @Progframecx @Progframecy
    //window modify Rpm_Progress_Progress_STTXT
    //window paint Rpm_Progress_Progress_STTXT
    //window modify Rpm_Progress_Progressframe_STTXT
    //window paint Rpm_Progress_Progressframe_STTXT
    //window paint Rpm_Progress_WIN
    return

//******************************
//* Close the Progress Window
//******************************
!p300_close_progress
    window close Rpm_Progress_WIN error
    return

//******************************
//* Parse a Property File that's
//* an XML file and convert all
//* tags into named pairs in the
//******************************
!x100_convert_xml
    string Xpath     error
    string Tag       error
    string TagDone   error
    string ValueDone error

    Xpath = null
   
    file PropertyFile error file PropertyFileValues b clear copy;* open PropertyFile null paste

    write PropertyFile RPM-data\fix1.dat
    fixfile RPM-data\fix1.dat RPM-data\fix2.dat
    open FixFile RPM-data\fix2.dat
    clear
    b
    copy;*
    close FixFile
    system:"del RPM-data\fix*.dat"
    open XMLFile null
    paste
    b rs:/@tab@/:/ /;*

    close TagFile error
    open TagFile null
    file XMLFile
    b
    do

        //************************************
        //* Check for Comments & Unwanted Tags
        //************************************
        if  (!eof)
+           scan:/@line/:/<!/
+           if  (found) call !x200_comments 
+       endif
        //************************************
        //* Find Tag Start
        //************************************
        if  (!eof)
+           scan:/@line/:/</
+           if (found)
+              call !x300_tag
+              if  (!TagDone)
+                  ValueDone = 'n'
+                  call !x400_values
+       endif
        //************************************
        //* Find Tag End
        //************************************
        if  (!eof)
+           scan:/@line/:'</'
+           if (found)
+              call !x500_tag_done
+       endif
        f;1
    until (eof)
    file TagFile
    clear
    b
    copy;*
    file PropertyFile
    b
    d;*
    paste
    close TagFile
    close XMLFile
    file PropertyFile
    return

//****************************************
//* Bypass Comments
//****************************************
!x200_comments
    Newline = right
    r:/@right@/
    fs:/->/
    if (!eof) 
+      scan:/@line/:/->/
+      Newline = right
+      r:/@Newline/
+   endif
    return

//****************************************
//* Start a Tag
//****************************************
!x300_tag
    scan:/@right/:word
    Tag = left
    r:/@right@/
    split:/@Tag@/;1
    if (left = '/')
+      TagDone = 'y'
+      scanr:/@Xpath@/:/</
+      Xpath = left
+      return
+   endif
    scan:/@Tag/:'/>'
    if  (found) return
    scan:/@Tag/:'</'
    if (found)
+      scan:/@Tag/:/>/
+      TagName = left
+      scan:/@right/:/</
+      TagValue = left
+      scan:/@right/:/>/
+      r:/@right@/
+      TagDone = 'y'
+      Newline = '@Xpath@:@TagName@=@TagValue@'
+      file TagFile
+      i:/@Newline@/
+      file XMLFile
+      return
+   endif
    scan:/@Tag/:/>/
    if (found)
+      Newline = '@right@@line@'
+      r:/@Newline@/
+      Xpath = '@Xpath@<@left@>'
+      TagDone = 'y'
+      return
+   endif
    if  (Tag = 'attribute')
+       call !x350_attribute
+       if  (TagDone)
+           return
+   endif
    TagDone = 'n'
    Xpath = '@Xpath@<@Tag@>'
    return

//****************************************
//* Handle XML Attributes
//****************************************
!x350_attribute
    TagDone = 'n'
    scan:/@line/:/"/
    if (!found) return
    scan:/@right/:/"/
    if (!found) return
    TagName = left
    scan:/@right/:/>/
    if (!found) return
    scan:/@right/:/</
    if (!found) return
    TagValue = left
    scan:/@right/:/>/
    r:/@right/
    Newline = '@Xpath@:@TagName@=@TagValue@'
    file TagFile
    i:/@Newline@/
    file XMLFile
    TagDone = 'y'
    return

//****************************************
//* Get the Tag Values
//****************************************
!x400_values
    if-1  (line = null) 
+       f;1
+       if-2 (eof)
+          return
+       else-2
+          scan:/@line/:/<!/
+          if-3  (found) 
+              call !x200_comments 
+              if-4 (eof)
+                 return
+       endif
+   endif
    scan:/@line/:word
    Tag = left
    r:/@right/
    scan:/@Tag/:'/>'
    if (found)
+      Tag = left
+      TagDone = 'y'
+   endif
    scan:/@Tag/:'?>'
    if (found)
+      Tag = left
+      TagDone = 'y'
+   endif
    scan:/@Tag/:/>/
    if (found)
+      Tag = left
+      r:/@right@/
+      ValueDone = 'y'
+   endif
    scan:/@Tag@/:'</'
    if (found)
+      TagDone = 'y'
+      goto !x400_value_tag_done
+   endif
    pack Tag
    splitr:/@Tag/;1
    if (right = ',') Tag = left
    if (Tag != null) 
+      Newline = '@Xpath@:@Tag@'
+      file TagFile
+      i:/@Newline@/
+   endif
    file XMLFile
!x400_value_tag_done
    if-1 (TagDone)
+      scanr:/@Xpath@/:/</
+      Xpath = left
+   else-1
+       if-2  (!ValueDone)
+           goto !x400_values
+   endif
    return

//****************************************
//* Tag is Closing
//****************************************
!x500_tag_done
    scan:/@right/:/>/
    r:/@right@/
    scanr:/@Xpath@/:/</
    Xpath = left
    return

//****************************************
//* Shrink the XML Names Xpath in 1st column
//****************************************
!x600_fix_xml_names
    b
    do
        f;1
        if (!eof)
+          scan:/@line/:/,/
+          TagName = left
+          HoldRight = right
+          scanr:/@TagName/:/>:/
+          TagName = right
+          scanr:/@left/:/</
+          TagName = '@right@:@TagName@'
+          Newline = '@TagName@,@HoldRight@'
+          r:/@Newline/
+       endif
    until (eof)
    b
    return

//****************************************
//* Shrink the XML Names Xpath in 1st column
//****************************************
!x700_fix_xml_names_short
    b
    do
        f;1
        if (!eof)
+          TagName = line
+          scanr:/@TagName/:/>:/
+          TagName = right
+          scanr:/@left/:/</
+          TagName = '@right@:@TagName@'
+          Newline = TagName
+          r:/@Newline/
+       endif
    until (eof)
    b
    return
 
//****************************************
//* Special return for Entry Field Actions
//****************************************
!z999_entryaction_return
    return
 
//*********************************************************************
//*    End of Program Rpm.BED
//*********************************************************************
